/*
	Base.js, version 1.1a
	Copyright 2006-2010, Dean Edwards
	License: http://www.opensource.org/licenses/mit-license.php
*/

/*!
 * jQuery JavaScript Library v1.7.1
 * http://jquery.com/
 *
 * Copyright 2011, John Resig
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 * Copyright 2011, The Dojo Foundation
 * Released under the MIT, BSD, and GPL Licenses.
 *
 * Date: Mon Nov 21 21:11:03 2011 -0500
 */

/*!
 * Sizzle CSS Selector Engine
 *  Copyright 2011, The Dojo Foundation
 *  Released under the MIT, BSD, and GPL Licenses.
 *  More information: http://sizzlejs.com/
 */

/*
 * TERMS OF USE - EASING EQUATIONS
 *
 * Open source under the BSD License.
 *
 * Copyright 2001 Robert Penner
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * - Redistributions of source code must retain the above copyright notice, this
 *   list of conditions and the following disclaimer.
 *
 * - Redistributions in binary form must reproduce the above copyright notice,
 *   this list of conditions and the following disclaimer in the documentation
 *   and/or other materials provided with the distribution.
 *
 * - Neither the name of the author nor the names of contributors may be used to
 *   endorse or promote products derived from this software without specific
 *   prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */

// tipsy, facebook style tooltips for jquery
// version 1.0.0a
// (c) 2008-2010 jason frame [jason@onehackoranother.com]
// releated under the MIT license

/*!
 * Protovis MSIE/VML addon
 * Copyright (C) 2011 by DataMarket <http://datamarket.com>
 * Dual licensed under the terms of the MIT or GPL Version 2 software licenses.
 * 
 * This software includes code from jQuery, http://jquery.com/
 * jQuery is licensed under the MIT or GPL Version 2 license.
 * 
 * This software includes code from the Protovis, http://mbostock.github.com/protovis/
 * Protovis is licensed under the BSD license.
 * 
 */

function sort(e,t){var n=this.dataTable.sort([{column:e,desc:t==pentaho.pda.Column.SORT_TYPES.DESCENDING}]);clearDataDisplay(),displayData()}function pentahoAction(e,t,n,r,i){var s=WEB_CONTEXT_BASE+"ViewAction",o="wrapper=false&solution="+e+"&path="+t+"&action="+n;if(r){var u;for(u=0;u<r.length;u++)o+="&"+encodeURIComponent(r[u][0])+"="+encodeURIComponent(r[u][1])}return pentahoPost(s,o,i)}function pentahoService(e,t,n,r){var i=WEB_CONTEXT_BASE+"ServiceAction",s="ajax=true&";e&&(s+="component="+e+"&");if(t){var o;for(o=0;o<t.length;o++)s+="&"+encodeURIComponent(t[o][0])+"="+encodeURIComponent(t[o][1])}return pentahoPost(i,s,n,r)}function pentahoGet(e,t,n,r,i){var s=undefined!=n&&null!=n,o=null,u="text/xml";r&&(u=r);if(window.XMLHttpRequest)o=new XMLHttpRequest,o.overrideMimeType&&o.overrideMimeType(u);else if(window.ActiveXObject)try{o=new ActiveXObject("Msxml2.XMLHTTP")}catch(a){try{o=new ActiveXObject("Microsoft.XMLHTTP")}catch(a){o=null}}if(!o)throw new Error("Cannot create an XMLHTTP instance");s&&(o.onreadystatechange=function(){pentahoResponse(o,n)});if(i!==!0){var f=(new Date).getTime();t=t+(t.length===0?"":"&")+f+"="+f}return o.open("GET",e+"?"+t,s),o.send(null),s?null:getResponse(o)}function getUnauthorizedMsg(){return"<web-service><unauthorized/></web-service>"}function getNotFoundMsg(){return"<web-service><not-found/></web-service>"}function pentahoPost(e,t,n,r){var i=undefined!=n&&null!=n,s=null,o="text/xml";r&&(o=r);if(window.XMLHttpRequest)s=new XMLHttpRequest,s.overrideMimeType&&s.overrideMimeType(o);else if(window.ActiveXObject)try{s=new ActiveXObject("Msxml2.XMLHTTP")}catch(u){try{s=new ActiveXObject("Microsoft.XMLHTTP")}catch(u){s=null}}if(!s)throw new Error("Cannot create XMLHTTP instance");return i&&(s.onreadystatechange=function(){pentahoResponse(s,n)}),s.open("POST",e,i),s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.setRequestHeader("Content-length",t.length),s.setRequestHeader("Connection","close"),s.send(t),i?null:getResponse(s)}function pentahoResponse(http_request,func){if(http_request.readyState==COMPLETE)try{var content=getResponse(http_request);if(typeof func=="function")func(content);else if(typeof func=="object"&&undefined!=func.obj)func.method.call(func.obj,content);else{if(typeof func!="string")throw new Error("Invalid state in pentahoResponse, unrecognized callback function.");eval(func+"( content );")}}catch(e){var msg=e.message;throw alert("pentaho-ajax.js.pentahoResponse(): "+e),e}}function getResponse(e){switch(e.status){case STATUS_OK:return e.responseText;case STATUS_UNAUTHORIZED:return getUnauthorizedMsg();case STATUS_NOT_FOUND:return getNotFoundMsg();default:return null}}var Base=function(){};Base.extend=function(e,t){var n=Base.prototype.extend;Base._prototyping=!0;var r=new this;n.call(r,e),r.base=function(){},delete Base._prototyping;var i=r.constructor,s=r.constructor=function(){if(!Base._prototyping)if(this._constructing||this.constructor==s)this._constructing=!0,i.apply(this,arguments),delete this._constructing;else if(arguments[0]!=null)return(arguments[0].extend||n).call(arguments[0],r)};return s.ancestor=this,s.extend=this.extend,s.forEach=this.forEach,s.implement=this.implement,s.prototype=r,s.toString=this.toString,s.valueOf=function(e){return e=="object"?s:i.valueOf()},n.call(s,t),typeof s.init=="function"&&s.init(),s},Base.prototype={extend:function(e,t){if(arguments.length>1){var n=this[e];if(n&&typeof t=="function"&&(!n.valueOf||n.valueOf()!=t.valueOf())&&/\bbase\b/.test(t)){var r=t.valueOf();t=function(){var e=this.base||Base.prototype.base;this.base=n;var t=r.apply(this,arguments);return this.base=e,t},t.valueOf=function(e){return e=="object"?t:r},t.toString=Base.toString}this[e]=t}else if(e){var i=Base.prototype.extend;!Base._prototyping&&typeof this!="function"&&(i=this.extend||i);var s={toSource:null},o=["constructor","toString","valueOf"],u=Base._prototyping?0:1;while(a=o[u++])e[a]!=s[a]&&i.call(this,a,e[a]);for(var a in e)s[a]||i.call(this,a,e[a])}return this}},Base=Base.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(e,t,n){for(var r in e)this.prototype[r]===undefined&&t.call(n,e[r],r,e)},implement:function(){for(var e=0;e<arguments.length;e++)typeof arguments[e]=="function"?arguments[e](this.prototype):this.prototype.extend(arguments[e]);return this},toString:function(){return String(this.valueOf())}}),pen.define("cdf/Base",[],function(){}),function(e,t){function u(e){var t=o[e]={},n,r;e=e.split(/\s+/);for(n=0,r=e.length;n<r;n++)t[e[n]]=!0;return t}function c(e,n,r){if(r===t&&e.nodeType===1){var i="data-"+n.replace(l,"-$1").toLowerCase();r=e.getAttribute(i);if(typeof r=="string"){try{r=r==="true"?!0:r==="false"?!1:r==="null"?null:s.isNumeric(r)?parseFloat(r):f.test(r)?s.parseJSON(r):r}catch(o){}s.data(e,n,r)}else r=t}return r}function h(e){for(var t in e){if(t==="data"&&s.isEmptyObject(e[t]))continue;if(t!=="toJSON")return!1}return!0}function p(e,t,n){var r=t+"defer",i=t+"queue",o=t+"mark",u=s._data(e,r);u&&(n==="queue"||!s._data(e,i))&&(n==="mark"||!s._data(e,o))&&setTimeout(function(){!s._data(e,i)&&!s._data(e,o)&&(s.removeData(e,r,!0),u.fire())},0)}function H(){return!1}function B(){return!0}function W(e){return!e||!e.parentNode||e.parentNode.nodeType===11}function X(e,t,n){t=t||0;if(s.isFunction(t))return s.grep(e,function(e,r){var i=!!t.call(e,r,e);return i===n});if(t.nodeType)return s.grep(e,function(e,r){return e===t===n});if(typeof t=="string"){var r=s.grep(e,function(e){return e.nodeType===1});if(q.test(t))return s.filter(t,r,!n);t=s.filter(t,r)}return s.grep(e,function(e,r){return s.inArray(e,t)>=0===n})}function V(e){var t=$.split("|"),n=e.createDocumentFragment();if(n.createElement)while(t.length)n.createElement(t.pop());return n}function at(e,t){return s.nodeName(e,"table")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function ft(e,t){if(t.nodeType!==1||!s.hasData(e))return;var n,r,i,o=s._data(e),u=s._data(t,o),a=o.events;if(a){delete u.handle,u.events={};for(n in a)for(r=0,i=a[n].length;r<i;r++)s.event.add(t,n+(a[n][r].namespace?".":"")+a[n][r].namespace,a[n][r],a[n][r].data)}u.data&&(u.data=s.extend({},u.data))}function lt(e,t){var n;if(t.nodeType!==1)return;t.clearAttributes&&t.clearAttributes(),t.mergeAttributes&&t.mergeAttributes(e),n=t.nodeName.toLowerCase();if(n==="object")t.outerHTML=e.outerHTML;else if(n!=="input"||e.type!=="checkbox"&&e.type!=="radio"){if(n==="option")t.selected=e.defaultSelected;else if(n==="input"||n==="textarea")t.defaultValue=e.defaultValue}else e.checked&&(t.defaultChecked=t.checked=e.checked),t.value!==e.value&&(t.value=e.value);t.removeAttribute(s.expando)}function ct(e){return typeof e.getElementsByTagName!="undefined"?e.getElementsByTagName("*"):typeof e.querySelectorAll!="undefined"?e.querySelectorAll("*"):[]}function ht(e){if(e.type==="checkbox"||e.type==="radio")e.defaultChecked=e.checked}function pt(e){var t=(e.nodeName||"").toLowerCase();t==="input"?ht(e):t!=="script"&&typeof e.getElementsByTagName!="undefined"&&s.grep(e.getElementsByTagName("input"),ht)}function dt(e){var t=n.createElement("div");return ut.appendChild(t),t.innerHTML=e.outerHTML,t.firstChild}function vt(e,t){t.src?s.ajax({url:t.src,async:!1,dataType:"script"}):s.globalEval((t.text||t.textContent||t.innerHTML||"").replace(st,"/*$0*/")),t.parentNode&&t.parentNode.removeChild(t)}function Lt(e,t,n){var r=t==="width"?e.offsetWidth:e.offsetHeight,i=t==="width"?xt:Tt,o=0,u=i.length;if(r>0){if(n!=="border")for(;o<u;o++)n||(r-=parseFloat(s.css(e,"padding"+i[o]))||0),n==="margin"?r+=parseFloat(s.css(e,n+i[o]))||0:r-=parseFloat(s.css(e,"border"+i[o]+"Width"))||0;return r+"px"}r=Nt(e,t,t);if(r<0||r==null)r=e.style[t]||0;r=parseFloat(r)||0;if(n)for(;o<u;o++)r+=parseFloat(s.css(e,"padding"+i[o]))||0,n!=="padding"&&(r+=parseFloat(s.css(e,"border"+i[o]+"Width"))||0),n==="margin"&&(r+=parseFloat(s.css(e,n+i[o]))||0);return r+"px"}function Gt(e){return function(t,n){typeof t!="string"&&(n=t,t="*");if(s.isFunction(n)){var r=t.toLowerCase().split(Rt),i=0,o=r.length,u,a,f;for(;i<o;i++)u=r[i],f=/^\+/.test(u),f&&(u=u.substr(1)||"*"),a=e[u]=e[u]||[],a[f?"unshift":"push"](n)}}}function Yt(e,n,r,i,s,o){s=s||n.dataTypes[0],o=o||{},o[s]=!0;var u=e[s],a=0,f=u?u.length:0,l=e===Xt,c;for(;a<f&&(l||!c);a++)c=u[a](n,r,i),typeof c=="string"&&(!l||o[c]?c=t:(n.dataTypes.unshift(c),c=Yt(e,n,r,i,c,o)));return(l||!c)&&!o["*"]&&(c=Yt(e,n,r,i,"*",o)),c}function Zt(e,n){var r,i,o=s.ajaxSettings.flatOptions||{};for(r in n)n[r]!==t&&((o[r]?e:i||(i={}))[r]=n[r]);i&&s.extend(!0,e,i)}function en(e,t,n,r){if(s.isArray(t))s.each(t,function(t,i){n||Ot.test(e)?r(e,i):en(e+"["+(typeof i=="object"||s.isArray(i)?t:"")+"]",i,n,r)});else if(!n&&t!=null&&typeof t=="object")for(var i in t)en(e+"["+i+"]",t[i],n,r);else r(e,t)}function tn(e,n,r){var i=e.contents,s=e.dataTypes,o=e.responseFields,u,a,f,l;for(a in o)a in r&&(n[o[a]]=r[a]);while(s[0]==="*")s.shift(),u===t&&(u=e.mimeType||n.getResponseHeader("content-type"));if(u)for(a in i)if(i[a]&&i[a].test(u)){s.unshift(a);break}if(s[0]in r)f=s[0];else{for(a in r){if(!s[0]||e.converters[a+" "+s[0]]){f=a;break}l||(l=a)}f=f||l}if(f)return f!==s[0]&&s.unshift(f),r[f]}function nn(e,n){e.dataFilter&&(n=e.dataFilter(n,e.dataType));var r=e.dataTypes,i={},o,u,a=r.length,f,l=r[0],c,h,p,d,v;for(o=1;o<a;o++){if(o===1)for(u in e.converters)typeof u=="string"&&(i[u.toLowerCase()]=e.converters[u]);c=l,l=r[o];if(l==="*")l=c;else if(c!=="*"&&c!==l){h=c+" "+l,p=i[h]||i["* "+l];if(!p){v=t;for(d in i){f=d.split(" ");if(f[0]===c||f[0]==="*"){v=i[f[1]+" "+l];if(v){d=i[d],d===!0?p=v:v===!0&&(p=d);break}}}}!p&&!v&&s.error("No conversion from "+h.replace(" "," to ")),p!==!0&&(n=p?p(n):v(d(n)))}}return n}function fn(){try{return new e.XMLHttpRequest}catch(t){}}function ln(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function bn(){return setTimeout(wn,0),yn=s.now()}function wn(){yn=t}function En(e,t){var n={};return s.each(gn.concat.apply([],gn.slice(0,t)),function(){n[this]=e}),n}function Sn(e){if(!cn[e]){var t=n.body,r=s("<"+e+">").appendTo(t),i=r.css("display");r.remove();if(i==="none"||i===""){hn||(hn=n.createElement("iframe"),hn.frameBorder=hn.width=hn.height=0),t.appendChild(hn);if(!pn||!hn.createElement)pn=(hn.contentWindow||hn.contentDocument).document,pn.write((n.compatMode==="CSS1Compat"?"<!doctype html>":"")+"<html><body>"),pn.close();r=pn.createElement(e),pn.body.appendChild(r),i=s.css(r,"display"),t.removeChild(hn)}cn[e]=i}return cn[e]}function Nn(e){return s.isWindow(e)?e:e.nodeType===9?e.defaultView||e.parentWindow:!1}var n=e.document,r=e.navigator,i=e.location,s=function(){function H(){if(i.isReady)return;try{n.documentElement.doScroll("left")}catch(e){setTimeout(H,1);return}i.ready()}var i=function(e,t){return new i.fn.init(e,t,u)},s=e.jQuery,o=e.$,u,a=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,f=/\S/,l=/^\s+/,c=/\s+$/,h=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,p=/^[\],:{}\s]*$/,d=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,v=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,m=/(?:^|:|,)(?:\s*\[)+/g,g=/(webkit)[ \/]([\w.]+)/,y=/(opera)(?:.*version)?[ \/]([\w.]+)/,b=/(msie) ([\w.]+)/,w=/(mozilla)(?:.*? rv:([\w.]+))?/,E=/-([a-z]|[0-9])/ig,S=/^-ms-/,x=function(e,t){return(t+"").toUpperCase()},T=r.userAgent,N,C,k,L=Object.prototype.toString,A=Object.prototype.hasOwnProperty,O=Array.prototype.push,M=Array.prototype.slice,_=String.prototype.trim,D=Array.prototype.indexOf,P={};return i.fn=i.prototype={constructor:i,init:function(e,r,s){var o,u,f,l;if(!e)return this;if(e.nodeType)return this.context=this[0]=e,this.length=1,this;if(e==="body"&&!r&&n.body)return this.context=n,this[0]=n.body,this.selector=e,this.length=1,this;if(typeof e=="string"){e.charAt(0)==="<"&&e.charAt(e.length-1)===">"&&e.length>=3?o=[null,e,null]:o=a.exec(e);if(o&&(o[1]||!r)){if(o[1])return r=r instanceof i?r[0]:r,l=r?r.ownerDocument||r:n,f=h.exec(e),f?i.isPlainObject(r)?(e=[n.createElement(f[1])],i.fn.attr.call(e,r,!0)):e=[l.createElement(f[1])]:(f=i.buildFragment([o[1]],[l]),e=(f.cacheable?i.clone(f.fragment):f.fragment).childNodes),i.merge(this,e);u=n.getElementById(o[2]);if(u&&u.parentNode){if(u.id!==o[2])return s.find(e);this.length=1,this[0]=u}return this.context=n,this.selector=e,this}return!r||r.jquery?(r||s).find(e):this.constructor(r).find(e)}return i.isFunction(e)?s.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),i.makeArray(e,this))},selector:"",jquery:"1.7.1",length:0,size:function(){return this.length},toArray:function(){return M.call(this,0)},get:function(e){return e==null?this.toArray():e<0?this[this.length+e]:this[e]},pushStack:function(e,t,n){var r=this.constructor();return i.isArray(e)?O.apply(r,e):i.merge(r,e),r.prevObject=this,r.context=this.context,t==="find"?r.selector=this.selector+(this.selector?" ":"")+n:t&&(r.selector=this.selector+"."+t+"("+n+")"),r},each:function(e,t){return i.each(this,e,t)},ready:function(e){return i.bindReady(),C.add(e),this},eq:function(e){return e=+e,e===-1?this.slice(e):this.slice(e,e+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(M.apply(this,arguments),"slice",M.call(arguments).join(","))},map:function(e){return this.pushStack(i.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:O,sort:[].sort,splice:[].splice},i.fn.init.prototype=i.fn,i.extend=i.fn.extend=function(){var e,n,r,s,o,u,a=arguments[0]||{},f=1,l=arguments.length,c=!1;typeof a=="boolean"&&(c=a,a=arguments[1]||{},f=2),typeof a!="object"&&!i.isFunction(a)&&(a={}),l===f&&(a=this,--f);for(;f<l;f++)if((e=arguments[f])!=null)for(n in e){r=a[n],s=e[n];if(a===s)continue;c&&s&&(i.isPlainObject(s)||(o=i.isArray(s)))?(o?(o=!1,u=r&&i.isArray(r)?r:[]):u=r&&i.isPlainObject(r)?r:{},a[n]=i.extend(c,u,s)):s!==t&&(a[n]=s)}return a},i.extend({noConflict:function(t){return e.$===i&&(e.$=o),t&&e.jQuery===i&&(e.jQuery=s),i},isReady:!1,readyWait:1,holdReady:function(e){e?i.readyWait++:i.ready(!0)},ready:function(e){if(e===!0&&!--i.readyWait||e!==!0&&!i.isReady){if(!n.body)return setTimeout(i.ready,1);i.isReady=!0;if(e!==!0&&--i.readyWait>0)return;C.fireWith(n,[i]),i.fn.trigger&&i(n).trigger("ready").off("ready")}},bindReady:function(){if(C)return;C=i.Callbacks("once memory");if(n.readyState==="complete")return setTimeout(i.ready,1);if(n.addEventListener)n.addEventListener("DOMContentLoaded",k,!1),e.addEventListener("load",i.ready,!1);else if(n.attachEvent){n.attachEvent("onreadystatechange",k),e.attachEvent("onload",i.ready);var t=!1;try{t=e.frameElement==null}catch(r){}n.documentElement.doScroll&&t&&H()}},isFunction:function(e){return i.type(e)==="function"},isArray:Array.isArray||function(e){return i.type(e)==="array"},isWindow:function(e){return e&&typeof e=="object"&&"setInterval"in e},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return e==null?String(e):P[L.call(e)]||"object"},isPlainObject:function(e){if(!e||i.type(e)!=="object"||e.nodeType||i.isWindow(e))return!1;try{if(e.constructor&&!A.call(e,"constructor")&&!A.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(n){return!1}var r;for(r in e);return r===t||A.call(e,r)},isEmptyObject:function(e){for(var t in e)return!1;return!0},error:function(e){throw new Error(e)},parseJSON:function(t){if(typeof t!="string"||!t)return null;t=i.trim(t);if(e.JSON&&e.JSON.parse)return e.JSON.parse(t);if(p.test(t.replace(d,"@").replace(v,"]").replace(m,"")))return(new Function("return "+t))();i.error("Invalid JSON: "+t)},parseXML:function(n){var r,s;try{e.DOMParser?(s=new DOMParser,r=s.parseFromString(n,"text/xml")):(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(n))}catch(o){r=t}return(!r||!r.documentElement||r.getElementsByTagName("parsererror").length)&&i.error("Invalid XML: "+n),r},noop:function(){},globalEval:function(t){t&&f.test(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(S,"ms-").replace(E,x)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toUpperCase()===t.toUpperCase()},each:function(e,n,r){var s,o=0,u=e.length,a=u===t||i.isFunction(e);if(r){if(a){for(s in e)if(n.apply(e[s],r)===!1)break}else for(;o<u;)if(n.apply(e[o++],r)===!1)break}else if(a){for(s in e)if(n.call(e[s],s,e[s])===!1)break}else for(;o<u;)if(n.call(e[o],o,e[o++])===!1)break;return e},trim:_?function(e){return e==null?"":_.call(e)}:function(e){return e==null?"":e.toString().replace(l,"").replace(c,"")},makeArray:function(e,t){var n=t||[];if(e!=null){var r=i.type(e);e.length==null||r==="string"||r==="function"||r==="regexp"||i.isWindow(e)?O.call(n,e):i.merge(n,e)}return n},inArray:function(e,t,n){var r;if(t){if(D)return D.call(t,e,n);r=t.length,n=n?n<0?Math.max(0,r+n):n:0;for(;n<r;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,n){var r=e.length,i=0;if(typeof n.length=="number")for(var s=n.length;i<s;i++)e[r++]=n[i];else while(n[i]!==t)e[r++]=n[i++];return e.length=r,e},grep:function(e,t,n){var r=[],i;n=!!n;for(var s=0,o=e.length;s<o;s++)i=!!t(e[s],s),n!==i&&r.push(e[s]);return r},map:function(e,n,r){var s,o,u=[],a=0,f=e.length,l=e instanceof i||f!==t&&typeof f=="number"&&(f>0&&e[0]&&e[f-1]||f===0||i.isArray(e));if(l)for(;a<f;a++)s=n(e[a],a,r),s!=null&&(u[u.length]=s);else for(o in e)s=n(e[o],o,r),s!=null&&(u[u.length]=s);return u.concat.apply([],u)},guid:1,proxy:function(e,n){if(typeof n=="string"){var r=e[n];n=e,e=r}if(!i.isFunction(e))return t;var s=M.call(arguments,2),o=function(){return e.apply(n,s.concat(M.call(arguments)))};return o.guid=e.guid=e.guid||o.guid||i.guid++,o},access:function(e,n,r,s,o,u){var a=e.length;if(typeof n=="object"){for(var f in n)i.access(e,f,n[f],s,o,r);return e}if(r!==t){s=!u&&s&&i.isFunction(r);for(var l=0;l<a;l++)o(e[l],n,s?r.call(e[l],l,o(e[l],n)):r,u);return e}return a?o(e[0],n):t},now:function(){return(new Date).getTime()},uaMatch:function(e){e=e.toLowerCase();var t=g.exec(e)||y.exec(e)||b.exec(e)||e.indexOf("compatible")<0&&w.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},sub:function(){function e(t,n){return new e.fn.init(t,n)}i.extend(!0,e,this),e.superclass=this,e.fn=e.prototype=this(),e.fn.constructor=e,e.sub=this.sub,e.fn.init=function(r,s){return s&&s instanceof i&&!(s instanceof e)&&(s=e(s)),i.fn.init.call(this,r,s,t)},e.fn.init.prototype=e.fn;var t=e(n);return e},browser:{}}),i.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(e,t){P["[object "+t+"]"]=t.toLowerCase()}),N=i.uaMatch(T),N.browser&&(i.browser[N.browser]=!0,i.browser.version=N.version),i.browser.webkit&&(i.browser.safari=!0),f.test(" ")&&(l=/^[\s\xA0]+/,c=/[\s\xA0]+$/),u=i(n),n.addEventListener?k=function(){n.removeEventListener("DOMContentLoaded",k,!1),i.ready()}:n.attachEvent&&(k=function(){n.readyState==="complete"&&(n.detachEvent("onreadystatechange",k),i.ready())}),i}(),o={};s.Callbacks=function(e){e=e?o[e]||u(e):{};var n=[],r=[],i,a,f,l,c,h=function(t){var r,i,o,u,a;for(r=0,i=t.length;r<i;r++)o=t[r],u=s.type(o),u==="array"?h(o):u==="function"&&(!e.unique||!d.has(o))&&n.push(o)},p=function(t,s){s=s||[],i=!e.memory||[t,s],a=!0,c=f||0,f=0,l=n.length;for(;n&&c<l;c++)if(n[c].apply(t,s)===!1&&e.stopOnFalse){i=!0;break}a=!1,n&&(e.once?i===!0?d.disable():n=[]:r&&r.length&&(i=r.shift(),d.fireWith(i[0],i[1])))},d={add:function(){if(n){var e=n.length;h(arguments),a?l=n.length:i&&i!==!0&&(f=e,p(i[0],i[1]))}return this},remove:function(){if(n){var t=arguments,r=0,i=t.length;for(;r<i;r++)for(var s=0;s<n.length;s++)if(t[r]===n[s]){a&&s<=l&&(l--,s<=c&&c--),n.splice(s--,1);if(e.unique)break}}return this},has:function(e){if(n){var t=0,r=n.length;for(;t<r;t++)if(e===n[t])return!0}return!1},empty:function(){return n=[],this},disable:function(){return n=r=i=t,this},disabled:function(){return!n},lock:function(){return r=t,(!i||i===!0)&&d.disable(),this},locked:function(){return!r},fireWith:function(t,n){return r&&(a?e.once||r.push([t,n]):(!e.once||!i)&&p(t,n)),this},fire:function(){return d.fireWith(this,arguments),this},fired:function(){return!!i}};return d};var a=[].slice;s.extend({Deferred:function(e){var t=s.Callbacks("once memory"),n=s.Callbacks("once memory"),r=s.Callbacks("memory"),i="pending",o={resolve:t,reject:n,notify:r},u={done:t.add,fail:n.add,progress:r.add,state:function(){return i},isResolved:t.fired,isRejected:n.fired,then:function(e,t,n){return a.done(e).fail(t).progress(n),this},always:function(){return a.done.apply(a,arguments).fail.apply(a,arguments),this},pipe:function(e,t,n){return s.Deferred(function(r){s.each({done:[e,"resolve"],fail:[t,"reject"],progress:[n,"notify"]},function(e,t){var n=t[0],i=t[1],o;s.isFunction(n)?a[e](function(){o=n.apply(this,arguments),o&&s.isFunction(o.promise)?o.promise().then(r.resolve,r.reject,r.notify):r[i+"With"](this===a?r:this,[o])}):a[e](r[i])})}).promise()},promise:function(e){if(e==null)e=u;else for(var t in u)e[t]=u[t];return e}},a=u.promise({}),f;for(f in o)a[f]=o[f].fire,a[f+"With"]=o[f].fireWith;return a.done(function(){i="resolved"},n.disable,r.lock).fail(function(){i="rejected"},t.disable,r.lock),e&&e.call(a,a),a},when:function(e){function c(e){return function(n){t[e]=arguments.length>1?a.call(arguments,0):n,--o||f.resolveWith(f,t)}}function h(e){return function(t){i[e]=arguments.length>1?a.call(arguments,0):t,f.notifyWith(l,i)}}var t=a.call(arguments,0),n=0,r=t.length,i=new Array(r),o=r,u=r,f=r<=1&&e&&s.isFunction(e.promise)?e:s.Deferred(),l=f.promise();if(r>1){for(;n<r;n++)t[n]&&t[n].promise&&s.isFunction(t[n].promise)?t[n].promise().then(c(n),f.reject,h(n)):--o;o||f.resolveWith(f,t)}else f!==e&&f.resolveWith(f,r?[e]:[]);return l}}),s.support=function(){var t,r,i,o,u,a,f,l,c,h,p,d,v,m=n.createElement("div"),g=n.documentElement;m.setAttribute("className","t"),m.innerHTML="   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/>",r=m.getElementsByTagName("*"),i=m.getElementsByTagName("a")[0];if(!r||!r.length||!i)return{};o=n.createElement("select"),u=o.appendChild(n.createElement("option")),a=m.getElementsByTagName("input")[0],t={leadingWhitespace:m.firstChild.nodeType===3,tbody:!m.getElementsByTagName("tbody").length,htmlSerialize:!!m.getElementsByTagName("link").length,style:/top/.test(i.getAttribute("style")),hrefNormalized:i.getAttribute("href")==="/a",opacity:/^0.55/.test(i.style.opacity),cssFloat:!!i.style.cssFloat,checkOn:a.value==="on",optSelected:u.selected,getSetAttribute:m.className!=="t",enctype:!!n.createElement("form").enctype,html5Clone:n.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>",submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0},a.checked=!0,t.noCloneChecked=a.cloneNode(!0).checked,o.disabled=!0,t.optDisabled=!u.disabled;try{delete m.test}catch(y){t.deleteExpando=!1}!m.addEventListener&&m.attachEvent&&m.fireEvent&&(m.attachEvent("onclick",function(){t.noCloneEvent=!1}),m.cloneNode(!0).fireEvent("onclick")),a=n.createElement("input"),a.value="t",a.setAttribute("type","radio"),t.radioValue=a.value==="t",a.setAttribute("checked","checked"),m.appendChild(a),l=n.createDocumentFragment(),l.appendChild(m.lastChild),t.checkClone=l.cloneNode(!0).cloneNode(!0).lastChild.checked,t.appendChecked=a.checked,l.removeChild(a),l.appendChild(m),m.innerHTML="",e.getComputedStyle&&(f=n.createElement("div"),f.style.width="0",f.style.marginRight="0",m.style.width="2px",m.appendChild(f),t.reliableMarginRight=(parseInt((e.getComputedStyle(f,null)||{marginRight:0}).marginRight,10)||0)===0);if(m.attachEvent)for(d in{submit:1,change:1,focusin:1})p="on"+d,v=p in m,v||(m.setAttribute(p,"return;"),v=typeof m[p]=="function"),t[d+"Bubbles"]=v;return l.removeChild(m),l=o=u=f=m=a=null,s(function(){var e,r,i,o,u,a,f,l,h,p,d,g=n.getElementsByTagName("body")[0];if(!g)return;f=1,l="position:absolute;top:0;left:0;width:1px;height:1px;margin:0;",h="visibility:hidden;border:0;",p="style='"+l+"border:5px solid #000;padding:0;'",d="<div "+p+"><div></div></div>"+"<table "+p+" cellpadding='0' cellspacing='0'>"+"<tr><td></td></tr></table>",e=n.createElement("div"),e.style.cssText=h+"width:0;height:0;position:static;top:0;margin-top:"+f+"px",g.insertBefore(e,g.firstChild),m=n.createElement("div"),e.appendChild(m),m.innerHTML="<table><tr><td style='padding:0;border:0;display:none'></td><td>t</td></tr></table>",c=m.getElementsByTagName("td"),v=c[0].offsetHeight===0,c[0].style.display="",c[1].style.display="none",t.reliableHiddenOffsets=v&&c[0].offsetHeight===0,m.innerHTML="",m.style.width=m.style.paddingLeft="1px",s.boxModel=t.boxModel=m.offsetWidth===2,typeof m.style.zoom!="undefined"&&(m.style.display="inline",m.style.zoom=1,t.inlineBlockNeedsLayout=m.offsetWidth===2,m.style.display="",m.innerHTML="<div style='width:4px;'></div>",t.shrinkWrapBlocks=m.offsetWidth!==2),m.style.cssText=l+h,m.innerHTML=d,r=m.firstChild,i=r.firstChild,u=r.nextSibling.firstChild.firstChild,a={doesNotAddBorder:i.offsetTop!==5,doesAddBorderForTableAndCells:u.offsetTop===5},i.style.position="fixed",i.style.top="20px",a.fixedPosition=i.offsetTop===20||i.offsetTop===15,i.style.position=i.style.top="",r.style.overflow="hidden",r.style.position="relative",a.subtractsBorderForOverflowNotVisible=i.offsetTop===-5,a.doesNotIncludeMarginInBodyOffset=g.offsetTop!==f,g.removeChild(e),m=e=null,s.extend(t,a)}),t}();var f=/^(?:\{.*\}|\[.*\])$/,l=/([A-Z])/g;s.extend({cache:{},uuid:0,expando:"jQuery"+(s.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(e){return e=e.nodeType?s.cache[e[s.expando]]:e[s.expando],!!e&&!h(e)},data:function(e,n,r,i){if(!s.acceptData(e))return;var o,u,a,f=s.expando,l=typeof n=="string",c=e.nodeType,h=c?s.cache:e,p=c?e[f]:e[f]&&f,d=n==="events";if((!p||!h[p]||!d&&!i&&!h[p].data)&&l&&r===t)return;p||(c?e[f]=p=++s.uuid:p=f),h[p]||(h[p]={},c||(h[p].toJSON=s.noop));if(typeof n=="object"||typeof n=="function")i?h[p]=s.extend(h[p],n):h[p].data=s.extend(h[p].data,n);return o=u=h[p],i||(u.data||(u.data={}),u=u.data),r!==t&&(u[s.camelCase(n)]=r),d&&!u[n]?o.events:(l?(a=u[n],a==null&&(a=u[s.camelCase(n)])):a=u,a)},removeData:function(e,t,n){if(!s.acceptData(e))return;var r,i,o,u=s.expando,a=e.nodeType,f=a?s.cache:e,l=a?e[u]:u;if(!f[l])return;if(t){r=n?f[l]:f[l].data;if(r){s.isArray(t)||(t in r?t=[t]:(t=s.camelCase(t),t in r?t=[t]:t=t.split(" ")));for(i=0,o=t.length;i<o;i++)delete r[t[i]];if(!(n?h:s.isEmptyObject)(r))return}}if(!n){delete f[l].data;if(!h(f[l]))return}s.support.deleteExpando||!f.setInterval?delete f[l]:f[l]=null,a&&(s.support.deleteExpando?delete e[u]:e.removeAttribute?e.removeAttribute(u):e[u]=null)},_data:function(e,t,n){return s.data(e,t,n,!0)},acceptData:function(e){if(e.nodeName){var t=s.noData[e.nodeName.toLowerCase()];if(t)return t!==!0&&e.getAttribute("classid")===t}return!0}}),s.fn.extend({data:function(e,n){var r,i,o,u=null;if(typeof e=="undefined"){if(this.length){u=s.data(this[0]);if(this[0].nodeType===1&&!s._data(this[0],"parsedAttrs")){i=this[0].attributes;for(var a=0,f=i.length;a<f;a++)o=i[a].name,o.indexOf("data-")===0&&(o=s.camelCase(o.substring(5)),c(this[0],o,u[o]));s._data(this[0],"parsedAttrs",!0)}}return u}return typeof e=="object"?this.each(function(){s.data(this,e)}):(r=e.split("."),r[1]=r[1]?"."+r[1]:"",n===t?(u=this.triggerHandler("getData"+r[1]+"!",[r[0]]),u===t&&this.length&&(u=s.data(this[0],e),u=c(this[0],e,u)),u===t&&r[1]?this.data(r[0]):u):this.each(function(){var t=s(this),i=[r[0],n];t.triggerHandler("setData"+r[1]+"!",i),s.data(this,e,n),t.triggerHandler("changeData"+r[1]+"!",i)}))},removeData:function(e){return this.each(function(){s.removeData(this,e)})}}),s.extend({_mark:function(e,t){e&&(t=(t||"fx")+"mark",s._data(e,t,(s._data(e,t)||0)+1))},_unmark:function(e,t,n){e!==!0&&(n=t,t=e,e=!1);if(t){n=n||"fx";var r=n+"mark",i=e?0:(s._data(t,r)||1)-1;i?s._data(t,r,i):(s.removeData(t,r,!0),p(t,n,"mark"))}},queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=s._data(e,t),n&&(!r||s.isArray(n)?r=s._data(e,t,s.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=s.queue(e,t),r=n.shift(),i={};r==="inprogress"&&(r=n.shift()),r&&(t==="fx"&&n.unshift("inprogress"),s._data(e,t+".run",i),r.call(e,function(){s.dequeue(e,t)},i)),n.length||(s.removeData(e,t+"queue "+t+".run",!0),p(e,t,"queue"))}}),s.fn.extend({queue:function(e,n){return typeof e!="string"&&(n=e,e="fx"),n===t?s.queue(this[0],e):this.each(function(){var t=s.queue(this,e,n);e==="fx"&&t[0]!=="inprogress"&&s.dequeue(this,e)})},dequeue:function(e){return this.each(function(){s.dequeue(this,e)})},delay:function(e,t){return e=s.fx?s.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,n){function h(){--u||r.resolveWith(i,[i])}typeof e!="string"&&(n=e,e=t),e=e||"fx";var r=s.Deferred(),i=this,o=i.length,u=1,a=e+"defer",f=e+"queue",l=e+"mark",c;while(o--)if(c=s.data(i[o],a,t,!0)||(s.data(i[o],f,t,!0)||s.data(i[o],l,t,!0))&&s.data(i[o],a,s.Callbacks("once memory"),!0))u++,c.add(h);return h(),r.promise()}});var d=/[\n\t\r]/g,v=/\s+/,m=/\r/g,g=/^(?:button|input)$/i,y=/^(?:button|input|object|select|textarea)$/i,b=/^a(?:rea)?$/i,w=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,E=s.support.getSetAttribute,S,x,T;s.fn.extend({attr:function(e,t){return s.access(this,e,t,!0,s.attr)},removeAttr:function(e){return this.each(function(){s.removeAttr(this,e)})},prop:function(e,t){return s.access(this,e,t,!0,s.prop)},removeProp:function(e){return e=s.propFix[e]||e,this.each(function(){try{this[e]=t,delete this[e]}catch(n){}})},addClass:function(e){var t,n,r,i,o,u,a;if(s.isFunction(e))return this.each(function(t){s(this).addClass(e.call(this,t,this.className))});if(e&&typeof e=="string"){t=e.split(v);for(n=0,r=this.length;n<r;n++){i=this[n];if(i.nodeType===1)if(!i.className&&t.length===1)i.className=e;else{o=" "+i.className+" ";for(u=0,a=t.length;u<a;u++)~o.indexOf(" "+t[u]+" ")||(o+=t[u]+" ");i.className=s.trim(o)}}}return this},removeClass:function(e){var n,r,i,o,u,a,f;if(s.isFunction(e))return this.each(function(t){s(this).removeClass(e.call(this,t,this.className))});if(e&&typeof e=="string"||e===t){n=(e||"").split(v);for(r=0,i=this.length;r<i;r++){o=this[r];if(o.nodeType===1&&o.className)if(e){u=(" "+o.className+" ").replace(d," ");for(a=0,f=n.length;a<f;a++)u=u.replace(" "+n[a]+" "," ");o.className=s.trim(u)}else o.className=""}}return this},toggleClass:function(e,t){var n=typeof e,r=typeof t=="boolean";return s.isFunction(e)?this.each(function(n){s(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if(n==="string"){var i,o=0,u=s(this),a=t,f=e.split(v);while(i=f[o++])a=r?a:!u.hasClass(i),u[a?"addClass":"removeClass"](i)}else if(n==="undefined"||n==="boolean")this.className&&s._data(this,"__className__",this.className),this.className=this.className||e===!1?"":s._data(this,"__className__")||""})},hasClass:function(e){var t=" "+e+" ",n=0,r=this.length;for(;n<r;n++)if(this[n].nodeType===1&&(" "+this[n].className+" ").replace(d," ").indexOf(t)>-1)return!0;return!1},val:function(e){var n,r,i,o=this[0];if(!arguments.length){if(o)return n=s.valHooks[o.nodeName.toLowerCase()]||s.valHooks[o.type],n&&"get"in n&&(r=n.get(o,"value"))!==t?r:(r=o.value,typeof r=="string"?r.replace(m,""):r==null?"":r);return}return i=s.isFunction(e),this.each(function(r){var o=s(this),u;if(this.nodeType!==1)return;i?u=e.call(this,r,o.val()):u=e,u==null?u="":typeof u=="number"?u+="":s.isArray(u)&&(u=s.map(u,function(e){return e==null?"":e+""})),n=s.valHooks[this.nodeName.toLowerCase()]||s.valHooks[this.type];if(!n||!("set"in n)||n.set(this,u,"value")===t)this.value=u})}}),s.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){var t,n,r,i,o=e.selectedIndex,u=[],a=e.options,f=e.type==="select-one";if(o<0)return null;n=f?o:0,r=f?o+1:a.length;for(;n<r;n++){i=a[n];if(i.selected&&(s.support.optDisabled?!i.disabled:i.getAttribute("disabled")===null)&&(!i.parentNode.disabled||!s.nodeName(i.parentNode,"optgroup"))){t=s(i).val();if(f)return t;u.push(t)}}return f&&!u.length&&a.length?s(a[o]).val():u},set:function(e,t){var n=s.makeArray(t);return s(e).find("option").each(function(){this.selected=s.inArray(s(this).val(),n)>=0}),n.length||(e.selectedIndex=-1),n}}},attrFn:{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0},attr:function(e,n,r,i){var o,u,a,f=e.nodeType;if(!e||f===3||f===8||f===2)return;if(i&&n in s.attrFn)return s(e)[n](r);if(typeof e.getAttribute=="undefined")return s.prop(e,n,r);a=f!==1||!s.isXMLDoc(e),a&&(n=n.toLowerCase(),u=s.attrHooks[n]||(w.test(n)?x:S));if(r!==t){if(r===null){s.removeAttr(e,n);return}return u&&"set"in u&&a&&(o=u.set(e,r,n))!==t?o:(e.setAttribute(n,""+r),r)}return u&&"get"in u&&a&&(o=u.get(e,n))!==null?o:(o=e.getAttribute(n),o===null?t:o)},removeAttr:function(e,t){var n,r,i,o,u=0;if(t&&e.nodeType===1){r=t.toLowerCase().split(v),o=r.length;for(;u<o;u++)i=r[u],i&&(n=s.propFix[i]||i,s.attr(e,i,""),e.removeAttribute(E?i:n),w.test(i)&&n in e&&(e[n]=!1))}},attrHooks:{type:{set:function(e,t){if(g.test(e.nodeName)&&e.parentNode)s.error("type property can't be changed");else if(!s.support.radioValue&&t==="radio"&&s.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}},value:{get:function(e,t){return S&&s.nodeName(e,"button")?S.get(e,t):t in e?e.value:null},set:function(e,t,n){if(S&&s.nodeName(e,"button"))return S.set(e,t,n);e.value=t}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,n,r){var i,o,u,a=e.nodeType;if(!e||a===3||a===8||a===2)return;return u=a!==1||!s.isXMLDoc(e),u&&(n=s.propFix[n]||n,o=s.propHooks[n]),r!==t?o&&"set"in o&&(i=o.set(e,r,n))!==t?i:e[n]=r:o&&"get"in o&&(i=o.get(e,n))!==null?i:e[n]},propHooks:{tabIndex:{get:function(e){var n=e.getAttributeNode("tabindex");return n&&n.specified?parseInt(n.value,10):y.test(e.nodeName)||b.test(e.nodeName)&&e.href?0:t}}}}),s.attrHooks.tabindex=s.propHooks.tabIndex,x={get:function(e,n){var r,i=s.prop(e,n);return i===!0||typeof i!="boolean"&&(r=e.getAttributeNode(n))&&r.nodeValue!==!1?n.toLowerCase():t},set:function(e,t,n){var r;return t===!1?s.removeAttr(e,n):(r=s.propFix[n]||n,r in e&&(e[r]=!0),e.setAttribute(n,n.toLowerCase())),n}},E||(T={name:!0,id:!0},S=s.valHooks.button={get:function(e,n){var r;return r=e.getAttributeNode(n),r&&(T[n]?r.nodeValue!=="":r.specified)?r.nodeValue:t},set:function(e,t,r){var i=e.getAttributeNode(r);return i||(i=n.createAttribute(r),e.setAttributeNode(i)),i.nodeValue=t+""}},s.attrHooks.tabindex.set=S.set,s.each(["width","height"],function(e,t){s.attrHooks[t]=s.extend(s.attrHooks[t],{set:function(e,n){if(n==="")return e.setAttribute(t,"auto"),n}})}),s.attrHooks.contenteditable={get:S.get,set:function(e,t,n){t===""&&(t="false"),S.set(e,t,n)}}),s.support.hrefNormalized||s.each(["href","src","width","height"],function(e,n){s.attrHooks[n]=s.extend(s.attrHooks[n],{get:function(e){var r=e.getAttribute(n,2);return r===null?t:r}})}),s.support.style||(s.attrHooks.style={get:function(e){return e.style.cssText.toLowerCase()||t},set:function(e,t){return e.style.cssText=""+t}}),s.support.optSelected||(s.propHooks.selected=s.extend(s.propHooks.selected,{get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}})),s.support.enctype||(s.propFix.enctype="encoding"),s.support.checkOn||s.each(["radio","checkbox"],function(){s.valHooks[this]={get:function(e){return e.getAttribute("value")===null?"on":e.value}}}),s.each(["radio","checkbox"],function(){s.valHooks[this]=s.extend(s.valHooks[this],{set:function(e,t){if(s.isArray(t))return e.checked=s.inArray(s(e).val(),t)>=0}})});var N=/^(?:textarea|input|select)$/i,C=/^([^\.]*)?(?:\.(.+))?$/,k=/\bhover(\.\S+)?\b/,L=/^key/,A=/^(?:mouse|contextmenu)|click/,O=/^(?:focusinfocus|focusoutblur)$/,M=/^(\w*)(?:#([\w\-]+))?(?:\.([\w\-]+))?$/,_=function(e){var t=M.exec(e);return t&&(t[1]=(t[1]||"").toLowerCase(),t[3]=t[3]&&new RegExp("(?:^|\\s)"+t[3]+"(?:\\s|$)")),t},D=function(e,t){var n=e.attributes||{};return(!t[1]||e.nodeName.toLowerCase()===t[1])&&(!t[2]||(n.id||{}).value===t[2])&&(!t[3]||t[3].test((n["class"]||{}).value))},P=function(e){return s.event.special.hover?e:e.replace(k,"mouseenter$1 mouseleave$1")};s.event={add:function(e,n,r,i,o){var u,a,f,l,c,h,p,d,v,m,g,y;if(e.nodeType===3||e.nodeType===8||!n||!r||!(u=s._data(e)))return;r.handler&&(v=r,r=v.handler),r.guid||(r.guid=s.guid++),f=u.events,f||(u.events=f={}),a=u.handle,a||(u.handle=a=function(e){return typeof s=="undefined"||!!e&&s.event.triggered===e.type?t:s.event.dispatch.apply(a.elem,arguments)},a.elem=e),n=s.trim(P(n)).split(" ");for(l=0;l<n.length;l++){c=C.exec(n[l])||[],h=c[1],p=(c[2]||"").split(".").sort(),y=s.event.special[h]||{},h=(o?y.delegateType:y.bindType)||h,y=s.event.special[h]||{},d=s.extend({type:h,origType:c[1],data:i,handler:r,guid:r.guid,selector:o,quick:_(o),namespace:p.join(".")},v),g=f[h];if(!g){g=f[h]=[],g.delegateCount=0;if(!y.setup||y.setup.call(e,i,p,a)===!1)e.addEventListener?e.addEventListener(h,a,!1):e.attachEvent&&e.attachEvent("on"+h,a)}y.add&&(y.add.call(e,d),d.handler.guid||(d.handler.guid=r.guid)),o?g.splice(g.delegateCount++,0,d):g.push(d),s.event.global[h]=!0}e=null},global:{},remove:function(e,t,n,r,i){var o=s.hasData(e)&&s._data(e),u,a,f,l,c,h,p,d,v,m,g,y;if(!o||!(d=o.events))return;t=s.trim(P(t||"")).split(" ");for(u=0;u<t.length;u++){a=C.exec(t[u])||[],f=l=a[1],c=a[2];if(!f){for(f in d)s.event.remove(e,f+t[u],n,r,!0);continue}v=s.event.special[f]||{},f=(r?v.delegateType:v.bindType)||f,g=d[f]||[],h=g.length,c=c?new RegExp("(^|\\.)"+c.split(".").sort().join("\\.(?:.*\\.)?")+"(\\.|$)"):null;for(p=0;p<g.length;p++)y=g[p],(i||l===y.origType)&&(!n||n.guid===y.guid)&&(!c||c.test(y.namespace))&&(!r||r===y.selector||r==="**"&&y.selector)&&(g.splice(p--,1),y.selector&&g.delegateCount--,v.remove&&v.remove.call(e,y));g.length===0&&h!==g.length&&((!v.teardown||v.teardown.call(e,c)===!1)&&s.removeEvent(e,f,o.handle),delete d[f])}s.isEmptyObject(d)&&(m=o.handle,m&&(m.elem=null),s.removeData(e,["events","handle"],!0))},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(n,r,i,o){if(!i||i.nodeType!==3&&i.nodeType!==8){var u=n.type||n,a=[],f,l,c,h,p,d,v,m,g,y;if(O.test(u+s.event.triggered))return;u.indexOf("!")>=0&&(u=u.slice(0,-1),l=!0),u.indexOf(".")>=0&&(a=u.split("."),u=a.shift(),a.sort());if((!i||s.event.customEvent[u])&&!s.event.global[u])return;n=typeof n=="object"?n[s.expando]?n:new s.Event(u,n):new s.Event(u),n.type=u,n.isTrigger=!0,n.exclusive=l,n.namespace=a.join("."),n.namespace_re=n.namespace?new RegExp("(^|\\.)"+a.join("\\.(?:.*\\.)?")+"(\\.|$)"):null,d=u.indexOf(":")<0?"on"+u:"";if(!i){f=s.cache;for(c in f)f[c].events&&f[c].events[u]&&s.event.trigger(n,r,f[c].handle.elem,!0);return}n.result=t,n.target||(n.target=i),r=r!=null?s.makeArray(r):[],r.unshift(n),v=s.event.special[u]||{};if(v.trigger&&v.trigger.apply(i,r)===!1)return;g=[[i,v.bindType||u]];if(!o&&!v.noBubble&&!s.isWindow(i)){y=v.delegateType||u,h=O.test(y+u)?i:i.parentNode,p=null;for(;h;h=h.parentNode)g.push([h,y]),p=h;p&&p===i.ownerDocument&&g.push([p.defaultView||p.parentWindow||e,y])}for(c=0;c<g.length&&!n.isPropagationStopped();c++)h=g[c][0],n.type=g[c][1],m=(s._data(h,"events")||{})[n.type]&&s._data(h,"handle"),m&&m.apply(h,r),m=d&&h[d],m&&s.acceptData(h)&&m.apply(h,r)===!1&&n.preventDefault();return n.type=u,!o&&!n.isDefaultPrevented()&&(!v._default||v._default.apply(i.ownerDocument,r)===!1)&&(u!=="click"||!s.nodeName(i,"a"))&&s.acceptData(i)&&d&&i[u]&&(u!=="focus"&&u!=="blur"||n.target.offsetWidth!==0)&&!s.isWindow(i)&&(p=i[d],p&&(i[d]=null),s.event.triggered=u,i[u](),s.event.triggered=t,p&&(i[d]=p)),n.result}return},dispatch:function(n){n=s.event.fix(n||e.event);var r=(s._data(this,"events")||{})[n.type]||[],i=r.delegateCount,o=[].slice.call(arguments,0),u=!n.exclusive&&!n.namespace,a=[],f,l,c,h,p,d,v,m,g,y,b;o[0]=n,n.delegateTarget=this;if(i&&!n.target.disabled&&(!n.button||n.type!=="click")){h=s(this),h.context=this.ownerDocument||this;for(c=n.target;c!=this;c=c.parentNode||this){d={},m=[],h[0]=c;for(f=0;f<i;f++)g=r[f],y=g.selector,d[y]===t&&(d[y]=g.quick?D(c,g.quick):h.is(y)),d[y]&&m.push(g);m.length&&a.push({elem:c,matches:m})}}r.length>i&&a.push({elem:this,matches:r.slice(i)});for(f=0;f<a.length&&!n.isPropagationStopped();f++){v=a[f],n.currentTarget=v.elem;for(l=0;l<v.matches.length&&!n.isImmediatePropagationStopped();l++){g=v.matches[l];if(u||!n.namespace&&!g.namespace||n.namespace_re&&n.namespace_re.test(g.namespace))n.data=g.data,n.handleObj=g,p=((s.event.special[g.origType]||{}).handle||g.handler).apply(v.elem,o),p!==t&&(n.result=p,p===!1&&(n.preventDefault(),n.stopPropagation()))}}return n.result},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return e.which==null&&(e.which=t.charCode!=null?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,r){var i,s,o,u=r.button,a=r.fromElement;return e.pageX==null&&r.clientX!=null&&(i=e.target.ownerDocument||n,s=i.documentElement,o=i.body,e.pageX=r.clientX+(s&&s.scrollLeft||o&&o.scrollLeft||0)-(s&&s.clientLeft||o&&o.clientLeft||0),e.pageY=r.clientY+(s&&s.scrollTop||o&&o.scrollTop||0)-(s&&s.clientTop||o&&o.clientTop||0)),!e.relatedTarget&&a&&(e.relatedTarget=a===e.target?r.toElement:a),!e.which&&u!==t&&(e.which=u&1?1:u&2?3:u&4?2:0),e}},fix:function(e){if(e[s.expando])return e;var r,i,o=e,u=s.event.fixHooks[e.type]||{},a=u.props?this.props.concat(u.props):this.props;e=s.Event(o);for(r=a.length;r;)i=a[--r],e[i]=o[i];return e.target||(e.target=o.srcElement||n),e.target.nodeType===3&&(e.target=e.target.parentNode),e.metaKey===t&&(e.metaKey=e.ctrlKey),u.filter?u.filter(e,o):e},special:{ready:{setup:s.bindReady},load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(e,t,n){s.isWindow(this)&&(this.onbeforeunload=n)},teardown:function(e,t){this.onbeforeunload===t&&(this.onbeforeunload=null)}}},simulate:function(e,t,n,r){var i=s.extend(new s.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?s.event.trigger(i,null,t):s.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},s.event.handle=s.event.dispatch,s.removeEvent=n.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){e.detachEvent&&e.detachEvent("on"+t,n)},s.Event=function(e,t){if(!(this instanceof s.Event))return new s.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault()?B:H):this.type=e,t&&s.extend(this,t),this.timeStamp=e&&e.timeStamp||s.now(),this[s.expando]=!0},s.Event.prototype={preventDefault:function(){this.isDefaultPrevented=B;var e=this.originalEvent;if(!e)return;e.preventDefault?e.preventDefault():e.returnValue=!1},stopPropagation:function(){this.isPropagationStopped=B;var e=this.originalEvent;if(!e)return;e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=B,this.stopPropagation()},isDefaultPrevented:H,isPropagationStopped:H,isImmediatePropagationStopped:H},s.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){s.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n=this,r=e.relatedTarget,i=e.handleObj,o=i.selector,u;if(!r||r!==n&&!s.contains(n,r))e.type=i.origType,u=i.handler.apply(this,arguments),e.type=t;return u}}}),s.support.submitBubbles||(s.event.special.submit={setup:function(){if(s.nodeName(this,"form"))return!1;s.event.add(this,"click._submit keypress._submit",function(e){var n=e.target,r=s.nodeName(n,"input")||s.nodeName(n,"button")?n.form:t;r&&!r._submit_attached&&(s.event.add(r,"submit._submit",function(e){this.parentNode&&!e.isTrigger&&s.event.simulate("submit",this.parentNode,e,!0)}),r._submit_attached=!0)})},teardown:function(){if(s.nodeName(this,"form"))return!1;s.event.remove(this,"._submit")}}),s.support.changeBubbles||(s.event.special.change={setup:function(){if(N.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio")s.event.add(this,"propertychange._change",function(e){e.originalEvent.propertyName==="checked"&&(this._just_changed=!0)}),s.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1,s.event.simulate("change",this,e,!0))});return!1}s.event.add(this,"beforeactivate._change",function(e){var t=e.target;N.test(t.nodeName)&&!t._change_attached&&(s.event.add(t,"change._change",function(e){this.parentNode&&!e.isSimulated&&!e.isTrigger&&s.event.simulate("change",this.parentNode,e,!0)}),t._change_attached=!0)})},handle:function(e){var t=e.target;if(this!==t||e.isSimulated||e.isTrigger||t.type!=="radio"&&t.type!=="checkbox")return e.handleObj.handler.apply(this,arguments)},teardown:function(){return s.event.remove(this,"._change"),N.test(this.nodeName)}}),s.support.focusinBubbles||s.each({focus:"focusin",blur:"focusout"},function(e,t){var r=0,i=function(e){s.event.simulate(t,e.target,s.event.fix(e),!0)};s.event.special[t]={setup:function(){r++===0&&n.addEventListener(e,i,!0)},teardown:function(){--r===0&&n.removeEventListener(e,i,!0)}}}),s.fn.extend({on:function(e,n,r,i,o){var u,a;if(typeof e=="object"){typeof n!="string"&&(r=n,n=t);for(a in e)this.on(a,n,r,e[a],o);return this}r==null&&i==null?(i=n,r=n=t):i==null&&(typeof n=="string"?(i=r,r=t):(i=r,r=n,n=t));if(i===!1)i=H;else if(!i)return this;return o===1&&(u=i,i=function(e){return s().off(e),u.apply(this,arguments)},i.guid=u.guid||(u.guid=s.guid++)),this.each(function(){s.event.add(this,e,i,r,n)})},one:function(e,t,n,r){return this.on.call(this,e,t,n,r,1)},off:function(e,n,r){if(e&&e.preventDefault&&e.handleObj){var i=e.handleObj;return s(e.delegateTarget).off(i.namespace?i.type+"."+i.namespace:i.type,i.selector,i.handler),this}if(typeof e=="object"){for(var o in e)this.off(o,n,e[o]);return this}if(n===!1||typeof n=="function")r=n,n=t;return r===!1&&(r=H),this.each(function(){s.event.remove(this,e,r,n)})},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},live:function(e,t,n){return s(this.context).on(e,this.selector,t,n),this},die:function(e,t){return s(this.context).off(e,this.selector||"**",t),this},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return arguments.length==1?this.off(e,"**"):this.off(t,e,n)},trigger:function(e,t){return this.each(function(){s.event.trigger(e,t,this)})},triggerHandler:function(e,t){if(this[0])return s.event.trigger(e,t,this[0],!0)},toggle:function(e){var t=arguments,n=e.guid||s.guid++,r=0,i=function(n){var i=(s._data(this,"lastToggle"+e.guid)||0)%r;return s._data(this,"lastToggle"+e.guid,i+1),n.preventDefault(),t[i].apply(this,arguments)||!1};i.guid=n;while(r<t.length)t[r++].guid=n;return this.click(i)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),s.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){s.fn[t]=function(e,n){return n==null&&(n=e,e=null),arguments.length>0?this.on(t,null,e,n):this.trigger(t)},s.attrFn&&(s.attrFn[t]=!0),L.test(t)&&(s.event.fixHooks[t]=s.event.keyHooks),A.test(t)&&(s.event.fixHooks[t]=s.event.mouseHooks)}),function(){function S(e,t,n,i,s,o){for(var u=0,a=i.length;u<a;u++){var f=i[u];if(f){var l=!1;f=f[e];while(f){if(f[r]===n){l=i[f.sizset];break}f.nodeType===1&&!o&&(f[r]=n,f.sizset=u);if(f.nodeName.toLowerCase()===t){l=f;break}f=f[e]}i[u]=l}}}function x(e,t,n,i,s,o){for(var u=0,a=i.length;u<a;u++){var f=i[u];if(f){var l=!1;f=f[e];while(f){if(f[r]===n){l=i[f.sizset];break}if(f.nodeType===1){o||(f[r]=n,f.sizset=u);if(typeof t!="string"){if(f===t){l=!0;break}}else if(h.filter(t,[f]).length>0){l=f;break}}f=f[e]}i[u]=l}}}var e=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,r="sizcache"+(Math.random()+"").replace(".",""),i=0,o=Object.prototype.toString,u=!1,a=!0,f=/\\/g,l=/\r\n/g,c=/\W/;[0,0].sort(function(){return a=!1,0});var h=function(t,r,i,s){i=i||[],r=r||n;var u=r;if(r.nodeType!==1&&r.nodeType!==9)return[];if(!t||typeof t!="string")return i;var a,f,l,c,p,m,g,b,w=!0,E=h.isXML(r),S=[],x=t;do{e.exec(""),a=e.exec(x);if(a){x=a[3],S.push(a[1]);if(a[2]){c=a[3];break}}}while(a);if(S.length>1&&v.exec(t))if(S.length===2&&d.relative[S[0]])f=T(S[0]+S[1],r,s);else{f=d.relative[S[0]]?[r]:h(S.shift(),r);while(S.length)t=S.shift(),d.relative[t]&&(t+=S.shift()),f=T(t,f,s)}else{!s&&S.length>1&&r.nodeType===9&&!E&&d.match.ID.test(S[0])&&!d.match.ID.test(S[S.length-1])&&(p=h.find(S.shift(),r,E),r=p.expr?h.filter(p.expr,p.set)[0]:p.set[0]);if(r){p=s?{expr:S.pop(),set:y(s)}:h.find(S.pop(),S.length!==1||S[0]!=="~"&&S[0]!=="+"||!r.parentNode?r:r.parentNode,E),f=p.expr?h.filter(p.expr,p.set):p.set,S.length>0?l=y(f):w=!1;while(S.length)m=S.pop(),g=m,d.relative[m]?g=S.pop():m="",g==null&&(g=r),d.relative[m](l,g,E)}else l=S=[]}l||(l=f),l||h.error(m||t);if(o.call(l)==="[object Array]")if(!w)i.push.apply(i,l);else if(r&&r.nodeType===1)for(b=0;l[b]!=null;b++)l[b]&&(l[b]===!0||l[b].nodeType===1&&h.contains(r,l[b]))&&i.push(f[b]);else for(b=0;l[b]!=null;b++)l[b]&&l[b].nodeType===1&&i.push(f[b]);else y(l,i);return c&&(h(c,u,i,s),h.uniqueSort(i)),i};h.uniqueSort=function(e){if(w){u=a,e.sort(w);if(u)for(var t=1;t<e.length;t++)e[t]===e[t-1]&&e.splice(t--,1)}return e},h.matches=function(e,t){return h(e,null,null,t)},h.matchesSelector=function(e,t){return h(t,null,null,[e]).length>0},h.find=function(e,t,n){var r,i,s,o,u,a;if(!e)return[];for(i=0,s=d.order.length;i<s;i++){u=d.order[i];if(o=d.leftMatch[u].exec(e)){a=o[1],o.splice(1,1);if(a.substr(a.length-1)!=="\\"){o[1]=(o[1]||"").replace(f,""),r=d.find[u](o,t,n);if(r!=null){e=e.replace(d.match[u],"");break}}}}return r||(r=typeof t.getElementsByTagName!="undefined"?t.getElementsByTagName("*"):[]),{set:r,expr:e}},h.filter=function(e,n,r,i){var s,o,u,a,f,l,c,p,v,m=e,g=[],y=n,b=n&&n[0]&&h.isXML(n[0]);while(e&&n.length){for(u in d.filter)if((s=d.leftMatch[u].exec(e))!=null&&s[2]){l=d.filter[u],c=s[1],o=!1,s.splice(1,1);if(c.substr(c.length-1)==="\\")continue;y===g&&(g=[]);if(d.preFilter[u]){s=d.preFilter[u](s,y,r,g,i,b);if(!s)o=a=!0;else if(s===!0)continue}if(s)for(p=0;(f=y[p])!=null;p++)f&&(a=l(f,s,p,y),v=i^a,r&&a!=null?v?o=!0:y[p]=!1:v&&(g.push(f),o=!0));if(a!==t){r||(y=g),e=e.replace(d.match[u],"");if(!o)return[];break}}if(e===m){if(o!=null)break;h.error(e)}m=e}return y},h.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)};var p=h.getText=function(e){var t,n,r=e.nodeType,i="";if(r){if(r===1||r===9){if(typeof e.textContent=="string")return e.textContent;if(typeof e.innerText=="string")return e.innerText.replace(l,"");for(e=e.firstChild;e;e=e.nextSibling)i+=p(e)}else if(r===3||r===4)return e.nodeValue}else for(t=0;n=e[t];t++)n.nodeType!==8&&(i+=p(n));return i},d=h.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(e){return e.getAttribute("href")},type:function(e){return e.getAttribute("type")}},relative:{"+":function(e,t){var n=typeof t=="string",r=n&&!c.test(t),i=n&&!r;r&&(t=t.toLowerCase());for(var s=0,o=e.length,u;s<o;s++)if(u=e[s]){while((u=u.previousSibling)&&u.nodeType!==1);e[s]=i||u&&u.nodeName.toLowerCase()===t?u||!1:u===t}i&&h.filter(t,e,!0)},">":function(e,t){var n,r=typeof t=="string",i=0,s=e.length;if(r&&!c.test(t)){t=t.toLowerCase();for(;i<s;i++){n=e[i];if(n){var o=n.parentNode;e[i]=o.nodeName.toLowerCase()===t?o:!1}}}else{for(;i<s;i++)n=e[i],n&&(e[i]=r?n.parentNode:n.parentNode===t);r&&h.filter(t,e,!0)}},"":function(e,t,n){var r,s=i++,o=x;typeof t=="string"&&!c.test(t)&&(t=t.toLowerCase(),r=t,o=S),o("parentNode",t,s,e,r,n)},"~":function(e,t,n){var r,s=i++,o=x;typeof t=="string"&&!c.test(t)&&(t=t.toLowerCase(),r=t,o=S),o("previousSibling",t,s,e,r,n)}},find:{ID:function(e,t,n){if(typeof t.getElementById!="undefined"&&!n){var r=t.getElementById(e[1]);return r&&r.parentNode?[r]:[]}},NAME:function(e,t){if(typeof t.getElementsByName!="undefined"){var n=[],r=t.getElementsByName(e[1]);for(var i=0,s=r.length;i<s;i++)r[i].getAttribute("name")===e[1]&&n.push(r[i]);return n.length===0?null:n}},TAG:function(e,t){if(typeof t.getElementsByTagName!="undefined")return t.getElementsByTagName(e[1])}},preFilter:{CLASS:function(e,t,n,r,i,s){e=" "+e[1].replace(f,"")+" ";if(s)return e;for(var o=0,u;(u=t[o])!=null;o++)u&&(i^(u.className&&(" "+u.className+" ").replace(/[\t\n\r]/g," ").indexOf(e)>=0)?n||r.push(u):n&&(t[o]=!1));return!1},ID:function(e){return e[1].replace(f,"")},TAG:function(e,t){return e[1].replace(f,"").toLowerCase()},CHILD:function(e){if(e[1]==="nth"){e[2]||h.error(e[0]),e[2]=e[2].replace(/^\+|\s*/g,"");var t=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec(e[2]==="even"&&"2n"||e[2]==="odd"&&"2n+1"||!/\D/.test(e[2])&&"0n+"+e[2]||e[2]);e[2]=t[1]+(t[2]||1)-0,e[3]=t[3]-0}else e[2]&&h.error(e[0]);return e[0]=i++,e},ATTR:function(e,t,n,r,i,s){var o=e[1]=e[1].replace(f,"");return!s&&d.attrMap[o]&&(e[1]=d.attrMap[o]),e[4]=(e[4]||e[5]||"").replace(f,""),e[2]==="~="&&(e[4]=" "+e[4]+" "),e},PSEUDO:function(t,n,r,i,s){if(t[1]==="not"){if(!((e.exec(t[3])||"").length>1||/^\w/.test(t[3]))){var o=h.filter(t[3],n,r,!0^s);return r||i.push.apply(i,o),!1}t[3]=h(t[3],null,null,n)}else if(d.match.POS.test(t[0])||d.match.CHILD.test(t[0]))return!0;return t},POS:function(e){return e.unshift(!0),e}},filters:{enabled:function(e){return e.disabled===!1&&e.type!=="hidden"},disabled:function(e){return e.disabled===!0},checked:function(e){return e.checked===!0},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},parent:function(e){return!!e.firstChild},empty:function(e){return!e.firstChild},has:function(e,t,n){return!!h(n[3],e).length},header:function(e){return/h\d/i.test(e.nodeName)},text:function(e){var t=e.getAttribute("type"),n=e.type;return e.nodeName.toLowerCase()==="input"&&"text"===n&&(t===n||t===null)},radio:function(e){return e.nodeName.toLowerCase()==="input"&&"radio"===e.type},checkbox:function(e){return e.nodeName.toLowerCase()==="input"&&"checkbox"===e.type},file:function(e){return e.nodeName.toLowerCase()==="input"&&"file"===e.type},password:function(e){return e.nodeName.toLowerCase()==="input"&&"password"===e.type},submit:function(e){var t=e.nodeName.toLowerCase();return(t==="input"||t==="button")&&"submit"===e.type},image:function(e){return e.nodeName.toLowerCase()==="input"&&"image"===e.type},reset:function(e){var t=e.nodeName.toLowerCase();return(t==="input"||t==="button")&&"reset"===e.type},button:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&"button"===e.type||t==="button"},input:function(e){return/input|select|textarea|button/i.test(e.nodeName)},focus:function(e){return e===e.ownerDocument.activeElement}},setFilters:{first:function(e,t){return t===0},last:function(e,t,n,r){return t===r.length-1},even:function(e,t){return t%2===0},odd:function(e,t){return t%2===1},lt:function(e,t,n){return t<n[3]-0},gt:function(e,t,n){return t>n[3]-0},nth:function(e,t,n){return n[3]-0===t},eq:function(e,t,n){return n[3]-0===t}},filter:{PSEUDO:function(e,t,n,r){var i=t[1],s=d.filters[i];if(s)return s(e,n,t,r);if(i==="contains")return(e.textContent||e.innerText||p([e])||"").indexOf(t[3])>=0;if(i==="not"){var o=t[3];for(var u=0,a=o.length;u<a;u++)if(o[u]===e)return!1;return!0}h.error(i)},CHILD:function(e,t){var n,i,s,o,u,a,f,l=t[1],c=e;switch(l){case"only":case"first":while(c=c.previousSibling)if(c.nodeType===1)return!1;if(l==="first")return!0;c=e;case"last":while(c=c.nextSibling)if(c.nodeType===1)return!1;return!0;case"nth":n=t[2],i=t[3];if(n===1&&i===0)return!0;s=t[0],o=e.parentNode;if(o&&(o[r]!==s||!e.nodeIndex)){a=0;for(c=o.firstChild;c;c=c.nextSibling)c.nodeType===1&&(c.nodeIndex=++a);o[r]=s}return f=e.nodeIndex-i,n===0?f===0:f%n===0&&f/n>=0}},ID:function(e,t){return e.nodeType===1&&e.getAttribute("id")===t},TAG:function(e,t){return t==="*"&&e.nodeType===1||!!e.nodeName&&e.nodeName.toLowerCase()===t},CLASS:function(e,t){return(" "+(e.className||e.getAttribute("class"))+" ").indexOf(t)>-1},ATTR:function(e,t){var n=t[1],r=h.attr?h.attr(e,n):d.attrHandle[n]?d.attrHandle[n](e):e[n]!=null?e[n]:e.getAttribute(n),i=r+"",s=t[2],o=t[4];return r==null?s==="!=":!s&&h.attr?r!=null:s==="="?i===o:s==="*="?i.indexOf(o)>=0:s==="~="?(" "+i+" ").indexOf(o)>=0:o?s==="!="?i!==o:s==="^="?i.indexOf(o)===0:s==="$="?i.substr(i.length-o.length)===o:s==="|="?i===o||i.substr(0,o.length+1)===o+"-":!1:i&&r!==!1},POS:function(e,t,n,r){var i=t[2],s=d.setFilters[i];if(s)return s(e,n,t,r)}}},v=d.match.POS,m=function(e,t){return"\\"+(t-0+1)};for(var g in d.match)d.match[g]=new RegExp(d.match[g].source+/(?![^\[]*\])(?![^\(]*\))/.source),d.leftMatch[g]=new RegExp(/(^(?:.|\r|\n)*?)/.source+d.match[g].source.replace(/\\(\d+)/g,m));var y=function(e,t){return e=Array.prototype.slice.call(e,0),t?(t.push.apply(t,e),t):e};try{Array.prototype.slice.call(n.documentElement.childNodes,0)[0].nodeType}catch(b){y=function(e,t){var n=0,r=t||[];if(o.call(e)==="[object Array]")Array.prototype.push.apply(r,e);else if(typeof e.length=="number")for(var i=e.length;n<i;n++)r.push(e[n]);else for(;e[n];n++)r.push(e[n]);return r}}var w,E;n.documentElement.compareDocumentPosition?w=function(e,t){return e===t?(u=!0,0):!e.compareDocumentPosition||!t.compareDocumentPosition?e.compareDocumentPosition?-1:1:e.compareDocumentPosition(t)&4?-1:1}:(w=function(e,t){if(e===t)return u=!0,0;if(e.sourceIndex&&t.sourceIndex)return e.sourceIndex-t.sourceIndex;var n,r,i=[],s=[],o=e.parentNode,a=t.parentNode,f=o;if(o===a)return E(e,t);if(!o)return-1;if(!a)return 1;while(f)i.unshift(f),f=f.parentNode;f=a;while(f)s.unshift(f),f=f.parentNode;n=i.length,r=s.length;for(var l=0;l<n&&l<r;l++)if(i[l]!==s[l])return E(i[l],s[l]);return l===n?E(e,s[l],-1):E(i[l],t,1)},E=function(e,t,n){if(e===t)return n;var r=e.nextSibling;while(r){if(r===t)return-1;r=r.nextSibling}return 1}),function(){var e=n.createElement("div"),r="script"+(new Date).getTime(),i=n.documentElement;e.innerHTML="<a name='"+r+"'/>",i.insertBefore(e,i.firstChild),n.getElementById(r)&&(d.find.ID=function(e,n,r){if(typeof n.getElementById!="undefined"&&!r){var i=n.getElementById(e[1]);return i?i.id===e[1]||typeof i.getAttributeNode!="undefined"&&i.getAttributeNode("id").nodeValue===e[1]?[i]:t:[]}},d.filter.ID=function(e,t){var n=typeof e.getAttributeNode!="undefined"&&e.getAttributeNode("id");return e.nodeType===1&&n&&n.nodeValue===t}),i.removeChild(e),i=e=null}(),function(){var e=n.createElement("div");e.appendChild(n.createComment("")),e.getElementsByTagName("*").length>0&&(d.find.TAG=function(e,t){var n=t.getElementsByTagName(e[1]);if(e[1]==="*"){var r=[];for(var i=0;n[i];i++)n[i].nodeType===1&&r.push(n[i]);n=r}return n}),e.innerHTML="<a href='#'></a>",e.firstChild&&typeof e.firstChild.getAttribute!="undefined"&&e.firstChild.getAttribute("href")!=="#"&&(d.attrHandle.href=function(e){return e.getAttribute("href",2)}),e=null}(),n.querySelectorAll&&function(){var e=h,t=n.createElement("div"),r="__sizzle__";t.innerHTML="<p class='TEST'></p>";if(t.querySelectorAll&&t.querySelectorAll(".TEST").length===0)return;h=function(t,i,s,o){i=i||n;if(!o&&!h.isXML(i)){var u=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(t);if(u&&(i.nodeType===1||i.nodeType===9)){if(u[1])return y(i.getElementsByTagName(t),s);if(u[2]&&d.find.CLASS&&i.getElementsByClassName)return y(i.getElementsByClassName(u[2]),s)}if(i.nodeType===9){if(t==="body"&&i.body)return y([i.body],s);if(u&&u[3]){var a=i.getElementById(u[3]);if(!a||!a.parentNode)return y([],s);if(a.id===u[3])return y([a],s)}try{return y(i.querySelectorAll(t),s)}catch(f){}}else if(i.nodeType===1&&i.nodeName.toLowerCase()!=="object"){var l=i,c=i.getAttribute("id"),p=c||r,v=i.parentNode,m=/^\s*[+~]/.test(t);c?p=p.replace(/'/g,"\\$&"):i.setAttribute("id",p),m&&v&&(i=i.parentNode);try{if(!m||v)return y(i.querySelectorAll("[id='"+p+"'] "+t),s)}catch(g){}finally{c||l.removeAttribute("id")}}}return e(t,i,s,o)};for(var i in e)h[i]=e[i];t=null}(),function(){var e=n.documentElement,t=e.matchesSelector||e.mozMatchesSelector||e.webkitMatchesSelector||e.msMatchesSelector;if(t){var r=!t.call(n.createElement("div"),"div"),i=!1;try{t.call(n.documentElement,"[test!='']:sizzle")}catch(s){i=!0}h.matchesSelector=function(e,n){n=n.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']");if(!h.isXML(e))try{if(i||!d.match.PSEUDO.test(n)&&!/!=/.test(n)){var s=t.call(e,n);if(s||!r||e.document&&e.document.nodeType!==11)return s}}catch(o){}return h(n,null,null,[e]).length>0}}}(),function(){var e=n.createElement("div");e.innerHTML="<div class='test e'></div><div class='test'></div>";if(!e.getElementsByClassName||e.getElementsByClassName("e").length===0)return;e.lastChild.className="e";if(e.getElementsByClassName("e").length===1)return;d.order.splice(1,0,"CLASS"),d.find.CLASS=function(e,t,n){if(typeof t.getElementsByClassName!="undefined"&&!n)return t.getElementsByClassName(e[1])},e=null}(),n.documentElement.contains?h.contains=function(e,t){return e!==t&&(e.contains?e.contains(t):!0)}:n.documentElement.compareDocumentPosition?h.contains=function(e,t){return!!(e.compareDocumentPosition(t)&16)}:h.contains=function(){return!1},h.isXML=function(e){var t=(e?e.ownerDocument||e:0).documentElement;return t?t.nodeName!=="HTML":!1};var T=function(e,t,n){var r,i=[],s="",o=t.nodeType?[t]:t;while(r=d.match.PSEUDO.exec(e))s+=r[0],e=e.replace(d.match.PSEUDO,"");e=d.relative[e]?e+"*":e;for(var u=0,a=o.length;u<a;u++)h(e,o[u],i,n);return h.filter(s,i)};h.attr=s.attr,h.selectors.attrMap={},s.find=h,s.expr=h.selectors,s.expr[":"]=s.expr.filters,s.unique=h.uniqueSort,s.text=h.getText,s.isXMLDoc=h.isXML,s.contains=h.contains}();var j=/Until$/,F=/^(?:parents|prevUntil|prevAll)/,I=/,/,q=/^.[^:#\[\.,]*$/,R=Array.prototype.slice,U=s.expr.match.POS,z={children:!0,contents:!0,next:!0,prev:!0};s.fn.extend({find:function(e){var t=this,n,r;if(typeof e!="string")return s(e).filter(function(){for(n=0,r=t.length;n<r;n++)if(s.contains(t[n],this))return!0});var i=this.pushStack("","find",e),o,u,a;for(n=0,r=this.length;n<r;n++){o=i.length,s.find(e,this[n],i);if(n>0)for(u=o;u<i.length;u++)for(a=0;a<o;a++)if(i[a]===i[u]){i.splice(u--,1);break}}return i},has:function(e){var t=s(e);return this.filter(function(){for(var e=0,n=t.length;e<n;e++)if(s.contains(this,t[e]))return!0})},not:function(e){return this.pushStack(X(this,e,!1),"not",e)},filter:function(e){return this.pushStack(X(this,e,!0),"filter",e)},is:function(e){return!!e&&(typeof e=="string"?U.test(e)?s(e,this.context).index(this[0])>=0:s.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){var n=[],r,i,o=this[0];if(s.isArray(e)){var u=1;while(o&&o.ownerDocument&&o!==t){for(r=0;r<e.length;r++)s(o).is(e[r])&&n.push({selector:e[r],elem:o,level:u});o=o.parentNode,u++}return n}var a=U.test(e)||typeof e!="string"?s(e,t||this.context):0;for(r=0,i=this.length;r<i;r++){o=this[r];while(o){if(a?a.index(o)>-1:s.find.matchesSelector(o,e)){n.push(o);break}o=o.parentNode;if(!o||!o.ownerDocument||o===t||o.nodeType===11)break}}return n=n.length>1?s.unique(n):n,this.pushStack(n,"closest",e)},index:function(e){return e?typeof e=="string"?s.inArray(this[0],s(e)):s.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(e,t){var n=typeof e=="string"?s(e,t):s.makeArray(e&&e.nodeType?[e]:e),r=s.merge(this.get(),n);return this.pushStack(W(n[0])||W(r[0])?r:s.unique(r))},andSelf:function(){return this.add(this.prevObject)}}),s.each({parent:function(e){var t=e.parentNode;return t&&t.nodeType!==11?t:null},parents:function(e){return s.dir(e,"parentNode")},parentsUntil:function(e,t,n){return s.dir(e,"parentNode",n)},next:function(e){return s.nth(e,2,"nextSibling")},prev:function(e){return s.nth(e,2,"previousSibling")},nextAll:function(e){return s.dir(e,"nextSibling")},prevAll:function(e){return s.dir(e,"previousSibling")},nextUntil:function(e,t,n){return s.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return s.dir(e,"previousSibling",n)},siblings:function(e){return s.sibling(e.parentNode.firstChild,e)},children:function(e){return s.sibling(e.firstChild)},contents:function(e){return s.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:s.makeArray(e.childNodes)}},function(e,t){s.fn[e]=function(n,r){var i=s.map(this,t,n);return j.test(e)||(r=n),r&&typeof r=="string"&&(i=s.filter(r,i)),i=this.length>1&&!z[e]?s.unique(i):i,(this.length>1||I.test(r))&&F.test(e)&&(i=i.reverse()),this.pushStack(i,e,R.call(arguments).join(","))}}),s.extend({filter:function(e,t,n){return n&&(e=":not("+e+")"),t.length===1?s.find.matchesSelector(t[0],e)?[t[0]]:[]:s.find.matches(e,t)},dir:function(e,n,r){var i=[],o=e[n];while(o&&o.nodeType!==9&&(r===t||o.nodeType!==1||!s(o).is(r)))o.nodeType===1&&i.push(o),o=o[n];return i},nth:function(e,t,n,r){t=t||1;var i=0;for(;e;e=e[n])if(e.nodeType===1&&++i===t)break;return e},sibling:function(e,t){var n=[];for(;e;e=e.nextSibling)e.nodeType===1&&e!==t&&n.push(e);return n}});var $="abbr|article|aside|audio|canvas|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",J=/ jQuery\d+="(?:\d+|null)"/g,K=/^\s+/,Q=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,G=/<([\w:]+)/,Y=/<tbody/i,Z=/<|&#?\w+;/,et=/<(?:script|style)/i,tt=/<(?:script|object|embed|option|style)/i,nt=new RegExp("<(?:"+$+")","i"),rt=/checked\s*(?:[^=]|=\s*.checked.)/i,it=/\/(java|ecma)script/i,st=/^\s*<!(?:\[CDATA\[|\-\-)/,ot={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},ut=V(n);ot.optgroup=ot.option,ot.tbody=ot.tfoot=ot.colgroup=ot.caption=ot.thead,ot.th=ot.td,s.support.htmlSerialize||(ot._default=[1,"div<div>","</div>"]),s.fn.extend({text:function(e){return s.isFunction(e)?this.each(function(t){var n=s(this);n.text(e.call(this,t,n.text()))}):typeof e!="object"&&e!==t?this.empty().append((this[0]&&this[0].ownerDocument||n).createTextNode(e)):s.text(this)},wrapAll:function(e){if(s.isFunction(e))return this.each(function(t){s(this).wrapAll(e.call(this,t))});if(this[0]){var t=s(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstChild&&e.firstChild.nodeType===1)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return s.isFunction(e)?this.each(function(t){s(this).wrapInner(e.call(this,t))}):this.each(function(){var t=s(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=s.isFunction(e);return this.each(function(n){s(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){s.nodeName(this,"body")||s(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(e){this.nodeType===1&&this.appendChild(e)})},prepend:function(){return this.domManip(arguments,!0,function(e){this.nodeType===1&&this.insertBefore(e,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(e){this.parentNode.insertBefore(e,this)});if(arguments.length){var e=s.clean(arguments);return e.push.apply(e,this.toArray()),this.pushStack(e,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(e){this.parentNode.insertBefore(e,this.nextSibling)});if(arguments.length){var e=this.pushStack(this,"after",arguments);return e.push.apply(e,s.clean(arguments)),e}},remove:function(e,t){for(var n=0,r;(r=this[n])!=null;n++)if(!e||s.filter(e,[r]).length)!t&&r.nodeType===1&&(s.cleanData(r.getElementsByTagName("*")),s.cleanData([r])),r.parentNode&&r.parentNode.removeChild(r);return this},empty:function(){for(var e=0,t;(t=this[e])!=null;e++){t.nodeType===1&&s.cleanData(t.getElementsByTagName("*"));while(t.firstChild)t.removeChild(t.firstChild)}return this},clone:function(e,t){return e=e==null?!1:e,t=t==null?e:t,this.map(function(){return s.clone(this,e,t)})},html:function(e){if(e===t)return this[0]&&this[0].nodeType===1?this[0].innerHTML.replace(J,""):null;if(typeof e=="string"&&!et.test(e)&&(s.support.leadingWhitespace||!K.test(e))&&!ot[(G.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(Q,"<$1></$2>");try{for(var n=0,r=this.length;n<r;n++)this[n].nodeType===1&&(s.cleanData(this[n].getElementsByTagName("*")),this[n].innerHTML=e)}catch(i){this.empty().append(e)}}else s.isFunction(e)?this.each(function(t){var n=s(this);n.html(e.call(this,t,n.html()))}):this.empty().append(e);return this},replaceWith:function(e){return this[0]&&this[0].parentNode?s.isFunction(e)?this.each(function(t){var n=s(this),r=n.html();n.replaceWith(e.call(this,t,r))}):(typeof e!="string"&&(e=s(e).detach()),this.each(function(){var t=this.nextSibling,n=this.parentNode;s(this).remove(),t?s(t).before(e):s(n).append(e)})):this.length?this.pushStack(s(s.isFunction(e)?e():e),"replaceWith",e):this},detach:function(e){return this.remove(e,!0)},domManip:function(e,n,r){var i,o,u,a,f=e[0],l=[];if(!s.support.checkClone&&arguments.length===3&&typeof f=="string"&&rt.test(f))return this.each(function(){s(this).domManip(e,n,r,!0)});if(s.isFunction(f))return this.each(function(i){var o=s(this);e[0]=f.call(this,i,n?o.html():t),o.domManip(e,n,r)});if(this[0]){a=f&&f.parentNode,s.support.parentNode&&a&&a.nodeType===11&&a.childNodes.length===this.length?i={fragment:a}:i=s.buildFragment(e,this,l),u=i.fragment,u.childNodes.length===1?o=u=u.firstChild:o=u.firstChild;if(o){n=n&&s.nodeName(o,"tr");for(var c=0,h=this.length,p=h-1;c<h;c++)r.call(n?at(this[c],o):this[c],i.cacheable||h>1&&c<p?s.clone(u,!0,!0):u)}l.length&&s.each(l,vt)}return this}}),s.buildFragment=function(e,t,r){var i,o,u,a,f=e[0];return t&&t[0]&&(a=t[0].ownerDocument||t[0]),a.createDocumentFragment||(a=n),e.length===1&&typeof f=="string"&&f.length<512&&a===n&&f.charAt(0)==="<"&&!tt.test(f)&&(s.support.checkClone||!rt.test(f))&&(s.support.html5Clone||!nt.test(f))&&(o=!0,u=s.fragments[f],u&&u!==1&&(i=u)),i||(i=a.createDocumentFragment(),s.clean(e,a,i,r)),o&&(s.fragments[f]=u?i:1),{fragment:i,cacheable:o}},s.fragments={},s.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){s.fn[e]=function(n){var r=[],i=s(n),o=this.length===1&&this[0].parentNode;if(o&&o.nodeType===11&&o.childNodes.length===1&&i.length===1)return i[t](this[0]),this;for(var u=0,a=i.length;u<a;u++){var f=(u>0?this.clone(!0):this).get();s(i[u])[t](f),r=r.concat(f)}return this.pushStack(r,e,i.selector)}}),s.extend({clone:function(e,t,n){var r,i,o,u=s.support.html5Clone||!nt.test("<"+e.nodeName)?e.cloneNode(!0):dt(e);if((!s.support.noCloneEvent||!s.support.noCloneChecked)&&(e.nodeType===1||e.nodeType===11)&&!s.isXMLDoc(e)){lt(e,u),r=ct(e),i=ct(u);for(o=0;r[o];++o)i[o]&&lt(r[o],i[o])}if(t){ft(e,u);if(n){r=ct(e),i=ct(u);for(o=0;r[o];++o)ft(r[o],i[o])}}return r=i=null,u},clean:function(e,t,r,i){var o;t=t||n,typeof t.createElement=="undefined"&&(t=t.ownerDocument||t[0]&&t[0].ownerDocument||n);var u=[],a;for(var f=0,l;(l=e[f])!=null;f++){typeof l=="number"&&(l+="");if(!l)continue;if(typeof l=="string")if(!Z.test(l))l=t.createTextNode(l);else{l=l.replace(Q,"<$1></$2>");var c=(G.exec(l)||["",""])[1].toLowerCase(),h=ot[c]||ot._default,p=h[0],d=t.createElement("div");t===n?ut.appendChild(d):V(t).appendChild(d),d.innerHTML=h[1]+l+h[2];while(p--)d=d.lastChild;if(!s.support.tbody){var v=Y.test(l),m=c==="table"&&!v?d.firstChild&&d.firstChild.childNodes:h[1]==="<table>"&&!v?d.childNodes:[];for(a=m.length-1;a>=0;--a)s.nodeName(m[a],"tbody")&&!m[a].childNodes.length&&m[a].parentNode.removeChild(m[a])}!s.support.leadingWhitespace&&K.test(l)&&d.insertBefore(t.createTextNode(K.exec(l)[0]),d.firstChild),l=d.childNodes}var g;if(!s.support.appendChecked)if(l[0]&&typeof (g=l.length)=="number")for(a=0;a<g;a++)pt(l[a]);else pt(l);l.nodeType?u.push(l):u=s.merge(u,l)}if(r){o=function(e){return!e.type||it.test(e.type)};for(f=0;u[f];f++)if(i&&s.nodeName(u[f],"script")&&(!u[f].type||u[f].type.toLowerCase()==="text/javascript"))i.push(u[f].parentNode?u[f].parentNode.removeChild(u[f]):u[f]);else{if(u[f].nodeType===1){var y=s.grep(u[f].getElementsByTagName("script"),o);u.splice.apply(u,[f+1,0].concat(y))}r.appendChild(u[f])}}return u},cleanData:function(e){var t,n,r=s.cache,i=s.event.special,o=s.support.deleteExpando;for(var u=0,a;(a=e[u])!=null;u++){if(a.nodeName&&s.noData[a.nodeName.toLowerCase()])continue;n=a[s.expando];if(n){t=r[n];if(t&&t.events){for(var f in t.events)i[f]?s.event.remove(a,f):s.removeEvent(a,f,t.handle);t.handle&&(t.handle.elem=null)}o?delete a[s.expando]:a.removeAttribute&&a.removeAttribute(s.expando),delete r[n]}}}});var mt=/alpha\([^)]*\)/i,gt=/opacity=([^)]*)/,yt=/([A-Z]|^ms)/g,bt=/^-?\d+(?:px)?$/i,wt=/^-?\d/,Et=/^([\-+])=([\-+.\de]+)/,St={position:"absolute",visibility:"hidden",display:"block"},xt=["Left","Right"],Tt=["Top","Bottom"],Nt,Ct,kt;s.fn.css=function(e,n){return arguments.length===2&&n===t?this:s.access(this,e,n,!0,function(e,n,r){return r!==t?s.style(e,n,r):s.css(e,n)})},s.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Nt(e,"opacity","opacity");return n===""?"1":n}return e.style.opacity}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":s.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,n,r,i){if(!e||e.nodeType===3||e.nodeType===8||!e.style)return;var o,u,a=s.camelCase(n),f=e.style,l=s.cssHooks[a];n=s.cssProps[a]||a;if(r===t)return l&&"get"in l&&(o=l.get(e,!1,i))!==t?o:f[n];u=typeof r,u==="string"&&(o=Et.exec(r))&&(r=+(o[1]+1)*+o[2]+parseFloat(s.css(e,n)),u="number");if(r==null||u==="number"&&isNaN(r))return;u==="number"&&!s.cssNumber[a]&&(r+="px");if(!l||!("set"in l)||(r=l.set(e,r))!==t)try{f[n]=r}catch(c){}},css:function(e,n,r){var i,o;n=s.camelCase(n),o=s.cssHooks[n],n=s.cssProps[n]||n,n==="cssFloat"&&(n="float");if(o&&"get"in o&&(i=o.get(e,!0,r))!==t)return i;if(Nt)return Nt(e,n)},swap:function(e,t,n){var r={};for(var i in t)r[i]=e.style[i],e.style[i]=t[i];n.call(e);for(i in t)e.style[i]=r[i]}}),s.curCSS=s.css,s.each(["height","width"],function(e,t){s.cssHooks[t]={get:function(e,n,r){var i;if(n)return e.offsetWidth!==0?Lt(e,t,r):(s.swap(e,St,function(){i=Lt(e,t,r)}),i)},set:function(e,t){if(!bt.test(t))return t;t=parseFloat(t);if(t>=0)return t+"px"}}}),s.support.opacity||(s.cssHooks.opacity={get:function(e,t){return gt.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?parseFloat(RegExp.$1)/100+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,i=s.isNumeric(t)?"alpha(opacity="+t*100+")":"",o=r&&r.filter||n.filter||"";n.zoom=1;if(t>=1&&s.trim(o.replace(mt,""))===""){n.removeAttribute("filter");if(r&&!r.filter)return}n.filter=mt.test(o)?o.replace(mt,i):o+" "+i}}),s(function(){s.support.reliableMarginRight||(s.cssHooks.marginRight={get:function(e,t){var n;return s.swap(e,{display:"inline-block"},function(){t?n=Nt(e,"margin-right","marginRight"):n=e.style.marginRight}),n}})}),n.defaultView&&n.defaultView.getComputedStyle&&(Ct=function(e,t){var n,r,i;return t=t.replace(yt,"-$1").toLowerCase(),(r=e.ownerDocument.defaultView)&&(i=r.getComputedStyle(e,null))&&(n=i.getPropertyValue(t),n===""&&!s.contains(e.ownerDocument.documentElement,e)&&(n=s.style(e,t))),n}),n.documentElement.currentStyle&&(kt=function(e,t){var n,r,i,s=e.currentStyle&&e.currentStyle[t],o=e.style;return s===null&&o&&(i=o[t])&&(s=i),!bt.test(s)&&wt.test(s)&&(n=o.left,r=e.runtimeStyle&&e.runtimeStyle.left,r&&(e.runtimeStyle.left=e.currentStyle.left),o.left=t==="fontSize"?"1em":s||0,s=o.pixelLeft+"px",o.left=n,r&&(e.runtimeStyle.left=r)),s===""?"auto":s}),Nt=Ct||kt,s.expr&&s.expr.filters&&(s.expr.filters.hidden=function(e){var t=e.offsetWidth,n=e.offsetHeight;return t===0&&n===0||!s.support.reliableHiddenOffsets&&(e.style&&e.style.display||s.css(e,"display"))==="none"},s.expr.filters.visible=function(e){return!s.expr.filters.hidden(e)});var At=/%20/g,Ot=/\[\]$/,Mt=/\r?\n/g,_t=/#.*$/,Dt=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,Pt=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,Ht=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,Bt=/^(?:GET|HEAD)$/,jt=/^\/\//,Ft=/\?/,It=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,qt=/^(?:select|textarea)/i,Rt=/\s+/,Ut=/([?&])_=[^&]*/,zt=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,Wt=s.fn.load,Xt={},Vt={},$t,Jt,Kt=["*/"]+["*"];try{$t=i.href}catch(Qt){$t=n.createElement("a"),$t.href="",$t=$t.href}Jt=zt.exec($t.toLowerCase())||[],s.fn.extend({load:function(e,n,r){if(typeof e!="string"&&Wt)return Wt.apply(this,arguments);if(!this.length)return this;var i=e.indexOf(" ");if(i>=0){var o=e.slice(i,e.length);e=e.slice(0,i)}var u="GET";n&&(s.isFunction(n)?(r=n,n=t):typeof n=="object"&&(n=s.param(n,s.ajaxSettings.traditional),u="POST"));var a=this;return s.ajax({url:e,type:u,dataType:"html",data:n,complete:function(e,t,n){n=e.responseText,e.isResolved()&&(e.done(function(e){n=e}),a.html(o?s("<div>").append(n.replace(It,"")).find(o):n)),r&&a.each(r,[n,t,e])}}),this},serialize:function(){return s.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?s.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||qt.test(this.nodeName)||Pt.test(this.type))}).map(function(e,t){var n=s(this).val();return n==null?null:s.isArray(n)?s.map(n,function(e,n){return{name:t.name,value:e.replace(Mt,"\r\n")}}):{name:t.name,value:n.replace(Mt,"\r\n")}}).get()}}),s.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(e,t){s.fn[t]=function(e){return this.on(t,e)}}),s.each(["get","post"],function(e,n){s[n]=function(e,r,i,o){return s.isFunction(r)&&(o=o||i,i=r,r=t),s.ajax({type:n,url:e,data:r,success:i,dataType:o})}}),s.extend({getScript:function(e,n){return s.get(e,t,n,"script")},getJSON:function(e,t,n){return s.get(e,t,n,"json")},ajaxSetup:function(e,t){return t?Zt(e,s.ajaxSettings):(t=e,e=s.ajaxSettings),Zt(e,t),e},ajaxSettings:{url:$t,isLocal:Ht.test(Jt[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":Kt},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":e.String,"text html":!0,"text json":s.parseJSON,"text xml":s.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:Gt(Xt),ajaxTransport:Gt(Vt),ajax:function(e,n){function S(e,n,c,h){if(y===2)return;y=2,m&&clearTimeout(m),v=t,p=h||"",E.readyState=e>0?4:0;var d,g,w,S=n,x=c?tn(r,E,c):t,T,N;if(e>=200&&e<300||e===304){if(r.ifModified){if(T=E.getResponseHeader("Last-Modified"))s.lastModified[l]=T;if(N=E.getResponseHeader("Etag"))s.etag[l]=N}if(e===304)S="notmodified",d=!0;else try{g=nn(r,x),S="success",d=!0}catch(C){S="parsererror",w=C}}else{w=S;if(!S||e)S="error",e<0&&(e=0)}E.status=e,E.statusText=""+(n||S),d?u.resolveWith(i,[g,S,E]):u.rejectWith(i,[E,S,w]),E.statusCode(f),f=t,b&&o.trigger("ajax"+(d?"Success":"Error"),[E,r,d?g:w]),a.fireWith(i,[E,S]),b&&(o.trigger("ajaxComplete",[E,r]),--s.active||s.event.trigger("ajaxStop"))}typeof e=="object"&&(n=e,e=t),n=n||{};var r=s.ajaxSetup({},n),i=r.context||r,o=i!==r&&(i.nodeType||i instanceof s)?s(i):s.event,u=s.Deferred(),a=s.Callbacks("once memory"),f=r.statusCode||{},l,c={},h={},p,d,v,m,g,y=0,b,w,E={readyState:0,setRequestHeader:function(e,t){if(!y){var n=e.toLowerCase();e=h[n]=h[n]||e,c[e]=t}return this},getAllResponseHeaders:function(){return y===2?p:null},getResponseHeader:function(e){var n;if(y===2){if(!d){d={};while(n=Dt.exec(p))d[n[1].toLowerCase()]=n[2]}n=d[e.toLowerCase()]}return n===t?null:n},overrideMimeType:function(e){return y||(r.mimeType=e),this},abort:function(e){return e=e||"abort",v&&v.abort(e),S(0,e),this}};u.promise(E),E.success=E.done,E.error=E.fail,E.complete=a.add,E.statusCode=function(e){if(e){var t;if(y<2)for(t in e)f[t]=[f[t],e[t]];else t=e[E.status],E.then(t,t)}return this},r.url=((e||r.url)+"").replace(_t,"").replace(jt,Jt[1]+"//"),r.dataTypes=s.trim(r.dataType||"*").toLowerCase().split(Rt),r.crossDomain==null&&(g=zt.exec(r.url.toLowerCase()),r.crossDomain=!(!g||g[1]==Jt[1]&&g[2]==Jt[2]&&(g[3]||(g[1]==="http:"?80:443))==(Jt[3]||(Jt[1]==="http:"?80:443)))),r.data&&r.processData&&typeof r.data!="string"&&(r.data=s.param(r.data,r.traditional)),Yt(Xt,r,n,E);if(y===2)return!1;b=r.global,r.type=r.type.toUpperCase(),r.hasContent=!Bt.test(r.type),b&&s.active++===0&&s.event.trigger("ajaxStart");if(!r.hasContent){r.data&&(r.url+=(Ft.test(r.url)?"&":"?")+r.data,delete r.data),l=r.url;if(r.cache===!1){var x=s.now(),T=r.url.replace(Ut,"$1_="+x);r.url=T+(T===r.url?(Ft.test(r.url)?"&":"?")+"_="+x:"")}}(r.data&&r.hasContent&&r.contentType!==!1||n.contentType)&&E.setRequestHeader("Content-Type",r.contentType),r.ifModified&&(l=l||r.url,s.lastModified[l]&&E.setRequestHeader("If-Modified-Since",s.lastModified[l]),s.etag[l]&&E.setRequestHeader("If-None-Match",s.etag[l])),E.setRequestHeader("Accept",r.dataTypes[0]&&r.accepts[r.dataTypes[0]]?r.accepts[r.dataTypes[0]]+(r.dataTypes[0]!=="*"?", "+Kt+"; q=0.01":""):r.accepts["*"]);for(w in r.headers)E.setRequestHeader(w,r.headers[w]);if(!r.beforeSend||r.beforeSend.call(i,E,r)!==!1&&y!==2){for(w in{success:1,error:1,complete:1})E[w](r[w]);v=Yt(Vt,r,n,E);if(!v)S(-1,"No Transport");else{E.readyState=1,b&&o.trigger("ajaxSend",[E,r]),r.async&&r.timeout>0&&(m=setTimeout(function(){E.abort("timeout")},r.timeout));try{y=1,v.send(c,S)}catch(N){if(!(y<2))throw N;S(-1,N)}}return E}return E.abort(),!1},param:function(e,n){var r=[],i=function(e,t){t=s.isFunction(t)?t():t,r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};n===t&&(n=s.ajaxSettings.traditional);if(s.isArray(e)||e.jquery&&!s.isPlainObject(e))s.each(e,function(){i(this.name,this.value)});else for(var o in e)en(o,e[o],n,i);return r.join("&").replace(At,"+")}}),s.extend({active:0,lastModified:{},etag:{}});var rn=s.now(),sn=/(\=)\?(&|$)|\?\?/i;s.ajaxSetup({jsonp:"callback",jsonpCallback:function(){return s.expando+"_"+rn++}}),s.ajaxPrefilter("json jsonp",function(t,n,r){var i=t.contentType==="application/x-www-form-urlencoded"&&typeof t.data=="string";if(t.dataTypes[0]==="jsonp"||t.jsonp!==!1&&(sn.test(t.url)||i&&sn.test(t.data))){var o,u=t.jsonpCallback=s.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,a=e[u],f=t.url,l=t.data,c="$1"+u+"$2";return t.jsonp!==!1&&(f=f.replace(sn,c),t.url===f&&(i&&(l=l.replace(sn,c)),t.data===l&&(f+=(/\?/.test(f)?"&":"?")+t.jsonp+"="+u))),t.url=f,t.data=l,e[u]=function(e){o=[e]},r.always(function(){e[u]=a,o&&s.isFunction(a)&&e[u](o[0])}),t.converters["script json"]=function(){return o||s.error(u+" was not called"),o[0]},t.dataTypes[0]="json","script"}}),s.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(e){return s.globalEval(e),e}}}),s.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),s.ajaxTransport("script",function(e){if(e.crossDomain){var r,i=n.head||n.getElementsByTagName("head")[0]||n.documentElement;return{send:function(s,o){r=n.createElement("script"),r.async="async",e.scriptCharset&&(r.charset=e.scriptCharset),r.src=e.url,r.onload=r.onreadystatechange=function(e,n){if(n||!r.readyState||/loaded|complete/.test(r.readyState))r.onload=r.onreadystatechange=null,i&&r.parentNode&&i.removeChild(r),r=t,n||o(200,"success")},i.insertBefore(r,i.firstChild)},abort:function(){r&&r.onload(0,1)}}}});var on=e.ActiveXObject?function(){for(var e in an)an[e](0,1)}:!1,un=0,an;s.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&fn()||ln()}:fn,function(e){s.extend(s.support,{ajax:!!e,cors:!!e&&"withCredentials"in e})}(s.ajaxSettings.xhr()),s.support.ajax&&s.ajaxTransport(function(n){if(!n.crossDomain||s.support.cors){var r;return{send:function(i,o){var u=n.xhr(),a,f;n.username?u.open(n.type,n.url,n.async,n.username,n.password):u.open(n.type,n.url,n.async);if(n.xhrFields)for(f in n.xhrFields)u[f]=n.xhrFields[f];n.mimeType&&u.overrideMimeType&&u.overrideMimeType(n.mimeType),!n.crossDomain&&!i["X-Requested-With"]&&(i["X-Requested-With"]="XMLHttpRequest");try{for(f in i)u.setRequestHeader(f,i[f])}catch(l){}u.send(n.hasContent&&n.data||null),r=function(e,i){var f,l,c,h,p;try{if(r&&(i||u.readyState===4)){r=t,a&&(u.onreadystatechange=s.noop,on&&delete an[a]);if(i)u.readyState!==4&&u.abort();else{f=u.status,c=u.getAllResponseHeaders(),h={},p=u.responseXML,p&&p.documentElement&&(h.xml=p),h.text=u.responseText;try{l=u.statusText}catch(d){l=""}!f&&n.isLocal&&!n.crossDomain?f=h.text?200:404:f===1223&&(f=204)}}}catch(v){i||o(-1,v)}h&&o(f,l,h,c)},!n.async||u.readyState===4?r():(a=++un,on&&(an||(an={},s(e).unload(on)),an[a]=r),u.onreadystatechange=r)},abort:function(){r&&r(0,1)}}}});var cn={},hn,pn,dn=/^(?:toggle|show|hide)$/,vn=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,mn,gn=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]],yn;s.fn.extend({show:function(e,t,n){var r,i;if(e||e===0)return this.animate(En("show",3),e,t,n);for(var o=0,u=this.length;o<u;o++)r=this[o],r.style&&(i=r.style.display,!s._data(r,"olddisplay")&&i==="none"&&(i=r.style.display=""),i===""&&s.css(r,"display")==="none"&&s._data(r,"olddisplay",Sn(r.nodeName)));for(o=0;o<u;o++){r=this[o];if(r.style){i=r.style.display;if(i===""||i==="none")r.style.display=s._data(r,"olddisplay")||""}}return this},hide:function(e,t,n){if(e||e===0)return this.animate(En("hide",3),e,t,n);var r,i,o=0,u=this.length;for(;o<u;o++)r=this[o],r.style&&(i=s.css(r,"display"),i!=="none"&&!s._data(r,"olddisplay")&&s._data(r,"olddisplay",i));for(o=0;o<u;o++)this[o].style&&(this[o].style.display="none");return this},_toggle:s.fn.toggle,toggle:function(e,t,n){var r=typeof e=="boolean";return s.isFunction(e)&&s.isFunction(t)?this._toggle.apply(this,arguments):e==null||r?this.each(function(){var t=r?e:s(this).is(":hidden");s(this)[t?"show":"hide"]()}):this.animate(En("toggle",3),e,t,n),this},fadeTo:function(e,t,n,r){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){function o(){i.queue===!1&&s._mark(this);var t=s.extend({},i),n=this.nodeType===1,r=n&&s(this).is(":hidden"),o,u,a,f,l,c,h,p,d;t.animatedProperties={};for(a in e){o=s.camelCase(a),a!==o&&(e[o]=e[a],delete e[a]),u=e[o],s.isArray(u)?(t.animatedProperties[o]=u[1],u=e[o]=u[0]):t.animatedProperties[o]=t.specialEasing&&t.specialEasing[o]||t.easing||"swing";if(u==="hide"&&r||u==="show"&&!r)return t.complete.call(this);n&&(o==="height"||o==="width")&&(t.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY],s.css(this,"display")==="inline"&&s.css(this,"float")==="none"&&(!s.support.inlineBlockNeedsLayout||Sn(this.nodeName)==="inline"?this.style.display="inline-block":this.style.zoom=1))}t.overflow!=null&&(this.style.overflow="hidden");for(a in e)f=new s.fx(this,t,a),u=e[a],dn.test(u)?(d=s._data(this,"toggle"+a)||(u==="toggle"?r?"show":"hide":0),d?(s._data(this,"toggle"+a,d==="show"?"hide":"show"),f[d]()):f[u]()):(l=vn.exec(u),c=f.cur(),l?(h=parseFloat(l[2]),p=l[3]||(s.cssNumber[a]?"":"px"),p!=="px"&&(s.style(this,a,(h||1)+p),c=(h||1)/f.cur()*c,s.style(this,a,c+p)),l[1]&&(h=(l[1]==="-="?-1:1)*h+c),f.custom(c,h,p)):f.custom(c,u,""));return!0}var i=s.speed(t,n,r);return s.isEmptyObject(e)?this.each(i.complete,[!1]):(e=s.extend({},e),i.queue===!1?this.each(o):this.queue(i.queue,o))},stop:function(e,n,r){return typeof e!="string"&&(r=n,n=e,e=t),n&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){function u(e,t,n){var i=t[n];s.removeData(e,n,!0),i.stop(r)}var t,n=!1,i=s.timers,o=s._data(this);r||s._unmark(!0,this);if(e==null)for(t in o)o[t]&&o[t].stop&&t.indexOf(".run")===t.length-4&&u(this,o,t);else o[t=e+".run"]&&o[t].stop&&u(this,o,t);for(t=i.length;t--;)i[t].elem===this&&(e==null||i[t].queue===e)&&(r?i[t](!0):i[t].saveState(),n=!0,i.splice(t,1));(!r||!n)&&s.dequeue(this,e)})}}),s.each({slideDown:En("show",1),slideUp:En("hide",1),slideToggle:En("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){s.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),s.extend({speed:function(e,t,n){var r=e&&typeof e=="object"?s.extend({},e):{complete:n||!n&&t||s.isFunction(e)&&e,duration:e,easing:n&&t||t&&!s.isFunction(t)&&t};r.duration=s.fx.off?0:typeof r.duration=="number"?r.duration:r.duration in s.fx.speeds?s.fx.speeds[r.duration]:s.fx.speeds._default;if(r.queue==null||r.queue===!0)r.queue="fx";return r.old=r.complete,r.complete=function(e){s.isFunction(r.old)&&r.old.call(this),r.queue?s.dequeue(this,r.queue):e!==!1&&s._unmark(this)},r},easing:{linear:function(e,t,n,r){return n+r*e},swing:function(e,t,n,r){return(-Math.cos(e*Math.PI)/2+.5)*r+n}},timers:[],fx:function(e,t,n){this.options=t,this.elem=e,this.prop=n,t.orig=t.orig||{}}}),s.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this),(s.fx.step[this.prop]||s.fx.step._default)(this)},cur:function(){if(this.elem[this.prop]==null||!!this.elem.style&&this.elem.style[this.prop]!=null){var e,t=s.css(this.elem,this.prop);return isNaN(e=parseFloat(t))?!t||t==="auto"?0:t:e}return this.elem[this.prop]},custom:function(e,n,r){function u(e){return i.step(e)}var i=this,o=s.fx;this.startTime=yn||bn(),this.end=n,this.now=this.start=e,this.pos=this.state=0,this.unit=r||this.unit||(s.cssNumber[this.prop]?"":"px"),u.queue=this.options.queue,u.elem=this.elem,u.saveState=function(){i.options.hide&&s._data(i.elem,"fxshow"+i.prop)===t&&s._data(i.elem,"fxshow"+i.prop,i.start)},u()&&s.timers.push(u)&&!mn&&(mn=setInterval(o.tick,o.interval))},show:function(){var e=s._data(this.elem,"fxshow"+this.prop);this.options.orig[this.prop]=e||s.style(this.elem,this.prop),this.options.show=!0,e!==t?this.custom(this.cur(),e):this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur()),s(this.elem).show()},hide:function(){this.options.orig[this.prop]=s._data(this.elem,"fxshow"+this.prop)||s.style(this.elem,this.prop),this.options.hide=!0,this.custom(this.cur(),0)},step:function(e){var t,n,r,i=yn||bn(),o=!0,u=this.elem,a=this.options;if(e||i>=a.duration+this.startTime){this.now=this.end,this.pos=this.state=1,this.update(),a.animatedProperties[this.prop]=!0;for(t in a.animatedProperties)a.animatedProperties[t]!==!0&&(o=!1);if(o){a.overflow!=null&&!s.support.shrinkWrapBlocks&&s.each(["","X","Y"],function(e,t){u.style["overflow"+t]=a.overflow[e]}),a.hide&&s(u).hide();if(a.hide||a.show)for(t in a.animatedProperties)s.style(u,t,a.orig[t]),s.removeData(u,"fxshow"+t,!0),s.removeData(u,"toggle"+t,!0);r=a.complete,r&&(a.complete=!1,r.call(u))}return!1}return a.duration==Infinity?this.now=i:(n=i-this.startTime,this.state=n/a.duration,this.pos=s.easing[a.animatedProperties[this.prop]](this.state,n,0,1,a.duration),this.now=this.start+(this.end-this.start)*this.pos),this.update(),!0}},s.extend(s.fx,{tick:function(){var e,t=s.timers,n=0;for(;n<t.length;n++)e=t[n],!e()&&t[n]===e&&t.splice(n--,1);t.length||s.fx.stop()},interval:13,stop:function(){clearInterval(mn),mn=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(e){s.style(e.elem,"opacity",e.now)},_default:function(e){e.elem.style&&e.elem.style[e.prop]!=null?e.elem.style[e.prop]=e.now+e.unit:e.elem[e.prop]=e.now}}}),s.each(["width","height"],function(e,t){s.fx.step[t]=function(e){s.style(e.elem,t,Math.max(0,e.now)+e.unit)}}),s.expr&&s.expr.filters&&(s.expr.filters.animated=function(e){return s.grep(s.timers,function(t){return e===t.elem}).length});var xn=/^t(?:able|d|h)$/i,Tn=/^(?:body|html)$/i;"getBoundingClientRect"in n.documentElement?s.fn.offset=function(e){var t=this[0],n;if(e)return this.each(function(t){s.offset.setOffset(this,e,t)});if(!t||!t.ownerDocument)return null;if(t===t.ownerDocument.body)return s.offset.bodyOffset(t);try{n=t.getBoundingClientRect()}catch(r){}var i=t.ownerDocument,o=i.documentElement;if(!n||!s.contains(o,t))return n?{top:n.top,left:n.left}:{top:0,left:0};var u=i.body,a=Nn(i),f=o.clientTop||u.clientTop||0,l=o.clientLeft||u.clientLeft||0,c=a.pageYOffset||s.support.boxModel&&o.scrollTop||u.scrollTop,h=a.pageXOffset||s.support.boxModel&&o.scrollLeft||u.scrollLeft,p=n.top+c-f,d=n.left+h-l;return{top:p,left:d}}:s.fn.offset=function(e){var t=this[0];if(e)return this.each(function(t){s.offset.setOffset(this,e,t)});if(!t||!t.ownerDocument)return null;if(t===t.ownerDocument.body)return s.offset.bodyOffset(t);var n,r=t.offsetParent,i=t,o=t.ownerDocument,u=o.documentElement,a=o.body,f=o.defaultView,l=f?f.getComputedStyle(t,null):t.currentStyle,c=t.offsetTop,h=t.offsetLeft;while((t=t.parentNode)&&t!==a&&t!==u){if(s.support.fixedPosition&&l.position==="fixed")break;n=f?f.getComputedStyle(t,null):t.currentStyle,c-=t.scrollTop,h-=t.scrollLeft,t===r&&(c+=t.offsetTop,h+=t.offsetLeft,s.support.doesNotAddBorder&&(!s.support.doesAddBorderForTableAndCells||!xn.test(t.nodeName))&&(c+=parseFloat(n.borderTopWidth)||0,h+=parseFloat(n.borderLeftWidth)||0),i=r,r=t.offsetParent),s.support.subtractsBorderForOverflowNotVisible&&n.overflow!=="visible"&&(c+=parseFloat(n.borderTopWidth)||0,h+=parseFloat(n.borderLeftWidth)||0),l=n}if(l.position==="relative"||l.position==="static")c+=a.offsetTop,h+=a.offsetLeft;return s.support.fixedPosition&&l.position==="fixed"&&(c+=Math.max(u.scrollTop,a.scrollTop),h+=Math.max(u.scrollLeft,a.scrollLeft)),{top:c,left:h}},s.offset={bodyOffset:function(e){var t=e.offsetTop,n=e.offsetLeft;return s.support.doesNotIncludeMarginInBodyOffset&&(t+=parseFloat(s.css(e,"marginTop"))||0,n+=parseFloat(s.css(e,"marginLeft"))||0),{top:t,left:n}},setOffset:function(e,t,n){var r=s.css(e,"position");r==="static"&&(e.style.position="relative");var i=s(e),o=i.offset(),u=s.css(e,"top"),a=s.css(e,"left"),f=(r==="absolute"||r==="fixed")&&s.inArray("auto",[u,a])>-1,l={},c={},h,p;f?(c=i.position(),h=c.top,p=c.left):(h=parseFloat(u)||0,p=parseFloat(a)||0),s.isFunction(t)&&(t=t.call(e,n,o)),t.top!=null&&(l.top=t.top-o.top+h),t.left!=null&&(l.left=t.left-o.left+p),"using"in t?t.using.call(e,l):i.css(l)}},s.fn.extend({position:function(){if(!this[0])return null;var e=this[0],t=this.offsetParent(),n=this.offset(),r=Tn.test(t[0].nodeName)?{top:0,left:0}:t.offset();return n.top-=parseFloat(s.css(e,"marginTop"))||0,n.left-=parseFloat(s.css(e,"marginLeft"))||0,r.top+=parseFloat(s.css(t[0],"borderTopWidth"))||0,r.left+=parseFloat(s.css(t[0],"borderLeftWidth"))||0,{top:n.top-r.top,left:n.left-r.left}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||n.body;while(e&&!Tn.test(e.nodeName)&&s.css(e,"position")==="static")e=e.offsetParent;return e})}}),s.each(["Left","Top"],function(e,n){var r="scroll"+n;s.fn[r]=function(n){var i,o;return n===t?(i=this[0],i?(o=Nn(i),o?"pageXOffset"in o?o[e?"pageYOffset":"pageXOffset"]:s.support.boxModel&&o.document.documentElement[r]||o.document.body[r]:i[r]):null):this.each(function(){o=Nn(this),o?o.scrollTo(e?s(o).scrollLeft():n,e?n:s(o).scrollTop()):this[r]=n})}}),s.each(["Height","Width"],function(e,n){var r=n.toLowerCase();s.fn["inner"+n]=function(){var e=this[0];return e?e.style?parseFloat(s.css(e,r,"padding")):this[r]():null},s.fn["outer"+n]=function(e){var t=this[0];return t?t.style?parseFloat(s.css(t,r,e?"margin":"border")):this[r]():null},s.fn[r]=function(e){var i=this[0];if(!i)return e==null?null:this;if(s.isFunction(e))return this.each(function(t){var n=s(this);n[r](e.call(this,t,n[r]()))});if(s.isWindow(i)){var o=i.document.documentElement["client"+n],u=i.document.body;return i.document.compatMode==="CSS1Compat"&&o||u&&u["client"+n]||o}if(i.nodeType===9)return Math.max(i.documentElement["client"+n],i.body["scroll"+n],i.documentElement["scroll"+n],i.body["offset"+n],i.documentElement["offset"+n]);if(e===t){var a=s.css(i,r),f=parseFloat(a);return s.isNumeric(f)?f:a}return this.css(r,typeof e=="string"?e:e+"px")}}),e.jQuery=e.$=s,typeof pen.define=="function"&&pen.define.amd&&pen.define.amd.jQuery&&pen.define("jquery",[],function(){return s})}(window),pen.define("cdf/jquery",[],function(){}),pen.define("cdf/lib/CCC/protovis",[],function(){Array.prototype.map||(Array.prototype.map=function(e,t){var n=this.length,r=new Array(n);for(var i=0;i<n;i++)i in this&&(r[i]=e.call(t,this[i],i,this));return r}),Array.prototype.filter||(Array.prototype.filter=function(e,t){var n=this.length,r=new Array;for(var i=0;i<n;i++)if(i in this){var s=this[i];e.call(t,s,i,this)&&r.push(s)}return r}),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){var n=this.length>>>0;for(var r=0;r<n;r++)r in this&&e.call(t,this[r],r,this)}),Array.prototype.reduce||(Array.prototype.reduce=function(e,t){var n=this.length;if(!n&&arguments.length==1)throw new Error("reduce: empty array, no initial value");var r=0;if(arguments.length<2)for(;;){if(r in this){t=this[r++];break}if(++r>=n)throw new Error("reduce: no values, no initial value")}for(;r<n;r++)r in this&&(t=e(t,this[r],r,this));return t});var pv={};pv.version={major:3,minor:3},pv.identity=function(e){return e},pv.index=function(){return this.index},pv.child=function(){return this.childIndex},pv.parent=function(){return this.parent.index},pv.extend=function(e){function t(){}return t.prototype=e.prototype||e,new t};try{eval("pv.parse = function(x) x;")}catch(e){pv.parse=function(e){var t=new RegExp("function\\s*(\\b\\w+)?\\s*\\([^)]*\\)\\s*","mg"),n,r,i=0,s="";while(n=t.exec(e)){var o=n.index+n[0].length;if(e.charAt(o)!="{"){s+=e.substring(i,o)+"{return ",i=o;for(var u=0;u>=0&&o<e.length;o++){var a=e.charAt(o);switch(a){case'"':case"'":while(++o<e.length&&(r=e.charAt(o))!=a)r=="\\"&&o++;break;case"[":case"(":u++;break;case"]":case")":u--;break;case";":case",":u==0&&u--}}s+=pv.parse(e.substring(i,--o))+";}",i=o}t.lastIndex=o}return s+=e.substring(i),s}}return pv.css=function(e,t){return window.getComputedStyle?window.getComputedStyle(e,null).getPropertyValue(t):e.currentStyle[t]},pv.error=function(e){typeof console=="undefined"?alert(e):console.error(e)},pv.listen=function(e,t,n){return t=="load"||t=="onload"?pv.listenForPageLoad(pv.listener(n)):(n=pv.listener(n),e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n),n)},pv.unlisten=function(e,t,n){n.$listener&&(n=n.$listener),e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent("on"+t,n)},pv.listener=function(e){return e.$listener||(e.$listener=function(t){try{return pv.event=t,e.call(this,t)}catch(n){pv.error(n)}finally{delete pv.event}})},pv.ancestor=function(e,t){while(t){if(t==e)return!0;t=t.parentNode}return!1},pv.scrollOffset=function(e){var t=0,n=0;while(e)t+=e.scrollLeft||0,n+=e.scrollTop||0,e=e.parentNode;return[t,n]},pv.listenForPageLoad=function(e){document.readyState==="complete"&&e(),pv.renderer()=="svgweb"?window.addEventListener("SVGLoad",e,!1):document.addEventListener?window.addEventListener("load",e,!1):document.attachEvent&&window.attachEvent("onload",e)},pv.renderer=function(){var e=typeof document.svgImplementation!="undefined"?document.svgImplementation:typeof window.svgweb=="undefined"?"nativesvg":"svgweb";return pv.renderer=function(){return e},e},pv.id=function(){var e=1;return function(){return e++}}(),pv.functor=function(e){return typeof e=="function"?e:function(){return e}},pv.get=function(e,t,n){var r;return e&&(r=e[t])!=null?r:n},pv.renderer()!=="batik"&&pv.listen(window,"load",function(){pv.$={i:0,x:document.getElementsByTagName("script")},pv.$.xlen=pv.$.x.length;for(;pv.$.i<pv.$.xlen;pv.$.i++){pv.$.s=pv.$.x[pv.$.i];if(pv.$.s.type=="text/javascript+protovis")try{window.eval(pv.parse(pv.$.s.text))}catch(e){pv.error(e)}}delete pv.$}),pv.Format={},pv.Format.re=function(e){return e.replace(/[\\\^\$\*\+\?\[\]\(\)\.\{\}]/g,"\\$&")},pv.Format.pad=function(e,t,n){var r=t-String(n).length;return r<1?n:(new Array(r+1)).join(e)+n},pv.Format.date=function(e){function n(n){return e.replace(/%[a-zA-Z0-9]/g,function(e){switch(e){case"%a":return["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][n.getDay()];case"%A":return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][n.getDay()];case"%h":case"%b":return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][n.getMonth()];case"%B":return["January","February","March","April","May","June","July","August","September","October","November","December"][n.getMonth()];case"%c":return n.toLocaleString();case"%C":return t("0",2,Math.floor(n.getFullYear()/100)%100);case"%d":return t("0",2,n.getDate());case"%x":case"%D":return t("0",2,n.getMonth()+1)+"/"+t("0",2,n.getDate())+"/"+t("0",2,n.getFullYear()%100);case"%e":return t(" ",2,n.getDate());case"%H":return t("0",2,n.getHours());case"%I":var r=n.getHours()%12;return r?t("0",2,r):12;case"%m":return t("0",2,n.getMonth()+1);case"%M":return t("0",2,n.getMinutes());case"%n":return"\n";case"%p":return n.getHours()<12?"AM":"PM";case"%T":case"%X":case"%r":var r=n.getHours()%12;return(r?t("0",2,r):12)+":"+t("0",2,n.getMinutes())+":"+t("0",2,n.getSeconds())+" "+(n.getHours()<12?"AM":"PM");case"%R":return t("0",2,n.getHours())+":"+t("0",2,n.getMinutes());case"%S":return t("0",2,n.getSeconds());case"%Q":return t("0",3,n.getMilliseconds());case"%t":return"	";case"%u":var i=n.getDay();return i?i:1;case"%w":return n.getDay();case"%y":return t("0",2,n.getFullYear()%100);case"%Y":return n.getFullYear();case"%%":return"%"}return e})}var t=pv.Format.pad;return n.format=n,n.parse=function(t){var n=1970,r=0,i=1,s=0,o=0,u=0,a=[function(){}],f=pv.Format.re(e).replace(/%[a-zA-Z0-9]/g,function(e){switch(e){case"%b":return a.push(function(e){r={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11}[e]}),"([A-Za-z]+)";case"%h":case"%B":return a.push(function(e){r={January:0,February:1,March:2,April:3,May:4,June:5,July:6,August:7,September:8,October:9,November:10,December:11}[e]}),"([A-Za-z]+)";case"%e":case"%d":return a.push(function(e){i=e}),"([0-9]+)";case"%I":case"%H":return a.push(function(e){s=e}),"([0-9]+)";case"%m":return a.push(function(e){r=e-1}),"([0-9]+)";case"%M":return a.push(function(e){o=e}),"([0-9]+)";case"%p":return a.push(function(e){s==12?e=="am"&&(s=0):e=="pm"&&(s=Number(s)+12)}),"(am|pm)";case"%S":return a.push(function(e){u=e}),"([0-9]+)";case"%y":return a.push(function(e){e=Number(e),n=e+(0<=e&&e<69?2e3:e>=69&&e<100?1900:0)}),"([0-9]+)";case"%Y":return a.push(function(e){n=e}),"([0-9]+)";case"%%":return a.push(function(){}),"%"}return e}),l=t.match(f);return l&&l.forEach(function(e,t){a[t](e)}),new Date(n,r,i,s,o,u)},n},pv.Format.time=function(e){function n(n){n=Number(n);switch(e){case"short":if(n>=31536e6)return(n/31536e6).toFixed(1)+" years";if(n>=6048e5)return(n/6048e5).toFixed(1)+" weeks";if(n>=864e5)return(n/864e5).toFixed(1)+" days";if(n>=36e5)return(n/36e5).toFixed(1)+" hours";if(n>=6e4)return(n/6e4).toFixed(1)+" minutes";return(n/1e3).toFixed(1)+" seconds";case"long":var r=[],i=n%6e4/1e3>>0,s=n%36e5/6e4>>0;r.push(t("0",2,i));if(n>=36e5){var o=n%864e5/36e5>>0;r.push(t("0",2,s)),n>=864e5?(r.push(t("0",2,o)),r.push(Math.floor(n/864e5).toFixed())):r.push(o.toFixed())}else r.push(s.toFixed());return r.reverse().join(":")}}var t=pv.Format.pad;return n.format=n,n.parse=function(t){switch(e){case"short":var n=/([0-9,.]+)\s*([a-z]+)/g,r,i=0;while(r=n.exec(t)){var s=parseFloat(r[0].replace(",","")),o=0;switch(r[2].toLowerCase()){case"year":case"years":o=31536e6;break;case"week":case"weeks":o=6048e5;break;case"day":case"days":o=864e5;break;case"hour":case"hours":o=36e5;break;case"minute":case"minutes":o=6e4;break;case"second":case"seconds":o=1e3}i+=s*o}return i;case"long":var r=t.replace(",","").split(":").reverse(),i=0;return r.length&&(i+=parseFloat(r[0])*1e3),r.length>1&&(i+=parseFloat(r[1])*6e4),r.length>2&&(i+=parseFloat(r[2])*36e5),r.length>3&&(i+=parseFloat(r[3])*864e5),i}},n},pv.Format.number=function(){function p(p){Infinity>i&&(p=Math.round(p*s)/s);var d=String(Math.abs(p)).split("."),v=d[0];v.length>t&&(v=v.substring(v.length-t)),a&&v.length<e&&(v=(new Array(e-v.length+1)).join(o)+v),v.length>3&&(v=v.replace(/\B(?=(?:\d{3})+(?!\d))/g,l)),!a&&v.length<n&&(v=(new Array(n-v.length+1)).join(o)+v),d[0]=p<0?c+v+h:v;var m=d[1]||"";return m.length>i&&(m=d[1]=m.substr(0,i)),m.length<r&&(d[1]=m+(new Array(r-m.length+1)).join(u)),d.join(f)}var e=0,t=Infinity,n=0,r=0,i=0,s=1,o="0",u="0",a=!0,f=".",l=",",c="−",h="";return p.format=p,p.parse=function(e){var n=pv.Format.re,r=String(e).split(f);r.length==1&&(r[1]=""),r[0].replace(new RegExp("^("+n(o)+")*"),""),r[1].replace(new RegExp("("+n(u)+")*$"),"");var a=r[0].replace(new RegExp(n(l),"g"),"");a.length>t&&(a=a.substring(a.length-t));var c=r[1]?Number("0."+r[1]):0;return Infinity>i&&(c=Math.round(c*s)/s),Math.round(a)+c},p.integerDigits=function(r,i){return arguments.length?(e=Number(r),t=arguments.length>1?Number(i):e,n=e+Math.floor(e/3)*l.length,this):[e,t]},p.fractionDigits=function(e,t){return arguments.length?(r=Number(e),i=arguments.length>1?Number(t):r,s=Math.pow(10,i),this):[r,i]},p.integerPad=function(e){return arguments.length?(o=String(e),a=/\d/.test(o),this):o},p.fractionPad=function(e){return arguments.length?(u=String(e),this):u},p.decimal=function(e){return arguments.length?(f=String(e),this):f},p.group=function(t){return arguments.length?(l=t?String(t):"",n=e+Math.floor(e/3)*l.length,this):l},p.negativeAffix=function(e,t){return arguments.length?(c=String(e||""),h=String(t||""),this):[c,h]},p},pv.map=function(e,t){var n={};return t?e.map(function(e,r){return n.index=r,t.call(n,e)}):e.slice()},pv.repeat=function(e,t){return arguments.length==1&&(t=2),pv.blend(pv.range(t).map(function(){return e}))},pv.array=function(e,t){var n=e>=0?new Array(e):[];if(t!==undefined)for(var r=0;r<e;r++)n[r]=t;return n},pv.cross=function(e,t){var n=[];for(var r=0,i=e.length,s=t.length;r<i;r++)for(var o=0,u=e[r];o<s;o++)n.push([u,t[o]]);return n},pv.blend=function(e){return Array.prototype.concat.apply([],e)},pv.transpose=function(e){var t=e.length,n=pv.max(e,function(e){return e.length});if(n>t){e.length=n;for(var r=t;r<n;r++)e[r]=new Array(t);for(var r=0;r<t;r++)for(var i=r+1;i<n;i++){var s=e[r][i];e[r][i]=e[i][r],e[i][r]=s}}else{for(var r=0;r<n;r++)e[r].length=t;for(var r=0;r<t;r++)for(var i=0;i<r;i++){var s=e[r][i];e[r][i]=e[i][r],e[i][r]=s}}e.length=n;for(var r=0;r<n;r++)e[r].length=t;return e},pv.normalize=function(e,t){var n=pv.map(e,t),r=pv.sum(n);for(var i=0;i<n.length;i++)n[i]/=r;return n},pv.permute=function(e,t,n){n||(n=pv.identity);var r=new Array(t.length),i={};return t.forEach(function(t,s){i.index=t,r[s]=n.call(i,e[t])}),r},pv.numerate=function(e,t){t||(t=pv.identity);var n={},r={};return e.forEach(function(e,i){r.index=i,n[t.call(r,e)]=i}),n},pv.uniq=function(e,t){t||(t=pv.identity);var n={},r=[],i={},s;return e.forEach(function(e,u){i.index=u,s=t.call(i,e),s in n||(n[s]=r.push(s))}),r},pv.naturalOrder=function(e,t){return e<t?-1:e>t?1:0},pv.reverseOrder=function(e,t){return t<e?-1:t>e?1:0},pv.search=function(e,t,n){n||(n=pv.identity);var r=0,i=e.length-1;while(r<=i){var s=r+i>>1,o=n(e[s]);if(o<t)r=s+1;else{if(!(o>t))return s;i=s-1}}return-r-1},pv.search.index=function(e,t,n){var r=pv.search(e,t,n);return r<0?-r-1:r},pv.range=function(e,t,n){arguments.length==1&&(t=e,e=0),n==undefined&&(n=1);if((t-e)/n==Infinity)throw new Error("range must be finite");var r=[],i=0,s;t-=(t-e)*1e-10;if(n<0)while((s=e+n*i++)>t)r.push(s);else while((s=e+n*i++)<t)r.push(s);return r},pv.random=function(e,t,n){return arguments.length==1&&(t=e,e=0),n==undefined&&(n=1),n?Math.floor(Math.random()*(t-e)/n)*n+e:Math.random()*(t-e)+e},pv.sum=function(e,t){var n={};return e.reduce(t?function(e,r,i){return n.index=i,e+t.call(n,r)}:function(e,t){return e+t},0)},pv.max=function(e,t){return t==pv.index?e.length-1:Math.max.apply(null,t?pv.map(e,t):e)},pv.max.index=function(e,t){if(!e.length)return-1;if(t==pv.index)return e.length-1;t||(t=pv.identity);var n=0,r=-Infinity,i={};for(var s=0;s<e.length;s++){i.index=s;var o=t.call(i,e[s]);o>r&&(r=o,n=s)}return n},pv.min=function(e,t){return t==pv.index?0:Math.min.apply(null,t?pv.map(e,t):e)},pv.min.index=function(e,t){if(!e.length)return-1;if(t==pv.index)return 0;t||(t=pv.identity);var n=0,r=Infinity,i={};for(var s=0;s<e.length;s++){i.index=s;var o=t.call(i,e[s]);o<r&&(r=o,n=s)}return n},pv.mean=function(e,t){return pv.sum(e,t)/e.length},pv.median=function(e,t){if(t==pv.index)return(e.length-1)/2;e=pv.map(e,t).sort(pv.naturalOrder);if(e.length%2)return e[Math.floor(e.length/2)];var n=e.length/2;return(e[n-1]+e[n])/2},pv.variance=function(e,t){if(e.length<1)return NaN;if(e.length==1)return 0;var n=pv.mean(e,t),r=0,i={};t||(t=pv.identity);for(var s=0;s<e.length;s++){i.index=s;var o=t.call(i,e[s])-n;r+=o*o}return r},pv.deviation=function(e,t){return Math.sqrt(pv.variance(e,t)/(e.length-1))},pv.log=function(e,t){return Math.log(e)/Math.log(t)},pv.logSymmetric=function(e,t){return e==0?0:e<0?-pv.log(-e,t):pv.log(e,t)},pv.logAdjusted=function(e,t){if(!isFinite(e))return e;var n=e<0;return e<t&&(e+=(t-e)/t),n?-pv.log(e,t):pv.log(e,t)},pv.logFloor=function(e,t){return e>0?Math.pow(t,Math.floor(pv.log(e,t))):-Math.pow(t,-Math.floor(-pv.log(-e,t)))},pv.logCeil=function(e,t){return e>0?Math.pow(t,Math.ceil(pv.log(e,t))):-Math.pow(t,-Math.ceil(-pv.log(-e,t)))},function(){var e=Math.PI/180,t=180/Math.PI;pv.radians=function(t){return e*t},pv.degrees=function(e){return t*e}}(),pv.keys=function(e){var t=[];for(var n in e)t.push(n);return t},pv.entries=function(e){var t=[];for(var n in e)t.push({key:n,value:e[n]});return t},pv.values=function(e){var t=[];for(var n in e)t.push(e[n]);return t},pv.dict=function(e,t){var n={},r={};for(var i=0;i<e.length;i++)if(i in e){var s=e[i];r.index=i,n[s]=t.call(r,s)}return n},pv.dom=function(e){return new pv.Dom(e)},pv.Dom=function(e){this.$map=e},pv.Dom.prototype.$leaf=function(e){return typeof e!="object"},pv.Dom.prototype.leaf=function(e){return arguments.length?(this.$leaf=e,this):this.$leaf},pv.Dom.prototype.root=function(e){function r(e){var n=new pv.Dom.Node;for(var i in e){var s=e[i];n.appendChild(t(s)?new pv.Dom.Node(s):r(s)).nodeName=i}return n}var t=this.$leaf,n=r(this.$map);return n.nodeName=e,n},pv.Dom.prototype.nodes=function(){return this.root().nodes()},pv.Dom.Node=function(e){this.nodeValue=e,this.childNodes=[]},pv.Dom.Node.prototype.parentNode=null,pv.Dom.Node.prototype.firstChild=null,pv.Dom.Node.prototype.lastChild=null,pv.Dom.Node.prototype.previousSibling=null,pv.Dom.Node.prototype.nextSibling=null,pv.Dom.Node.prototype.removeChild=function(e){var t=this.childNodes.indexOf(e);if(t==-1)throw new Error("child not found");return this.childNodes.splice(t,1),e.previousSibling?e.previousSibling.nextSibling=e.nextSibling:this.firstChild=e.nextSibling,e.nextSibling?e.nextSibling.previousSibling=e.previousSibling:this.lastChild=e.previousSibling,delete e.nextSibling,delete e.previousSibling,delete e.parentNode,e},pv.Dom.Node.prototype.appendChild=function(e){return e.parentNode&&e.parentNode.removeChild(e),e.parentNode=this,e.previousSibling=this.lastChild,this.lastChild?this.lastChild.nextSibling=e:this.firstChild=e,this.lastChild=e,this.childNodes.push(e),e},pv.Dom.Node.prototype.insertBefore=function(e,t){if(!t)return this.appendChild(e);var n=this.childNodes.indexOf(t);if(n==-1)throw new Error("child not found");return e.parentNode&&e.parentNode.removeChild(e),e.parentNode=this,e.nextSibling=t,e.previousSibling=t.previousSibling,t.previousSibling?t.previousSibling.nextSibling=e:(t==this.lastChild&&(this.lastChild=e),this.firstChild=e),this.childNodes.splice(n,0,e),e},pv.Dom.Node.prototype.insertAt=function(e,t){var n;if(t==null||t===(n=this.childNodes.length))return this.appendChild(e);if(t>n)throw new Error("Index out of range.");e.parentNode&&e.parentNode.removeChild(e);var r=this.childNodes[t];return e.parentNode=this,e.nextSibling=r,e.previousSibling=r.previousSibling,r.previousSibling?r.previousSibling.nextSibling=e:(r==this.lastChild&&(this.lastChild=e),this.firstChild=e),this.childNodes.splice(t,0,e),e},pv.Dom.Node.prototype.removeAt=function(e){var t=this.childNodes[e];return t&&(this.childNodes.splice(e,1),t.previousSibling?t.previousSibling.nextSibling=t.nextSibling:this.firstChild=t.nextSibling,t.nextSibling?t.nextSibling.previousSibling=t.previousSibling:this.lastChild=t.previousSibling,delete t.nextSibling,delete t.previousSibling,delete t.parentNode),t},pv.Dom.Node.prototype.replaceChild=function(e,t){var n=this.childNodes.indexOf(t);if(n==-1)throw new Error("child not found");return e.parentNode&&e.parentNode.removeChild(e),e.parentNode=this,e.nextSibling=t.nextSibling,e.previousSibling=t.previousSibling,t.previousSibling?t.previousSibling.nextSibling=e:this.firstChild=e,t.nextSibling?t.nextSibling.previousSibling=e:this.lastChild=e,this.childNodes[n]=e,t},pv.Dom.Node.prototype.visitBefore=function(e){function t(n,r){e(n,r);for(var i=n.firstChild;i;i=i.nextSibling)t(i,r+1)}t(this,0)},pv.Dom.Node.prototype.visitAfter=function(e){function t(n,r){for(var i=n.firstChild;i;i=i.nextSibling)t(i,r+1);e(n,r)}t(this,0)},pv.Dom.Node.prototype.sort=function(e){if(this.firstChild){this.childNodes.sort(e);var t=this.firstChild=this.childNodes[0],n;delete t.previousSibling;for(var r=1;r<this.childNodes.length;r++)t.sort(e),n=this.childNodes[r],n.previousSibling=t,t=t.nextSibling=n;this.lastChild=t,delete t.nextSibling,t.sort(e)}return this},pv.Dom.Node.prototype.reverse=function(){var e=[];return this.visitAfter(function(t){while(t.lastChild)e.push(t.removeChild(t.lastChild));for(var n;n=e.pop();)t.insertBefore(n,t.firstChild)}),this},pv.Dom.Node.prototype.nodes=function(){function t(n){e.push(n),n.childNodes.forEach(t)}var e=[];return t(this,e),e},pv.Dom.Node.prototype.toggle=function(e){if(e)return this.toggled?this.visitBefore(function(e){e.toggled&&e.toggle()}):this.visitAfter(function(e){e.toggled||e.toggle()});var t=this;if(t.toggled){for(var n;n=t.toggled.pop();)t.appendChild(n);delete t.toggled}else if(t.lastChild){t.toggled=[];while(t.lastChild)t.toggled.push(t.removeChild(t.lastChild))}},pv.nodes=function(e){var t=new pv.Dom.Node;for(var n=0;n<e.length;n++)t.appendChild(new pv.Dom.Node(e[n]));return t.nodes()},pv.tree=function(e){return new pv.Tree(e)},pv.Tree=function(e){this.array=e},pv.Tree.prototype.keys=function(e){return this.k=e,this},pv.Tree.prototype.value=function(e){return this.v=e,this},pv.Tree.prototype.map=function(){var e={},t={};for(var n=0;n<this.array.length;n++){t.index=n;var r=this.array[n],i=this.k.call(t,r),s=e;for(var o=0;o<i.length-1;o++)s=s[i[o]]||(s[i[o]]={});s[i[o]]=this.v?this.v.call(t,r):r}return e},pv.nest=function(e){return new pv.Nest(e)},pv.Nest=function(e){this.array=e,this.keys=[]},pv.Nest.prototype.key=function(e){return this.keys.push(e),this},pv.Nest.prototype.sortKeys=function(e){return this.keys[this.keys.length-1].order=e||pv.naturalOrder,this},pv.Nest.prototype.sortValues=function(e){return this.order=e||pv.naturalOrder,this},pv.Nest.prototype.map=function(){var e={},t=[];for(var n,r=0;r<this.array.length;r++){var i=this.array[r],s=e;for(n=0;n<this.keys.length-1;n++){var o=this.keys[n](i);s[o]||(s[o]={}),s=s[o]}o=this.keys[n](i);if(!s[o]){var u=[];t.push(u),s[o]=u}s[o].push(i)}if(this.order)for(var n=0;n<t.length;n++)t[n].sort(this.order);return e},pv.Nest.prototype.entries=function(){function e(t){var n=[];for(var r in t){var i=t[r];n.push({key:r,values:i instanceof Array?i:e(i)})}return n}function t(e,n){var r=this.keys[n].order;r&&e.sort(function(e,t){return r(e.key,t.key)});if(++n<this.keys.length)for(var i=0;i<e.length;i++)t.call(this,e[i].values,n);return e}return t.call(this,e(this.map()),0)},pv.Nest.prototype.rollup=function(e){function t(n){for(var r in n){var i=n[r];i instanceof Array?n[r]=e(i):t(i)}return n}return t(this.map())},pv.flatten=function(e){return new pv.Flatten(e)},pv.Flatten=function(e){this.map=e,this.keys=[]},pv.Flatten.prototype.key=function(e,t){return this.keys.push({name:e,value:t}),delete this.$leaf,this},pv.Flatten.prototype.leaf=function(e){return this.keys.length=0,this.$leaf=e,this},pv.Flatten.prototype.array=function(){function s(r,i){if(i<n.length-1)for(var o in r)t.push(o),s(r[o],i+1),t.pop();else e.push(t.concat(r))}var e=[],t=[],n=this.keys,r=this.$leaf;if(r){function i(n,s){if(r(n))e.push({keys:t.slice(),value:n});else for(var o in n)t.push(o),i(n[o],s+1),t.pop()}return i(this.map,0),e}return s(this.map,0),e.map(function(e){var t={};for(var r=0;r<n.length;r++){var i=n[r],s=e[r];t[i.name]=i.value?i.value.call(null,s):s}return t})},pv.vector=function(e,t){return new pv.Vector(e,t)},pv.Vector=function(e,t){this.x=e,this.y=t},pv.Vector.prototype.perp=function(){return new pv.Vector(-this.y,this.x)},pv.Vector.prototype.rotate=function(e){var t=Math.cos(e),n=Math.sin(e);return new pv.Vector(t*this.x-n*this.y,n*this.x+t*this.y)},pv.Vector.prototype.norm=function(){var e=this.length();return this.times(e?1/e:1)},pv.Vector.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},pv.Vector.prototype.times=function(e){return new pv.Vector(this.x*e,this.y*e)},pv.Vector.prototype.plus=function(e,t){return arguments.length==1?new pv.Vector(this.x+e.x,this.y+e.y):new pv.Vector(this.x+e,this.y+t)},pv.Vector.prototype.minus=function(e,t){return arguments.length==1?new pv.Vector(this.x-e.x,this.y-e.y):new pv.Vector(this.x-e,this.y-t)},pv.Vector.prototype.dot=function(e,t){return arguments.length==1?this.x*e.x+this.y*e.y:this.x*e+this.y*t},pv.Transform=function(){},pv.Transform.prototype={k:1,x:0,y:0},pv.Transform.identity=new pv.Transform,pv.Transform.prototype.translate=function(e,t){var n=new pv.Transform;return n.k=this.k,n.x=this.k*e+this.x,n.y=this.k*t+this.y,n},pv.Transform.prototype.scale=function(e){var t=new pv.Transform;return t.k=this.k*e,t.x=this.x,t.y=this.y,t},pv.Transform.prototype.invert=function(){var e=new pv.Transform,t=1/this.k;return e.k=t,e.x=-this.x*t,e.y=-this.y*t,e},pv.Transform.prototype.times=function(e){var t=new pv.Transform;return t.k=this.k*e.k,t.x=this.k*e.x+this.x,t.y=this.k*e.y+this.y,t},pv.Scale=function(){},pv.Scale.interpolator=function(e,t){return typeof e=="number"?function(n){return n*(t-e)+e}:(e=pv.color(e).rgb(),t=pv.color(t).rgb(),function(n){var r=e.a*(1-n)+t.a*n;return r<1e-5&&(r=0),e.a==0?pv.rgb(t.r,t.g,t.b,r):t.a==0?pv.rgb(e.r,e.g,e.b,r):pv.rgb(Math.round(e.r*(1-n)+t.r*n),Math.round(e.g*(1-n)+t.g*n),Math.round(e.b*(1-n)+t.b*n),r)})},pv.Scale.quantitative=function(){function h(e){return new Date(e)}function p(n){var i=pv.search(e,n);return i<0&&(i=-i-2),i=Math.max(0,Math.min(r.length-1,i)),r[i]((o(n)-t[i])/(t[i+1]-t[i]))}var e=[0,1],t=[0,1],n=[0,1],r=[pv.identity],i=Number,s=!1,o=pv.identity,u=pv.identity,a=String,f=null,l,c;return p.transform=function(n,r){return o=function(e){return s?-n(-e):n(e)},u=function(e){return s?-r(-e):r(e)},t=e.map(o),this},p.domain=function(n,r,u){if(arguments.length){var a;return n instanceof Array?(arguments.length<2&&(r=pv.identity),arguments.length<3&&(u=r),a=n.length&&r(n[0]),e=n.length?[pv.min(n,r),pv.max(n,u)]:[]):(a=n,e=Array.prototype.slice.call(arguments).map(Number)),e.length?e.length==1&&(e=[e[0],e[0]]):e=[-Infinity,Infinity],s=(e[0]||e[e.length-1])<0,t=e.map(o),i=a instanceof Date?h:Number,this}return e.map(i)},p.range=function(){if(arguments.length){n=Array.prototype.slice.call(arguments),n.length?n.length==1&&(n=[n[0],n[0]]):n=[-Infinity,Infinity],r=[];for(var e=0;e<n.length-1;e++)r.push(pv.Scale.interpolator(n[e],n[e+1]));return this}return n},p.invert=function(e){var s=pv.search(n,e);return s<0&&(s=-s-2),s=Math.max(0,Math.min(r.length-1,s)),i(u(t[s]+(e-n[s])/(n[s+1]-n[s])*(t[s+1]-t[s])))},p.ticks=function(t,n){var r=e[0],s=e[e.length-1],o=s<r,u=o?s:r,f=o?r:s,p=f-u;if(!p||!isFinite(p))return i==h&&(a=pv.Format.date("%x")),[i(u)];if(i==h){function v(e,t){switch(t){case 31536e6:e.setMonth(0);case 2592e6:e.setDate(1);case 6048e5:t==6048e5&&e.setDate(e.getDate()-e.getDay());case 864e5:e.setHours(0);case 36e5:e.setMinutes(0);case 6e4:e.setSeconds(0);case 1e3:e.setMilliseconds(0)}}var m=5,g,y,b,w=1;p>=m*31536e6?(g=31536e6,y="%Y",b=function(e){e.setFullYear(e.getFullYear()+w)}):p>=m*2592e6?(g=2592e6,y="%m/%Y",b=function(e){e.setMonth(e.getMonth()+w)}):p>=m*6048e5?(g=6048e5,y="%m/%d",b=function(e){e.setDate(e.getDate()+7*w)}):p>=m*864e5?(g=864e5,y="%m/%d",b=function(e){e.setDate(e.getDate()+w)}):p>=m*36e5?(g=36e5,y="%I:%M %p",b=function(e){e.setHours(e.getHours()+w)}):p>=m*6e4?(g=6e4,y="%I:%M %p",b=function(e){e.setMinutes(e.getMinutes()+w)}):p>=m*1e3?(g=1e3,y="%I:%M:%S",b=function(e){e.setSeconds(e.getSeconds()+w)}):(g=1,y="%S.%Qs",b=function(e){e.setTime(e.getTime()+w)}),g=c?c:g,y=l?l:y,a=pv.Format.date(y);var E=new Date(u),S=[];v(E,g);var x=p/g;if(x>10)switch(g){case 36e5:w=x>20?6:3,E.setHours(Math.floor(E.getHours()/w)*w);break;case 2592e6:w=x>24?3:x>12?2:1,E.setMonth(Math.floor(E.getMonth()/w)*w);break;case 6048e5:w=x>15?3:x>10?2:1,E.setDate(Math.floor(E.getDate()/(7*w))*7*w);break;case 864e5:w=x>=30?5:x>=15?3:2,E.setDate(Math.floor(E.getDate()/w)*w);break;case 6e4:w=x>30?15:x>15?10:5,E.setMinutes(Math.floor(E.getMinutes()/w)*w);break;case 1e3:w=x>90?15:x>60?10:5,E.setSeconds(Math.floor(E.getSeconds()/w)*w);break;case 1:w=x>1e3?250:x>200?100:x>100?50:x>50?25:5,E.setMilliseconds(Math.floor(E.getMilliseconds()/w)*w);break;default:w=pv.logCeil(x/15,10),x/w<2?w/=5:x/w<5&&(w/=2),E.setFullYear(Math.floor(E.getFullYear()/w)*w)}c&&(w=1,b=function(e){e.setSeconds(e.getSeconds()+w*c/1e3)});for(;;){b(E);if(E>f)break;S.push(new Date(E))}return o?S.reverse():S}t==null&&(t=10);var T=pv.get(n,"roundInside",!0),N=pv.get(n,"numberExponentMin",-Infinity),C=pv.get(n,"numberExponentMax",+Infinity),k=Math.floor(pv.log(p/t,10)),L=!1;k>C?(k=C,L=!0):k<N&&(k=N,L=!0);var w=Math.pow(10,k),A=p/w,O=t/A;O<=.15&&k<C-1?w*=10:O<=.35?w*=5:O<=.75&&(w*=2),k=Math.floor(pv.log(w,10)+1e-10);var r=w*Math[T?"ceil":"floor"](u/w),s=w*Math[T?"floor":"ceil"](f/w);a=pv.Format.number().fractionDigits(Math.max(0,-k));var M=pv.range(r,s+w,w);return o&&M.reverse(),M.roundInside=T,M.step=w,M.exponent=k,M.exponentOverflow=L,M.exponentMin=N,M.exponentMax=C,M},p.dateTickFormat=function(){return arguments.length?(l=arguments[0],this):l},p.dateTickPrecision=function(){return arguments.length?(c=arguments[0],this):c},p.tickFormatter=function(e){return arguments.length?(f=e,this):f},p.tickFormat=function(e){var t=f||a;return t(e)},p.nice=function(){if(e.length!=2)return this;var n=e[0],r=e[e.length-1],i=r<n,s=i?r:n,u=i?n:r,a=u-s;if(!a||!isFinite(a))return this;var f=Math.pow(10,Math.round(Math.log(a)/Math.log(10))-1);return e=[Math.floor(s/f)*f,Math.ceil(u/f)*f],i&&e.reverse(),t=e.map(o),this},p.by=function(e){function t(){return p(e.apply(this,arguments))}for(var n in p)t[n]=p[n];return t},p.by1=function(e){function t(t){return p(e.call(this,t))}for(var n in p)t[n]=p[n];return t},p.domain.apply(p,arguments),p},pv.Scale.linear=function(){var e=pv.Scale.quantitative();return e.domain.apply(e,arguments),e},pv.Scale.log=function(){var e=pv.Scale.quantitative(1,10),t,n,r=function(e){return Math.log(e)/n},i=function(e){return Math.pow(t,e)};return e.ticks=function(){var n=e.domain(),s=n[0]<0,o=Math.floor(s?-r(-n[0]):r(n[0])),u=Math.ceil(s?-r(-n[1]):r(n[1])),a=[];if(s){a.push(-i(-o));for(;o++<u;)for(var f=t-1;f>0;f--)a.push(-i(-o)*f)}else{for(;o<u;o++)for(var f=1;f<t;f++)a.push(i(o)*f);a.push(i(o))}for(o=0;a[o]<n[0];o++);for(u=a.length;a[u-1]>n[1];u--);return a.slice(o,u)},e.tickFormat=function(e){return e.toPrecision(1)},e.nice=function(){var n=e.domain();return e.domain(pv.logFloor(n[0],t),pv.logCeil(n[1],t))},e.base=function(s){return arguments.length?(t=Number(s),n=Math.log(t),e.transform(r,i),this):t},e.domain.apply(e,arguments),e.base(10)},pv.Scale.root=function(){var e=pv.Scale.quantitative();return e.power=function(t){if(arguments.length){var n=Number(t),r=1/n;return e.transform(function(e){return Math.pow(e,r)},function(e){return Math.pow(e,n)}),this}return n},e.domain.apply(e,arguments),e.power(2)},pv.Scale.ordinal=function(){function i(r){return r in t||(t[r]=e.push(r)-1),n[t[r]%n.length]}var e=[],t={},n=[],r=0;return i.domain=function(n,r){if(arguments.length){n=n instanceof Array?arguments.length>1?pv.map(n,r):n:Array.prototype.slice.call(arguments),e=[];var i={};for(var s=0;s<n.length;s++){var o=n[s];o in i||(i[o]=!0,e.push(o))}return t=pv.numerate(e),this}return e},i.range=function(e,t){return arguments.length?(n=e instanceof Array?arguments.length>1?pv.map(e,t):e:Array.prototype.slice.call(arguments),typeof n[0]=="string"&&(n=n.map(pv.color)),this):n},i.split=function(e,t){var r=t-e,i=this.domain().length,s=0;return r===0?n=pv.array(i,e):i&&(s=(t-e)/i,n=pv.range(e+s/2,t,s)),n.step=s,this},i.splitBandedCenter=function(e,t,r){return i.split(e,t),r==null&&(r=1),n.band=n.step*r,n.margin=n.step-n.band,this},i.splitBandedFlushCenter=function(e,t,r){r==null&&(r=1);var i=t-e,s=this.domain().length,o=0,u=0,a=0;return i===0?n=pv.array(s,e):s&&(u=i*r/s,a=s>1?(i-s*u)/(s-1):0,o=a+u,n=pv.range(e+u/2,t,o)),n.step=o,n.band=u,n.margin=a,this},i.splitFlush=function(e,t){var r=this.domain().length,i=(t-e)/(r-1);return n=r==1?[(e+t)/2]:pv.range(e,t+i/2,i),this},i.splitBanded=function(e,t,r){arguments.length<3&&(r=1);if(r<0){var i=this.domain().length,s=-r*i,o=t-e-s,u=o/(i+1);n=pv.range(e+u,t,u-r),n.band=-r}else{var a=(t-e)/(this.domain().length+(1-r));n=pv.range(e+a*(1-r),t,a),n.band=a*r,n.step=a,n.margin=a-n.band}return this},i.by=function(e){function t(){return i(e.apply(this,arguments))}for(var n in i)t[n]=i[n];return t},i.by1=function(e){function t(t){return i(e.call(this,t))}for(var n in i)t[n]=i[n];return t},i.domain.apply(i,arguments),i},pv.Scale.quantile=function(){function s(e){return i(Math.max(0,Math.min(t,pv.search.index(n,e)-1))/t)}var e=-1,t=-1,n=[],r=[],i=pv.Scale.linear();return s.quantiles=function(i){if(arguments.length){e=Number(i);if(e<0)n=[r[0]].concat(r),t=r.length-1;else{n=[],n[0]=r[0];for(var s=1;s<=e;s++)n[s]=r[~~(s*(r.length-1)/e)];t=e-1}return this}return n},s.domain=function(t,n){return arguments.length?(r=t instanceof Array?pv.map(t,n):Array.prototype.slice.call(arguments),r.sort(pv.naturalOrder),s.quantiles(e),this):r},s.range=function(){return arguments.length?(i.range.apply(i,arguments),this):i.range()},s.by=function(e){function t(){return s(e.apply(this,arguments))}for(var n in s)t[n]=s[n];return t},s.by1=function(e){function t(t){return s(e.call(this,t))}for(var n in s)t[n]=s[n];return t},s.domain.apply(s,arguments),s},pv.histogram=function(e,t){var n=!0;return{bins:function(r){var i=pv.map(e,t),s=[];arguments.length||(r=pv.Scale.linear(i).ticks());for(var o=0;o<r.length-1;o++){var u=s[o]=[];u.x=r[o],u.dx=r[o+1]-r[o],u.y=0}for(var o=0;o<i.length;o++){var a=pv.search.index(r,i[o])-1,u=s[Math.max(0,Math.min(s.length-1,a))];u.y++,u.push(e[o])}if(!n)for(var o=0;o<s.length;o++)s[o].y/=i.length;return s},frequency:function(e){return arguments.length?(n=Boolean(e),this):n}}},pv.color=function(e){if(e.rgb)return e.rgb();var t=/([a-z]+)\((.*)\)/i.exec(e);if(t){var n=t[2].split(","),r=1;switch(t[1]){case"hsla":case"rgba":r=parseFloat(n[3]);if(!r)return pv.Color.transparent}switch(t[1]){case"hsla":case"hsl":var i=parseFloat(n[0]),s=parseFloat(n[1])/100,o=parseFloat(n[2])/100;return(new pv.Color.Hsl(i,s,o,r)).rgb();case"rgba":case"rgb":function u(e){var t=parseFloat(e);return e[e.length-1]=="%"?Math.round(t*2.55):t}var a=u(n[0]),f=u(n[1]),l=u(n[2]);return pv.rgb(a,f,l,r)}}var c=pv.Color.names[e];if(c)return c;if(e.charAt(0)=="#"){var a,f,l;return e.length==4?(a=e.charAt(1),a+=a,f=e.charAt(2),f+=f,l=e.charAt(3),l+=l):e.length==7&&(a=e.substring(1,3),f=e.substring(3,5),l=e.substring(5,7)),pv.rgb(parseInt(a,16),parseInt(f,16),parseInt(l,16),1)}return new pv.Color(e,1)},pv.Color=function(e,t){this.color=e,this.opacity=t},pv.Color.prototype.hsl=function(){return this.rgb().hsl()},pv.Color.prototype.brighter=function(e){return this.rgb().brighter(e)},pv.Color.prototype.darker=function(e){return this.rgb().darker(e)},pv.rgb=function(e,t,n,r){return new pv.Color.Rgb(e,t,n,arguments.length==4?r:1)},pv.Color.Rgb=function(e,t,n,r){pv.Color.call(this,r?"rgb("+e+","+t+","+n+")":"none",r),this.r=e,this.g=t,this.b=n,this.a=r},pv.Color.Rgb.prototype=pv.extend(pv.Color),pv.Color.Rgb.prototype.red=function(e){return pv.rgb(e,this.g,this.b,this.a)},pv.Color.Rgb.prototype.green=function(e){return pv.rgb(this.r,e,this.b,this.a)},pv.Color.Rgb.prototype.blue=function(e){return pv.rgb(this.r,this.g,e,this.a)},pv.Color.Rgb.prototype.alpha=function(e){return pv.rgb(this.r,this.g,this.b,e)},pv.Color.Rgb.prototype.rgb=function(){return this},pv.Color.Rgb.prototype.brighter=function(e){e=Math.pow(.7,arguments.length?e:1);var t=this.r,n=this.g,r=this.b,i=30;return!t&&!n&&!r?pv.rgb(i,i,i,this.a):(t&&t<i&&(t=i),n&&n<i&&(n=i),r&&r<i&&(r=i),pv.rgb(Math.min(255,Math.floor(t/e)),Math.min(255,Math.floor(n/e)),Math.min(255,Math.floor(r/e)),this.a))},pv.Color.Rgb.prototype.darker=function(e){return e=Math.pow(.7,arguments.length?e:1),pv.rgb(Math.max(0,Math.floor(e*this.r)),Math.max(0,Math.floor(e*this.g)),Math.max(0,Math.floor(e*this.b)),this.a)},pv.Color.Rgb.prototype.hsl=function(){var e=this.r/255,t=this.g/255,n=this.b/255,r=Math.max(e,t,n),i=Math.min(e,t,n),s=(r+i)/2,o,u;if(r===i)o=u=0;else{var a=r-i;u=s>.5?a/(2-r-i):a/(r+i);switch(r){case e:o=(t-n)/a+(t<n?6:0);break;case t:o=(n-e)/a+2;break;case n:o=(e-t)/a+4}o/=6}return pv.hsl(o*360,u,s,this.a)},pv.hsl=function(e,t,n,r){return new pv.Color.Hsl(e,t,n,arguments.length==4?r:1)},pv.Color.Hsl=function(e,t,n,r){pv.Color.call(this,"hsl("+e+","+t*100+"%,"+n*100+"%)",r),this.h=e,this.s=t,this.l=n,this.a=r},pv.Color.Hsl.prototype=pv.extend(pv.Color),pv.Color.Hsl.prototype.hsl=function(){return this},pv.Color.Hsl.prototype.hue=function(e){return pv.hsl(e,this.s,this.l,this.a)},pv.Color.Hsl.prototype.saturation=function(e){return pv.hsl(this.h,e,this.l,this.a)},pv.Color.Hsl.prototype.lightness=function(e){return pv.hsl(this.h,this.s,e,this.a)},pv.Color.Hsl.prototype.alpha=function(e){return pv.hsl(this.h,this.s,this.l,e)},pv.Color.Hsl.prototype.rgb=function(){function s(e){return e>360?e-=360:e<0&&(e+=360),e<60?i+(r-i)*e/60:e<180?r:e<240?i+(r-i)*(240-e)/60:i}function o(e){return Math.round(s(e)*255)}var e=this.h,t=this.s,n=this.l;e%=360,e<0&&(e+=360),t=Math.max(0,Math.min(t,1)),n=Math.max(0,Math.min(n,1));var r=n<=.5?n*(1+t):n+t-n*t,i=2*n-r;return pv.rgb(o(e+120),o(e),o(e-120),this.a)},pv.Color.names={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32",transparent:pv.Color.transparent=pv.rgb(0,0,0,0)},function(){var e=pv.Color.names;e.none=e.transparent;for(var t in e)e[t]=pv.color(e[t])}(),pv.colors=function(){var e=pv.Scale.ordinal();return e.range.apply(e,arguments),e},pv.Colors={},pv.Colors.category10=function(){var e=pv.colors("#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf");return e.domain.apply(e,arguments),e},pv.Colors.category20=function(){var e=pv.colors("#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5");return e.domain.apply(e,arguments),e},pv.Colors.category19=function(){var e=pv.colors("#9c9ede","#7375b5","#4a5584","#cedb9c","#b5cf6b","#8ca252","#637939","#e7cb94","#e7ba52","#bd9e39","#8c6d31","#e7969c","#d6616b","#ad494a","#843c39","#de9ed6","#ce6dbd","#a55194","#7b4173");return e.domain.apply(e,arguments),e},function(){function t(t){var n=r(t);if(!n.length)return null;var s=Math.PI,o,u,a,f=n[0];f.indexOf("to ")===0?(u=/^to\s+(?:((top|bottom)(?:\s+(left|right))?)|((left|right)(?:\\s+(top|bottom))?))$/.exec(f),u&&(u[1]?(o=u[2],u[3]&&(o+=" "+u[3])):(o=u[5],u[6]&&(o=u[6]+" "+o)),s=pv.radians(e[o]),n.shift())):(a=parseFloat(f),isNaN(a)||(s=a,/^.*?deg$/.test(f)&&(s=pv.radians(s)),n.shift()));var l=i(n);switch(l.length){case 0:return null;case 1:return new pv.FillStyle.Solid(l[0].color,1)}return new pv.FillStyle.LinearGradient(s,l)}function n(e){var t=r(e);if(!t.length)return null;var n=i(t);switch(n.length){case 0:return null;case 1:return new pv.FillStyle.Solid(n[0].color,1)}return new pv.FillStyle.RadialGradient(50,50,n)}function r(e){var t={},n=0;e=e.replace(/\b\w+?\(.*?\)/g,function(e){var r="__color"+n++;return t[r]=e,r});var r=e.split(/\s*,\s*/);return r.length?(n&&r.forEach(function(e,n){t.hasOwnProperty(e)&&(r[n]=t[e])}),r):null}function i(e){function s(e){var t=i.length;if(t){var n=r,s=(e-n)/(t+1);for(var o=0;o<t;o++)n+=s,i[o].offset=n;i.length=0}}var t=[],n=+Infinity,r=-Infinity,i=[],o=0,u=e.length;while(o<u){var a=e[o++],f=/^(.+?)\s*([+\-]?[e\.\d]+%)?$/i.exec(a);if(f){var l={color:pv.color(f[1])},c=parseFloat(f[2]);isNaN(c)&&(t.length?o===u&&(c=Math.max(r,100)):c=0),t.push(l),isNaN(c)?i.push(l):(l.offset=c,s(c),c>r?r=c:c<r&&(c=r),c<n&&(n=c))}}if(t.length>=2&&(n<0||r>100)){var h=[],p=[];t.forEach(function(e){h.push(e.offset),p.push(e.color)});var d=pv.scale.linear().domain(h).range(p);if(n<0){while(t.length&&t[0].offset<=0)t.shift();t.unshift({offset:0,color:d(0)})}if(r>100){while(t.length&&t[t.length-1].offset>=100)t.pop();t.push({offset:100,color:d(100)})}}return t}pv.fillStyle=function(e){if(e.type)return e;if(e.rgb)return new pv.FillStyle.Solid(e.color,e.opacity);var r=/^\s*([a-z\-]+)\(\s*(.*?)\s*\)\s*$/.exec(e);if(r)switch(r[1]){case"linear-gradient":return t(r[2]);case"radial-gradient":return n(r[2])}return new pv.FillStyle.Solid(pv.color(e))};var e={top:0,"top right":45,right:90,"bottom right":135,bottom:180,"bottom left":225,left:270,"top left":315},s=pv.FillStyle=function(e){this.type=e};s.prototype=new pv.Color("none",1),s.prototype.rgb=function(){var e=pv.color(this.color);return this.opacity!==e.opacity&&(e=e.alpha(this.opacity)),e};var o=pv.FillStyle.Solid=function(e,t){s.call(this,"solid"),e.rgb?(this.color=e.color,this.opacity=e.opacity):(this.color=e,this.opacity=t)};o.prototype=pv.extend(pv.FillStyle),o.prototype.alpha=function(e){return new o(this.color,e)},o.prototype.brighter=function(e){return new o(this.rgb().brighter(e))},o.prototype.darker=function(e){return new o(this.color.darker(e))},pv.FillStyle.transparent=new o(pv.Color.transparent);var u=0,a=pv.FillStyle.Gradient=function(e,t){s.call(this,e),this.id=++u,this.stops=t,t.length&&(this.color=t[0].color.color)};a.prototype=pv.extend(pv.FillStyle),a.prototype.rgb=function(){return this.stops.length?this.stops[0].color:undefined},a.prototype.alpha=function(e){return this._clone(this.stops.map(function(t){return{offset:t.offset,color:t.color.alpha(e)}}))},a.prototype.darker=function(e){return this._clone(this.stops.map(function(t){return{offset:t.offset,color:t.color.darker(e)}}))},a.prototype.brighter=function(e){return this._clone(this.stops.map(function(t){return{offset:t.offset,color:t.color.brighter(e)}}))};var f=pv.FillStyle.LinearGradient=function(e,t){a.call(this,"lineargradient",t),this.angle=e};f.prototype=pv.extend(a),f.prototype._clone=function(e){return new f(this.angle,e)};var l=pv.FillStyle.RadialGradient=function(e,t,n){a.call(this,"radialgradient",n),this.cx=e,this.cy=t};l.prototype=pv.extend(a),l.prototype._clone=function(e){return new l(this.cx,this.cy,e)}}(),pv.ramp=function(e,t){var n=pv.Scale.linear();return n.range.apply(n,arguments),n},pv.Scene=pv.SvgScene={svg:"http://www.w3.org/2000/svg",xmlns:"http://www.w3.org/2000/xmlns",xlink:"http://www.w3.org/1999/xlink",xhtml:"http://www.w3.org/1999/xhtml",scale:1,events:["DOMMouseScroll","mousewheel","mousedown","mouseup","mouseover","mouseout","mousemove","click","dblclick"],implicit:{svg:{"shape-rendering":"auto","pointer-events":"painted",x:0,y:0,dy:0,"text-anchor":"start",transform:"translate(0,0)",fill:"none","fill-opacity":1,stroke:"none","stroke-opacity":1,"stroke-width":1.5,"stroke-linejoin":"miter","stroke-linecap":"butt","stroke-miterlimit":8,"stroke-dasharray":"none"},css:{font:"10px sans-serif"}}},pv.SvgScene.updateAll=function(e){if(e.length&&e[0].reverse&&e.type!="line"&&e.type!="area"){var t=pv.extend(e);for(var n=0,r=e.length-1;r>=0;n++,r--)t[n]=e[r];e=t}this.removeSiblings(this[e.type](e))},pv.SvgScene.create=function(e){return document.createElementNS(this.svg,e)},pv.SvgScene.expect=function(e,t,n,r,i,s){if(e){var o=e.tagName;o==="defs"&&(e=e.nextSibling),o==="a"&&(e=e.firstChild);if(o!==t){var u=this.create(t);e.parentNode.replaceChild(u,e),e=u}}else e=this.create(t);return i&&this.setAttributes(e,i),s&&this.setStyle(e,s),e},pv.SvgScene.setAttributes=function(e,t){var n=this.implicit.svg;for(var r in t){var i=t[r];i==null||i==n[r]?e.removeAttribute(r):e.setAttribute(r,i)}},pv.SvgScene.setStyle=function(e,t){var n=this.implicit.css;switch(pv.renderer()){case"batik":for(var r in t){var i=t[r];i==null||i==n[r]?e.removeAttribute(r):e.style.setProperty(r,i)}break;case"svgweb":for(var r in t){var i=t[r];if(i==null||i==n[r])continue;e.style[r]=i}break;default:for(var r in t){var i=t[r];i==null||i==n[r]?e.style.removeProperty(r):e.style[r]=i}}},pv.SvgScene.append=function(e,t,n){return e.$scene={scenes:t,index:n},e=this.title(e,t[n]),e.parentNode||t.$g.appendChild(e),e.nextSibling},pv.SvgScene.title=function(e,t){var n=e.parentNode;n&&n.tagName!="a"&&(n=null);if(t.title){n||(n=this.create("a"),n.setAttributeNS(this.xlink,"xlink:href",""),e.parentNode&&e.parentNode.replaceChild(n,e),n.appendChild(e)),n.setAttributeNS(this.xlink,"xlink:title",t.title);var r=null;for(var i=e.firstChild;i!=null;i=i.nextSibling)if(i.nodeName=="title"){r=i;break}return r?r.removeChild(r.firstChild):(r=this.create("title"),e.appendChild(r)),pv.renderer()=="svgweb"?r.appendChild(document.createTextNode(t.title,!0)):r.appendChild(document.createTextNode(t.title)),n}return n&&n.parentNode.replaceChild(e,n),e},pv.SvgScene.dispatch=pv.listener(function(e){var t=e.target.$scene;if(t){var n=e.type;switch(n){case"DOMMouseScroll":n="mousewheel",e.wheel=-480*e.detail;break;case"mousewheel":e.wheel=(window.opera?12:1)*e.wheelDelta}pv.Mark.dispatch(n,t.scenes,t.index,e)&&e.preventDefault()}}),pv.SvgScene.removeSiblings=function(e){while(e){var t=e.nextSibling;e.nodeName!="defs"&&e.parentNode.removeChild(e),e=t}},pv.SvgScene.undefined=function(){},pv.SvgScene.removeFillStyleDefinitions=function(e){var t=e.$g.getElementsByTagName("defs");if(t.length===1){var n=t[0],r=n.firstChild;while(r){var i=r.nextSibling;(r.nodeName=="linearGradient"||r.nodeName=="radialGradient")&&n.removeChild(r),r=i}}},function(){var e={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"},t={shortdash:[3,1],shortdot:[1,1],shortdashdot:[3,1,1,1],shortdashdotdot:[3,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]};pv.SvgScene.isStandardDashStyle=function(e){return t.hasOwnProperty(e)},pv.SvgScene.translateDashStyleAlias=function(t){return e.hasOwnProperty(t)?e[t]:t},pv.SvgScene.parseDasharray=function(e){var n=e.strokeDasharray;if(n&&n!=="none"){n=this.translateDashStyleAlias(n);var r=t[n];r?n=r:n=n.split(/[\s,]+/);var i=e.lineWidth,s=e.lineCap||"butt",o=s==="butt";n=n.map(function(e,t){return e=+e,o||(t%2?e+=1:e-=1),e<=0&&(e=.001),e*i/this.scale},this).join(" ")}else n=null;return n}}(),function(){var e=0;pv.SvgScene.addFillStyleDefinition=function(t,n){var r=n.type==="lineargradient";if(r||n.type==="radialgradient"){var i=t.$g,s=i.getElementsByTagName("defs"),o;s.length?o=s[0]:o=i.appendChild(this.create("defs"));var u,a="__pv_gradient"+n.id;s=undefined;if(!s){var f="__pv_gradient"+n.id+"_inst_"+ ++e;u=o.appendChild(this.create(r?"linearGradient":"radialGradient")),u.setAttribute("id",f),u.setAttribute("class",a);if(r){var l=n.angle-Math.PI/2,c=Math.abs(l%(Math.PI/2))-Math.PI/4,h=Math.abs(Math.SQRT2/2*Math.cos(c)),p=h*Math.cos(l),d=h*Math.sin(l),v=.5-p,m=.5-d,g=.5+p,y=.5+d;u.setAttribute("x1",v),u.setAttribute("y1",m),u.setAttribute("x2",g),u.setAttribute("y2",y)}var b=n.stops;for(var w=0,E=b.length;w<E;w++){var S=b[w],x=u.appendChild(this.create("stop")),T=S.color;x.setAttribute("offset",S.offset+"%"),x.setAttribute("stop-color",T.color),x.setAttribute("stop-opacity",T.opacity+"")}n.color="url(#"+f+")"}}}}(),pv.SvgScene.pathBasis=function(){function t(e,t,n,r,i){return{x:e[0]*t.left+e[1]*n.left+e[2]*r.left+e[3]*i.left,y:e[0]*t.top+e[1]*n.top+e[2]*r.top+e[3]*i.top}}var e=[[1/6,2/3,1/6,0],[0,2/3,1/3,0],[0,1/3,2/3,0],[0,1/6,2/3,1/6]],n=function(n,r,i,s){var o=t(e[1],n,r,i,s),u=t(e[2],n,r,i,s),a=t(e[3],n,r,i,s);return"C"+o.x+","+o.y+","+u.x+","+u.y+","+a.x+","+a.y};return n.segment=function(n,r,i,s){var o=t(e[0],n,r,i,s),u=t(e[1],n,r,i,s),a=t(e[2],n,r,i,s),f=t(e[3],n,r,i,s);return"M"+o.x+","+o.y+"C"+u.x+","+u.y+","+a.x+","+a.y+","+f.x+","+f.y},n}(),pv.SvgScene.curveBasis=function(e){if(e.length<=2)return"";var t="",n=e[0],r=n,i=n,s=e[1];t+=this.pathBasis(n,r,i,s);for(var o=2;o<e.length;o++)n=r,r=i,i=s,s=e[o],t+=this.pathBasis(n,r,i,s);return t+=this.pathBasis(r,i,s,s),t+=this.pathBasis(i,s,s,s),t},pv.SvgScene.curveBasisSegments=function(e){if(e.length<=2)return"";var t=[],n=e[0],r=n,i=n,s=e[1],o=this.pathBasis.segment(n,r,i,s);n=r,r=i,i=s,s=e[2],t.push(o+this.pathBasis(n,r,i,s));for(var u=3;u<e.length;u++)n=r,r=i,i=s,s=e[u],t.push(this.pathBasis.segment(n,r,i,s));return t.push(this.pathBasis.segment(r,i,s,s)+this.pathBasis(i,s,s,s)),t},pv.SvgScene.curveHermite=function(e,t){if(t.length<1||e.length!=t.length&&e.length!=t.length+2)return"";var n=e.length!=t.length,r="",i=e[0],s=e[1],o=t[0],u=o,a=1;n&&(r+="Q"+(s.left-o.x*2/3)+","+(s.top-o.y*2/3)+","+s.left+","+s.top,i=e[1],a=2);if(t.length>1){u=t[1],s=e[a],a++,r+="C"+(i.left+o.x)+","+(i.top+o.y)+","+(s.left-u.x)+","+(s.top-u.y)+","+s.left+","+s.top;for(var f=2;f<t.length;f++,a++)s=e[a],u=t[f],r+="S"+(s.left-u.x)+","+(s.top-u.y)+","+s.left+","+s.top}if(n){var l=e[a];r+="Q"+(s.left+u.x*2/3)+","+(s.top+u.y*2/3)+","+l.left+","+l.top}return r},pv.SvgScene.curveHermiteSegments=function(e,t){if(t.length<1||e.length!=t.length&&e.length!=t.length+2)return[];var n=e.length!=t.length,r=[],i=e[0],s=i,o=t[0],u=o,a=1;n&&(s=e[1],r.push("M"+i.left+","+i.top+"Q"+(s.left-u.x*2/3)+","+(s.top-u.y*2/3)+","+s.left+","+s.top),a=2);for(var f=1;f<t.length;f++,a++)i=s,o=u,s=e[a],u=t[f],r.push("M"+i.left+","+i.top+"C"+(i.left+o.x)+","+(i.top+o.y)+","+(s.left-u.x)+","+(s.top-u.y)+","+s.left+","+s.top);if(n){var l=e[a];r.push("M"+s.left+","+s.top+"Q"+(s.left+u.x*2/3)+","+(s.top+u.y*2/3)+","+l.left+","+l.top)}return r},pv.SvgScene.cardinalTangents=function(e,t){var n=[],r=(1-t)/2,i=e[0],s=e[1],o=e[2];for(var u=3;u<e.length;u++)n.push({x:r*(o.left-i.left),y:r*(o.top-i.top)}),i=s,s=o,o=e[u];return n.push({x:r*(o.left-i.left),y:r*(o.top-i.top)}),n},pv.SvgScene.curveCardinal=function(e,t){return e.length<=2?"":this.curveHermite(e,this.cardinalTangents(e,t))},pv.SvgScene.curveCardinalSegments=function(e,t){return e.length<=2?"":this.curveHermiteSegments(e,this.cardinalTangents(e,t))},pv.SvgScene.monotoneTangents=function(e){var t=[],n=[],r=[],i=[],s=0;for(s=0;s<e.length-1;s++)n[s]=(e[s+1].top-e[s].top)/(e[s+1].left-e[s].left);r[0]=n[0],i[0]=e[1].left-e[0].left;for(s=1;s<e.length-1;s++)r[s]=(n[s-1]+n[s])/2,i[s]=(e[s+1].left-e[s-1].left)/2;r[s]=n[s-1],i[s]=e[s].left-e[s-1].left;for(s=0;s<e.length-1;s++)n[s]==0&&(r[s]=0,r[s+1]=0);for(s=0;s<e.length-1;s++){if(Math.abs(r[s])<1e-5||Math.abs(r[s+1])<1e-5)continue;var o=r[s]/n[s],u=r[s+1]/n[s],a=o*o+u*u;if(a>9){var f=3/Math.sqrt(a);r[s]=f*o*n[s],r[s+1]=f*u*n[s]}}var l;for(var c=0;c<e.length;c++)l=1+r[c]*r[c],t.push({x:i[c]/3/l,y:r[c]*i[c]/3/l});return t},pv.SvgScene.curveMonotone=function(e){return e.length<=2?"":this.curveHermite(e,this.monotoneTangents(e))},pv.SvgScene.curveMonotoneSegments=function(e){return e.length<=2?"":this.curveHermiteSegments(e,this.monotoneTangents(e))},pv.SvgScene.area=function(e){function s(t,r){var i=[],s=[];for(var o=r;t<=o;t++,r--){var u=e[t],a=e[r],f=u.left+","+u.top,l=a.left+a.width+","+(a.top+a.height);if(t<o){var c=e[t+1],h=e[r-1];switch(n.interpolate){case"step-before":f+="V"+c.top,l+="H"+(h.left+h.width);break;case"step-after":f+="H"+c.left,l+="V"+(h.top+h.height)}}i.push(f),s.push(l)}return i.concat(s).join("L")}function o(t,r){var i=[],s=[],o,u;for(var a=r;t<=a;t++,r--){var f=e[r];i.push(e[t]),s.push({left:f.left+f.width,top:f.top+f.height})}return n.interpolate=="basis"?(o=pv.SvgScene.curveBasis(i),u=pv.SvgScene.curveBasis(s)):n.interpolate=="cardinal"?(o=pv.SvgScene.curveCardinal(i,n.tension),u=pv.SvgScene.curveCardinal(s,n.tension)):(o=pv.SvgScene.curveMonotone(i),u=pv.SvgScene.curveMonotone(s)),i[0].left+","+i[0].top+o+"L"+s[0].left+","+s[0].top+u}var t=e.$g.firstChild;this.removeFillStyleDefinitions(e);if(!e.length)return t;var n=e[0];if(n.segmented)return this.areaSegment(e);if(!n.visible)return t;var r=n.fillStyle,i=n.strokeStyle;if(!r.opacity&&!i.opacity)return t;r.type&&r.type!=="solid"&&this.addFillStyleDefinition(e,r),i.type&&i.type!="solid"&&this.addFillStyleDefinition(e,i);var u=[],a,f;for(var l=0;l<e.length;l++){a=e[l];if(!a.width&&!a.height)continue;for(var c=l+1;c<e.length;c++){f=e[c];if(!f.width&&!f.height)break}l&&n.interpolate!="step-after"&&l--,c<e.length&&n.interpolate!="step-before"&&c++,u.push((c-l>2&&(n.interpolate=="basis"||n.interpolate=="cardinal"||n.interpolate=="monotone")?o:s)(l,c-1)),l=c-1}return u.length?(t=this.expect(t,"path",e,0,{"shape-rendering":n.antialias?null:"crispEdges","pointer-events":n.events,cursor:n.cursor,d:"M"+u.join("ZM")+"Z",fill:r.color,"fill-opacity":r.opacity||null,stroke:i.color,"stroke-opacity":i.opacity||null,"stroke-width":i.opacity?n.lineWidth/this.scale:null,"stroke-linecap":n.lineCap,"stroke-linejoin":n.lineJoin,"stroke-miterlimit":n.strokeMiterLimit,"stroke-dasharray":i.opacity?this.parseDasharray(n):null}),n.svg&&this.setAttributes(t,n.svg),n.css&&this.setStyle(t,n.css),this.append(t,e,0)):t},pv.SvgScene.areaSegment=function(e){var t=e.$g.firstChild,n=e[0],r,i;if(n.interpolate=="basis"||n.interpolate=="cardinal"||n.interpolate=="monotone"){var s=[],o=[];for(var u=0,a=e.length;u<a;u++){var f=e[a-u-1];s.push(e[u]),o.push({left:f.left+f.width,top:f.top+f.height})}n.interpolate=="basis"?(r=this.curveBasisSegments(s),i=this.curveBasisSegments(o)):n.interpolate=="cardinal"?(r=this.curveCardinalSegments(s,n.tension),i=this.curveCardinalSegments(o,n.tension)):(r=this.curveMonotoneSegments(s),i=this.curveMonotoneSegments(o))}for(var u=0,a=e.length-1;u<a;u++){var l=e[u],c=e[u+1];if(!l.visible||!c.visible)continue;var h=l.fillStyle,p=l.strokeStyle;if(!h.opacity&&!p.opacity)continue;var d;if(r){var v=r[u],m="L"+i[a-u-1].substr(1);d=v+m+"Z"}else{var g=l,f=c;switch(l.interpolate){case"step-before":g=c;break;case"step-after":f=l}d="M"+l.left+","+g.top+"L"+c.left+","+f.top+"L"+(c.left+c.width)+","+(f.top+f.height)+"L"+(l.left+l.width)+","+(g.top+g.height)+"Z"}t=this.expect(t,"path",e,u,{"shape-rendering":l.antialias?null:"crispEdges","pointer-events":l.events,cursor:l.cursor,d:d,fill:h.color,"fill-opacity":h.opacity||null,stroke:p.color,"stroke-opacity":p.opacity||null,"stroke-width":p.opacity?l.lineWidth/this.scale:null}),l.svg&&this.setAttributes(t,l.svg),l.css&&this.setStyle(t,l.css),t=this.append(t,e,u)}return t},pv.SvgScene.minBarWidth=1,pv.SvgScene.minBarHeight=1,pv.SvgScene.minBarLineWidth=1,pv.SvgScene.bar=function(e){var t=e.$g.firstChild;this.removeFillStyleDefinitions(e);for(var n=0;n<e.length;n++){var r=e[n];if(!r.visible||Math.abs(r.width)<=1e-10||Math.abs(r.height)<=1e-10)continue;r.width<this.minBarWidth&&(r.width=this.minBarWidth),r.height<this.minBarHeight&&(r.height=this.minBarHeight);var i=r.fillStyle,s=r.strokeStyle;if(!i.opacity&&!s.opacity)continue;i.type&&i.type!=="solid"&&this.addFillStyleDefinition(e,i),s.type&&s.type!="solid"&&this.addFillStyleDefinition(e,s);var o;s.opacity?(o=r.lineWidth,o<1e-10?o=0:o=Math.max(this.minBarLineWidth,o/this.scale)):o=null,t=this.expect(t,"rect",e,n,{"shape-rendering":r.antialias?null:"crispEdges","pointer-events":r.events,cursor:r.cursor,x:r.left,y:r.top,width:Math.max(1e-10,r.width),height:Math.max(1e-10,r.height),fill:i.color,"fill-opacity":i.opacity||null,stroke:s.color,"stroke-opacity":s.opacity||null,"stroke-width":o,"stroke-linecap":r.lineCap,"stroke-dasharray":s.opacity?this.parseDasharray(r):null}),r.svg&&this.setAttributes(t,r.svg),r.css&&this.setStyle(t,r.css),t=this.append(t,e,n)}return t},pv.SvgScene.dot=function(e){var t=e.$g.firstChild;this.removeFillStyleDefinitions(e);for(var n=0;n<e.length;n++){var r=e[n];if(!r.visible)continue;var i=r.fillStyle,s=r.strokeStyle;if(!i.opacity&&!s.opacity)continue;i.type&&i.type!=="solid"&&this.addFillStyleDefinition(e,i),s.type&&s.type!="solid"&&this.addFillStyleDefinition(e,s);var o=r.shapeRadius,u=null;switch(r.shape){case"cross":u="M"+ -o+","+ -o+"L"+o+","+o+"M"+o+","+ -o+"L"+ -o+","+o;break;case"triangle":var a=o,f=o*1.1547;u="M0,"+a+"L"+f+","+ -a+" "+ -f+","+ -a+"Z";break;case"diamond":o*=Math.SQRT2,u="M0,"+ -o+"L"+o+",0"+" 0,"+o+" "+ -o+",0"+"Z";break;case"square":u="M"+ -o+","+ -o+"L"+o+","+ -o+" "+o+","+o+" "+ -o+","+o+"Z";break;case"tick":u="M0,0L0,"+ -r.shapeSize;break;case"bar":u="M0,"+r.shapeSize/2+"L0,"+ -(r.shapeSize/2)}var l={"shape-rendering":r.antialias?null:"crispEdges","pointer-events":r.events,cursor:r.cursor,fill:i.color,"fill-opacity":i.opacity||null,stroke:s.color,"stroke-opacity":s.opacity||null,"stroke-width":s.opacity?r.lineWidth/this.scale:null,"stroke-linecap":r.lineCap,"stroke-dasharray":s.opacity?this.parseDasharray(r):null};u?(l.transform="translate("+r.left+","+r.top+")",r.shapeAngle&&(l.transform+=" rotate("+180*r.shapeAngle/Math.PI+")"),l.d=u,t=this.expect(t,"path",e,n,l)):(l.cx=r.left,l.cy=r.top,l.r=o,t=this.expect(t,"circle",e,n,l)),r.svg&&this.setAttributes(t,r.svg),r.css&&this.setStyle(t,r.css),t=this.append(t,e,n)}return t},pv.SvgScene.image=function(e){var t=e.$g.firstChild;for(var n=0;n<e.length;n++){var r=e[n];if(!r.visible)continue;t=this.fill(t,e,n);if(r.image){t=this.expect(t,"foreignObject",e,n,{cursor:r.cursor,x:r.left,y:r.top,width:r.width,height:r.height}),r.svg&&this.setAttributes(t,r.svg),r.css&&this.setStyle(t,r.css);var i=t.firstChild||t.appendChild(document.createElementNS(this.xhtml,"canvas"));i.$scene={scenes:e,index:n},i.style.width=r.width,i.style.height=r.height,i.width=r.imageWidth,i.height=r.imageHeight,i.getContext("2d").putImageData(r.image,0,0)}else t=this.expect(t,"image",e,n,{preserveAspectRatio:"none",cursor:r.cursor,x:r.left,y:r.top,width:r.width,height:r.height}),r.svg&&this.setAttributes(t,r.svg),r.css&&this.setStyle(t,r.css),t.setAttributeNS(this.xlink,"xlink:href",r.url);t=this.append(t,e,n),t=this.stroke(t,e,n)}return t},pv.SvgScene.label=function(e){var t=e.$g.firstChild;for(var n=0;n<e.length;n++){var r=e[n];if(!r.visible)continue;var i=r.textStyle;if(!i.opacity||!r.text)continue;var s=0,o=0,u=0,a="start";switch(r.textBaseline){case"middle":pv.renderer()=="svgweb"?o=3:u=".35em";break;case"top":pv.renderer()=="svgweb"?o=9+r.textMargin:(u=".71em",o=r.textMargin);break;case"bottom":o="-"+r.textMargin}switch(r.textAlign){case"right":a="end",s="-"+r.textMargin;break;case"center":a="middle";break;case"left":s=r.textMargin}t=this.expect(t,"text",e,n,{"pointer-events":r.events,cursor:r.cursor,x:s,y:o,dy:u,transform:"translate("+r.left+","+r.top+")"+(r.textAngle?" rotate("+180*r.textAngle/Math.PI+")":"")+(this.scale!=1?" scale("+1/this.scale+")":""),fill:i.color,"fill-opacity":i.opacity||null,"text-anchor":a},{font:r.font,"text-shadow":r.textShadow,"text-decoration":r.textDecoration}),r.svg&&this.setAttributes(t,r.svg),r.css&&this.setStyle(t,r.css),t.firstChild?t.firstChild.nodeValue=r.text:pv.renderer()=="svgweb"?t.appendChild(document.createTextNode(r.text,!0)):t.appendChild(document.createTextNode(r.text)),t=this.append(t,e,n)}return t},pv.SvgScene.line=function(e){var t=e.$g.firstChild;this.removeFillStyleDefinitions(e);if(e.length<2)return t;var n=e[0];if(n.segmented)return this.lineSegment(e);if(!n.visible)return t;var r=n.fillStyle,i=n.strokeStyle;if(!r.opacity&&!i.opacity)return t;i.type&&i.type!="solid"&&this.addFillStyleDefinition(e,i);var s="M"+n.left+","+n.top;if(e.length>2&&(n.interpolate=="basis"||n.interpolate=="cardinal"||n.interpolate=="monotone"))switch(n.interpolate){case"basis":s+=this.curveBasis(e);break;case"cardinal":s+=this.curveCardinal(e,n.tension);break;case"monotone":s+=this.curveMonotone(e)}else for(var o=1;o<e.length;o++)s+=this.pathSegment(e[o-1],e[o]);return t=this.expect(t,"path",e,0,{"shape-rendering":n.antialias?null:"crispEdges","pointer-events":n.events,cursor:n.cursor,d:s,fill:r.color,"fill-opacity":r.opacity||null,stroke:i.color,"stroke-opacity":i.opacity||null,"stroke-width":i.opacity?n.lineWidth/this.scale:null,"stroke-linecap":n.lineCap,"stroke-linejoin":n.lineJoin,"stroke-miterlimit":n.strokeMiterLimit,"stroke-dasharray":i.opacity?this.parseDasharray(n):null}),n.svg&&this.setAttributes(t,n.svg),n.css&&this.setStyle(t,n.css),this.append(t,e,0)},pv.SvgScene.lineSegment=function(e){var t=e.$g.firstChild,n=e[0],r;switch(n.interpolate){case"basis":r=this.curveBasisSegments(e);break;case"cardinal":r=this.curveCardinalSegments(e,n.tension);break;case"monotone":r=this.curveMonotoneSegments(e)}for(var i=0,s=e.length-1;i<s;i++){var o=e[i],u=e[i+1];if(!o.visible||!u.visible)continue;var a=o.strokeStyle,f=pv.FillStyle.transparent;if(!a.opacity)continue;var l;o.interpolate=="linear"&&o.lineJoin=="miter"?(f=a,a=pv.FillStyle.transparent,l=this.pathJoin(e[i-1],o,u,e[i+2])):r?l=r[i]:l="M"+o.left+","+o.top+this.pathSegment(o,u),t=this.expect(t,"path",e,i,{"shape-rendering":o.antialias?null:"crispEdges","pointer-events":o.events,cursor:o.cursor,d:l,fill:f.color,"fill-opacity":f.opacity||null,stroke:a.color,"stroke-opacity":a.opacity||null,"stroke-width":a.opacity?o.lineWidth/this.scale:null,"stroke-linejoin":o.lineJoin}),o.svg&&this.setAttributes(t,o.svg),o.css&&this.setStyle(t,o.css),t=this.append(t,e,i)}return t},pv.SvgScene.pathSegment=function(e,t){var n=1;switch(e.interpolate){case"polar-reverse":n=0;case"polar":var r=t.left-e.left,i=t.top-e.top,s=1-e.eccentricity,o=Math.sqrt(r*r+i*i)/(2*s);if(s<=0||s>1)break;return"A"+o+","+o+" 0 0,"+n+" "+t.left+","+t.top;case"step-before":return"V"+t.top+"H"+t.left;case"step-after":return"H"+t.left+"V"+t.top}return"L"+t.left+","+t.top},pv.SvgScene.lineIntersect=function(e,t,n,r){return e.plus(t.times(n.minus(e).dot(r.perp())/t.dot(r.perp())))},pv.strokeMiterLimit=4,pv.SvgScene.pathJoin=function(e,t,n,r){var i=[],s,o,u,a=t.lineWidth/this.scale,f=pv.vector(t.left,t.top),l=pv.vector(n.left,n.top),c=l.minus(f),h=c.perp().norm(),p=h.times(a/2),d=f.plus(p),v=f.minus(p),m=l.plus(p),g=l.minus(p);if(!e||!e.visible)i.push(v,d);else{var y=pv.vector(e.left,e.top),b=f.minus(y),w=b.perp().norm(),E=w.plus(h).norm(),S=this.lineIntersect(f,E,d,c),x=this.lineIntersect(f,E,v,c);u=S.minus(x).length();var T=e.lineWidth/this.scale,N=(a+T)/2;o=u/N,s=t.strokeMiterLimit||pv.strokeMiterLimit;if(o<=s)i.push(x,S);else{var C=c.times(-1),k=b.norm().plus(C.norm()).norm(),L=f.plus(k.times(N/2));k.dot(h)>=0?i.push(x,L,d):i.push(v,L,S)}}if(!r||!r.visible)i.push(m,g);else{var A=pv.vector(r.left,r.top),O=A.minus(l),M=O.perp().norm(),_=M.plus(h).norm(),D=this.lineIntersect(l,_,m,c),P=this.lineIntersect(l,_,g,c);u=D.minus(P).length();var H=r.lineWidth/this.scale,B=(H+a)/2;o=u/B,s=n.strokeMiterLimit||pv.strokeMiterLimit;if(o<=s)i.push(D,P);else{var j=O.times(-1),F=c.norm().plus(j.norm()).norm(),I=l.plus(F.times(B/2));F.dot(h)>=0?i.push(m,I,P):i.push(D,I,g)}}var q=i.shift();return"M"+q.x+","+q.y+"L"+i.map(function(e){return e.x+","+e.y}).join(" ")},pv.SvgScene.panel=function(e){var t=e.$g,n=t&&t.firstChild,r=!1;for(var i=0;i<e.length;i++){var s=e[i];if(!s.visible)continue;if(!e.parent){pv.renderer()!=="batik"&&(s.canvas.style.display="inline-block"),t&&t.parentNode!=s.canvas&&(t=s.canvas.firstChild,n=t&&t.firstChild);if(!t){t=this.create(pv.renderer()!=="batik"?"svg":"g"),t.setAttribute("font-size","10px"),t.setAttribute("font-family","sans-serif"),t.setAttribute("fill","none"),t.setAttribute("stroke","none"),t.setAttribute("stroke-width",1.5);if(pv.renderer()==="svgweb"){t.setAttribute("width",s.width+s.left+s.right),t.setAttribute("height",s.height+s.top+s.bottom);var o=document.createDocumentFragment(!0);t.addEventListener("SVGLoad",function(){var t=this;(function(){if(r){r=!1,t.appendChild(o);for(var n=0;n<pv.Scene.events.length;n++)t.addEventListener(pv.Scene.events[n],pv.SvgScene.dispatch,!1);e.$g=t,e.$g.__ready=!0}else setTimeout(arguments.callee,10)})()},!1),svgweb.appendChild(t,s.canvas),t=o}else{for(var u=0;u<this.events.length;u++)t.addEventListener(this.events[u],this.dispatch,!1);t=s.canvas.appendChild(t),t.__ready=!0}n=t.firstChild}e.$g=t,t.__ready&&(t.setAttribute("width",s.width+s.left+s.right),t.setAttribute("height",s.height+s.top+s.bottom))}if(s.overflow=="hidden"){var a=pv.id().toString(36),f=this.expect(n,"g",e,i,{"clip-path":"url(#"+a+")"});f.parentNode||t.appendChild(f),e.$g=t=f,n=f.firstChild,n=this.expect(n,"clipPath",e,i,{id:a});var l=n.firstChild||n.appendChild(this.create("rect"));l.setAttribute("x",s.left),l.setAttribute("y",s.top),l.setAttribute("width",s.width),l.setAttribute("height",s.height),n.parentNode||t.appendChild(n),n=n.nextSibling}n=this.fill(n,e,i);var c=this.scale,h=s.transform,p=s.left+h.x,d=s.top+h.y;this.scale*=h.k,this.eachChild(e,i,function(r){r.$g=n=this.expect(n,"g",e,i,{transform:"translate("+p+","+d+")"+(h.k!=1?" scale("+h.k+")":"")}),this.updateAll(r),n.parentNode||t.appendChild(n),n=n.nextSibling}),this.scale=c,n=this.stroke(n,e,i),s.overflow=="hidden"&&(e.$g=t=f.parentNode,n=f.nextSibling)}return r=!0,n},pv.SvgScene.eachChild=function(e,t,n,r){if(e.mark.zOrderChildCount){var i=e[t].children.slice(0);i.sort(function(e,t){return e.mark._zOrder-t.mark._zOrder}),i.forEach(n,r||this)}else e[t].children.forEach(n,r||this)},pv.SvgScene.fill=function(e,t,n){this.removeFillStyleDefinitions(t);var r=t[n],i=r.fillStyle;if(i.opacity||r.events=="all")i.type&&i.type!=="solid"&&this.addFillStyleDefinition(t,i),e=this.expect(e,"rect",t,n,{"shape-rendering":r.antialias?null:"crispEdges","pointer-events":r.events,cursor:r.cursor,x:r.left,y:r.top,width:r.width,height:r.height,fill:i.color,"fill-opacity":i.opacity,stroke:null}),e=this.append(e,t,n);return e},pv.SvgScene.stroke=function(e,t,n){var r=t[n],i=r.strokeStyle;if(i.opacity||r.events=="all")e=this.expect(e,"rect",t,n,{"shape-rendering":r.antialias?null:"crispEdges","pointer-events":r.events=="all"?"stroke":r.events,cursor:r.cursor,x:r.left,y:r.top,width:Math.max(1e-10,r.width),height:Math.max(1e-10,r.height),fill:null,stroke:i.color,"stroke-opacity":i.opacity,"stroke-width":r.lineWidth/this.scale,"stroke-linecap":r.lineCap,"stroke-dasharray":i.opacity?this.parseDasharray(r):null}),e=this.append(e,t,n);return e},pv.SvgScene.minRuleLineWidth=1,pv.SvgScene.rule=function(e){var t=e.$g.firstChild;for(var n=0;n<e.length;n++){var r=e[n];if(!r.visible)continue;var i=r.strokeStyle;if(!i.opacity)continue;var s=r.lineWidth;s<1e-10?s=0:s=Math.max(this.minRuleLineWidth,s/this.scale),t=this.expect(t,"line",e,n,{"shape-rendering":r.antialias?null:"crispEdges","pointer-events":r.events,cursor:r.cursor,x1:r.left,y1:r.top,x2:r.left+r.width,y2:r.top+r.height,stroke:i.color,"stroke-opacity":i.opacity,"stroke-width":s,"stroke-linecap":r.lineCap,"stroke-dasharray":i.opacity?this.parseDasharray(r):null}),r.svg&&this.setAttributes(t,r.svg),r.css&&this.setStyle(t,r.css),t=this.append(t,e,n)}return t},pv.SvgScene.wedge=function(e){var t=e.$g.firstChild;this.removeFillStyleDefinitions(e);for(var n=0;n<e.length;n++){var r=e[n];if(!r.visible)continue;var i=r.fillStyle,s=r.strokeStyle;if(!i.opacity&&!s.opacity)continue;var o=r.innerRadius,u=r.outerRadius,a=Math.abs(r.angle),f;if(a>=2*Math.PI)o?f="M0,"+u+"A"+u+","+u+" 0 1,1 0,"+ -u+"A"+u+","+u+" 0 1,1 0,"+u+"M0,"+o+"A"+o+","+o+" 0 1,1 0,"+ -o+"A"+o+","+o+" 0 1,1 0,"+o+"Z":f="M0,"+u+"A"+u+","+u+" 0 1,1 0,"+ -u+"A"+u+","+u+" 0 1,1 0,"+u+"Z";else{var l=Math.min(r.startAngle,r.endAngle),c=Math.max(r.startAngle,r.endAngle),h=Math.cos(l),p=Math.cos(c),d=Math.sin(l),v=Math.sin(c);o?f="M"+u*h+","+u*d+"A"+u+","+u+" 0 "+(a<Math.PI?"0":"1")+",1 "+u*p+","+u*v+"L"+o*p+","+o*v+"A"+o+","+o+" 0 "+(a<Math.PI?"0":"1")+",0 "+o*h+","+o*d+"Z":f="M"+u*h+","+u*d+"A"+u+","+u+" 0 "+(a<Math.PI?"0":"1")+",1 "+u*p+","+u*v+"L0,0Z"}i.type&&i.type!=="solid"&&this.addFillStyleDefinition(e,i),s.type&&s.type!="solid"&&this.addFillStyleDefinition(e,s),t=this.expect(t,"path",e,n,{"shape-rendering":r.antialias?null:"crispEdges","pointer-events":r.events,cursor:r.cursor,transform:"translate("+r.left+","+r.top+")",d:f,fill:i.color,"fill-rule":"evenodd","fill-opacity":i.opacity||null,stroke:s.color,"stroke-opacity":s.opacity||null,"stroke-width":s.opacity?r.lineWidth/this.scale:null,"stroke-linejoin":r.lineJoin,"stroke-miterlimit":r.strokeMiterLimit,"stroke-linecap":r.lineCap,"stroke-dasharray":s.opacity?this.parseDasharray(r):null}),r.svg&&this.setAttributes(t,r.svg),r.css&&this.setStyle(t,r.css),t=this.append(t,e,n)}return t},pv.Mark=function(){this.$properties=[],this.$propertiesMap={},this.$handlers={}},pv.Mark.prototype.properties={},pv.Mark.cast={},pv.Mark.prototype.property=function(e,t){return this.hasOwnProperty("properties")||(this.properties=pv.extend(this.properties)),this.properties[e]=!0,pv.Mark.prototype.propertyMethod(e,!1,pv.Mark.cast[e]=t),this},pv.Mark.prototype.localProperty=function(e,t){this.hasOwnProperty("properties")||(this.properties=pv.extend(this.properties)),this.properties[e]=!0;var n=pv.Mark.cast[e];return t&&(pv.Mark.cast[e]=n=t),this.propertyMethod(e,!1,n),this},pv.Mark.prototype.propertyMethod=function(e,t,n){n||(n=pv.Mark.cast[e]),this[e]=function(r){if(t&&this.scene){var i=this.scene.defs;return arguments.length?(i[e]={id:r==null?0:pv.id(),value:r!=null&&n?n(r):r},this):i[e]?i[e].value:null}if(arguments.length){var s=!t<<1|typeof r=="function",o;return s&1&&n?o=pv.Mark.funPropertyCaller(r,n):r!=null&&n?o=n(r):o=r,this.setPropertyValue(e,o,s),this}var u=pv.propertyEval;if(u){var a=this.binds,f=a.properties[e];if(f){var l=a.net,c=l[e];c==null&&(c=l[e]=0),(f.dependents||(f.dependents={}))[u.name]=!0,(pv.propertyEvalDependencies||(pv.propertyEvalDependencies={}))[e]=!0,c>=pv.propertyEvalNetIndex&&(pv.propertyEvalNetIndex=c+1)}}return this.instance()[e]}},pv.Mark.funPropertyCaller=function(e,t){var n=pv.Mark.stack;return function(){var r=e.apply(this,n);return r!=null?t(r):null}},pv.Mark.prototype.setPropertyValue=function(e,t,n){var r=this.$propertiesMap,i=this.$properties,s={name:e,id:pv.id(),value:t,type:n},o=r[e];r[e]=s;if(o)for(var u=0;u<i.length;u++)if(i[u]===o){i.splice(u,1);break}return i.push(s),s},pv.Mark.prototype.propertyValue=function(e){var t=this.$propertiesMap[e];if(t)return t.value},pv.Mark.stack=[],pv.Mark.prototype.property("data").property("visible",Boolean).property("datum",Object).property("css",Object).property("svg",Object).property("left",Number).property("right",Number).property("top",Number).property("bottom",Number).property("cursor",String).property("title",String).property("reverse",Boolean).property("antialias",Boolean).property("events",String).property("id",String),pv.Mark.prototype.childIndex=-1,pv.Mark.prototype.index=-1,pv.Mark.prototype.scale=1,pv.Mark.prototype._zOrder=0,pv.Mark.prototype.defaults=(new pv.Mark).data(function(e){return[e]}).datum(function(){var e=this.parent;return e?e.scene[e.index].datum:null}).visible(!0).antialias(!0).events("painted"),pv.Mark.prototype.extend=function(e){return this.proto=e,this.target=e.target,this},pv.Mark.prototype.add=function(e){return this.parent.add(e).extend(this)},pv.Mark.prototype.def=function(e,t){return this.propertyMethod(e,!0),this[e](arguments.length>1?t:null)},pv.Mark.prototype.zOrder=function(e){return arguments.length?(e=+e||0,this._zOrder!==e&&(this._zOrder!==0&&this.parent&&this.parent.zOrderChildCount--,this._zOrder=e,this._zOrder!==0&&this.parent&&this.parent.zOrderChildCount++),this):this._zOrder},pv.Mark.prototype.anchor=function(e){return e||(e="center"),(new pv.Anchor(this)).name(e).data(function(){return this.scene.target.map(function(e){return e.data})}).datum(function(){return this.scene.target[this.index].datum}).visible(function(){return this.scene.target[this.index].visible}).id(function(){return this.scene.target[this.index].id}).left(function(){var e=this.scene.target[this.index],t=e.width||0;switch(this.name()){case"bottom":case"top":case"center":return e.left+t/2;case"left":return null}return e.left+t}).top(function(){var e=this.scene.target[this.index],t=e.height||0;switch(this.name()){case"left":case"right":case"center":return e.top+t/2;case"top":return null}return e.top+t}).right(function(){var e=this.scene.target[this.index];return this.name()=="left"?e.right+(e.width||0):null}).bottom(function(){var e=this.scene.target[this.index];return this.name()=="top"?e.bottom+(e.height||0):null}).textAlign(function(){switch(this.name()){case"bottom":case"top":case"center":return"center";case"right":return"right"}return"left"}).textBaseline(function(){switch(this.name()){case"right":case"left":case"center":return"middle";case"top":return"top"}return"bottom"})},pv.Mark.prototype.anchorTarget=function(){return this.target},pv.Mark.prototype.margin=function(e){return this.left(e).right(e).top(e).bottom(e)},pv.Mark.prototype.instance=function(e){var t=this.scene||this.parent.instance(-1).children[this.childIndex],n=!arguments.length||this.hasOwnProperty("index")?this.index:e;return t[n<0?t.length-1:n]},pv.Mark.prototype.instances=function(e){var t=this,n=[],r;while(!(r=t.scene))e=e.parent,n.push({index:e.index,childIndex:t.childIndex}),t=t.parent;while(n.length){var i=n.pop();r=r[i.index].children[i.childIndex]}if(this.hasOwnProperty("index")){var s=pv.extend(r[this.index]);return s.right=s.top=s.left=s.bottom=0,[s]}return r},pv.Mark.prototype.first=function(){return this.scene[0]},pv.Mark.prototype.last=function(){return this.scene[this.scene.length-1]},pv.Mark.prototype.sibling=function(){return this.index==0?null:this.scene[this.index-1]},pv.Mark.prototype.cousin=function(){var e=this.parent,t=e&&e.sibling();return t&&t.children?t.children[this.childIndex][this.index]:null},pv.Mark.prototype.render=function(){if(this.parent&&!this.root.scene){this.root.render();return}this.renderCore()},pv.Mark.prototype.renderCore=function(){function i(e,r,i){e.scale=i;if(r<n.length){t.unshift(null);if(e.hasOwnProperty("index"))s(e,r,i);else{for(var o=0,u=e.scene.length;o<u;o++)e.index=o,s(e,r,i);delete e.index}t.shift()}else{e.build(),pv.Scene.scale=i;var a=null;e.scene&&e.scene.$g&&e.scene.$g.suspendRedraw&&(a=e.scene.$g.suspendRedraw(1e3)),pv.Scene.updateAll(e.scene),a&&e.scene.$g.unsuspendRedraw(a)}delete e.scale}function s(e,r,s){var o=e.scene[e.index],u;if(o.visible){var a=n[r],f=e.children[a];for(u=0;u<a;u++)e.children[u].scene=o.children[u];t[0]=o.data,f.scene?i(f,r+1,s*o.transform.k):(f.scene=o.children[a],i(f,r+1,s*o.transform.k),delete f.scene);for(u=0;u<a;u++)delete e.children[u].scene}}var e=this.parent,t=pv.Mark.stack,n=[];for(var r=this;r.parent;r=r.parent)n.unshift(r.childIndex);this.bind();while(e&&!e.hasOwnProperty("index"))e=e.parent;this.context(e?e.scene:undefined,e?e.index:-1,function(){i(this.root,0,1)})},pv.Mark._requiredPropsPosition={id:0,datum:1,visible:3},pv.Mark.prototype.bind=function(){function s(i){do{var s=i.$properties;for(var o=s.length-1;o>=0;o--){var u=s[o];if(!(u.name in e)){e[u.name]=u;switch(u.name){case"data":t=u;break;case"datum":case"visible":case"id":n.push(u);break;default:r[u.type].push(u)}}}}while(i=i.proto)}var e={},t,n=[],r=[[],[],[],[]],i=pv.Mark._requiredPropsPosition;s(this),s(this.defaults),n.sort(function(e,t){return i[e.name]-i[t.name]}),r[1].reverse(),r[3].reverse();var o=this;do for(var u in o.properties)u in e||r[2].push(e[u]={name:u,type:2,value:null});while(o=o.proto);var a=r[0].concat(r[1]);for(var f=0;f<a.length;f++)this.propertyMethod(a[f].name,!0);this.binds={properties:e,net:{},data:t,defs:a,required:n,optional:pv.blend(r)}},pv.Mark.prototype.updateNet=function(e,t){function s(e,t){if(t>(i[e.name]||0)){i[e.name]=t;var n=e.dependents;if(n){t++;for(var o in n)if(n.hasOwnProperty(o)){var u=r[o];u&&s(u,t)}}}}var n=this.binds,r=n.properties,i=n.net;s(e,t)},pv.Mark.prototype.build=function(){var e=this.scene,t=pv.Mark.stack;e||(e=this.scene=[],e.mark=this,e.type=this.type,e.childIndex=this.childIndex,this.parent&&(e.parent=this.parent.scene,e.parentIndex=this.parent.index)),this.target&&(e.target=this.target.instances(e));if(this.binds.defs.length){var n=e.defs;n||(e.defs=n={});for(var r=0;r<this.binds.defs.length;r++){var i=this.binds.defs[r],s=n[i.name];if(!s||i.id>s.id)n[i.name]={id:0,value:i.type&1?i.value.apply(this,t):i.value}}}var o=this.binds.data;o=o.type&1?o.value.apply(this,t):o.value;var u=pv.Mark.prototype;t.unshift(null);try{var a=e.length=o.length;for(var r=0;r<a;r++){u.index=this.index=r;var f=e[r]||(e[r]={});f.data=t[0]=o[r],this.buildInstance(f)}}finally{u.index=-1,delete this.index,t.shift()}return this},pv.Mark.prototype.buildProperties=function(e,t){var n=pv.Mark.stack;for(var r=0,i=t.length;r<i;r++){var s=t[r],o=s.value;switch(s.type){case 3:o=o.apply(this,n);break;case 2:break;case 0:case 1:o=this.scene.defs[s.name].value}e[s.name]=o}},pv.Mark.prototype.buildPropertiesWithDepTracking=function(e,t){var n=this.binds.net,r,i,s,o,u,a,f=pv.Mark.stack,l=t.length;try{for(;;){s=null,a={};for(var c=0;c<l;c++){var h=t[c],p=h.name;a[p]=!0;if(!o||o[p]){var d=h.value;switch(h.type){case 0:case 1:d=this.scene.defs[p].value;break;case 3:pv.propertyEval=h,pv.propertyEvalNetIndex=r=n[p]||0,pv.propertyEvalDependencies=null,d=d.apply(this,f),i=pv.propertyEvalNetIndex;if(i>r){var v=pv.propertyEvalDependencies;for(var m in v)v.hasOwnProperty(m)&&!a.hasOwnProperty(p)&&(s||(s={}),s[m]=!0);this.updateNet(h,i)}}e[p]=d}}if(!s)break;o=s,u=pv.numerate(t,function(e){return e.name}),t.sort(function(e,t){var r=pv.naturalOrder(n[e.name]||0,n[t.name]||0);return r||(r=pv.naturalOrder(u[e.name],u[t.name])),r}),u=null}}finally{pv.propertyEval=null,pv.propertyEvalNetIndex=null,pv.propertyEvalDependencies=null}},pv.Mark.prototype.buildInstance=function(e){this.buildProperties(e,this.binds.required),e.visible&&(this.index===0?this.buildPropertiesWithDepTracking(e,this.binds.optional):this.buildProperties(e,this.binds.optional),this.buildImplied(e))},pv.Mark.prototype.buildImplied=function(e){var t=e.left,n=e.right,r=e.top,i=e.bottom,s=this.properties,o=s.width?e.width:0,u=s.height?e.height:0,a,f;if(o==null||n==null||t==null){a=this.parent?this.parent.instance():null,f=!0;var l=a?a.width:o+t+n;o==null?o=l-(n=n||0)-(t=t||0):n==null?t==null?t=n=(l-o)/2:n=l-o-t:t=l-o-n}if(u==null||i==null||r==null){f||(a=this.parent?this.parent.instance():null);var c=a?a.height:u+r+i;u==null?u=c-(r=r||0)-(i=i||0):i==null?r==null?i=r=(c-u)/2:i=c-u-r:r=c-u-i}e.left=t,e.right=n,e.top=r,e.bottom=i,s.width&&(e.width=o),s.height&&(e.height=u),s.textStyle&&!e.textStyle&&(e.textStyle=pv.FillStyle.transparent),s.fillStyle&&!e.fillStyle&&(e.fillStyle=pv.FillStyle.transparent),s.strokeStyle&&!e.strokeStyle&&(e.strokeStyle=pv.FillStyle.transparent)},pv.Mark.prototype.mouse=function(){var e=this.root.canvas(),t=pv.scrollOffset(e),n=pv.event,r=t[0]+n.clientX*1,i=t[1]+n.clientY*1;if(pv.renderer()!=="svgweb")do r-=e.offsetLeft,i-=e.offsetTop;while(e=e.offsetParent);var s=pv.Transform.identity,o=this.properties.transform?this:this.parent,u=[];do u.push(o);while(o=o.parent);while(o=u.pop()){var a=o.instance();s=s.translate(a.left,a.top).times(a.transform)}return s=s.invert(),pv.vector(r*s.k+s.x,i*s.k+s.y)},pv.Mark.prototype.event=function(e,t){t=pv.functor(t);var n=this.$handlers[e];return n?n instanceof Array?n.push(t):n=[n,t]:n=t,this.$handlers[e]=n,this},pv.Mark.prototype.context=function(e,t,n){function u(e,t){pv.Mark.scene=e,r.index=t;if(!e)return;var n=e.mark,s=n,o=[];do o.push(s),i.push(e[t].data),s.index=t,s.scene=e,t=e.parentIndex,e=e.parent;while(s=s.parent);for(var u=o.length-1,a=1;u>0;u--)s=o[u],s.scale=a,a*=s.scene[s.index].transform.k;var f=n.children;if(f){var l=n.scene[n.index];for(var u=0,c=f.length;u<c;u++)s=f[u],s.scene=l.children[u],s.scale=a}}function a(e,t){if(!e)return;var n=e.mark,r,s=n.children;if(s)for(var o=0,u=s.length;o<u;o++)r=s[o],delete r.scene,delete r.scale;r=n;do i.pop(),r.parent&&(delete r.scene,delete r.scale),delete r.index;while(r=r.parent)}var r=pv.Mark.prototype,i=pv.Mark.stack,s=pv.Mark.scene,o=r.index;if(e&&e===s&&t===o)try{n.apply(this,i)}catch(f){throw pv.error(f),f}finally{pv.Mark.scene=s,r.index=o}else{a(s,o),u(e,t);try{n.apply(this,i)}catch(f){throw pv.error(f),f}finally{a(e,t),u(s,o)}}},pv.Mark.dispatch=function(e,t,n,r){var i=t.mark,s=t.parent,o=i.$handlers[e];return o?(i.context(t,n,function(){var e=pv.Mark.stack.concat(r);if(o instanceof Array){var t;o.forEach(function(n){var r=n.apply(i,e);r&&r.render&&(t||(t=[])).push(r)}),t&&t.forEach(function(e){e.render()})}else i=o.apply(i,e),i&&i.render&&i.render()}),!0):s&&pv.Mark.dispatch(e,s,t.parentIndex,r)},pv.Mark.prototype.eachInstance=function(e,t){function u(n,s,a){var f=s===o,l;f||(l=r[s]);var c=n.length;if(c>0){for(var h=0;h<c;h++){var p=n[h];if(s===o)e.call(t,n[h],a);else if(p.visible){var d=p.children[l];if(d){var v=a.times(p.transform).translate(p.left,p.top);u(d,s+1,v)}}}e.call(t,i,null)}}var n=this,r=[],i={isBreak:!0,visible:!1,datum:{}};while(n.parent)r.unshift(n.childIndex),n=n.parent;var s=n.scene;if(!s)return;var o=r.length;u(s,0,pv.Transform.identity)},pv.Mark.prototype.toScreenTransform=function(){var e=pv.Transform.identity;this instanceof pv.Panel&&(e=e.translate(this.left(),this.top()).times(this.transform()));var t=this.parent;if(t)do e=e.translate(t.left(),t.top()).times(t.transform());while(t=t.parent);return e},pv.Mark.prototype.transition=function(){return new pv.Transition(this)},pv.Mark.prototype.on=function(e){return this["$"+e]=new pv.Transient(this)},pv.Anchor=function(e){pv.Mark.call(this),this.target=e,this.parent=e.parent},pv.Anchor.prototype=pv.extend(pv.Mark).property("name",String),pv.Anchor.prototype.extend=function(e){return this.proto=e,this},pv.Area=function(){pv.Mark.call(this)},pv.Area.prototype=pv.extend(pv.Mark).property("width",Number).property("height",Number).property("lineWidth",Number).property("lineJoin",String).property("strokeMiterLimit",Number).property("lineCap",String).property("strokeDasharray",String).property("strokeStyle",pv.fillStyle).property("fillStyle",pv.fillStyle).property("segmented",Boolean).property("interpolate",String).property("tension",Number),pv.Area.prototype.type="area",pv.Area.prototype.defaults=(new pv.Area).extend(pv.Mark.prototype.defaults).lineWidth(1.5).fillStyle(pv.Colors.category20().by(pv.parent)).interpolate("linear").tension(.7).lineJoin("miter").strokeMiterLimit(8).lineCap("butt").strokeDasharray("none"),pv.Area.prototype.buildImplied=function(e){e.height==null&&(e.height=0),e.width==null&&(e.width=0),pv.Mark.prototype.buildImplied.call(this,e)},pv.Area.fixed={lineWidth:1,lineJoin:1,strokeMiterLimit:1,lineCap:1,strokeStyle:1,strokeDasharray:1,fillStyle:1,segmented:1,interpolate:1,tension:1},pv.Area.prototype.bind=function(){pv.Mark.prototype.bind.call(this);var e=this.binds,t=e.required,n=e.optional;for(var r=0,i=n.length;r<i;r++){var s=n[r];s.fixed=s.name in pv.Area.fixed,s.name=="segmented"&&(t.push(s),n.splice(r,1),r--,i--)}this.binds.$required=t,this.binds.$optional=n},pv.Area.prototype.buildInstance=function(e){var t=this.binds;if(this.index){var n=t.fixed;if(!n){n=t.fixed=[];function r(e){return!e.fixed||(n.push(e),!1)}t.required=t.required.filter(r),this.scene[0].segmented||(t.optional=t.optional.filter(r))}var i=n.length;if(i){var s=this.scene[0];for(var o=0;o<i;o++){var u=n[o].name;e[u]=s[u]}}}else t.required=t.$required,t.optional=t.$optional,t.fixed=null;pv.Mark.prototype.buildInstance.call(this,e)},pv.Area.prototype.anchor=function(e){var t;return pv.Mark.prototype.anchor.call(this,e).interpolate(function(){return this.scene.target[this.index].interpolate}).eccentricity(function(){return this.scene.target[this.index].eccentricity}).tension(function(){return this.scene.target[this.index].tension})},pv.Bar=function(){pv.Mark.call(this)},pv.Bar.prototype=pv.extend(pv.Mark).property("width",Number).property("height",Number).property("lineWidth",Number).property("strokeStyle",pv.fillStyle).property("fillStyle",pv.fillStyle).property("lineCap",String).property("strokeDasharray",String),pv.Bar.prototype.type="bar",pv.Bar.prototype.defaults=(new pv.Bar).extend(pv.Mark.prototype.defaults).lineWidth(1.5).fillStyle(pv.Colors.category20().by(pv.parent)).lineCap("butt").strokeDasharray("none"),pv.Dot=function(){pv.Mark.call(this)},pv.Dot.prototype=pv.extend(pv.Mark).property("shape",String).property("shapeAngle",Number).property("shapeRadius",Number).property("shapeSize",Number).property("lineWidth",Number).property("strokeStyle",pv.fillStyle).property("lineCap",String).property("strokeDasharray",String).property("fillStyle",pv.fillStyle),pv.Dot.prototype.type="dot",pv.Dot.prototype.defaults=(new pv.Dot).extend(pv.Mark.prototype.defaults).shape("circle").lineWidth(1.5).strokeStyle(pv.Colors.category10().by(pv.parent)).lineCap("butt").strokeDasharray("none"),pv.Dot.prototype.anchor=function(e){var t;return pv.Mark.prototype.anchor.call(this,e).left(function(){var e=this.scene.target[this.index];switch(this.name()){case"bottom":case"top":case"center":return e.left;case"left":return null}return e.left+e.shapeRadius}).right(function(){var e=this.scene.target[this.index];return this.name()=="left"?e.right+e.shapeRadius:null}).top(function(){var e=this.scene.target[this.index];switch(this.name()){case"left":case"right":case"center":return e.top;case"top":return null}return e.top+e.shapeRadius}).bottom(function(){var e=this.scene.target[this.index];return this.name()=="top"?e.bottom+e.shapeRadius:null}).textAlign(function(){switch(this.name()){case"left":return"right";case"bottom":case"top":case"center":return"center"}return"left"}).textBaseline(function(){switch(this.name()){case"right":case"left":case"center":return"middle";case"bottom":return"top"}return"bottom"})},pv.Dot.prototype.buildImplied=function(e){var t=e.shapeRadius,n=e.shapeSize;t==null?n==null?(e.shapeSize=20.25,e.shapeRadius=4.5):e.shapeRadius=Math.sqrt(n):n==null&&(e.shapeSize=t*t),pv.Mark.prototype.buildImplied.call(this,e)},pv.Label=function(){pv.Mark.call(this)},pv.Label.prototype=pv.extend(pv.Mark).property("text",String).property("font",String).property("textAngle",Number).property("textStyle",pv.color).property("textAlign",String).property("textBaseline",String).property("textMargin",Number).property("textDecoration",String).property("textShadow",String),pv.Label.prototype.type="label",pv.Label.prototype.defaults=(new pv.Label).extend(pv.Mark.prototype.defaults).events("none").text(pv.identity).font("10px sans-serif").textAngle(0).textStyle("black").textAlign("left").textBaseline("bottom").textMargin(3),pv.Line=function(){pv.Mark.call(this)},pv.Line.prototype=pv.extend(pv.Mark).property("lineWidth",Number).property("lineJoin",String).property("strokeMiterLimit",Number).property("lineCap",String).property("strokeStyle",pv.fillStyle).property("strokeDasharray",String).property("fillStyle",pv.fillStyle).property("segmented",Boolean).property("interpolate",String).property("eccentricity",Number).property("tension",Number),pv.Line.prototype.type="line",pv.Line.prototype.defaults=(new pv.Line).extend(pv.Mark.prototype.defaults).lineWidth(1.5).strokeStyle(pv.Colors.category10().by(pv.parent)).interpolate("linear").eccentricity(0).tension(.7).lineJoin("miter").strokeMiterLimit(8).lineCap("butt").strokeDasharray("none"),pv.Line.prototype.bind=pv.Area.prototype.bind,pv.Line.prototype.buildInstance=pv.Area.prototype.buildInstance,pv.Line.prototype.anchor=function(e){return pv.Area.prototype.anchor.call(this,e).textAlign(function(e){switch(this.name()){case"left":return"right";case"bottom":case"top":case"center":return"center";case"right":return"left"}}).textBaseline(function(e){switch(this.name()){case"right":case"left":case"center":return"middle";case"top":return"bottom";case"bottom":return"top"}})},pv.Rule=function(){pv.Mark.call(this)},pv.Rule.prototype=pv.extend(pv.Mark).property("width",Number).property("height",Number).property("lineWidth",Number).property("strokeStyle",pv.fillStyle).property("lineCap",String).property("strokeDasharray",String),pv.Rule.prototype.type="rule",pv.Rule.prototype.defaults=(new pv.Rule).extend(pv.Mark.prototype.defaults).lineWidth(1).strokeStyle("black").antialias(!1).lineCap("butt").strokeDasharray("none"),pv.Rule.prototype.anchor=pv.Line.prototype.anchor,pv.Rule.prototype.buildImplied=function(e){var t=e.left,n=e.right,r=e.top,i=e.bottom;e.width!=null||t==null&&n==null||n!=null&&t!=null?e.height=0:e.width=0,pv.Mark.prototype.buildImplied.call(this,e)},pv.Panel=function(){pv.Bar.call(this),this.children=[],this.root=this,this.$dom=pv.$&&pv.$.s},pv.Panel.prototype=pv.extend(pv.Bar).property("transform").property("overflow",String).property("canvas",function(e){return typeof e=="string"?document.getElementById(e):e}),pv.Panel.prototype.type="panel",pv.Panel.prototype.zOrderChildCount=0,pv.Panel.prototype.defaults=(new pv.Panel).extend(pv.Bar.prototype.defaults).fillStyle(null).overflow("visible"),pv.Panel.prototype.anchor=function(e){var t=pv.Bar.prototype.anchor.call(this,e);return t.parent=this,t},pv.Panel.prototype.add=function(e){var t=new e;return t.parent=this,t.root=this.root,t.childIndex=this.children.length,this.children.push(t),t},pv.Panel.prototype.bind=function(){pv.Mark.prototype.bind.call(this);var e=this.children;for(var t=0,n=e.length;t<n;t++)e[t].bind()},pv.Panel.prototype.buildInstance=function(e){pv.Bar.prototype.buildInstance.call(this,e);if(!e.visible)return;var t=this.scale*e.transform.k;pv.Mark.prototype.index=-1;var n,r=this.children,i=e.children||(e.children=[]);for(var s=0,o=r.length;s<o;s++)n=r[s],n.scene=i[s],n.scale=t,n.build();for(var s=0;s<o;s++)n=r[s],i[s]=n.scene,delete n.scene,delete n.scale;i.length=o},pv.Panel.prototype.buildImplied=function(e){if(!this.parent){var t=e.canvas;if(pv.renderer()==="batik")if(t){if(t.$panel!=this){pv.Panel.updateCreateId(t),t.$panel=this;while(t.lastChild)t.removeChild(t.lastChild)}}else t=document.lastChild;else if(t){if(t.$panel!=this){pv.Panel.updateCreateId(t),t.$panel=this;while(t.lastChild)t.removeChild(t.lastChild)}var n,r;e.width==null&&(n=parseFloat(pv.css(t,"width")),e.width=n-e.left-e.right),e.height==null&&(r=parseFloat(pv.css(t,"height")),e.height=r-e.top-e.bottom)}else{var i=this.$canvas||(this.$canvas=[]);if(!(t=i[this.index])){t=i[this.index]=document.createElement(pv.renderer()=="svgweb"?"div":"span");if(this.$dom)this.$dom.parentNode.insertBefore(t,this.$dom);else{var s=document.body;while(s.lastChild&&s.lastChild.tagName)s=s.lastChild;s!=document.body&&(s=s.parentNode),s.appendChild(t)}}}e.canvas=t}e.transform||(e.transform=pv.Transform.identity),pv.Mark.prototype.buildImplied.call(this,e)},pv.Panel.updateCreateId=function(e){e.$pvCreateId=(e.$pvCreateId||0)+1},pv.Image=function(){pv.Bar.call(this)},pv.Image.prototype=pv.extend(pv.Bar).property("url",String).property("imageWidth",Number).property("imageHeight",Number),pv.Image.prototype.type="image",pv.Image.prototype.defaults=(new pv.Image).extend(pv.Bar.prototype.defaults).fillStyle(null),pv.Image.prototype.image=function(e){return this.$image=function(){var t=e.apply(this,arguments);return t==null?pv.Color.transparent:typeof t=="string"?pv.color(t):t},this},pv.Image.prototype.bind=function(){pv.Bar.prototype.bind.call(this);var e=this.binds,t=this;do e.image=t.$image;while(!e.image&&(t=t.proto))},pv.Image.prototype.buildImplied=function(e){pv.Bar.prototype.buildImplied.call(this,e);if(!e.visible)return;e.imageWidth==null&&(e.imageWidth=e.width),e.imageHeight==null&&(e.imageHeight=e.height);if(e.url==null&&this.binds.image){var t=this.$canvas||(this.$canvas=document.createElement("canvas")),n=t.getContext("2d"),r=e.imageWidth,i=e.imageHeight,s=pv.Mark.stack,o;t.width=r,t.height=i,o=(e.image=n.createImageData(r,i)).data,s.unshift(null,null);for(var u=0,a=0;u<i;u++){s[1]=u;for(var f=0;f<r;f++){s[0]=f;var l=this.binds.image.apply(this,s);o[a++]=l.r,o[a++]=l.g,o[a++]=l.b,o[a++]=255*l.a}}s.splice(0,2)}},pv.Wedge=function(){pv.Mark.call(this)},pv.Wedge.prototype=pv.extend(pv.Mark).property("startAngle",Number).property("endAngle",Number).property("angle",Number).property("innerRadius",Number).property("outerRadius",Number).property("lineWidth",Number).property("strokeStyle",pv.fillStyle).property("lineJoin",String).property("strokeMiterLimit",Number).property("lineCap",String).property("strokeDasharray",String).property("fillStyle",pv.fillStyle),pv.Wedge.prototype.type="wedge",pv.Wedge.prototype.defaults=(new pv.Wedge).extend(pv.Mark.prototype.defaults).startAngle(function(){var e=this.sibling();return e?e.endAngle:-Math.PI/2}).innerRadius(0).lineWidth(1.5).strokeStyle(null).fillStyle(pv.Colors.category20().by(pv.index)).lineJoin("miter").strokeMiterLimit(8).lineCap("butt").strokeDasharray("none"),pv.Wedge.prototype.midRadius=function(){return(this.innerRadius()+this.outerRadius())/2},pv.Wedge.prototype.midAngle=function(){return(this.startAngle()+this.endAngle())/2},pv.Wedge.prototype.anchor=function(e){function t(e){return e.innerRadius||e.angle<2*Math.PI}function n(e){return(e.innerRadius+e.outerRadius)/2}function r(e){return(e.startAngle+e.endAngle)/2}return pv.Mark.prototype.anchor.call(this,e).left(function(){var e=this.scene.target[this.index];if(t(e))switch(this.name()){case"outer":return e.left+e.outerRadius*Math.cos(r(e));case"inner":return e.left+e.innerRadius*Math.cos(r(e));case"start":return e.left+n(e)*Math.cos(e.startAngle);case"center":return e.left+n(e)*Math.cos(r(e));case"end":return e.left+n(e)*Math.cos(e.endAngle)}return e.left}).top(function(){var e=this.scene.target[this.index];if(t(e))switch(this.name()){case"outer":return e.top+e.outerRadius*Math.sin(r(e));case"inner":return e.top+e.innerRadius*Math.sin(r(e));case"start":return e.top+n(e)*Math.sin(e.startAngle);case"center":return e.top+n(e)*Math.sin(r(e));case"end":return e.top+n(e)*Math.sin(e.endAngle)}return e.top}).textAlign(function(){var e=this.scene.target[this.index];if(t(e))switch(this.name()){case"outer":return pv.Wedge.upright(r(e))?"right":"left";case"inner":return pv.Wedge.upright(r(e))?"left":"right"}return"center"}).textBaseline(function(){var e=this.scene.target[this.index];if(t(e))switch(this.name()){case"start":return pv.Wedge.upright(e.startAngle)?"top":"bottom";case"end":return pv.Wedge.upright(e.endAngle)?"bottom":"top"}return"middle"}).textAngle(function(){var e=this.scene.target[this.index],n=0;if(t(e))switch(this.name()){case"center":case"inner":case"outer":n=r(e);break;case"start":n=e.startAngle;break;case"end":n=e.endAngle}return pv.Wedge.upright(n)?n:n+Math.PI})},pv.Wedge.upright=function(e){return e%=2*Math.PI,e=e<0?2*Math.PI+e:e,e<Math.PI/2||e>=3*Math.PI/2},pv.Wedge.prototype.buildImplied=function(e){e.angle==null?e.angle=e.endAngle-e.startAngle:e.endAngle==null&&(e.endAngle=e.startAngle+e.angle),pv.Mark.prototype.buildImplied.call(this,e)},pv.Ease=function(){function e(e){return function(t){return 1-e(1-t)}}function t(e){return function(t){return.5*(t<.5?e(2*t):2-e(2-2*t))}}function n(e){return function(t){return t<0?0:t>1?1:Math.pow(t,e)}}function r(e){return 1-Math.cos(e*Math.PI/2)}function i(e){return e?Math.pow(2,10*(e-1))-.001:0}function s(e){return-(Math.sqrt(1-e*e)-1)}function o(e,t){var n;return t||(t=.45),!e||e<1?(e=1,n=t/4):n=t/(2*Math.PI)*Math.asin(1/e),function(r){return r<=0||r>=1?r:-(e*Math.pow(2,10*--r)*Math.sin((r-n)*2*Math.PI/t))}}function u(e){return e||(e=1.70158),function(t){return t*t*((e+1)*t-e)}}function a(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375}var f=n(2),l=n(3),c=o(),h=u(),p={linear:pv.identity,"quad-in":f,"quad-out":e(f),"quad-in-out":t(f),"quad-out-in":t(e(f)),"cubic-in":l,"cubic-out":e(l),"cubic-in-out":t(l),"cubic-out-in":t(e(l)),"sin-in":r,"sin-out":e(r),"sin-in-out":t(r),"sin-out-in":t(e(r)),"exp-in":i,"exp-out":e(i),"exp-in-out":t(i),"exp-out-in":t(e(i)),"circle-in":s,"circle-out":e(s),"circle-in-out":t(s),"circle-out-in":t(e(s)),"elastic-in":c,"elastic-out":e(c),"elastic-in-out":t(c),"elastic-out-in":t(e(c)),"back-in":h,"back-out":e(h),"back-in-out":t(h),"back-out-in":t(e(h)),"bounce-in":a,"bounce-out":e(a),"bounce-in-out":t(a),"bounce-out-in":t(e(a))};return pv.ease=function(e){return p[e]},{reverse:e,reflect:t,linear:function(){return pv.identity},sin:function(){return r},exp:function(){return i},circle:function(){return s},elastic:o,back:u,bounce:a,poly:n}}(),pv.Transition=function(e){function a(e){var t={};for(var n=0;n<e.length;n++){var r=e[n];r.id&&(t[r.id]=r)}return t}function f(e,t,n,r){var i;if(t in o){var s=pv.Scale.interpolator(n[t],r[t]);i=function(e){n[t]=s(e)}}else i=function(e){e>.5&&(n[t]=r[t])};i.next=e.head,e.head=i}function l(e,t,n){for(var r in t){if(r=="children")continue;if(t[r]==n[r])continue;f(e,r,t,n)}if(t.children)for(var i=0;i<t.children.length;i++)c(e,t.children[i],n.children[i])}function c(e,t,n){var r=t.mark,i=a(t),s=a(n);for(var o=0;o<t.length;o++){var u=t[o],f=u.id?s[u.id]:n[o];u.index=o;if(!u.visible)continue;if(!f||!f.visible){var c=h(t,o,r.$exit,n);u.transition=f?2:(n.push(c),1),f=c}l(e,u,f)}for(var o=0;o<n.length;o++){var f=n[o],u=f.id?i[f.id]:t[o];if((!u||!u.visible)&&f.visible){var c=h(n,o,r.$enter,t);u?t[u.index]=c:t.push(c),l(e,c,f)}}}function h(e,t,n,r){var i=pv.extend(e[t]),s=e.mark,o=s.root.scene,a=(n||u).$properties,f;r.target&&(f=r.target[r.length])&&(e=pv.extend(e),e.target=pv.extend(r.target),e.target[t]=f);var l={};for(var c=0;c<a.length;c++)l[a[c].name]=1;return a=s.binds.optional.filter(function(e){return!(e.name in l)}).concat(a),s.context(e,t,function(){this.buildProperties(i,a),this.buildImplied(i)}),s.root.scene=o,i}function p(e){for(var t=0,n=0;t<e.length;t++){var r=e[t];r.transition!=1&&(e[n++]=r,r.transition==2&&(r.visible=!1),r.children&&r.children.forEach(p))}e.length=n}function d(){if(s){var e=s;s=null,e()}}var t=this,n=pv.ease("cubic-in-out"),r=250,i,s,o={top:1,left:1,right:1,bottom:1,width:1,height:1,innerRadius:1,outerRadius:1,radius:1,startAngle:1,endAngle:1,angle:1,fillStyle:1,strokeStyle:1,lineWidth:1,eccentricity:1,tension:1,textAngle:1,textStyle:1,textMargin:1},u=new pv.Transient;t.ease=function(e){return arguments.length?(n=typeof e=="function"?e:pv.ease(e),t):n},t.duration=function(e){return arguments.length?(r=Number(e),t):r},t.start=function(o){s=o,e.parent&&(d(),fail()),e.$transition&&e.$transition.stop(),e.$transition=t;var u=pv.Mark.prototype.index,a=e.scene,f;e.scene=null,e.bind(),e.build(),f=e.scene,e.scene=a,pv.Mark.prototype.index=u;var l=Date.now(),h={};c(h,a,f),i=setInterval(function(){var i=Math.max(0,Math.min(1,(Date.now()-l)/r)),s=n(i);for(var o=h.head;o;o=o.next)o(s);i==1&&(p(e.scene),t.stop()),pv.Scene.updateAll(a)},24)},t.stop=function(){clearInterval(i),d()}},pv.Transient=function(e){pv.Mark.call(this),this.fillStyle(null).strokeStyle(null).textStyle(null),this.on=function(t){return e.on(t)}},pv.Transient.prototype=pv.extend(pv.Mark),pv.simulation=function(e){return new pv.Simulation(e)},pv.Simulation=function(e){for(var t=0;t<e.length;t++)this.particle(e[t])},pv.Simulation.prototype.particle=function(e){return e.next=this.particles,isNaN(e.px)&&(e.px=e.x),isNaN(e.py)&&(e.py=e.y),isNaN(e.fx)&&(e.fx=0),isNaN(e.fy)&&(e.fy=0),this.particles=e,this},pv.Simulation.prototype.force=function(e){return e.next=this.forces,this.forces=e,this},pv.Simulation.prototype.constraint=function(e){return e.next=this.constraints,this.constraints=e,this},pv.Simulation.prototype.stabilize=function(e){var t;arguments.length||(e=3);for(var n=0;n<e;n++){var r=new pv.Quadtree(this.particles);for(t=this.constraints;t;t=t.next)t.apply(this.particles,r)}for(var i=this.particles;i;i=i.next)i.px=i.x,i.py=i.y;return this},pv.Simulation.prototype.step=function(){var e,t,n;for(e=this.particles;e;e=e.next){var r=e.px,i=e.py;e.px=e.x,e.py=e.y,e.x+=e.vx=e.x-r+e.fx,e.y+=e.vy=e.y-i+e.fy}var s=new pv.Quadtree(this.particles);for(n=this.constraints;n;n=n.next)n.apply(this.particles,s);for(e=this.particles;e;e=e.next)e.fx=e.fy=0;for(t=this.forces;t;t=t.next)t.apply(this.particles,s)},pv.Quadtree=function(e){function a(e,t,n,r,i,s){if(isNaN(t.x)||isNaN(t.y))return;if(e.leaf)if(e.p)if(Math.abs(e.p.x-t.x)+Math.abs(e.p.y-t.y)<.01)f(e,t,n,r,i,s);else{var o=e.p;e.p=null,f(e,o,n,r,i,s),f(e,t,n,r,i,s)}else e.p=t;else f(e,t,n,r,i,s)}function f(e,t,n,r,i,s){var o=(n+i)*.5,u=(r+s)*.5,f=t.x>=o,l=t.y>=u;e.leaf=!1;switch((l<<1)+f){case 0:e=e.c1||(e.c1=new pv.Quadtree.Node);break;case 1:e=e.c2||(e.c2=new pv.Quadtree.Node);break;case 2:e=e.c3||(e.c3=new pv.Quadtree.Node);break;case 3:e=e.c4||(e.c4=new pv.Quadtree.Node)}f?n=o:i=o,l?r=u:s=u,a(e,t,n,r,i,s)}var t,n=Number.POSITIVE_INFINITY,r=n,i=Number.NEGATIVE_INFINITY,s=i;for(t=e;t;t=t.next)t.x<n&&(n=t.x),t.y<r&&(r=t.y),t.x>i&&(i=t.x),t.y>s&&(s=t.y);var o=i-n,u=s-r;o>u?s=r+o:i=n+u,this.xMin=n,this.yMin=r,this.xMax=i,this.yMax=s,this.root=new pv.Quadtree.Node;for(t=e;t;t=t.next)a(this.root,t,n,r,i,s)},pv.Quadtree.Node=function(){this.leaf=!0,this.c1=null,this.c2=null,this.c3=null,this.c4=null,this.p=null},pv.Force={},pv.Force.charge=function(e){function u(t){function i(e){u(e),t.cn+=e.cn,n+=e.cn*e.cx,r+=e.cn*e.cy}var n=0,r=0;t.cn=0,t.leaf||(t.c1&&i(t.c1),t.c2&&i(t.c2),t.c3&&i(t.c3),t.c4&&i(t.c4)),t.p&&(t.cn+=e,n+=e*t.p.x,r+=e*t.p.y),t.cx=n/t.cn,t.cy=r/t.cn}function a(t,r,o,u,f,l){var c=t.cx-r.x,h=t.cy-r.y,p=1/Math.sqrt(c*c+h*h);if(t.leaf&&t.p!=r||(f-o)*p<s){if(p<i)return;p>n&&(p=n);var d=t.cn*p*p*p,v=c*d,m=h*d;r.fx+=v,r.fy+=m}else if(!t.leaf){var g=(o+f)*.5,y=(u+l)*.5;t.c1&&a(t.c1,r,o,u,g,y),t.c2&&a(t.c2,r,g,u,f,y),t.c3&&a(t.c3,r,o,y,g,l),t.c4&&a(t.c4,r,g,y,f,l);if(p<i)return;p>n&&(p=n);if(t.p&&t.p!=r){var d=e*p*p*p,v=c*d,m=h*d;r.fx+=v,r.fy+=m}}}var t=2,n=1/t,r=500,i=1/r,s=.9,o={};return arguments.length||(e=-40),o.constant=function(t){return arguments.length?(e=Number(t),o):e},o.domain=function(e,s){return arguments.length?(t=Number(e),n=1/t,r=Number(s),i=1/r,o):[t,r]},o.theta=function(e){return arguments.length?(s=Number(e),o):s},o.apply=function(e,t){u(t.root);for(var n=e;n;n=n.next)a(t.root,n,t.xMin,t.yMin,t.xMax,t.yMax)},o},pv.Force.drag=function(e){var t={};return arguments.length||(e=.1),t.constant=function(n){return arguments.length?(e=n,t):e},t.apply=function(t){if(e)for(var n=t;n;n=n.next)n.fx-=e*n.vx,n.fy-=e*n.vy},t},pv.Force.spring=function(e){var t=.1,n=20,r,i,s={};return arguments.length||(e=.1),s.links=function(e){return arguments.length?(r=e,i=e.map(function(e){return 1/Math.sqrt(Math.max(e.sourceNode.linkDegree,e.targetNode.linkDegree))}),s):r},s.constant=function(t){return arguments.length?(e=Number(t),s):e},s.damping=function(e){return arguments.length?(t=Number(e),s):t},s.length=function(e){return arguments.length?(n=Number(e),s):n},s.apply=function(s){for(var o=0;o<r.length;o++){var u=r[o].sourceNode,a=r[o].targetNode,f=u.x-a.x,c=u.y-a.y,h=Math.sqrt(f*f+c*c),p=h?1/h:1,v=e*i[o],m=t*i[o],g=(v*(h-n)+m*(f*(u.vx-a.vx)+c*(u.vy-a.vy))*p)*p,y=-g*(h?f:.01*(.5-Math.random())),b=-g*(h?c:.01*(.5-Math.random()));u.fx+=y,u.fy+=b,a.fx-=y,a.fy-=b}},s},pv.Constraint={},pv.Constraint.collision=function(e){function a(t,u,f,l,c,h){if(!t.leaf){var p=(f+c)*.5,d=(l+h)*.5,v=d>i,m=d<o,g=p>r,y=p<s;v&&(t.c1&&g&&a(t.c1,u,f,l,p,d),t.c2&&y&&a(t.c2,u,p,l,c,d)),m&&(t.c3&&g&&a(t.c3,u,f,d,p,h),t.c4&&y&&a(t.c4,u,p,d,c,h))}if(t.p&&t.p!=u){var b=u.x-t.p.x,w=u.y-t.p.y,E=Math.sqrt(b*b+w*w),S=n+e(t.p);if(E<S){var x=(E-S)/E*.5;b*=x,w*=x,u.x-=b,u.y-=w,t.p.x+=b,t.p.y+=w}}}var t=1,n,r,i,s,o,u={};return arguments.length||(n=10),u.repeat=function(e){return arguments.length?(t=Number(e),u):t},u.apply=function(u,f){var l,c,h=-Infinity;for(l=u;l;l=l.next)c=e(l),c>h&&(h=c);for(var p=0;p<t;p++)for(l=u;l;l=l.next)c=(n=e(l))+h,r=l.x-c,s=l.x+c,i=l.y-c,o=l.y+c,a(f.root,l,f.xMin,f.yMin,f.xMax,f.yMax)},u},pv.Constraint.position=function(e){var t=1,n={};return arguments.length||(e=function(e){return e.fix}),n.alpha=function(e){return arguments.length?(t=Number(e),n):t},n.apply=function(n){for(var r=n;r;r=r.next){var i=e(r);i&&(r.x+=(i.x-r.x)*t,r.y+=(i.y-r.y)*t,r.fx=r.fy=r.vx=r.vy=0)}},n},pv.Constraint.bound=function(){var e={},t,n;return e.x=function(e,n){return arguments.length?(t={min:Math.min(e,n),max:Math.max(e,n)},this):t},e.y=function(e,t){return arguments.length?(n={min:Math.min(e,t),max:Math.max(e,t)},this):n},e.apply=function(e){if(t)for(var r=e;r;r=r.next)r.x=r.x<t.min?t.min:r.x>t.max?t.max:r.x;if(n)for(var r=e;r;r=r.next)r.y=r.y<n.min?n.min:r.y>n.max?n.max:r.y},e},pv.Layout=function(){pv.Panel.call(this)},pv.Layout.prototype=pv.extend(pv.Panel),pv.Layout.prototype.property=pv.Mark.prototype.localProperty,pv.Layout.Network=function(){pv.Layout.call(this);var e=this;this.$id=pv.id(),(this.node=(new pv.Mark).data(function(){return e.nodes()}).strokeStyle("#1f77b4").fillStyle("#fff").left(function(e){return e.x}).top(function(e){return e.y})).parent=this,this.link=(new pv.Mark).extend(this.node).data(function(e){return[e.sourceNode,e.targetNode]}).fillStyle(null).lineWidth(function(e,t){return t.linkValue*1.5}).strokeStyle("rgba(0,0,0,.2)"),this.link.add=function(t){return e.add(pv.Panel).data(function(){return e.links()}).add(t).extend(this)},(this.label=(new pv.Mark).extend(this.node).textMargin(7).textBaseline("middle").text(function(e){return e.nodeName||e.nodeValue}).textAngle(function(e){var t=e.midAngle;return pv.Wedge.upright(t)?t:t+Math.PI}).textAlign(function(e){return pv.Wedge.upright(e.midAngle)?"left":"right"})).parent=this},pv.Layout.Network.prototype=pv.extend(pv.Layout).property("nodes",function(e){return e.map(function(e,t){return typeof e!="object"&&(e={nodeValue:e}),e.index=t,e})}).property("links",function(e){return e.map(function(e){return isNaN(e.linkValue)&&(e.linkValue=isNaN(e.value)?1:e.value),e})}),pv.Layout.Network.prototype.reset=function(){return this.$id=pv.id(),this},pv.Layout.Network.prototype.buildProperties=function(e,t){(e.$id||0)<this.$id&&pv.Layout.prototype.buildProperties.call(this,e,t)},pv.Layout.Network.prototype.buildImplied=function(e){pv.Layout.prototype.buildImplied.call(this,e);if(e.$id>=this.$id)return!0;e.$id=this.$id,e.nodes.forEach(function(e){e.linkDegree=0}),e.links.forEach(function(t){var n=t.linkValue;(t.sourceNode||(t.sourceNode=e.nodes[t.source])).linkDegree+=n,(t.targetNode||(t.targetNode=e.nodes[t.target])).linkDegree+=n})},pv.Layout.Hierarchy=function(){pv.Layout.Network.call(this),this.link.strokeStyle("#ccc")},pv.Layout.Hierarchy.prototype=pv.extend(pv.Layout.Network),pv.Layout.Hierarchy.prototype.buildImplied=function(e){e.links||(e.links=pv.Layout.Hierarchy.links.call(this)),pv.Layout.Network.prototype.buildImplied.call(this,e)},pv.Layout.Hierarchy.links=function(){return this.nodes().filter(function(e){return e.parentNode}).map(function(e){return{sourceNode:e,targetNode:e.parentNode,linkValue:1}})},pv.Layout.Hierarchy.NodeLink={buildImplied:function(e){function a(e){return e.parentNode?e.depth*(u-o)+o:0}function f(e){return e.parentNode?(e.breadth-.25)*2*Math.PI:0}function l(e){switch(n){case"left":return e.depth*i;case"right":return i-e.depth*i;case"top":return e.breadth*i;case"bottom":return i-e.breadth*i;case"radial":return i/2+a(e)*Math.cos(e.midAngle)}}function c(e){switch(n){case"left":return e.breadth*s;case"right":return s-e.breadth*s;case"top":return e.depth*s;case"bottom":return s-e.depth*s;case"radial":return s/2+a(e)*Math.sin(e.midAngle)}}var t=e.nodes,n=e.orient,r=/^(top|bottom)$/.test(n),i=e.width,s=e.height;if(n=="radial"){var o=e.innerRadius,u=e.outerRadius;o==null&&(o=0),u==null&&(u=Math.min(i,s)/2)}for(var h=0;h<t.length;h++){var p=t[h];p.midAngle=n=="radial"?f(p):r?Math.PI/2:0,p.x=l(p),p.y=c(p),p.firstChild&&(p.midAngle+=Math.PI)}}},pv.Layout.Hierarchy.Fill={constructor:function(){this.node.strokeStyle("#fff").fillStyle("#ccc").width(function(e){return e.dx}).height(function(e){return e.dy}).innerRadius(function(e){return e.innerRadius}).outerRadius(function(e){return e.outerRadius}).startAngle(function(e){return e.startAngle}).angle(function(e){return e.angle}),this.label.textAlign("center").left(function(e){return e.x+e.dx/2}).top(function(e){return e.y+e.dy/2}),delete this.link},buildImplied:function(e){function f(e,t){return(e+t)/(1+t)}function l(e){switch(n){case"left":return f(e.minDepth,o)*i;case"right":return(1-f(e.maxDepth,o))*i;case"top":return e.minBreadth*i;case"bottom":return(1-e.maxBreadth)*i;case"radial":return i/2}}function c(e){switch(n){case"left":return e.minBreadth*s;case"right":return(1-e.maxBreadth)*s;case"top":return f(e.minDepth,o)*s;case"bottom":return(1-f(e.maxDepth,o))*s;case"radial":return s/2}}function h(e){switch(n){case"left":case"right":return(e.maxDepth-e.minDepth)/(1+o)*i;case"top":case"bottom":return(e.maxBreadth-e.minBreadth)*i;case"radial":return e.parentNode?(e.innerRadius+e.outerRadius)*Math.cos(e.midAngle):0}}function p(e){switch(n){case"left":case"right":return(e.maxBreadth-e.minBreadth)*s;case"top":case"bottom":return(e.maxDepth-e.minDepth)/(1+o)*s;case"radial":return e.parentNode?(e.innerRadius+e.outerRadius)*Math.sin(e.midAngle):0}}function d(e){return Math.max(0,f(e.minDepth,o/2))*(a-u)+u}function v(e){return f(e.maxDepth,o/2)*(a-u)+u}function m(e){return(e.parentNode?e.minBreadth-.25:0)*2*Math.PI}function g(e){return(e.parentNode?e.maxBreadth-e.minBreadth:1)*2*Math.PI}var t=e.nodes,n=e.orient,r=/^(top|bottom)$/.test(n),i=e.width,s=e.height,o=-t[0].minDepth;if(n=="radial"){var u=e.innerRadius,a=e.outerRadius;u==null&&(u=0),u&&(o*=2),a==null&&(a=Math.min(i,s)/2)}for(var y=0;y<t.length;y++){var b=t[y];b.x=l(b),b.y=c(b),n=="radial"?(b.innerRadius=d(b),b.outerRadius=v(b),b.startAngle=m(b),b.angle=g(b),b.midAngle=b.startAngle+b.angle/2):b.midAngle=r?-Math.PI/2:0,b.dx=h(b),b.dy=p(b)}}},pv.Layout.Grid=function(){pv.Layout.call(this);var e=this;(this.cell=(new pv.Mark).data(function(){return e.scene[e.index].$grid}).width(function(){return e.width()/e.cols()}).height(function(){return e.height()/e.rows()}).left(function(){return this.width()*(this.index%e.cols())}).top(function(){return this.height()*Math.floor(this.index/e.cols())})).parent=this},pv.Layout.Grid.prototype=pv.extend(pv.Layout).property("rows").property("cols"),pv.Layout.Grid.prototype.defaults=(new pv.Layout.Grid).extend(pv.Layout.prototype.defaults).rows(1).cols(1),pv.Layout.Grid.prototype.buildImplied=function(e){pv.Layout.prototype.buildImplied.call(this,e);var t=e.rows,n=e.cols;typeof n=="object"&&(t=pv.transpose(n)),typeof t=="object"?(e.$grid=pv.blend(t),e.rows=t.length,e.cols=t[0]?t[0].length:0):e.$grid=pv.repeat([e.data],t*n)},pv.Layout.Stack=function(){function s(e){return function(){return n[e](this.parent.index,this.index)}}pv.Layout.call(this);var e=this,t=function(){return null},n={t:t,l:t,r:t,b:t,w:t,h:t},r,i=e.buildImplied;this.buildImplied=function(e){i.call(this,e);var s=e.layers,o=s.length,u,a=e.orient,f=/^(top|bottom)\b/.test(a),l=this.parent[f?"height":"width"](),c=[],h=[],p=[],d=pv.Mark.stack,v={parent:{parent:this}};d.unshift(null),r=[];for(var m=0;m<o;m++){p[m]=[],h[m]=[],v.parent.index=m,d[0]=s[m],r[m]=this.$values.apply(v.parent,d),m||(u=r[m].length),d.unshift(null);for(var g=0;g<u;g++)d[0]=r[m][g],v.index=g,m||(c[g]=this.$x.apply(v,d)),p[m][g]=this.$y.apply(v,d);d.shift()}d.shift();var y;switch(e.order){case"inside-out":var b=p.map(function(e){return pv.max.index(e)}),w=pv.range(o).sort(function(e,t){return b[e]-b[t]}),E=p.map(function(e){return pv.sum(e)}),S=0,x=0,T=[],N=[];for(var m=0;m<o;m++){var g=w[m];S<x?(S+=E[g],T.push(g)):(x+=E[g],N.push(g))}y=N.reverse().concat(T);break;case"reverse":y=pv.range(o-1,-1,-1);break;default:y=pv.range(o)}switch(e.offset){case"silohouette":for(var g=0;g<u;g++){var v=0;for(var m=0;m<o;m++)v+=p[m][g];h[y[0]][g]=(l-v)/2}break;case"wiggle":var v=0;for(var m=0;m<o;m++)v+=p[m][0];h[y[0]][0]=v=(l-v)/2;for(var g=1;g<u;g++){var C=0,k=0,L=c[g]-c[g-1];for(var m=0;m<o;m++)C+=p[m][g];for(var m=0;m<o;m++){var A=(p[y[m]][g]-p[y[m]][g-1])/(2*L);for(var O=0;O<m;O++)A+=(p[y[O]][g]-p[y[O]][g-1])/L;k+=A*p[y[m]][g]}h[y[0]][g]=v-=C?k/C*L:0}break;case"expand":for(var g=0;g<u;g++){h[y[0]][g]=0;var O=0;for(var m=0;m<o;m++)O+=p[m][g];if(O){O=l/O;for(var m=0;m<o;m++)p[m][g]*=O}else{O=l/o;for(var m=0;m<o;m++)p[m][g]=O}}break;default:for(var g=0;g<u;g++)h[y[0]][g]=0}for(var g=0;g<u;g++){var v=h[y[0]][g];for(var m=1;m<o;m++)v+=p[y[m-1]][g],h[y[m]][g]=v}var m=a.indexOf("-"),M=f?"h":"w",_=m<0?f?"l":"b":a.charAt(m+1),D=a.charAt(0);for(var P in n)n[P]=t;n[_]=function(e,t){return c[t]},n[D]=function(e,t){return h[e][t]},n[M]=function(e,t){return p[e][t]}},this.layer=(new pv.Mark).data(function(){return r[this.parent.index]}).top(s("t")).left(s("l")).right(s("r")).bottom(s("b")).width(s("w")).height(s("h")),this.layer.add=function(t){return e.add(pv.Panel).data(function(){return e.layers()}).add(t).extend(this)}},pv.Layout.Stack.prototype=pv.extend(pv.Layout).property("orient",String).property("offset",String).property("order",String).property("layers"),pv.Layout.Stack.prototype.defaults=(new pv.Layout.Stack).extend(pv.Layout.prototype.defaults).orient("bottom-left").offset("zero").layers([[]]),pv.Layout.Stack.prototype.$x=pv.Layout.Stack.prototype.$y=function(){return 0},pv.Layout.Stack.prototype.x=function(e){return this.$x=pv.functor(e),this},pv.Layout.Stack.prototype.y=function(e){return this.$y=pv.functor(e),this},pv.Layout.Stack.prototype.$values=pv.identity,pv.Layout.Stack.prototype.values=function(e){return this.$values=pv.functor(e),this},pv.Layout.Band=function(){function s(e){return function(){return n[e](this.index,this.parent.index)}}pv.Layout.call(this);var e=this,t=e.buildImplied,n,r,i=(new pv.Mark).data(function(){return r[this.parent.index]}).top(s("t")).left(s("l")).right(s("r")).bottom(s("b")).width(s("w")).height(s("h"));this.buildImplied=function(e){t.call(this,e),n=Object.create(pv.Layout.Band.$baseItemProps),r=[];var i=e.layers,s=i.length;if(s>0){var o=e.orient,u=/^(top|bottom)\b/.test(o),a=this.parent[u?"height":"width"](),f=this._readData(i,r,e),l=f.length;e.bandOrder==="reverse"&&f.reverse();if(e.order==="reverse"){r.reverse();for(var c=0;c<l;c++)f[c].items.reverse()}switch(e.layout){case"grouped":this._calcGrouped(f,s,e);break;case"stacked":this._calcStacked(f,s,a,e)}this._bindItemProps(f,n,o,u)}};var o=this.item={end:this,add:function(t){return e.add(pv.Panel).data(function(){return e.layers()}).add(t).extend(i)},order:function(t){return e.order(t),this},w:function(t){return e.$iw=pv.functor(t),this},h:function(t){return e.$ih=pv.functor(t),this},horizontalRatio:function(t){return e.$ihorizRatio=pv.functor(t),this},verticalMargin:function(t){return e.$ivertiMargin=pv.functor(t),this}},u=this.band={end:this,w:function(t){return e.$bw=pv.functor(t),this},x:function(t){return e.$bx=pv.functor(t),this},order:function(t){return e.bandOrder(t),this},differentialControl:function(t){return e.$bDiffControl=pv.functor(t),this}};this.band.item=o,this.item.band=u},pv.Layout.Band.$baseItemProps=function(){var e=function(){return null};return{t:e,l:e,r:e,b:e,w:e,h:e}}(),pv.Layout.Band.prototype=pv.extend(pv.Layout).property("orient",String).property("layout",String).property("layers").property("yZero",Number).property("verticalMode",String).property("horizontalMode",String).property("order",String).property("bandOrder",String),pv.Layout.Band.prototype.defaults=(new pv.Layout.Band).extend(pv.Layout.prototype.defaults).orient("bottom-left").layout("grouped").yZero(0).layers([[]]),pv.Layout.Band.prototype.$bx=pv.Layout.Band.prototype.$bw=pv.Layout.Band.prototype.$bDiffControl=pv.Layout.Band.prototype.$iw=pv.Layout.Band.prototype.$ih=pv.Layout.Band.prototype.$ivertiMargin=pv.functor(0),pv.Layout.Band.prototype.$ihorizRatio=pv.functor(.9),pv.Layout.Band.prototype.$values=pv.identity,pv.Layout.Band.prototype.values=function(e){return this.$values=pv.functor(e),this},pv.Layout.prototype._readData=function(e,t,n){var r=e.length,i=[],s,o=pv.Mark.stack,u={parent:{parent:this}};o.unshift(null);for(var a=0;a<r;a++){u.parent.index=a,o[0]=e[a];var f=t[a]=this.$values.apply(u.parent,o);a||(s=f.length),o.unshift(null);for(var l=0;l<s;l++){o[0]=f[l],u.index=l;var c=i[l];c||(c=i[l]={horizRatio:this.$ihorizRatio.apply(u,o),vertiMargin:this.$ivertiMargin.apply(u,o),w:this.$bw.apply(u,o),x:this.$bx.apply(u,o),diffControl:this.$bDiffControl?this.$bDiffControl.apply(u,o):0,items:[]});var h=this.$ih.apply(u,o);c.items[a]={y:n.yZero||0,x:0,w:this.$iw.apply(u,o),h:h!=null?Math.abs(h):h,dir:h<0?-1:1}}o.shift()}return o.shift(),i},pv.Layout.Band.prototype._calcGrouped=function(e,t,n){for(var r=0,i=e.length;r<i;r++){var s=e[r],o=s.items,u=s.w,a=s.horizRatio,f=0;for(var l=0;l<t;l++)f+=o[l].w;t===1?a=1:a>0&&a<=1||(a=1);if(u==null)u=s.w=f/a;else if(n.horizontalMode==="expand"){var c=a*u;if(f){var h=c/f;for(var l=0;l<t;l++)o[l].w*=h}else{var p=c/t;for(var l=0;l<t;l++)o[l].w=p}f=c}var d=f/a,v=s.x-d/2,m=t>1?(d-f)/(t-1):0;for(var l=0;l<t;l++){var g=o[l];g.x=v,v+=g.w+m,g.dir<0&&(g.y-=g.h)}}},pv.Layout.Band.prototype._calcStacked=function(e,t,n,r){var i=e.length,s;if(r.verticalMode==="expand")for(var o=0;o<i;o++){s=e[o].items;var u=null,a=0;for(var f=0;f<t;f++){var l=s[f];l.dir=1;var c=l.h;c!=null&&(a++,u+=c)}if(a)if(u){var h=n/u;for(var f=0;f<t;f++){var c=s[f].h;c!=null&&(s[f].h=c*h)}}else{var p=n/a;for(var f=0;f<t;f++){var c=s[f].h;c!=null&&(s[f].h=p)}}}var d=r.yZero,v=d;for(var o=0;o<i;o++){var m=e[o],g=m.x,y=m.diffControl,b=y<0,w=m.vertiMargin>0?m.vertiMargin:0;s=m.items;var E=this._layoutItemsOfDir(1,b,s,w,g,v),S;E.existsOtherDir&&(S=this._layoutItemsOfDir(-1,b,s,w,g,v)),y?Math.abs(y)===1&&(v=E.yOffset,S&&(v-=S.yOffset)):v=d}},pv.Layout.Band.prototype._layoutItemsOfDir=function(e,t,n,r,i,s){var o=!1,u=r/2,a=t?-e:e,f=t;for(var l=0,c=n.length;l<c;l+=1){var h=n[f?c-l-1:l];if(h.dir===e){var p=h.h||0;a>0?(h.y=s+u,s+=p):(h.y=s-(p-u),s-=p),h.h-=r,h.x=i-h.w/2}else o=!0}return{existsOtherDir:o,yOffset:s}},pv.Layout.Band.prototype._bindItemProps=function(e,t,n,r){var i=n.indexOf("-"),s=r?"h":"w",o=r?"w":"h",u=i<0?r?"l":"b":n.charAt(i+1),a=n.charAt(0);t[u]=function(t,n){return e[t].items[n].x},t[a]=function(t,n){return e[t].items[n].y},t[o]=function(t,n){return e[t].items[n].w},t[s]=function(t,n){return e[t].items[n].h||0}},pv.Layout.Treemap=function(){pv.Layout.Hierarchy.call(this),this.node.strokeStyle("#fff").fillStyle("rgba(31, 119, 180, .25)").width(function(e){return e.dx}).height(function(e){return e.dy}),this.label.visible(function(e){return!e.firstChild}).left(function(e){return e.x+e.dx/2}).top(function(e){return e.y+e.dy/2}).textAlign("center").textAngle(function(e){return e.dx>e.dy?0:-Math.PI/2}),(this.leaf=(new pv.Mark).extend(this.node).fillStyle(null).strokeStyle(null).visible(function(e){return!e.firstChild})).parent=this,delete this.link},pv.Layout.Treemap.prototype=pv.extend(pv.Layout.Hierarchy).property("round",Boolean).property("paddingLeft",Number).property("paddingRight",Number).property("paddingTop",Number).property("paddingBottom",Number).property("mode",String).property("order",String),pv.Layout.Treemap.prototype.defaults=(new pv.Layout.Treemap).extend(pv.Layout.Hierarchy.prototype.defaults).mode("squarify").order("ascending"),pv.Layout.Treemap.prototype.padding=function(e){return this.paddingLeft(e).paddingRight(e).paddingTop(e).paddingBottom(e)},pv.Layout.Treemap.prototype.$size=function(e){return Number(e.nodeValue)},pv.Layout.Treemap.prototype.size=function(e){return this.$size=pv.functor(e),this},pv.Layout.Treemap.prototype.buildImplied=function(e){function h(e,t,n,r,i,s,o){for(var u=0,a=0;u<e.length;u++){var f=e[u];n?(f.x=r+a,f.y=i,a+=f.dx=l(s*f.size/t),f.dy=o):(f.x=r,f.y=i+a,f.dx=s,a+=f.dy=l(o*f.size/t))}f&&(n?f.dx+=s-a:f.dy+=o-a)}function p(e,t){var n=-Infinity,r=Infinity,i=0;for(var s=0;s<e.length;s++){var o=e[s].size;o<r&&(r=o),o>n&&(n=o),i+=o}return i*=i,t*=t,Math.max(t*n/i,i/(t*r))}function d(e,t){function b(e){var t=i==g,s=pv.sum(e,f),o=g?l(s/g):0;return h(e,s,t,n,r,t?i:o,t?o:d),t?(r+=o,d-=o):(n+=o,i-=o),g=Math.min(i,d),t}var n=e.x+s,r=e.y+u,i=e.dx-s-o,d=e.dy-u-a;if(c!="squarify"){h(e.childNodes,e.size,c=="slice"?!0:c=="dice"?!1:t&1,n,r,i,d);return}var v=[],m=Infinity,g=Math.min(i,d),y=i*d/e.size;if(e.size<=0)return;e.visitBefore(function(e){e.size*=y});var w=e.childNodes.slice();while(w.length){var E=w[w.length-1];if(!E.size){w.pop();continue}v.push(E);var y=p(v,g);y<=m?(w.pop(),m=y):(v.pop(),b(v),v.length=0,m=Infinity)}if(b(v))for(var t=0;t<v.length;t++)v[t].dy+=d;else for(var t=0;t<v.length;t++)v[t].dx+=i}if(pv.Layout.Hierarchy.prototype.buildImplied.call(this,e))return;var t=this,n=e.nodes,r=n[0],i=pv.Mark.stack,s=e.paddingLeft,o=e.paddingRight,u=e.paddingTop,a=e.paddingBottom,f=function(e){return e.size},l=e.round?Math.round:Number,c=e.mode;i.unshift(null),r.visitAfter(function(e,n){e.depth=n,e.x=e.y=e.dx=e.dy=0,e.size=e.firstChild?pv.sum(e.childNodes,function(e){return e.size}):t.$size.apply(t,(i[0]=e,i))}),i.shift();switch(e.order){case"ascending":r.sort(function(e,t){return e.size-t.size});break;case"descending":r.sort(function(e,t){return t.size-e.size});break;case"reverse":r.reverse()}r.x=0,r.y=0,r.dx=e.width,r.dy=e.height,r.visitBefore(d)},pv.Layout.Tree=function(){pv.Layout.Hierarchy.call(this)},pv.Layout.Tree.prototype=pv.extend(pv.Layout.Hierarchy).property("group",Number).property("breadth",Number).property("depth",Number).property("orient",String),pv.Layout.Tree.prototype.defaults=(new pv.Layout.Tree).extend(pv.Layout.Hierarchy.prototype.defaults).group(1).breadth(15).depth(60).orient("top"),pv.Layout.Tree.prototype.buildImplied=function(e){function a(e){var t,n,r;if(!e.firstChild){if(t=e.previousSibling)e.prelim=t.prelim+m(e.depth,!0)}else{t=e.firstChild,n=e.lastChild,r=t;for(var i=t;i;i=i.nextSibling)a(i),r=l(i,r);d(e);var s=.5*(t.prelim+n.prelim);(t=e.previousSibling)?(e.prelim=t.prelim+m(e.depth,!0),e.mod=e.prelim-s):e.prelim=s}}function f(e,t,n){e.breadth=e.prelim+t,t+=e.mod;for(var r=e.firstChild;r;r=r.nextSibling)f(r,t,n)}function l(e,t){var n=e.previousSibling;if(n){var r=e,i=e,s=n,o=e.parentNode.firstChild,u=r.mod,a=i.mod,f=s.mod,l=o.mod,d=h(s),g=c(r);while(d&&g){s=d,r=g,o=c(o),i=h(i),i.ancestor=e;var y=s.prelim+f-(r.prelim+u)+m(s.depth,!1);y>0&&(p(v(s,e,t),e,y),u+=y,a+=y),f+=s.mod,u+=r.mod,l+=o.mod,a+=i.mod,d=h(s),g=c(r)}d&&!h(i)&&(i.thread=d,i.mod+=f-a),g&&!c(o)&&(o.thread=g,o.mod+=u-l,t=e)}return t}function c(e){return e.firstChild||e.thread}function h(e){return e.lastChild||e.thread}function p(e,t,n){var r=t.number-e.number;t.change-=n/r,t.shift+=n,e.change+=n/r,t.prelim+=n,t.mod+=n}function d(e){var t=0,n=0;for(var r=e.lastChild;r;r=r.previousSibling)r.prelim+=t,r.mod+=t,n+=r.change,t+=r.shift+n}function v(e,t,n){return e.ancestor.parentNode==t.parentNode?e.ancestor:n}function m(e,t){return(t?1:s+1)/(n=="radial"?e:1)}function y(e){return n=="radial"?e.breadth/r:0}function b(e){switch(n){case"left":return e.depth;case"right":return o-e.depth;case"top":case"bottom":return e.breadth+o/2;case"radial":return o/2+e.depth*Math.cos(y(e))}}function w(e){switch(n){case"left":case"right":return e.breadth+u/2;case"top":return e.depth;case"bottom":return u-e.depth;case"radial":return u/2+e.depth*Math.sin(y(e))}}if(pv.Layout.Hierarchy.prototype.buildImplied.call(this,e))return;var t=e.nodes,n=e.orient,r=e.depth,i=e.breadth,s=e.group,o=e.width,u=e.height,g=t[0];g.visitAfter(function(e,t){e.ancestor=e,e.prelim=0,e.mod=0,e.change=0,e.shift=0,e.number=e.previousSibling?e.previousSibling.number+1:0,e.depth=t}),a(g),f(g,-g.prelim,0),g.visitAfter(function(e){e.breadth*=i,e.depth*=r,e.midAngle=y(e),e.x=b(e),e.y=w(e),e.firstChild&&(e.midAngle+=Math.PI),delete e.breadth,delete e.depth,delete e.ancestor,delete e.prelim,delete e.mod,delete e.change,delete e.shift,delete e.number,delete e.thread})},pv.Layout.Indent=function(){pv.Layout.Hierarchy.call(this),this.link.interpolate("step-after")},pv.Layout.Indent.prototype=pv.extend(pv.Layout.Hierarchy).property("depth",Number).property("breadth",Number),pv.Layout.Indent.prototype.defaults=(new pv.Layout.Indent).extend(pv.Layout.Hierarchy.prototype.defaults).depth(15).breadth(15),pv.Layout.Indent.prototype.buildImplied=function(e){function o(e,t,u){e.x=i+u++*r,e.y=s+t++*n,e.midAngle=0;for(var a=e.firstChild;a;a=a.nextSibling)t=o(a,t,u);return t}if(pv.Layout.Hierarchy.prototype.buildImplied.call(this,e))return;var t=e.nodes,n=e.breadth,r=e.depth,i=0,s=0;o(t[0],1,1)},pv.Layout.Pack=function(){pv.Layout.Hierarchy.call(this),this.node.shapeRadius(function(e){return e.radius}).strokeStyle("rgb(31, 119, 180)").fillStyle("rgba(31, 119, 180, .25)"),this.label.textAlign("center"),delete this.link},pv.Layout.Pack.prototype=pv.extend(pv.Layout.Hierarchy).property("spacing",Number).property("order",String),pv.Layout.Pack.prototype.defaults=(new pv.Layout.Pack).extend(pv.Layout.Hierarchy.prototype.defaults).spacing(1).order("ascending"),pv.Layout.Pack.prototype.$radius=function(){return 1},pv.Layout.Pack.prototype.size=function(e){return this.$radius=typeof e=="function"?function(){return Math.sqrt(e.apply(this,arguments))}:(e=Math.sqrt(e),function(){return e}),this},pv.Layout.Pack.prototype.buildImplied=function(e){function i(e){var n=pv.Mark.stack;n.unshift(null);for(var r=0,i=e.length;r<i;r++){var s=e[r];s.firstChild||(s.radius=t.$radius.apply(t,(n[0]=s,n)))}n.shift()}function s(t){var n=[];for(var r=t.firstChild;r;r=r.nextSibling)r.firstChild&&(r.radius=s(r)),r.n=r.p=r,n.push(r);switch(e.order){case"ascending":n.sort(function(e,t){return e.radius-t.radius});break;case"descending":n.sort(function(e,t){return t.radius-e.radius});break;case"reverse":n.reverse()}return o(n)}function o(t){function h(e){n=Math.min(e.x-e.radius,n),r=Math.max(e.x+e.radius,r),i=Math.min(e.y-e.radius,i),s=Math.max(e.y+e.radius,s)}function p(e,t){var n=e.n;e.n=t,t.p=e,t.n=n,n.p=t}function d(e,t){e.n=t,t.p=e}function v(e,t){var n=t.x-e.x,r=t.y-e.y,i=e.radius+t.radius;return i*i-n*n-r*r>.001}var n=Infinity,r=-Infinity,i=Infinity,s=-Infinity,o,a,f,l,c;o=t[0],o.x=-o.radius,o.y=0,h(o);if(t.length>1){a=t[1],a.x=a.radius,a.y=0,h(a);if(t.length>2){f=t[2],u(o,a,f),h(f),p(o,f),o.p=f,p(f,a),a=o.n;for(var m=3;m<t.length;m++){u(o,a,f=t[m]);var g=0,y=1,b=1;for(l=a.n;l!=a;l=l.n,y++)if(v(l,f)){g=1;break}if(g==1)for(c=o.p;c!=l.p;c=c.p,b++)if(v(c,f)){b<y&&(g=-1,l=c);break}g==0?(p(o,f),a=f,h(f)):g>0?(d(o,l),a=l,m--):g<0&&(d(l,a),o=l,m--)}}}var w=(n+r)/2,E=(i+s)/2,S=0;for(var m=0;m<t.length;m++){var x=t[m];x.x-=w,x.y-=E,S=Math.max(S,x.radius+Math.sqrt(x.x*x.x+x.y*x.y))}return S+e.spacing}function u(e,t,n){var r=t.radius+n.radius,i=e.radius+n.radius,s=t.x-e.x,o=t.y-e.y,u=Math.sqrt(s*s+o*o),a=(i*i+u*u-r*r)/(2*i*u),f=Math.acos(a),l=a*i,c=Math.sin(f)*i;s/=u,o/=u,n.x=e.x+l*s+c*o,n.y=e.y+l*o-c*s}function a(e,t,n,r){for(var i=e.firstChild;i;i=i.nextSibling)i.x+=e.x,i.y+=e.y,a(i,t,n,r);e.x=t+r*e.x,e.y=n+r*e.y,e.radius*=r}if(pv.Layout.Hierarchy.prototype.buildImplied.call(this,e))return;var t=this,n=e.nodes,r=n[0];i(n),r.x=0,r.y=0,r.radius=s(r);var f=this.width(),l=this.height(),c=1/Math.max(2*r.radius/f,2*r.radius/l);a(r,f/2,l/2,c)},pv.Layout.Force=function(){pv.Layout.Network.call(this),this.link.lineWidth(function(e,t){return Math.sqrt(t.linkValue)*1.5}),this.label.textAlign("center")},pv.Layout.Force.prototype=pv.extend(pv.Layout.Network).property("bound",Boolean).property("iterations",Number).property("dragConstant",Number).property("chargeConstant",Number).property("chargeMinDistance",Number).property("chargeMaxDistance",Number).property("chargeTheta",Number).property("springConstant",Number).property("springDamping",Number).property("springLength",Number),pv.Layout.Force.prototype.defaults=(new pv.Layout.Force).extend(pv.Layout.Network.prototype.defaults).dragConstant(.1).chargeConstant(-40).chargeMinDistance(2).chargeMaxDistance(500).chargeTheta(.9).springConstant(.1).springDamping(.3).springLength(20),pv.Layout.Force.prototype.buildImplied=function(e){function c(e){return e.fix?1:e.vx*e.vx+e.vy*e.vy}if(pv.Layout.Network.prototype.buildImplied.call(this,e)){var t=e.$force;t&&(t.next=this.binds.$force,this.binds.$force=t);return}var n=this,r=e.nodes,i=e.links,s=e.iterations,o=e.width,u=e.height;for(var a=0,f;a<r.length;a++)f=r[a],isNaN(f.x)&&(f.x=o/2+40*Math.random()-20),isNaN(f.y)&&(f.y=u/2+40*Math.random()-20);var l=pv.simulation(r);l.force(pv.Force.drag(e.dragConstant)),l.force(pv.Force.charge(e.chargeConstant).domain(e.chargeMinDistance,e.chargeMaxDistance).theta(e.chargeTheta)),l.force(pv.Force.spring(e.springConstant).damping(e.springDamping).length(e.springLength).links(i)),l.constraint(pv.Constraint.position()),e.bound&&l.constraint(pv.Constraint.bound().x(6,o-6).y(6,u-6));if(s==null){l.step(),l.step();var h=e.$force=this.binds.$force={next:this.binds.$force,nodes:r,min:1e-4*(i.length+1),sim:l};this.$timer||(this.$timer=setInterval(function(){var e=!1;for(var t=n.binds.$force;t;t=t.next)pv.max(t.nodes,c)>t.min&&(t.sim.step(),e=!0);e&&n.render()},42))}else for(var a=0;a<s;a++)l.step()},pv.Layout.Cluster=function(){pv.Layout.Hierarchy.call(this);var e,t=this.buildImplied;this.buildImplied=function(n){t.call(this,n),e=/^(top|bottom)$/.test(n.orient)?"step-before":/^(left|right)$/.test(n.orient)?"step-after":"linear"},this.link.interpolate(function(){return e})},pv.Layout.Cluster.prototype=pv.extend(pv.Layout.Hierarchy).property("group",Number).property("orient",String).property("innerRadius",Number).property("outerRadius",Number),pv.Layout.Cluster.prototype.defaults=(new pv.Layout.Cluster).extend(pv.Layout.Hierarchy.prototype.defaults).group(0).orient("top"),pv.Layout.Cluster.prototype.buildImplied=function(e){if(pv.Layout.Hierarchy.prototype.buildImplied.call(this,e))return;var t=e.nodes[0],n=e.group,r,i,s=0,o=.5-n/2,u=undefined;t.visitAfter(function(e){e.firstChild?e.depth=1+pv.max(e.childNodes,function(e){return e.depth}):(n&&u!=e.parentNode&&(u=e.parentNode,s+=n),s++,e.depth=0)}),r=1/s,i=1/t.depth;var u=undefined;t.visitAfter(function(e){e.firstChild?e.breadth=pv.mean(e.childNodes,function(e){return e.breadth}):(n&&u!=e.parentNode&&(u=e.parentNode,o+=n),e.breadth=r*o++),e.depth=1-e.depth*i}),t.visitAfter(function(e){e.minBreadth=e.firstChild?e.firstChild.minBreadth:e.breadth-r/2,e.maxBreadth=e.firstChild?e.lastChild.maxBreadth:e.breadth+r/2}),t.visitBefore(function(e){e.minDepth=e.parentNode?e.parentNode.maxDepth:0,e.maxDepth=e.parentNode?e.depth+t.depth:e.minDepth+2*t.depth}),t.minDepth=-i,pv.Layout.Hierarchy.NodeLink.buildImplied.call(this,e)},pv.Layout.Cluster.Fill=function(){pv.Layout.Cluster.call(this),pv.Layout.Hierarchy.Fill.constructor.call(this)},pv.Layout.Cluster.Fill.prototype=pv.extend(pv.Layout.Cluster),pv.Layout.Cluster.Fill.prototype.buildImplied=function(e){if(pv.Layout.Cluster.prototype.buildImplied.call(this,e))return;pv.Layout.Hierarchy.Fill.buildImplied.call(this,e)},pv.Layout.Partition=function(){pv.Layout.Hierarchy.call(this)},pv.Layout.Partition.prototype=pv.extend(pv.Layout.Hierarchy).property("order",String).property("orient",String).property("innerRadius",Number).property("outerRadius",Number),pv.Layout.Partition.prototype.defaults=(new pv.Layout.Partition).extend(pv.Layout.Hierarchy.prototype.defaults).orient("top"),pv.Layout.Partition.prototype.$size=function(){return 1},pv.Layout.Partition.prototype.size=function(e){return this.$size=e,this},pv.Layout.Partition.prototype.buildImplied=function(e){if(pv.Layout.Hierarchy.prototype.buildImplied.call(this,e))return;var t=this,n=e.nodes[0],r=pv.Mark.stack,i=0;r.unshift(null),n.visitAfter(function(e,n){n>i&&(i=n),e.size=e.firstChild?pv.sum(e.childNodes,function(e){return e.size}):t.$size.apply(t,(r[0]=e,r))}),r.shift();switch(e.order){case"ascending":n.sort(function(e,t){return e.size-t.size});break;case"descending":n.sort(function(e,t){return t.size-e.size})}var s=1/i;n.minBreadth=0,n.breadth=.5,n.maxBreadth=1,n.visitBefore(function(e){var t=e.minBreadth,n=e.maxBreadth-t;for(var r=e.firstChild;r;r=r.nextSibling)r.minBreadth=t,r.maxBreadth=t+=r.size/e.size*n,r.breadth=(t+r.minBreadth)/2}),n.visitAfter(function(e,t){e.minDepth=(t-1)*s,e.maxDepth=e.depth=t*s}),pv.Layout.Hierarchy.NodeLink.buildImplied.call(this,e)},pv.Layout.Partition.Fill=function(){pv.Layout.Partition.call(this),pv.Layout.Hierarchy.Fill.constructor.call(this)},pv.Layout.Partition.Fill.prototype=pv.extend(pv.Layout.Partition),pv.Layout.Partition.Fill.prototype.buildImplied=function(e){if(pv.Layout.Partition.prototype.buildImplied.call(this,e))return;pv.Layout.Hierarchy.Fill.buildImplied.call(this,e)},pv.Layout.Arc=function(){pv.Layout.Network.call(this);var e,t,n,r=this.buildImplied;this.buildImplied=function(i){r.call(this,i),t=i.directed,e=i.orient=="radial"?"linear":"polar",n=i.orient=="right"||i.orient=="top"},this.link.data(function(e){var r=e.sourceNode,i=e.targetNode;return n!=(t||r.breadth<i.breadth)?[r,i]:[i,r]}).interpolate(function(){return e})},pv.Layout.Arc.prototype=pv.extend(pv.Layout.Network).property("orient",String).property("directed",Boolean),pv.Layout.Arc.prototype.defaults=(new pv.Layout.Arc).extend(pv.Layout.Network.prototype.defaults).orient("bottom"),pv.Layout.Arc.prototype.sort=function(e){return this.$sort=e,this},pv.Layout.Arc.prototype.buildImplied=function(e){function a(e){switch(n){case"top":return-Math.PI/2;case"bottom":return Math.PI/2;case"left":return Math.PI;case"right":return 0;case"radial":return(e-.25)*2*Math.PI}}function f(e){switch(n){case"top":case"bottom":return e*s;case"left":return 0;case"right":return s;case"radial":return s/2+u*Math.cos(a(e))}}function l(e){switch(n){case"top":return 0;case"bottom":return o;case"left":case"right":return e*o;case"radial":return o/2+u*Math.sin(a(e))}}if(pv.Layout.Network.prototype.buildImplied.call(this,e))return;var t=e.nodes,n=e.orient,r=this.$sort,i=pv.range(t.length),s=e.width,o=e.height,u=Math.min(s,o)/2;r&&i.sort(function(e,n){return r(t[e],t[n])});for(var c=0;c<t.length;c++){var h=t[i[c]],p=h.breadth=(c+.5)/t.length;h.x=f(p),h.y=l(p),h.midAngle=a(p)}},pv.Layout.Horizon=function(){pv.Layout.call(this);var e=this,t,n,r,i,s,o,u=this.buildImplied;this.buildImplied=function(e){u.call(this,e),t=e.bands,n=e.mode,r=Math.round((n=="color"?.5:1)*e.height),i=e.backgroundStyle,s=pv.ramp(i,e.negativeStyle).domain(0,t),o=pv.ramp(i,e.positiveStyle).domain(0,t)};var t=(new pv.Panel).data(function(){return pv.range(t*2)}).overflow("hidden").height(function(){return r}).top(function(e){return n=="color"?(e&1)*r:0}).fillStyle(function(e){return e?null:i});this.band=(new pv.Mark).top(function(e,t){return n=="mirror"&&t&1?(t+1>>1)*r:null}).bottom(function(e,t){return n=="mirror"?t&1?null:(t+1>>1)*-r:(t&1||-1)*(t+1>>1)*r}).fillStyle(function(e,t){return(t&1?s:o)((t>>1)+1)}),this.band.add=function(n){return e.add(pv.Panel).extend(t).add(n).extend(this)}},pv.Layout.Horizon.prototype=pv.extend(pv.Layout).property("bands",Number).property("mode",String).property("backgroundStyle",pv.color).property("positiveStyle",pv.color).property("negativeStyle",pv.color),pv.Layout.Horizon.prototype.defaults=(new pv.Layout.Horizon).extend(pv.Layout.prototype.defaults).bands(2).mode("offset").backgroundStyle("white").positiveStyle("#1f77b4").negativeStyle("#d62728"),pv.Layout.Rollup=function(){pv.Layout.Network.call(this);var e=this,t,n,r=e.buildImplied;this.buildImplied=function(e){r.call(this,e),t=e.$rollup.nodes,n=e.$rollup.links},this.node.data(function(){return t}).shapeSize(function(e){return e.nodes.length*20}),this.link.interpolate("polar").eccentricity(.8),this.link.add=function(t){return e.add(pv.Panel).data(function(){return n}).add(t).extend(this)}},pv.Layout.Rollup.prototype=pv.extend(pv.Layout.Network).property("directed",Boolean),pv.Layout.Rollup.prototype.x=function(e){return this.$x=pv.functor(e),this},pv.Layout.Rollup.prototype.y=function(e){return this.$y=pv.functor(e),this},pv.Layout.Rollup.prototype.buildImplied=function(e){function l(e){return s[e]+","+o[e]}if(pv.Layout.Network.prototype.buildImplied.call(this,e))return;var t=e.nodes,n=e.links,r=e.directed,i=t.length,s=[],o=[],u=0,a={},f={},c=pv.Mark.stack,h={parent:this};c.unshift(null);for(var p=0;p<i;p++)h.index=p,c[0]=t[p],s[p]=this.$x.apply(h,c),o[p]=this.$y.apply(h,c);c.shift();for(var p=0;p<t.length;p++){var d=l(p),v=a[d];v||(v=a[d]=pv.extend(t[p]),v.index=u++,v.x=s[p],v.y=o[p],v.nodes=[]),v.nodes.push(t[p])}for(var p=0;p<n.length;p++){var m=n[p].sourceNode,g=n[p].targetNode,y=a[l(m.index)],b=a[l(g.index)],w=!r&&y.index>b.index,E=w?b.index+","+y.index:y.index+","+b.index,S=f[E];S||(S=f[E]={sourceNode:y,targetNode:b,linkValue:0,links:[]}),S.links.push(n[p]),S.linkValue+=n[p].linkValue}e.$rollup={nodes:pv.values(a),links:pv.values(f)}},pv.Layout.Matrix=function(){pv.Layout.Network.call(this);var e=this,t,n,r,i,s,o=e.buildImplied;this.buildImplied=function(e){o.call(this,e),t=e.nodes.length,n=e.width/t,r=e.height/t,i=e.$matrix.labels,s=e.$matrix.pairs},this.link.data(function(){return s}).left(function(){return n*(this.index%t)}).top(function(){return r*Math.floor(this.index/t)}).width(function(){return n}).height(function(){return r}).lineWidth(1.5).strokeStyle("#fff").fillStyle(function(e){return e.linkValue?"#555":"#eee"}).parent=this,delete this.link.add,this.label.data(function(){return i}).left(function(){return this.index&1?n*((this.index>>1)+.5):0}).top(function(){return this.index&1?0:r*((this.index>>1)+.5)}).textMargin(4).textAlign(function(){return this.index&1?"left":"right"}).textAngle(function(){return this.index&1?-Math.PI/2:0}),delete this.node},pv.Layout.Matrix.prototype=pv.extend(pv.Layout.Network).property("directed",Boolean),pv.Layout.Matrix.prototype.sort=function(e){return this.$sort=e,this},pv.Layout.Matrix.prototype.buildImplied=function(e){if(pv.Layout.Network.prototype.buildImplied.call(this,e))return;var t=e.nodes,n=e.links,r=this.$sort,i=t.length,s=pv.range(i),o=[],u=[],a={};e.$matrix={labels:o,pairs:u},r&&s.sort(function(e,n){return r(t[e],t[n])});for(var f=0;f<i;f++)for(var l=0;l<i;l++){var c=s[f],h=s[l],p={row:f,col:l,sourceNode:t[c],targetNode:t[h],linkValue:0};u.push(a[c+"."+h]=p)}for(var f=0;f<i;f++){var c=s[f];o.push(t[c],t[c])}for(var f=0;f<n.length;f++){var d=n[f],v=d.sourceNode.index,m=d.targetNode.index,g=d.linkValue;a[v+"."+m].linkValue+=g,e.directed||(a[m+"."+v].linkValue+=g)}},pv.Layout.Bullet=function(){pv.Layout.call(this);var e=this,t=e.buildImplied,n=e.x=pv.Scale.linear(),r,i,s,o,u;this.buildImplied=function(e){t.call(this,u=e),r=e.orient,i=/^left|right$/.test(r),s=pv.ramp("#bbb","#eee").domain(0,Math.max(1,u.ranges.length-1)),o=pv.ramp("steelblue","lightsteelblue").domain(0,Math.max(1,u.measures.length-1))},(this.range=new pv.Mark).data(function(){return u.ranges}).reverse(!0).left(function(){return r=="left"?0:null}).top(function(){return r=="top"?0:null}).right(function(){return r=="right"?0:null}).bottom(function(){return r=="bottom"?0:null}).width(function(e){return i?n(e):null}).height(function(e){return i?null:n(e)}).fillStyle(function(){return s(this.index)}).antialias(!1).parent=e,(this.measure=new pv.Mark).extend(this.range).data(function(){return u.measures}).left(function(){return r=="left"?0:i?null:this.parent.width()/3.25}).top(function(){return r=="top"?0:i?this.parent.height()/3.25:null}).right(function(){return r=="right"?0:i?null:this.parent.width()/3.25}).bottom(function(){return r=="bottom"?0:i?this.parent.height()/3.25:null}).fillStyle(function(){return o(this.index)}).parent=e,(this.marker=new pv.Mark).data(function(){return u.markers}).left(function(e){return r=="left"?n(e):i?null:this.parent.width()/2}).top(function(e){return r=="top"?n(e):i?this.parent.height()/2:null}).right(function(e){return r=="right"?n(e):null}).bottom(function(e){return r=="bottom"?n(e):null}).strokeStyle("black").shape("bar").shapeAngle(function(){return i?0:Math.PI/2}).parent=e,(this.tick=new pv.Mark).data(function(){return n.ticks(7)}).left(function(e){return r=="left"?n(e):null}).top(function(e){return r=="top"?n(e):null}).right(function(e){return r=="right"?n(e):i?null:-6}).bottom(function(e){return r=="bottom"?n(e):i?-8:null}).height(function(){return i?6:null}).width(function(){return i?null:6}).parent=e},pv.Layout.Bullet.prototype=pv.extend(pv.Layout).property("orient",String).property("ranges").property("markers").property("measures").property("maximum",Number),pv.Layout.Bullet.prototype.defaults=(new pv.Layout.Bullet).extend(pv.Layout.prototype.defaults).orient("left").ranges([]).markers([]).measures([]),pv.Layout.Bullet.prototype.buildImplied=function(e){pv.Layout.prototype.buildImplied.call(this,e);var t=this.parent[/^left|right$/.test(e.orient)?"width":"height"]();e.maximum=e.maximum||pv.max([].concat(e.ranges,e.markers,e.measures)),this.x.domain(0,e.maximum).range(0,t)},pv.Behavior={},pv.Behavior.drag=function(){function s(s,o){t=this.index,e=this.scene;var u=this.mouse();r=((n=s).fix=pv.vector(s.x,s.y)).minus(u),i={x:this.parent.width()-(s.dx||0),y:this.parent.height()-(s.dy||0)},e.mark.context(e,t,function(){this.render()}),pv.Mark.dispatch("dragstart",e,t,o)}function o(s){if(!e)return;e.mark.context(e,t,function(){var e=this.mouse();n.x=n.fix.x=Math.max(0,Math.min(r.x+e.x,i.x)),n.y=n.fix.y=Math.max(0,Math.min(r.y+e.y,i.y)),this.render()}),pv.Mark.dispatch("drag",e,t,s)}function u(r){if(!e)return;n.fix=null,e.mark.context(e,t,function(){this.render()}),pv.Mark.dispatch("dragend",e,t,r),e=null}var e,t,n,r,i;return pv.listen(window,"mousemove",o),pv.listen(window,"mouseup",u),s},pv.Behavior.point=function(e){function u(e,t){var n=e[t],s={cost:Infinity};for(var o=(n.visible?n.children.length:0)-1;o>=0;o--){var a=n.children[o],f=a.mark,l;if(f.type=="panel"){f.scene=a;for(var c=a.length-1;c>=0;c--)f.index=c,l=u(a,c),l.cost<s.cost&&(s=l);delete f.scene,delete f.index}else if(f.$handlers.point){var h=f.mouse();for(var c=a.length-1;c>=0;c--){var p=a[c],d=h.x-p.left-(p.width||0)/2,v=h.y-p.top-(p.height||0)/2,m=r*d*d+i*v*v;m<s.cost&&(s.distance=d*d+v*v,s.cost=m,s.scene=a,s.index=c)}}}return s}function a(e){var n=u(this.scene,this.index);if(n.cost==Infinity||n.distance>o)n=null;if(t){if(n&&t.scene==n.scene&&t.index==n.index)return;pv.Mark.dispatch("unpoint",t.scene,t.index,e)}if(t=n)pv.Mark.dispatch("point",n.scene,n.index,e),!s&&this.type==="panel"?(s=this,s.event("mouseout",function(){var e=arguments[arguments.length-1];f.call(s.scene.$g,e)})):pv.listen(this.root.canvas(),"mouseout",f)}function f(e){t&&!pv.ancestor(this,e.relatedTarget)&&(pv.Mark.dispatch("unpoint",t.scene,t.index,e),t=null)}var t,n=null,r=1,i=1,s=null,o=arguments.length?e*e:900;return a.collapse=function(e){if(arguments.length){n=String(e);switch(n){case"y":r=1,i=0;break;case"x":r=0,i=1;break;default:r=1,i=1}return a}return n},a},pv.Behavior.select=function(){function i(i,s){t=this.index,e=this.scene,r=this.mouse(),n=i,n.x=r.x,n.y=r.y,n.dx=n.dy=0,pv.Mark.dispatch("selectstart",e,t,s)}function s(i){if(!e)return;e.mark.context(e,t,function(){var e=this.mouse();n.x=Math.max(0,Math.min(r.x,e.x)),n.y=Math.max(0,Math.min(r.y,e.y)),n.dx=Math.min(this.width(),Math.max(e.x,r.x))-n.x,n.dy=Math.min(this.height(),Math.max(e.y,r.y))-n.y,this.render()}),pv.Mark.dispatch("select",e,t,i)}function o(n){if(!e)return;pv.Mark.dispatch("selectend",e,t,n),e=null}var e,t,n,r;return pv.listen(window,"mousemove",s),pv.listen(window,"mouseup",o),i},pv.Behavior.resize=function(e){function s(s,o){n=this.index,t=this.scene,i=this.mouse(),r=s;switch(e){case"left":i.x=r.x+r.dx;break;case"right":i.x=r.x;break;case"top":i.y=r.y+r.dy;break;case"bottom":i.y=r.y}pv.Mark.dispatch("resizestart",t,n,o)}function o(e){if(!t)return;t.mark.context(t,n,function(){var e=this.mouse();r.x=Math.max(0,Math.min(i.x,e.x)),r.y=Math.max(0,Math.min(i.y,e.y)),r.dx=Math.min(this.parent.width(),Math.max(e.x,i.x))-r.x,r.dy=Math.min(this.parent.height(),Math.max(e.y,i.y))-r.y,this.render()}),pv.Mark.dispatch("resize",t,n,e)}function u(e){if(!t)return;pv.Mark.dispatch("resizeend",t,n,e),t=null}var t,n,r,i;return pv.listen(window,"mousemove",o),pv.listen(window,"mouseup",u),s},pv.Behavior.pan=function(){function o(){t=this.index,e=this.scene,r=pv.vector(pv.event.pageX,pv.event.pageY),n=this.transform(),i=1/(n.k*this.scale),s&&(s={x:(1-n.k)*this.width(),y:(1-n.k)*this.height()})}function u(o){if(!e)return;e.mark.context(e,t,function(){var e=(pv.event.pageX-r.x)*i,t=(pv.event.pageY-r.y)*i,o=n.translate(e,t);s&&(o.x=Math.max(s.x,Math.min(0,o.x)),o.y=Math.max(s.y,Math.min(0,o.y))),this.transform(o).render()}),pv.Mark.dispatch("pan",e,t,o)}function a(){e=null}var e,t,n,r,i,s;return o.bound=function(e){return arguments.length?(s=Boolean(e),this):Boolean(s)},pv.listen(window,"mousemove",u),pv.listen(window,"mouseup",a),o},pv.Behavior.zoom=function(e){function n(n){var r=this.mouse(),i=pv.event.wheel*e,s=this.transform().translate(r.x,r.y).scale(i<0?1e3/(1e3-i):(1e3+i)/1e3).translate(-r.x,-r.y);t&&(s.k=Math.max(1,s.k),s.x=Math.max((1-s.k)*this.width(),Math.min(0,s.x)),s.y=Math.max((1-s.k)*this.height(),Math.min(0,s.y))),this.transform(s).render(),pv.Mark.dispatch("zoom",this.scene,this.index,n)}var t;return arguments.length||(e=1/48),n.bound=function(e){return arguments.length?(t=Boolean(e),this):Boolean(t)},n},pv.Geo=function(){},pv.Geo.projections={mercator:{project:function(e){return{x:e.lng/180,y:e.lat>85?1:e.lat<-85?-1:Math.log(Math.tan(Math.PI/4+pv.radians(e.lat)/2))/Math.PI}},invert:function(e){return{lng:e.x*180,lat:pv.degrees(2*Math.atan(Math.exp(e.y*Math.PI))-Math.PI/2)}}},"gall-peters":{project:function(e){return{x:e.lng/180,y:Math.sin(pv.radians(e.lat))}},invert:function(e){return{lng:e.x*180,lat:pv.degrees(Math.asin(e.y))}}},sinusoidal:{project:function(e){return{x:pv.radians(e.lng)*Math.cos(pv.radians(e.lat))/Math.PI,y:e.lat/90}},invert:function(e){return{lng:pv.degrees(e.x*Math.PI/Math.cos(e.y*Math.PI/2)),lat:e.y*90}}},aitoff:{project:function(e){var t=pv.radians(e.lng),n=pv.radians(e.lat),r=Math.acos(Math.cos(n)*Math.cos(t/2));return{x:2*(r?Math.cos(n)*Math.sin(t/2)*r/Math.sin(r):0)/Math.PI,y:2*(r?Math.sin(n)*r/Math.sin(r):0)/Math.PI}},invert:function(e){var t=e.x*Math.PI/2,n=e.y*Math.PI/2;return{lng:pv.degrees(t/Math.cos(n)),lat:pv.degrees(n)}}},hammer:{project:function(e){var t=pv.radians(e.lng),n=pv.radians(e.lat),r=Math.sqrt(1+Math.cos(n)*Math.cos(t/2));return{x:2*Math.SQRT2*Math.cos(n)*Math.sin(t/2)/r/3,y:Math.SQRT2*Math.sin(n)/r/1.5}},invert:function(e){var t=e.x*3,n=e.y*1.5,r=Math.sqrt(1-t*t/16-n*n/4);return{lng:pv.degrees(2*Math.atan2(r*t,2*(2*r*r-1))),lat:pv.degrees(Math.asin(r*n))}}},identity:{project:function(e){return{x:e.lng/180,y:e.lat/90}},invert:function(e){return{lng:e.x*180,lat:e.y*90}}}},pv.Geo.scale=function(e){function l(e){if(!a||e.lng!=a.lng||e.lat!=a.lat){a=e;var t=c(e);f={x:s(t.x),y:o(t.y)}}return f}function c(e){var t={lng:e.lng-u.lng,lat:e.lat};return i.project(t)}function h(e){var t=i.invert(e);return t.lng+=u.lng,t}var t={x:0,y:0},n={x:1,y:1},r=[],i=pv.Geo.projections.identity,s=pv.Scale.linear(-1,1).range(0,1),o=pv.Scale.linear(-1,1).range(1,0),u={lng:0,lat:0},a,f;return l.x=function(e){return l(e).x},l.y=function(e){return l(e).y},l.ticks={lng:function(e){var t,n;if(r.length>1){var i=pv.Scale.linear();e==undefined&&(e=10),t=i.domain(r,function(e){return e.lat}).ticks(e),n=i.domain(r,function(e){return e.lng}).ticks(e)}else t=pv.range(-80,81,10),n=pv.range(-180,181,10);return n.map(function(e){return t.map(function(t){return{lat:t,lng:e}})})},lat:function(e){return pv.transpose(l.ticks.lng(e))}},l.invert=function(e){return h({x:s.invert(e.x),y:o.invert(e.y)})},l.domain=function(e,t){if(arguments.length){r=e instanceof Array?arguments.length>1?pv.map(e,t):e:Array.prototype.slice.call(arguments);if(r.length>1){var n=r.map(function(e){return e.lng}),i=r.map(function(e){return e.lat});u={lng:(pv.max(n)+pv.min(n))/2,lat:(pv.max(i)+pv.min(i))/2};var f=r.map(c);s.domain(f,function(e){return e.x}),o.domain(f,function(e){return e.y})}else u={lng:0,lat:0},s.domain(-1,1),o.domain(-1,1);return a=null,this}return r},l.range=function(e,r){return arguments.length?(typeof e=="object"?(t={x:Number(e.x),y:Number(e.y)},n={x:Number(r.x),y:Number(r.y)}):(t={x:0,y:0},n={x:Number(e),y:Number(r)}),s.range(t.x,n.x),o.range(n.y,t.y),a=null,this):[t,n]},l.projection=function(e){return arguments.length?(i=typeof e=="string"?pv.Geo.projections[e]||pv.Geo.projections.identity:e,this.domain(r)):e},l.by=function(e){function t(){return l(e.apply(this,arguments))}for(var n in l)t[n]=l[n];return t},arguments.length&&l.projection(e),l},pv}),pen.define("cdf/lib/CCC/jquery.tipsy",["cdf/jquery"],function(e){(function(e){function t(e){var t=e.attr("title");(t||typeof e.attr("original-title")!="string")&&e.attr("original-title",t||"").removeAttr("title")}function n(n,r){this.$element=e(n),this.options=r,this.enabled=!0,t(this.$element)}n.prototype={enter:function(){var e=this,t=this.options;e.hoverState="in",t.delayIn==0?e.show():setTimeout(function(){e.hoverState==="in"&&(e.hoverState=null,e.show())},t.delayIn)},leave:function(){var e=this,t=this.options;e.hoverState="out",t.delayOut==0?e.hide():setTimeout(function(){e.hoverState==="out"&&e.hide()},t.delayOut)},visible:function(){var e;return this.hoverState==="in"||this.hoverState!=="out"&&!!this.$tip&&!!(e=this.$tip[0].parentNode)&&e.nodeType!==11},update:function(){this.visible()?this.show(!0):this.enter()},show:function(t){function h(e){var t;switch(e.charAt(0)){case"n":t={top:s.top+s.height+u,left:s.left+s.width/2-l/2};break;case"s":t={top:s.top-c-u,left:s.left+s.width/2-l/2};break;case"e":t={top:s.top+s.height/2-c/2,left:s.left-l-u};break;case"w":t={top:s.top+s.height/2-c/2,left:s.left+s.width+u}}return e.length===2&&(e.charAt(1)=="w"?t.left=a?s.left+s.width+u:s.left+s.width/2-15:t.left=a?s.left-l-u:s.left+s.width/2-l+15),t}if(this.hoverState==="in")return;var n=this.getTitle();if(!this.enabled||!n){this.hoverState=null,this.hide();return}var r=this.tip();r.find(".tipsy-inner")[this.options.html?"html":"text"](n),r[0].className="tipsy",t||r.remove();var i=r[0].parentNode;(!i||i.nodeType===11)&&r.css({top:0,left:0,visibility:"hidden",display:"block"}).appendTo(document.body);var s=e.extend({},this.$element.offset());if(this.$element[0].nearestViewportElement){var o=this.$element[0].getBoundingClientRect();s.width=o.width,s.height=o.height}else s.width=this.$element[0].offsetWidth||0,s.height=this.$element[0].offsetHeight||0;var u=this.options.offset,a=this.options.corners,f=this.options.arrow,l=r[0].offsetWidth,c=r[0].offsetHeight;f||(u-=4);var p=typeof this.options.gravity=="function"?this.options.gravity.call(this.$element[0],{width:l,height:c},h):this.options.gravity,d=h(p);r.css(d).addClass("tipsy-"+p+(a&&p.length>1?p.charAt(1):""));if(f){var v=a&&p.length===2;r.find(".tipsy-arrow")[v?"hide":"show"]()}var m=this.options.fade&&(!t||!this._prevGravity||this._prevGravity!==p);m?r.stop().css({opacity:0,display:"block",visibility:"visible"}).animate({opacity:this.options.opacity}):r.css({visibility:"visible",opacity:this.options.opacity}),this._prevGravity=p,this.hoverState=null},hide:function(){this.options.fade?this.tip().stop().fadeOut(function(){e(this).remove()}):this.$tip&&this.tip().remove(),this.hoverState=null},setTitle:function(e){e=e==null?"":""+e,this.$element.attr("original-title",e).removeAttr("title")},getTitle:function(){var e,n=this.$element,r=this.options;return t(n),typeof r.title=="string"?e=n.attr(r.title=="title"?"original-title":r.title):typeof r.title=="function"&&(e=r.title.call(n[0])),e=(""+e).replace(/(^\s*|\s*$)/,""),e||r.fallback},tip:function(){return this.$tip||(this.$tip=e('<div class="tipsy"></div>'),this.options.arrow?this.$tip.html('<div class="tipsy-arrow"></div><div class="tipsy-inner"/></div>'):this.$tip.html('<div class="tipsy-inner"/></div>'),this.$tip.remove()),this.$tip},validate:function(){var e=this.$element[0].parentNode;if(!e||e.nodeType===11)this.hide(),this.$element=null,this.options=null},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled}},e.fn.tipsy=function(t,r){function i(r){var i=e.data(r,"tipsy");return i||(i=new n(r,e.fn.tipsy.elementOptions(r,t)),e.data(r,"tipsy",i)),i}function s(){i(this).enter()}function o(){i(this).leave()}if(t===!0)return this.data("tipsy");if(typeof t=="string")return this.data("tipsy")[t](r);t=e.extend({},e.fn.tipsy.defaults,t),t.arrow==null&&(t.arrow=!t.corners),t.live||this.each(function(){i(this)});if(t.trigger!="manual"){var u=t.live?"live":"bind",a=t.trigger=="hover"?"mouseenter":"focus",f=t.trigger=="hover"?"mouseleave":"blur";this[u](a,s)[u](f,o)}return this},e.fn.tipsy.defaults={delayIn:0,delayOut:0,fade:!1,fallback:"",gravity:"n",html:!1,live:!1,offset:0,opacity:.8,title:"title",trigger:"hover",corners:!1,arrow:null},e.fn.tipsy.elementOptions=function(t,n){return e.metadata?e.extend({},n,e(t).metadata()):n},e.fn.tipsy.autoNS=function(){return e(this).offset().top>e(document).scrollTop()+e(window).height()/2?"s":"n"},e.fn.tipsy.autoWE=function(){return e(this).offset().left>e(document).scrollLeft()+e(window).width()/2?"e":"w"}})(jQuery)}),pen.define("cdf/lib/CCC/jquery.tipsy",[],function(){}),pen.define("cdf/lib/CCC/tipsy",["cdf/lib/CCC/protovis"],function(e){(function(){function r(t){return e.Transform.identity.translate(t.left(),t.top()).times(t.transform())}function i(e){var t=e.instance(),n=t.left,i=t.top,s=t.width,o=t.height,u,a,f;while(f=e.parent){n<0&&(s+=n,n=0),i<0&&(o+=i,i=0),u=t.right,u<0&&(s+=u),a=t.bottom,a<0&&(o+=a);var l=r(f),c=l.k;n=l.x+c*n,i=l.y+c*i,s=c*s,o=c*o,e=f,t=e.instance()}return{left:n,top:i,width:s,height:o}}var t=0;e.Behavior.tipsy=function(r){function g(e,t){t||(t=e.instance());var n=t&&t.tooltip||!e.properties.tooltip&&typeof e.tooltip=="function"&&e.tooltip()||t.title||t.text;return typeof n=="function"&&(n=n()),n||""}function y(e){var t,n,r,s;if(e.properties.width){var o=i(e);t=o.left,n=o.top,r=o.width,s=o.height}else{var u=e.toScreenTransform(),a=e.instance(),f;if(e.properties.outerRadius){var l=a.startAngle+a.angle/2;f=a.outerRadius,t=u.x+a.left+f*Math.cos(l),n=u.y+a.top+f*Math.sin(l)}else if(e.properties.shapeRadius){f=Math.max(2,a.shapeRadius);var c=a.left,h=a.top;switch(a.shape){case"diamond":f*=Math.SQRT2;break;case"circle":f/=Math.SQRT2}t=(c-f)*u.k+u.x,n=(h-f)*u.k+u.y,s=r=2*f*u.k}else t=a.left*u.k+u.x,n=a.top*u.k+u.y}var p=Math.ceil(t),d=Math.ceil(n),v=p-t,m=d-n;return r=Math.max(1,Math.floor((r||0)-v)),s=Math.max(1,Math.floor((s||0)-m)),{left:p,top:d,width:r,height:s}}function w(t,i){function d(e){var t=i(e);return v(e,t)}function v(e,t){var n=m(t.left,"width"),r=m(t.top,"height"),i=n.fits&&r.fits;return{gravity:e,width:n,height:r,value:n.value+r.value+(2-e.length),isTotal:i,isPartial:!i&&(n.fits||r.fits)}}function m(e,n){var r=$(window)[n](),i=t[n],s=e-u[n==="width"?0:1],o=r-(s+i),a=s>=0&&o>=0,f=(s>=0?s:4*s)+(o>=0?o:4*o);return{fits:a,value:f}}this===o[0]||def.assert();var u=e.scrollOffset(this),a=r.userGravity;typeof a=="function"&&(a=a.call(this)||$.fn.tipsy.defaults.gravity),a==="c"&&(a="w");var f=d(a);if(!f.isTotal){var l=b.indexOf(a);for(var c=1,h=b.length;c<h;c++){var p=(l+c)%h;f=E(f,d(b[p]))}n.debug>=6&&a!==f.gravity&&n.log("[TIPSY] #"+s+" Choosing gravity '"+f.gravity+"' over '"+a+"'"),a=f.gravity}return n.debug>=6&&n.log("[TIPSY] #"+s+" Gravity '"+a+"'"),a}function E(e,t){if(e.isTotal){if(!t.isTotal)return e}else if(t.isTotal){if(!e.isTotal)return t}else if(e.isPartial){if(!t.isPartial)return e}else if(t.isPartial&&!e.isPartial)return t;return t.value>e.value?t:e}function S(e){o.css({left:e.left,top:e.top,width:e.width,height:e.height})}function x(e){var t=e.root.canvas();d=$(t),t.style.position="relative",d.mouseleave(O),T(),h||(h="tipsyPvBehavior_"+(new Date).getTime());var n=document.getElementById(h);n||(n=document.createElement("div"),n.id=h,t.appendChild(n));var i=n.style;i.padding="0px",i.margin="0px",i.position="absolute",i.pointerEvents="none",i.display="block",i.zIndex=-10,o=$(n),N(),o.data("tipsy",null),o.tipsy(r)}function T(){m=d.data("tipsy-pv-shared-info");if(m){var e=d[0].$pvCreateId||0;if(m.createId===e){m.behaviors.push(M);return}m.behaviors.forEach(function(e){e()})}m={createId:d[0].$pvCreateId||0,behaviors:[M]},d.data("tipsy-pv-shared-info",m)}function N(){o&&(n.debug>=5?o.css({borderColor:"red",borderWidth:"1px",borderStyle:"solid"}):o.css({borderWidth:"0px"}))}function C(t){t||(t=e.event);var n=5,r=d.offset();return{left:t.pageX-r.left-n,top:t.pageY-r.top-n,width:10+2*n,height:20}}function k(e){if(!u&&e||u&&u[0]!==e)n.debug>=4&&n.log("[TIPSY] #"+s+" Changing target element."),u&&(u.unbind("mousemove",P),p||u.unbind("mouseleave",O)),u=e?$(e):null,f=l=null,u&&(u.mousemove(P),p||u.mouseleave(O))}function L(){return a++}function A(e){return e===a-1}function O(){var e=L();n.debug>=4&&n.log("[TIPSY] #"+s+" Delayed Hide Begin opId="+e);if(c>0){setTimeout(function(){A(e)?(n.debug>=4&&n.log("[TIPSY] #"+s+" Hiding opId="+e+" nextOperationId="+a),_(e)):n.debug>=4&&n.log("[TIPSY] #"+s+" Delayed Hide Cancelled opId="+e)},c);return}n.debug>=4&&n.log("[TIPSY] #"+s+" Hiding Immediately opId="+e),_(e)}function M(){var e=L();n.debug>=4&&n.log("[TIPSY] #"+s+" Hiding as Other opId="+e),_(e)}function _(e){k(null),o&&o.tipsy("leave")}function D(){var e=m&&m.behaviors;e&&e.length>1&&e.forEach(function(e){e!==M&&e()})}function P(e){if(!o)return;if(f!=null&&f===e.clientX&&l===e.clientY)return;var t=this.$scene,i,u;if(!t||!(u=t.scenes)||!(i=u.mark))return;var a=L();n.debug>=4&&n.log("[TIPSY] #"+s+" Updating opId="+a),f=e.clientX,l=e.clientY;var c;o.tipsy("visible")?r.followMouse?c=C(e):i.context(u,t.index,function(){c=y(i)}):i.context(u,t.index,function(){var t=g(i);n.debug>=4&&n.log("[TIPSY] #"+s+" Update text. Was hidden. Text: "+t),o.tipsy("setTitle",t),c=r.followMouse?C(e):y(i)}),S(c),D(),o.tipsy("update")}function H(e){n.debug>=4&&n.log("[TIPSY] #"+s+" Creating"),x(e),p&&e.event("unpoint",O)}function B(t){var i=L();n.debug>=4&&n.log("[TIPSY] #"+s+" Show IN opId="+i),d||H(t);var a=!u;k(e.event.target);var f=g(t);n.debug>=4&&n.log("[TIPSY] #"+s+" Text: "+f),o.tipsy("setTitle",f),S(r.followMouse?C():y(t)),D(),a?o.tipsy("enter"):o.tipsy("update"),n.debug>=4&&n.log("[TIPSY] #"+s+" Show OUT")}function j(){var e=this;(!v||v(j,e))&&B(e)}var s=t++;r?r=Object.create(r):r={},r.trigger="manual",r.userGravity=r.gravity||$.fn.tipsy.defaults.gravity,r.gravity=w;var o,u,a=0,f,l,c=r.delayOut,h,p=r.usesPoint,d,v=r.isEnabled,m;r.delayOut=0;var b=["nw","n","ne","e","se","s","sw","w"];return j};var n=e.Behavior.tipsy;n.debug=0,n.setDebug=function(e){n.debug=e},n.log=function(e){typeof console!="undefined"&&console.log(""+e)}})()}),pen.define("cdf/lib/CCC/tipsy",[],function(){}),pen.define("cdf/lib/CCC/protovis-msie",["cdf/lib/CCC/protovis"],function(e){e.have_SVG=!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect,e.have_VML=function(e,t,n){return t=e.createElement("div"),t.innerHTML='<pvml:shape adj="1" />',n=t.firstChild,n.style.behavior="url(#default#VML)",n?typeof n.adj=="object":!0}(document),Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){var n=this.length>>>0,r=!isFinite(t)||t<0?0:t>this.length?this.length:t;for(;r<n;r++)if(this[r]===e)return r;return-1}),!e.have_SVG&&e.have_VML&&function(){typeof Date.now!="function"&&(Date.now=function(){return new Date*1});var t={is64Bit:window.navigator.cpuClass==="x64",round:function(e){return Math.round((e||0)*21.6)},styles:null,pre:"<pvml:",post:' class="msvml">',block:{group:1,shape:1,shapetype:1,line:1,polyline:1,curve:1,rect:1,roundrect:1,oval:1,arc:1,image:1},caps:{butt:"flat",round:"round",square:"square"},joins:{bevel:"bevel",round:"round",miter:"miter"},cursorstyles:{hand:"pointer",crosshair:1,pointer:1,move:1,text:1,wait:1,help:1,progress:1,"n-resize":1,"ne-resize":1,"nw-resize":1,"s-resize":1,"se-resize":1,"sw-resize":1,"e-resize":1,"w-resize":1},text_shim:null,_textcache:{},text_dims:function(e,n){var r=t.text_shim||(t.init(),t.text_shim);n=t.processFont(n);var i=t._textcache[n]||(t._textcache[n]={}),s=i[e];return s||(r.style.font=n,r.innerText=e,i[e]=s={fontsize:parseInt(r.style.fontSize,10),height:r.offsetHeight,width:r.offsetWidth}),s},_fontCache:{},_fontSubst:{"default":"Arial","sans-serif":"Arial",sansserif:"Arial",sans:"Arial",serif:"Times New Roman",dialog:"Arial",monospaced:"Courier New",dialoginput:"Courier New"},_fontWhiteListIE64Bit:{"agency fb":1,aharoni:1,algerian:1,andalus:1,"angsana new":1,angsanaupc:1,aparajita:1,"arabic typesetting":1,arial:1,"arial black":1,"arial narrow":1,"arial rounded mt bold":1,"arial unicode ms":1,"baskerville old face":1,batang:1,batangche:1,"bauhaus 93":1,"bell mt":1,"berlin sans fb":1,"berlin sans fb demi":1,"bernard mt condensed":1,"blackadder itc":1,"bodoni mt":1,"bodoni mt black":1,"bodoni mt condensed":1,"bodoni mt poster compressed":1,"book antiqua":1,"bookman old style":1,"bookshelf symbol 7":1,"bradley hand itc":1,"britannic bold":1,broadway:1,"browallia new":1,browalliaupc:1,"brush script mt":1,calibri:1,"californian fb":1,"calisto mt":1,cambria:1,"cambria math":1,candara:1,castellar:1,centaur:1,century:1,"century gothic":1,"century schoolbook":1,chiller:1,"colonna mt":1,"comic sans ms":1,consolas:1,constantia:1,"cooper black":1,"copperplate gothic bold":1,"copperplate gothic light":1,corbel:1,"cordia new":1,cordiaupc:1,"courier new":1,"curlz mt":1,daunpenh:1,david:1,"dfkai-sb":1,dilleniaupc:1,dokchampa:1,dotum:1,dotumche:1,ebrima:1,"edwardian script itc":1,elephant:1,"engravers mt":1,"eras bold itc":1,"eras demi itc":1,"eras light itc":1,"eras medium itc":1,"estrangelo edessa":1,eucrosiaupc:1,euphemia:1,fangsong:1,"felix titling":1,"footlight mt light":1,forte:1,"franklin gothic book":1,"franklin gothic demi":1,"franklin gothic demi cond":1,"franklin gothic heavy":1,"franklin gothic medium":1,"franklin gothic medium cond":1,frankruehl:1,freesiaupc:1,"freestyle script":1,"french script mt":1,gabriola:1,garamond:1,gautami:1,georgia:1,gigi:1,"gill sans mt":1,"gill sans mt condensed":1,"gill sans mt ext condensed bold":1,"gill sans ultra bold":1,"gill sans ultra bold condensed":1,gisha:1,"gloucester mt extra condensed":1,"goudy old style":1,"goudy stout":1,gulim:1,gulimche:1,gungsuh:1,gungsuhche:1,"guttman adii":1,"guttman adii-light":1,"guttman aharoni":1,"guttman calligraphic":1,"guttman david":1,"guttman drogolin":1,"guttman frank":1,"guttman frnew":1,"guttman haim":1,"guttman haim-condensed":1,"guttman hatzvi":1,"guttman hodes":1,"guttman kav":1,"guttman kav-light":1,"guttman keren":1,"guttman logo1":1,"guttman mantova":1,"guttman mantova-decor":1,"guttman miryam":1,"guttman myamfix":1,"guttman rashi":1,"guttman stam":1,"guttman stam1":1,"guttman vilna":1,"guttman yad":1,"guttman yad-brush":1,"guttman yad-light":1,"guttman-aharoni":1,"guttman-aram":1,"guttman-courmir":1,"guttman-soncino":1,"guttman-toledo":1,haettenschweiler:1,"harlow solid italic":1,harrington:1,"high tower text":1,impact:1,"imprint mt shadow":1,"informal roman":1,irisupc:1,"iskoola pota":1,jasmineupc:1,jokerman:1,"juice itc":1,kaiti:1,kalinga:1,kartika:1,"khmer ui":1,kodchiangupc:1,kokila:1,"kristen itc":1,"kunstler script":1,"lao ui":1,latha:1,leelawadee:1,"levenim mt":1,lilyupc:1,"lucida bright":1,"lucida calligraphy":1,"lucida console":1,"lucida fax":1,"lucida handwriting":1,"lucida sans":1,"lucida sans typewriter":1,"lucida sans unicode":1,magneto:1,"maiandra gd":1,"malgun gothic":1,mangal:1,marlett:1,"matura mt script capitals":1,meiryo:1,"meiryo ui":1,"microsoft himalaya":1,"microsoft jhenghei":1,"microsoft new tai lue":1,"microsoft phagspa":1,"microsoft sans serif":1,"microsoft tai le":1,"microsoft uighur":1,"microsoft yahei":1,"microsoft yi baiti":1,mingliu:1,"mingliu-extb":1,mingliu_hkscs:1,"mingliu_hkscs-extb":1,miriam:1,"miriam fixed":1,mistral:1,"modern no. 20":1,"mongolian baiti":1,"monotype corsiva":1,"monotype hadassah":1,moolboran:1,"ms gothic":1,"ms mincho":1,"ms outlook":1,"ms pgothic":1,"ms pmincho":1,"ms reference sans serif":1,"ms reference specialty":1,"ms ui gothic":1,"mt extra":1,"mv boli":1,narkisim:1,"niagara engraved":1,"niagara solid":1,nsimsun:1,nyala:1,"ocr a extended":1,"old english text mt":1,onyx:1,"palace script mt":1,"palatino linotype":1,papyrus:1,parchment:1,perpetua:1,"perpetua titling mt":1,"plantagenet cherokee":1,playbill:1,pmingliu:1,"pmingliu-extb":1,"poor richard":1,pristina:1,raavi:1,"rage italic":1,ravie:1,rockwell:1,"rockwell condensed":1,"rockwell extra bold":1,rod:1,"sakkal majalla":1,"script mt bold":1,"segoe print":1,"segoe script":1,"segoe ui":1,"segoe ui light":1,"segoe ui semibold":1,"segoe ui symbol":1,"shonar bangla":1,"showcard gothic":1,shruti:1,simhei:1,"simplified arabic":1,"simplified arabic fixed":1,simsun:1,"simsun-extb":1,"snap itc":1,stencil:1,sylfaen:1,symbol:1,tahoma:1,"tempus sans itc":1,"times new roman":1,"toptype soncino":1,"traditional arabic":1,"trebuchet ms":1,tunga:1,"tw cen mt":1,"tw cen mt condensed":1,"tw cen mt condensed extra bold":1,utsaah:1,vani:1,verdana:1,vijaya:1,"viner hand itc":1,vivaldi:1,"vladimir script":1,vrinda:1,webdings:1,"wide latin":1,wingdings:1,"wingdings 2":1,"wingdings 3":1},_defaultFontIE64Bit:"Arial",processFont:function(e){var n=t._fontCache[e];if(!n){var r=t.text_shim||(t.init(),t.text_shim),i=r.style;i.font=e;var s=i.fontFamily;s.charAt(0)==='"'&&(s=s.substr(1,s.length-1));var o=s.toLowerCase(),u=t._fontSubst[o];u?s=u:t.is64Bit&&!t._fontWhiteListIE64Bit[o]&&(s=t._defaultFontIE64Bit),i.fontFamily='"'+s+'"',t._fontCache[e]=n=i.font}return n},d2r:Math.PI*2/360,get_dim:function(e,t){var n=t||{};n.translate_x=0,n.translate_y=0;if(e.transform){var r=/translate\((-?\d+(?:\.\d+)?(?:e-?\d+)?)(?:,(-?\d+(?:\.\d+)?(?:e-?\d+)?))?\)/.exec(e.transform);r&&r[1]&&(n.translate_x=parseFloat(r[1])),r&&r[2]&&(n.translate_y=parseFloat(r[2]));var i=/rotate\((\d+\.\d+|\d+)\)/.exec(e.transform);i&&(n.rotation=parseFloat(i[1])%360)}return n.x=parseFloat(e.x||0),n.y=parseFloat(e.y||0),"width"in e&&(n.width=parseFloat(e.width)),"height"in e&&(n.height=parseFloat(e.height)),n},solidFillStyle:{type:"solid"},elm_defaults:{g:{rewrite:"span",attr:function(e,n,r,i,s){var o=t.get_dim(e);r.style.cssText="position:absolute;zoom:1;left:"+(o.translate_x+o.x)+"px;top:"+(o.translate_y+o.y)+"px;"}},line:{rewrite:"shape",attr:function(e,n,r,i,s){var o=parseFloat(e.x1||0),u=parseFloat(e.y1||0),a=parseFloat(e.x2||0),f=parseFloat(e.y2||0),l=t.round;r.coordorigin="0,0",r.coordsize="21600,21600",t.path(r).v="M "+l(o)+" "+l(u)+" L "+l(a)+" "+l(f)+" E",t.stroke(r,e,i,s)},css:"top:0px;left:0px;width:1000px;height:1000px"},rect:{rewrite:"shape",attr:function(e,n,r,i,s){var o=t.get_dim(e),u=t.path(r),a=t.round;r.coordorigin="0,0",r.coordsize="21600,21600";var f=a(o.translate_x+o.x),l=a(o.translate_y+o.y),c=a(o.width),h=a(o.height);u.v="M "+f+" "+l+" L "+(f+c)+" "+l+" L "+(f+c)+" "+(l+h)+" L "+f+" "+(l+h)+" x",t.stroke(r,e,i,s),t.fill(r,e,i,s)},css:"top:0px;left:0px;width:1000px;height:1000px"},path:{rewrite:"shape",attr:function(e,n,r,i,s){var o=t.get_dim(e),u=r.style;u.left=o.translate_x+o.x+"px",u.top=o.translate_y+o.y+"px",r.coordorigin="0,0",r.coordsize="21600,21600",t.path(r,e.d),t.fill(r,e,i,s),t.stroke(r,e,i,s)},css:"top:0px;left:0px;width:1000px;height:1000px"},circle:{rewrite:"oval",attr:function(e,n,r,i,s){var o=t.get_dim(e),u=r.style,a=parseFloat(e.cx||0)+.7,f=parseFloat(e.cy||0)+.7,l=parseFloat(e.r||0)+.5;u.top=o.translate_y+f-l+"px",u.left=o.translate_x+a-l+"px",u.width=l*2+"px",u.height=l*2+"px",t.fill(r,e,i,s),t.stroke(r,e,i,s)}},text:{rewrite:"shape",attr:function(e,n,r,i,s){var o=t.get_dim(e),u=r.style;r.stroked="False",r.path="m0,0 l1,0 e";var a=t.textpath(r);a.string=e.string;var f=a.style;f["v-text-align"]=e.textAlign,f.font=e.font,e.textDecoration&&(f.textDecoration=e.textDecoration),t.path(r).textpathok="True";var l=e.rotation;if(l){l=180*l/Math.PI,l=-(~~l%360)*t.d2r;if(l){var c=Math.cos(l).toFixed(8),h=Math.sin(l).toFixed(8),p=t.skew(r);p.on="true",p.matrix=c+","+h+","+ -h+","+c+",0,0"}}var d=i[s];d.fillStyle=t.solidFillStyle,t.fill(r,e,i,s),d.fillStyle=null},css:"position:absolute;top:0px;left:0px;width:1px;height:1px;"},svg:{rewrite:"span",css:"position:relative;overflow:hidden;display:inline-block;~display:block;"},"vml:path":{rewrite:"path"},"vml:stroke":{rewrite:"stroke"},"vml:fill":{rewrite:"fill"},"vml:textpath":{rewrite:"textpath"},"vml:skew":{rewrite:"skew"}},_elmcache:{span:document.createElement("span"),div:document.createElement("div")},createElement:function(e,n){var r,i=t._elmcache,s=t.elm_defaults[e]||{},o=s.rewrite||e;return o in i?r=i[o].cloneNode(!1):(i[o]=document.createElement(t.pre+o+t.post),o in t.block&&(i[o].className+=" msvml_block"),r=i[o].cloneNode(!1)),s.css&&(r.style.cssText=s.css),r},_hex:e.range(0,256).map(function(t){return e.Format.pad("0",2,t.toString(16))}),_colorcache:{},color:function(e){var n=t._colorcache[e],r;return!n&&(r=/^rgb\((\d+),(\d+),(\d+)\)$/i.exec(e))&&(t._colorcache[e]=n="#"+t._hex[r[1]]+t._hex[r[2]]+t._hex[r[3]]),n||e},fill:function(n,r,i,s){var o=n.getElementsByTagName("fill")[0];o||(o=n.appendChild(t.createElement("vml:fill")));var u=i[s].fillStyle;if(!r.fill||!u||u.type==="solid"&&r.fill==="none")o.on="false";else{o.on="true";if(u.type==="solid")o.type="solid",o.color=t.color(r.fill);else{var a=u.type==="lineargradient";o.method="none";var f=u.stops,l=f.length;if(l>0){var c=[];for(var s=0;s<l;s++){var h=f[s];c.push(h.offset+"% "+t.color(h.color.color))}o.color=t.color(f[0].color.color),o.color2=t.color(f[l-1].color.color),o.colors=c.join(",")}if(a){o.type="gradient";var p=-e.degrees(u.angle)%360;o.angle=p<0?p+360:p}else o.type="gradientTitle",o.focus="100%",o.focussize="0 0",o.focusposition="0 0",o.angle=0}o.opacity=Math.min(parseFloat(r["fill-opacity"]||"1"),1)||"1"}},stroke:function(e,n,r,i){var s=e.getElementsByTagName("stroke")[0];s||(s=e.appendChild(t.createElement("vml:stroke")));if(!n.stroke||n.stroke==="none")s.on="false",s.weight=0;else{var o=n["stroke-width"];o==null||o===""?o=1:o=+o,o<1e-10?o=0:o<1&&(o=1);if(!o)s.on="false",s.weight=0;else{s.on="true",s.weight=o,s.color=t.color(n.stroke)||"black",s.opacity=Math.min(parseFloat(n["stroke-opacity"]||"1"),1)||"1",s.joinstyle=t.joins[n["stroke-linejoin"]]||"miter",s.miterlimit=n["stroke-miterlimit"]||8,s.endcap=t.caps[n["stroke-linecap"]]||"flat";var u=n["stroke-dasharray"];if(!u||u==="none")u="Solid";s.dashstyle=u}}},path:function(e,n){var r=e.getElementsByTagName("path")[0];return r||(r=e.appendChild(t.createElement("vml:path"))),arguments.length>1&&(r.v=t.rewritePath(n)),r},skew:function(e){var n=e.getElementsByTagName("skew")[0];return n||(n=e.appendChild(t.createElement("vml:skew"))),n.on="false",n},textpath:function(e){var n=e.getElementsByTagName("textpath")[0];return n||(n=e.appendChild(t.createElement("vml:textpath"))),n.style["v-text-align"]="center",n.style["v-text-kern"]="true",n.on="true",n},init:function(){t.text_shim||(t.text_shim=document.getElementById("pv_vml_text_shim")||document.createElement("span"),t.text_shim.id="protovisvml_text_shim",t.text_shim.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline-block;white-space:nowrap;",document.body.appendChild(t.text_shim));if(!t.styles){t.styles=document.getElementById("protovisvml_styles")||document.createElement("style"),t.styles.id="protovisvml_styles",document.documentElement.firstChild.appendChild(t.styles),t.styles.styleSheet.addRule(".msvml","behavior:url(#default#VML);"),t.styles.styleSheet.addRule(".msvml_block","position:absolute;top:0;left:0;");try{document.namespaces.pvml||document.namespaces.add("pvml","urn:schemas-microsoft-com:vml")}catch(e){t.pre="<",t.post=' class="msvml" xmlns="urn:schemas-microsoft.com:vml">'}}},_pathcache:{},rewritePath:function(e,n){var r=0,i=0,s=t.round;if(!e)return e;if(e in t._pathcache)return t._pathcache[e];e=e.replace(/(\d*)((\.*\d*)(e ?-?\d*))/g,"$1");var o=e.match(/([MLHVCSQTAZ ][^MLHVCSQTAZ ]*)/gi),u=[],a=[],f="";for(var l=0,c=o.length;l<c;l++){var h=o[l],p=h.charAt(0),d=h.substring(1).split(/[,]/);p==" "&&(p=f),f=p;switch(p){case"M":p="m",r=s(d[0]),i=s(d[1]),d=[r,i];break;case"m":p="m",r+=s(d[0]),i+=s(d[1]),d=[r,i];break;case"A":p="l",d=[r=s(d[5]),i=s(d[6])];break;case"L":p="l",d=[r=s(d[0]),i=s(d[1])];break;case"l":p="l",d=[r+=s(d[0]),i+=s(d[1])];break;case"H":p="l",d=[r=s(d[0]),i];break;case"h":p="l",d=[r+=s(d[0]),i];break;case"V":p="l",d=[r,i=s(d[0])];break;case"v":p="l",d=[r,i+=s(d[0])];break;case"C":p="c",a=d=[s(d[0]),s(d[1]),s(d[2]),s(d[3]),r=s(d[4]),i=s(d[5])];break;case"c":p="c",a=d=[r+s(d[0]),i+s(d[1]),r+s(d[2]),i+s(d[3]),r+=s(d[4]),i+=s(d[5])];break;case"S":p="c",a=d=[a[4]+(a[4]-a[2]),a[5]+(a[5]-a[3]),s(d[0]),s(d[1]),r=s(d[2]),i=s(d[3])];break;case"s":p="c",a=d=[a[4]+(a[4]-a[2]),a[5]+(a[5]-a[3]),r+s(d[0]),i+s(d[1]),r+=s(d[2]),i+=s(d[3])];break;case"Q":p="c";var v=s(d[0]),m=s(d[1]),g=s(d[2]),y=s(d[3]);d=[~~(r+(v-r)*2/3),~~(i+(m-i)*2/3),~~(v+(g-v)/3),~~(m+(y-m)/3),r=g,i=y];break;case"q":p="l",r+=s(d[2]),i+=s(d[3]),d=[r,i];break;case"Z":case"z":p="xe",d=[];break;default:p="",d=[]}u.push(p,d.join(","))}return t._pathcache[e]=u.join("")+"e"}};e.Vml=t,e.VmlScene={scale:1,events:["mousewheel","mousedown","mouseup","mouseover","mouseout","mousemove","click","dblclick"],implicit:{css:{}},copy_functions:function(t){for(var n in t)typeof t[n]=="function"&&!(n in e.VmlScene)&&(e.VmlScene[n]=t[n])}},e.VmlScene.copy_functions(e.SvgScene),e.Scene=e.VmlScene,e.renderer=function(){return"vml"},function(t){e.VmlScene.minRuleLineWidth=t?1.2:1.1,e.VmlScene.minBarWidth=t?2.2:1.8,e.VmlScene.minBarHeight=t?2.2:1.8,e.VmlScene.minBarLineWidth=t?1.2:1}(t.is64Bit),e.VmlScene.expect=function(e,n,r,i,s,o){o=o||{};var u=t.elm_defaults[n]||{},a=u.rewrite||n;if(e){if(e.tagName.toUpperCase()!==a.toUpperCase()){var f=t.createElement(n);e.parentNode.replaceChild(f,e),e=f}}else e=t.createElement(n);"attr"in u&&u.attr(s,o,e,r,i);if(s.cursor in t.cursorstyles){var l=t.cursorstyles[s.cursor];o.cursor=l===1?s.cursor:l}return o&&this.setStyle(e,o),e},e.VmlScene.removeSiblings=function(e){while(e){var t=e.nextSibling;e.parentNode.removeChild(e),e=t}},e.VmlScene.removeFillStyleDefinitions=function(e){},e.VmlScene.addFillStyleDefinition=function(e,t){},e.VmlScene.setAttributes=function(e,t){},e.VmlScene.setStyle=function(e,t){var n=e.style;for(var r in t){var i=t[r];i==null?n.removeAttribute(r):n[r]=i}},e.VmlScene.append=function(e,t,n){return e.$scene={scenes:t,index:n},e=this.title(e,t[n]),(!e.parentNode||e.parentNode.nodeType===11)&&t.$g.appendChild(e),e.nextSibling},e.VmlScene.title=function(e,t){return e.title=t.title||"",e},e.VmlScene.panel=function(e){var n=e.$g,r=n&&n.firstChild,i=!1;for(var s=0;s<e.length;s++){var o=e[s];if(!o.visible)continue;if(!e.parent){var u=o.canvas;u.style.display="inline-block",u.style.zoom=1,n&&n.parentNode!==u&&(n=u.firstChild,r=n&&n.firstChild);if(!n){i=!0,t.init(),n=u.appendChild(t.createElement("svg")),n.unselectable="on",n.onselectstart=function(){return!1};var a=this.events,f=this.dispatch;for(var l=0,c=a.length;l<c;l++)n.addEventListener?n.addEventListener(a[l],f,!1):n.attachEvent("on"+a[l],f);r=n.firstChild}e.$g=n;var h=o.width+o.left+o.right,p=o.height+o.top+o.bottom;n.style.width=h+"px",n.style.height=p+"px",n.style.clip="rect(0px "+h+"px "+p+"px 0px)"}r=this.fill(r,e,s);var d=this.scale,v=o.transform,m=o.left+v.x,g=o.top+v.y;this.scale*=v.k,this.eachChild(e,s,function(i){i.$g=r=this.expect(r,"g",e,s,{transform:"translate("+m+","+g+")"+(v.k!=1?" scale("+v.k+")":"")}),this.updateAll(i);var o=r.parentNode;if(!o||o.nodeType===11){n.appendChild(r);var u=t.elm_defaults[r.svgtype];u&&typeof u.onappend=="function"&&u.onappend(r,e[s])}r=r.nextSibling}),this.scale=d,r=this.stroke(r,e,s)}return i&&(this.removeSiblings(r),r=n.appendChild(t.createElement("oval"))),r},e.VmlScene.parseDasharray=function(e){var t=e.strokeDasharray;if(t&&t!=="none"){var n=this.translateDashStyleAlias(t);this.isStandardDashStyle(n)?t=n:(t=t.split(/[\s,]+/).map(function(e){return+e/this.scale},this),t.length%2&&(t=t.concat(t)),t=t.join(" "))}else t=null;return t},function(){function s(t){if(t&&t.type){this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=n;if(t.defaultPrevented||t.returnValue===!1||t.getPreventDefault&&t.getPreventDefault())this.isDefaultPrevented=e;this.timeStamp=t.timeStamp||Date.now()}else this.type=t,this.timeStamp=Date.now()}var e=function(){return!0},n=function(){return!1},r=["altKey","attrChange","attrName","bubbles","button","cancelable","charCode","clientX","clientY","ctrlKey","currentTarget","data","detail","eventPhase","fromElement","handler","keyCode","layerX","layerY","metaKey","newValue","offsetX","offsetY","pageX","pageY","prevValue","relatedNode","relatedTarget","screenX","screenY","shiftKey","srcElement","target","toElement","view","wheelDelta","which"],i=r.length;s.prototype={preventDefault:function(){this.isDefaultPrevented=e;var t=this.originalEvent;if(!t)return;t.preventDefault?t.preventDefault():t.returnValue=!1},stopPropagation:function(){this.isPropagationStopped=e;var t=this.originalEvent;if(!t)return;t.stopPropagation&&t.stopPropagation(),t.cancelBubble=!0},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=e,this.stopPropagation()},isDefaultPrevented:n,isPropagationStopped:n,isImmediatePropagationStopped:n};var o=document.compatMode&&document.compatMode!="BackCompat"?"documentElement":"body";t.fixEvent=function(e){var t=e;e=new s(t);var n=e.type,u=n==="keypress";for(var a=i;a;){var f=r[--a];e[f]=t[f]}var l=e.target;l||(l=e.srcElement||document,l.nodeType===3&&(l=l.parentNode),e.target=l);var c;!e.relatedTarget&&(c=e.fromElement)&&(e.relatedTarget=c===l?e.toElement:c);if(!u){var h;if(e.pageX==null&&(h=e.clientX)!=null){var p=document[o];e.pageX=h+(p.scrollLeft||0)-(p.clientLeft||0),e.pageY=e.clientY+(p.scrollTop||0)-(p.clientTop||0)}}if(e.which==null){var d,v,m;u?(d=e.charCode)!=null?e.which=d:(v=e.keyCode)!=null&&(e.which=v):(m=e.button)!==null&&(e.which=m&1?1:m&2?3:m&4?2:0)}return e.metaKey=!!e.metaKey,n==="mousewheel"&&(e.wheel=e.wheelDelta),e}}(),e.listener=function(n,r){return n.$listener||(n.$listener=function(r){try{return e.event=t.fixEvent(r||window.event),n.call(this,e.event)}catch(r){e.error(r)}finally{delete e.event}})},e.listen=function(t,n,r){return r=e.listener(r,t),t===window&&(t=document.documentElement),t.addEventListener?t.addEventListener(n,r,!1):t.attachEvent("on"+n,r),r},e.VmlScene.dispatch=e.listener(function(t){var n=t.target.$scene;n&&e.Mark.dispatch(t.type,n.scenes,n.index,t)&&t.preventDefault()}),e.VmlScene.image=function(e){var t=e.$g.firstChild;for(var n=0;n<e.length;n++){var r=e[n];if(!r.visible)continue;t=this.fill(t,e,n);if(!r.image){t=new Image,t.src=r.url;var i=t.style;i.position="absolute",i.top=r.top,i.left=r.left,i.width=r.width,i.height=r.height,i.cursor=r.cursor,i.msInterpolationMode="bicubic"}t=this.append(t,e,n),t=this.stroke(t,e,n)}return t},e.VmlScene.label=function(e){var n=e.$g.firstChild,r=Math.round;for(var i=0;i<e.length;i++){var s=e[i];if(!s.visible)continue;var o=s.textStyle;if(!o.opacity||!s.text)continue;var u=s.text.replace(/\s+/g," "),a=t.processFont(s.font),f=t.text_dims(u,a),l=0,c=0;switch(s.textBaseline){case"middle":c=.1*f.fontsize;break;case"top":c=s.textMargin+.5*f.fontsize;break;case"bottom":c=-(s.textMargin+.5*f.fontsize)}switch(s.textAlign){case"left":l=s.textMargin;break;case"right":l=-s.textMargin}var h=s.textAngle;if(h){var p=Math.cos(h),d=Math.sin(h),v=l*p-c*d,m=l*d+c*p;l=v,c=m}var g=s.left+l,y=s.top+c,b={};s.cursor&&(b.cursor=s.cursor),b.fill=t.color(o.color)||"black",t.is64Bit&&(b["fill-opacity"]=.7),b.x=g,b.y=y,b.rotation=s.textAngle,b.string=u,b.textAlign=s.textAlign,b.font=a,b.textDecoration=s.textDecoration,n=this.expect(n,"text",e,i,b,{display:"block",lineHeight:1,whiteSpace:"nowrap",zoom:1,position:"absolute",cursor:"default",top:y+"px",left:g+"px"}),n=this.append(n,e,i)}return n},e.VmlScene.wedge=function(e){var n=e.$g.firstChild,r=t.round;for(var i=0;i<e.length;i++){var s=e[i];if(!s.visible)continue;var o=s.fillStyle,u=s.strokeStyle;if(!o.opacity&&!u.opacity)continue;n=this.expect(n,"path",e,i,{"pointer-events":s.events,cursor:s.cursor,transform:"translate("+s.left+","+s.top+")",d:"",fill:o.color,"fill-rule":"evenodd","fill-opacity":o.opacity||null,stroke:u.color,"stroke-opacity":u.opacity||null,"stroke-width":u.opacity?s.lineWidth/this.scale:null,"stroke-linecap":s.lineCap,"stroke-linejoin":s.lineJoin,"stroke-miterlimit":s.strokeMiterLimit,"stroke-dasharray":u.opacity?this.parseDasharray(s):null});var a=n.getElementsByTagName("path")[0];a||(a=t.make("path"),n.appendChild(a));var f=r(s.innerRadius),l=r(s.outerRadius),c;if(s.angle>=2*Math.PI)f?c="AE0,0 "+l+","+l+" 0 23592960"+"AL0,0 "+f+","+f+" 0 23592960":c="AE0,0 "+l+","+l+" 0 23592960";else{var h=Math.round(s.startAngle/Math.PI*11796480),p=Math.round(s.angle/Math.PI*11796480);f?c="AE 0,0 "+l+","+l+" "+ -h+" "+ -p+" 0,0 "+f+","+f+" "+ -(h+p)+" "+p+"X":c="M0,0AE0,0 "+l+","+l+" "+ -h+" "+ -p+"X"}a.v=c,n=this.append(n,e,i)}return n}}()}),pen.define("cdf/lib/CCC/protovis-msie",[],function(){}),pen.define("cdf/lib/CCC/pvc-d1.0",["cdf/Base","cdf/lib/CCC/def","cdf/lib/CCC/protovis"],function(e,t,n){function i(e,t){e&&(e.forEach(function(e){t&&(e[t]=null),e.dispose()}),e.length=0)}function s(e,n,r,i){r&&!r[i]||t.assert("Must not have a '"+i+"'."),r[i]=e,(e[n]||(e[n]=[])).push(r)}function o(e,n,r,i){r&&(!r[i]||r[i]===e)||t.assert("Not a child");var s=e[n];if(s){var o=s.indexOf(r);o>=0&&t.array.removeAt(s,o)}r[i]=null}function u(e){this.playedVisualRoles.set(e.name,e),f.call(this.type,this)}function a(e){this.playedVisualRoles.rem(e.name),f.call(this.type,this)}function f(e){this._isPctRoleDimTypeMap=null}function l(e,n){function i(){var i=t.query(r.source).select(function(e){var t=n(e);return t&&t.key||null}).distinct().array();return r._createSecondAxisSeriesKeySet(e,i)}var r=this;return n=this._filterDimensionReader(n,"series"),this._dataPartGet(i,n)}function c(e,t){return e.id-t.id}function h(e,t){return t.id-e.id}function d(){delete this.isSelected}function v(e){var n=t.get(e,"visible"),r=t.get(e,"selected");return(n==null?null:!!n)+":"+(r==null?null:!!r)}function m(e){this.owner===this||t.assert("Can only create atoms on an owner dimension.");if(!this._nullAtom){var n=""+(this.type._formatter?this.type._formatter.call(null,null,e):"");this._nullAtom=new r.data.Atom(this,null,n,null,""),this._atomsByKey[""]=this._nullAtom,this._atoms.unshift(this._nullAtom),this.data._atomsBase[this.name]=this._nullAtom}return this._nullAtom}function g(){this.owner===this||t.assert("Can only create atoms on an owner dimension.");if(!this._virtualNullAtom){var e=""+(this.type._formatter?this.type._formatter.call(null,null,null):"");this._virtualNullAtom=new r.data.Atom(this,null,e,null,""),this.data._atomsBase[this.name]=this._virtualNullAtom}return this._virtualNullAtom}function y(e){this.owner===this||t.assert("Can only unintern atoms on an owner dimension."),e&&e.dimension===this||t.assert("Not an interned atom");if(e===this._virtualNullAtom)return;var n=e.key;this._atomsByKey[n]===e&&(t.array.remove(this._atoms,e,this._atomComparer),delete this._atomsByKey[n],n||(delete this._nullAtom,this.data._atomsBase[this.name]=this._virtualNullAtom)),b.call(this)}function b(){this._atomVisibleDatumsCount=this._sumCache=this._visibleAtoms=this._visibleIndexes=null}function w(){b.call(this)}function E(e){s(this,"_children",e,"parent"),e.owner=this.owner}function S(e){o(this,"_children",e,"parent")}function x(e){s(this,"_linkChildren",e,"linkParent"),e.owner=this.owner}function T(e){o(this,"_linkChildren",e,"linkParent")}function N(e,n){var r;if(!this._disposed&&(r=this._atomVisibleDatumsCount)){var i=e.atoms[this.name],s=i.key;t.hasOwn(this._atomsByKey,s)||t.assert("Atom must exist in this dimension.");var o=r[s];n||o>0||t.assert("Must have had accounted for at least one visible datum."),r[s]=(o||0)+(n?1:-1),this._visibleAtoms=this._sumCache=this._visibleIndexes=null}}function C(){var e=this._atomVisibleDatumsCount;return e||(e={},this.data.datums(null,{visible:!0}).each(function(t){var n=t.atoms[this.name],r=n.key;e[r]=(e[r]||0)+1},this),this._atomVisibleDatumsCount=e),e}function k(e){var t=[];return this._atoms.forEach(function(n,r){this.isVisible(n)===e&&t.push(r)},this),t}function L(e){return t.query(this._atoms).where(function(t){return this.isVisible(t)===e},this).array()}function A(){i(this._children,"parent"),i(this._linkChildren,"linkParent"),this._childrenByKey=null,this._groupByCache=null,this._selectedDatums&&this._selectedDatums.clear()}function O(){this.isOwner()||t.fail("Can only be called on the owner data.")}function M(e,i,s){function f(e){var t=new r.data.Datum(this,e);s&&s(t)&&(t.isNull=!0);if(i&&!i(t))return a=!0,null;var n=t.atoms;for(var o in n){var f=n[o];if(f){var l=f.dimension;l._virtualNullAtom===f&&l.intern(null),u[o][f.key]=!0}}return t}var o=this.type.dimensionsNames(),u=n.dict(o,function(){return{}}),a=!1,l=t.query(e).select(f,this).where(t.notNully).distinct(function(e){return e.key}).array();return a&&t.eachOwn(this._dimensions,function(e){var n=u[e.name],r=e.atoms().filter(function(e){return!t.hasOwn(n,e.key)});r.forEach(function(t){y.call(e,t)})}),l}function _(e,i,s){function f(e){var n=new r.data.Datum(this,e);s&&s(u)&&(u.isNull=!0);if(i&&!i(n))return null;t.each(n.atoms,function(e){if(e){var t=e.dimension;t._virtualNullAtom===e&&t.intern(null),a[e.dimension.name][e.key]=!0}});var u=o[n.key];return u||(o[n.key]=u=n),u}var o=t.query(this._datums).uniqueIndex(function(e){return e.key}),u=this.type.dimensionsNames(),a=n.dict(u,function(){return{}}),l=t.query(e).select(f,this).where(t.notNully).array();return t.eachOwn(this._dimensions,function(e){var n=a[e.name],r=e.atoms().filter(function(e){return!t.hasOwn(n,e.key)});r.forEach(function(t){y.call(e,t)})}),l}function D(e){this.appendChild(e),(this._childrenByKey||(this._childrenByKey={}))[e.key]=e}function P(e){s(this,"_linkChildren",e,"linkParent")}function H(e){o(this,"_linkChildren",e,"linkParent")}function B(e,n){!e.isNull||t.assert("Null datums do not notify selected changes"),n?this._selectedDatums.set(e.id,e):this._selectedDatums.rem(e.id),this._sumAbsCache=null}function j(e,n){t.hasOwn(this._datumsById,e.id)&&(!e.isNull||t.assert("Null datums do not notify visible changes"),n?this._visibleDatums.set(e.id,e):this._visibleDatums.rem(e.id),this._sumAbsCache=null,t.eachOwn(this._dimensions,function(t){N.call(t,e,n)}),this._children.forEach(function(t){j.call(t,e,n)}),this._linkChildren&&this._linkChildren.forEach(function(t){j.call(t,e,n)}))}function F(){this._selectedDatums&&this._selectedDatums.clear(),this._visibleDatums.clear(),this._datumsById={},this._sumAbsCache=null,this._datums&&this._datums.forEach(q,this)}function I(e){t.hasOwn(this._datumsById,e.id)||(this._datums.push(e),q.call(this,e))}function q(e){var t=e.id;this._datumsById[t]=e;if(!e.isNull){var n;e.isSelected&&(n=this._selectedDatums)&&n.set(t,e),e.isVisible&&this._visibleDatums.set(t,e)}}function U(e,n){return t.string.is(e)||t.fail.argumentInvalid("groupLevelText","Invalid grouping specification."),t.query(e.split(/\s*\|\s*/)).where(t.truthy).select(function(e){var i=R.exec(e)||t.fail.argumentInvalid("groupLevelText","Invalid grouping level syntax '{0}'.",[e]),s=i[1],o=(i[2]||"").toLowerCase(),u=o==="desc",a=new r.data.GroupingDimensionSpec(s,u,n);return a})}function z(e){function r(e){if(e!=null){typeof e=="object"||t.fail.invalidArgument("datumFilter");var r={},s=!1;for(var o in e){var u=i.call(this,o,e[o]);u&&(s=!0,r[o]=u)}s&&n.push(r)}}function i(e,n){var r=this.dimensions(e),i=t.query(n).select(function(e){return r.atom(e)}).where(t.notNully).distinct(function(e){return e.key}).array();return i.length?i:null}var n=[];return e=t.array.as(e),e&&e.forEach(r,this),n}function W(e,n){var r=t.get(n,"selected"),i=t.get(n,"visible"),s=t.get(n,"where"),o=t.get(n,"isNull");return i!=null&&(e=e.where(function(e){return e.isVisible===i})),o!=null&&(e=e.where(function(e){return e.isNull===o})),r!=null&&(e=e.where(function(e){return e.isSelected===r})),s&&(e=e.where(s)),e}function X(e,n){var r=t.array.as(t.get(n,"orderBy")),i=t.create(n||{},{orderBy:null}),s=t.query(e).selectMany(function(e,t){return r&&(i.orderBy=r[t]),V.call(this,e,i)},this);return s.distinct(function(e){return e.id})}function V(e,n){var r=n.orderBy;if(!r)r=Object.keys(e).sort().join(",");else if(r.indexOf("|")>=0)throw t.error.argumentInvalid("keyArgs.orderBy","Multi-dimension order by is not supported.");var i=this.groupBy(r,n),s=i.treeHeight,o=[];return t.query(function(){var n;if(!this._data)this._data=i,this._dimAtomsOrQuery=t.query(e[i._childrenKeyDimName]);else if(this._datumsQuery){this._data||t.assert("Must have a current data"),o.length||t.assert("Must have a parent data"),!this._dimAtomsOrQuery||t.assert();if(this._datumsQuery.next())return this.item=this._datumsQuery.item,1;this._datumsQuery=null,n=o.pop(),this._data=n.data,this._dimAtomsOrQuery=n.dimAtomsOrQuery}this._dimAtomsOrQuery||t.assert("Invalid programmer"),this._data||t.assert("Must have a current data");var r=o.length;do{while(this._dimAtomsOrQuery.next()){var u=this._dimAtomsOrQuery.item,a=this._data._childrenByKey[u.globalKey];if(a&&(r<s-1||a._datums.length)){o.push({data:this._data,dimAtomsOrQuery:this._dimAtomsOrQuery}),this._data=a;if(!(r<s-1))return this._dimAtomsOrQuery=null,this._datumsQuery=t.query(a._datums),this._datumsQuery.next(),this.item=this._datumsQuery.item,1;this._dimAtomsOrQuery=t.query(e[a._childrenKeyDimName]),r++}}if(!r)return 0;n=o.pop(),this._data=n.data,this._dimAtomsOrQuery=n.dimAtomsOrQuery,r--}while(!0);return 0})}function J(e){this._renderId!==e&&(r.debug>=7&&r.log({sceneId:this.id,oldRenderId:this._renderId,newRenderId:e}),this._renderId=e,this.renderState={})}function K(e){return this._active!==e?(this._active&&Q.call(this._active,!1),this._active=e||null,this._active&&Q.call(this._active,!0),!0):!1}function Q(e){this.isActive!==!!e&&(e?this.isActive=!0:delete this.isActive)}function G(e,t){this.sign=e.sign||null,this.event=t||null,this.index=e.index,this.pvMark=e;var n=e.instance(),i=n._scene;if(!i){var s=n.group,o=s?null:n.datum;i=new r.visual.Scene(null,{panel:this.panel,group:s,datum:o})}this.scene=i}var r=t.globalSpace("pvc",{debug:0});(function(){function i(){var e=n.Behavior.tipsy;e&&e.setDebug&&(e.setDebug(r.debug),e.log=r.log)}(function(){if(typeof window.location!="undefined"){var e=window.location.href;if(e&&/\bdebug=true\b/.test(e)){var t=/\bdebugLevel=(\d+)/.exec(e);r.debug=t?+t[1]:1}}})(),r.invisibleFill="rgba(127,127,127,0.00001)";var e=r.arraySlice=Array.prototype.slice;r.setDebug=function(e){return e=+e,r.debug=isNaN(e)?0:e,i(),r.debug},r.log=function(e){r.debug&&typeof console!="undefined"&&console.log("[pvChart]: "+(typeof e=="string"?e:JSON.stringify(e)))},r.logError=function(e){e&&typeof e=="object"&&e.message&&(e=e.message);if(typeof console=="undefined")throw new Error("[pvChart ERROR]: "+e);console.log("[pvChart ERROR]: "+e)},n.error=r.logError,i(),r.cloneMatrix=function(e){return e.map(function(e){return e.slice()})},r.orientation={vertical:"vertical",horizontal:"horizontal"},r.extendType=function(e,n,r){if(n){var i,s=function(e,n){e!==undefined&&(i||(i={}),i[n]=t.fun.to(e))};r?r.forEach(function(e){s(n[e],e)}):t.each(s),i&&e.add(i)}},r.Range=function(e,t,n){arguments.length==1&&(t=e,e=0),n==null&&(n=1);if((t-e)/n==Infinity)throw new Error("range must be finite");this.stop=t,this.start=e,this.step=n},r.Range.prototype.forEach=function(e,t){var n=0,r;if(this.step<0)while((r=this.start+this.step*n++)>this.stop)e.call(t,r);else while((r=this.start+this.step*n++)<this.stop)e.call(t,r)},r.Range.prototype.map=function(e,t){var n=[];return this.forEach(function(r){n.push(e.call(t,r))}),n},r.defaultColorScheme=null,r.setDefaultColorScheme=function(e){return r.defaultColorScheme=r.colorScheme(e)},r.defaultColor=n.Colors.category10()("?"),r.colorScheme=function(e){if(e==null)return null;if(typeof e=="function"){if(!e.hasOwnProperty("range"))return e;e=e.range()}else e=t.array.as(e);return e.length?function(){var t=n.colors(e);return t.domain.apply(t,arguments),t}:null},r.createColorScheme=function(e){return r.colorScheme(e)||r.defaultColorScheme||n.Colors.category10},r.toGrayScale=function(e,t,r,i){e=n.color(e);var s=.299*e.r+.587*e.g+.114*e.b;r===undefined?r=200:r==null&&(r=255),i===undefined?i=30:i==null&&(i=0);var o=r-i;return o<=0?s=r:s=i+s/255*o,t==null?t=e.opacity:t<0&&(t=-t*e.opacity),s=Math.round(s),n.rgb(s,s,s,t)},r.removeTipsyLegends=function(){try{$(".tipsy").remove()}catch(e){}},r.createDateComparer=function(e,t){return t||(t=n.identity),function(n,r){return e.parse(t(n))-e.parse(t(r))}},n.Format.createParser=function(e){function t(t){return e.parse(t)}return t},n.Format.createFormatter=function(e){function t(t){return t!=null?e.format(t):""}return t},r.buildIndexedId=function(e,t){return t===0?e:e+""+(t+1)},r.parseLegendClickMode=function(e){e||(e="none");switch(e){case"toggleSelected":case"toggleVisible":case"none":break;default:r.debug>=2&&r.log("[Warning] Invalid 'legendClickMode' option value: '"+e+"'. Assuming 'none'."),e="none"}return e},r.parseShape=function(e){if(e)switch(e){case"square":case"circle":case"diamond":case"triangle":case"cross":case"bar":break;default:r.debug>=2&&r.log("[Warning] Invalid 'shape' option value: '"+e+"'."),e=null}return e},r.parseAlign=function(e,n){var i,s;return e==="left"||e==="right"?(i=n&&r.BasePanel.verticalAlign[n],i||(i="middle",s=!!n)):(i=n&&r.BasePanel.horizontalAlign[n],i||(i="center",s=!!n)),s&&r.debug>=2&&r.log(t.format("Invalid alignment value '{0}'. Assuming '{1}'.",[n,i])),i},r.Sides=function(e){e!=null&&this.setSides(e)},r.Sides.hnames="left right".split(" "),r.Sides.vnames="top bottom".split(" "),r.Sides.names="left right top bottom".split(" "),r.Sides.namesSet=n.dict(r.Sides.names,t.retTrue),r.parsePosition=function(e,n){return e&&!t.hasOwn(r.Sides.namesSet,e)&&(n||(n="left"),r.debug>=2&&r.log(t.format("Invalid position value '{0}. Assuming '{1}'.",[e,n])),e=n),e},r.Sides.as=function(e){return e!=null&&!(e instanceof r.Sides)&&(e=(new r.Sides).setSides(e)),e},r.Sides.prototype.setSides=function(e){if(typeof e=="string"){var t=e.split(/\s+/).map(function(e){return r.PercentValue.parse(e)});switch(t.length){case 1:return this.set("all",t[0]),this;case 2:return this.set("top",t[0]),this.set("left",t[1]),this.set("right",t[1]),this.set("bottom",t[0]),this;case 3:return this.set("top",t[0]),this.set("left",t[1]),this.set("right",t[1]),this.set("bottom",t[2]),this;case 4:return this.set("top",t[0]),this.set("right",t[1]),this.set("bottom",t[2]),this.set("left",t[3]),this;case 0:return this}}else{if(typeof e=="number")return this.set("all",e),this;if(typeof e=="object"){if(e instanceof r.PercentValue)this.set("all",e);else{this.set("all",e.all);for(var n in e)n!=="all"&&r.Sides.namesSet.hasOwnProperty(n)&&this.set(n,e[n])}return this}}return r.debug&&r.log("Invalid 'sides' value: "+JSON.stringify(e)),this},r.Sides.prototype.set=function(e,n){n=r.PercentValue.parse(n),n!=null&&(e==="all"?r.Sides.names.forEach(function(e){this[e]=n},this):t.hasOwn(r.Sides.namesSet,e)&&(this[e]=n))},r.Sides.prototype.resolve=function(e,t){typeof e=="object"&&(t=e.height,e=e.width);var n={};return r.Sides.names.forEach(function(r){var i=0,s=this[r];s!=null&&(typeof s=="number"?i=s:i=s.resolve(r==="left"||r==="right"?e:t)),n[r]=i},this),n.width=n.left+n.right,n.height=n.bottom+n.top,n},r.Sides.resolvedMax=function(e,t){var n={};return r.Sides.names.forEach(function(r){n[r]=Math.max(e[r]||0,t[r]||0)}),n},r.PercentValue=function(e){this.percent=e},r.PercentValue.prototype.resolve=function(e){return this.percent*e},r.PercentValue.parse=function(e){if(e!=null&&e!==""){switch(typeof e){case"number":return e;case"string":var n=e.match(/^(.+?)\s*(%)?$/);if(n){var i=+n[1];if(!isNaN(i)){if(!n[2])return i;if(i>=0)return new r.PercentValue(i/100)}}break;case"object":if(e instanceof r.PercentValue)return e}r.debug&&r.log(t.format("Invalid margins component '{0}'",[""+e]))}},r.PercentValue.resolve=function(e,t){return e instanceof r.PercentValue?e.resolve(t):e};var s=n.Mark.prototype.renderCore,o=n.Mark.prototype.zOrder;n.Mark.prototype.zOrder=function(e){var t=this.borderPanel;return t&&t!==this?o.call(t,e):o.call(this,e)},n.Mark.prototype.renderCore=function(){var e=this.root;e._renderId=(e._renderId||0)+1,r.debug>=10&&r.log("BEGIN RENDER "+e._renderId),s.apply(this,arguments),r.debug>=10&&r.log("END RENDER "+e._renderId)},n.Mark.prototype.renderId=function(){return this.root._renderId},n.Mark.prototype.intercept=function(n,r,i,s){function o(){var t=e.call(arguments);return r.call(this,i,t)}if(i!==undefined)s||(this[n](i),i=this.propertyValue(n));else if(!this._intercepted||!this._intercepted[n])i=this.propertyValue(n);return i!==undefined&&(i=t.fun.to(i)),this[n](o),(this._intercepted||(this._intercepted={}))[n]=!0,this},n.Mark.prototype.lock=function(e,t){return t!==undefined&&this[e](t),(this._locked||(this._locked={}))[e]=!0,this},n.Mark.prototype.isIntercepted=function(e){return this._intercepted&&this._intercepted[e]},n.Mark.prototype.isLocked=function(e){return this._locked&&this._locked[e]},n.Mark.prototype.addMargin=function(r,i){if(i!==0){var s=t.nullyTo(this.propertyValue(r),0),o=n.functor(s);this[r](function(){return i+o.apply(this,e.call(arguments))})}return this},n.Mark.prototype.addMargins=function(e){var n=t.get(e,"all",0);return this.addMargin("left",t.get(e,"left",n)),this.addMargin("right",t.get(e,"right",n)),this.addMargin("top",t.get(e,"top",n)),this.addMargin("bottom",t.get(e,"bottom",n)),this},n.Mark.prototype.eachSignumInstance=function(e,t){this.eachInstance(function(n,r){(n.datum||n.group)&&e.call(t,n,r)})},n.Transform.prototype.transformHPosition=function(e){return this.x+this.k*e},n.Transform.prototype.transformVPosition=function(e){return this.y+this.k*e},n.Transform.prototype.transformLength=function(e){return this.k*e},n.Mark.prototype.getInstanceShape=function(e){return new l(e.left,e.top,e.width,e.height)},n.Mark.prototype.getInstanceCenterPoint=function(e){return n.vector(e.left+(e.width||0)/2,e.top+(e.height||0)/2)},n.Label.prototype.getInstanceShape=function(e){var t=r.text,i=t.getTextSize(e.text,e.font);return t.getLabelPolygon(i.width,i.height,e.textAlign,e.textBaseline,e.textAngle,e.textMargin).apply(n.Transform.identity.translate(e.left,e.top))},n.Wedge.prototype.getInstanceCenterPoint=function(e){var t=e.startAngle+e.angle/2,r=(e.outerRadius+e.innerRadius)/2,i=e.left+r*Math.cos(t),s=e.top+r*Math.sin(t);return n.vector(i,s)},n.Wedge.prototype.getInstanceShape=function(e){var t=this.getInstanceCenterPoint(e);return new c(t.x,t.y,10)},n.Dot.prototype.getInstanceShape=function(e){var t=e.shapeRadius,n=e.left,r=e.top;switch(e.shape){case"diamond":t*=Math.SQRT2;case"square":case"cross":return new l(n-t,r-t,2*t,2*t)}return new c(n,r,t)},n.Dot.prototype.getInstanceCenterPoint=function(e){return n.vector(e.left,e.top)},n.Area.prototype.getInstanceShape=n.Line.prototype.getInstanceShape=function(e,t){return new h(e.left,e.top,t.left,t.top)},n.Area.prototype.getInstanceCenterPoint=n.Line.prototype.getInstanceCenterPoint=function(e,t){return n.vector((e.left+t.left)/2,(e.top+t.top)/2)};var u=t.type("pvc.Size").init(function(e,t){arguments.length===1?e!=null&&this.setSize(e):(e!=null&&(this.width=e),t!=null&&(this.height=t))}).add({setSize:function(e,n){if(typeof e=="string"){var i=e.split(/\s+/).map(function(e){return r.PercentValue.parse(e)});switch(i.length){case 1:return this.set(t.get(n,"singleProp","all"),i[0]),this;case 2:return this.set("width",i[0]),this.set("height",i[1]),this;case 0:return this}}else{if(typeof e=="number")return this.set(t.get(n,"singleProp","all"),e),this;if(typeof e=="object"){this.set("all",e.all);for(var s in e)s!=="all"&&this.set(s,e[s]);return this}}return r.debug&&r.log("Invalid 'size' value: "+JSON.stringify(e)),this},set:function(e,n){n!=null&&t.hasOwn(r.Size.namesSet,e)&&(n=r.PercentValue.parse(n),n!=null&&(e==="all"?r.Size.names.forEach(function(e){this[e]=n},this):this[e]=n))},clone:function(){return new u(this.width,this.height)},intersect:function(e){return new u(Math.min(this.width,e.width),Math.min(this.height,e.height))},resolve:function(e){var t={};return r.Size.names.forEach(function(n){var r=this[n];if(r!=null)if(typeof r=="number")t[n]=r;else if(e){var i=e[n];i!=null&&(t[n]=r.resolve(i))}},this),t}});r.Size.names=["width","height"],r.Size.namesSet=n.dict(r.Size.names,t.retTrue),r.Size.as=function(e){return e!=null&&!(e instanceof u)&&(e=(new u).setSize(e)),e};var a=t.type("pvc.Offset").init(function(e,t){arguments.length===1?e!=null&&this.setOffset(e):(e!=null&&(this.x=e),t!=null&&(this.y=t))}).add({setOffset:function(e,n){if(typeof e=="string"){var i=e.split(/\s+/).map(function(e){return r.PercentValue.parse(e)});switch(i.length){case 1:return this.set(t.get(n,"singleProp","all"),i[0]),this;case 2:return this.set("x",i[0]),this.set("y",i[1]),this;case 0:return this}}else{if(typeof e=="number")return this.set(t.get(n,"singleProp","all"),e),this;if(typeof e=="object"){this.set("all",e.all);for(var s in e)s!=="all"&&this.set(s,e[s]);return this}}return r.debug&&r.log("Invalid 'offset' value: "+JSON.stringify(e)),this},set:function(e,n){n!=null&&t.hasOwn(r.Offset.namesSet,e)&&(n=r.PercentValue.parse(n),n!=null&&(e==="all"?r.Offset.names.forEach(function(e){this[e]=n},this):this[e]=n))},resolve:function(e){var t={};return r.Size.names.forEach(function(n){var i=r.Offset.namesSizeToOffset[n],s=this[i];if(s!=null)if(typeof s=="number")t[i]=s;else if(e){var o=e[n];o!=null&&(t[i]=s.resolve(o))}},this),t}});r.Offset.names=["x","y"],r.Offset.namesSet=n.dict(r.Offset.names,t.retTrue),r.Offset.namesSizeToOffset={width:"x",height:"y"},r.Offset.namesSidesToOffset={left:"x",right:"x",top:"y",bottom:"y"},r.Offset.as=function(e){return e!=null&&!(e instanceof a)&&(e=(new a).setOffset(e)),e};var f=t.type("pvc.Shape").add({transform:function(e){return this.clone().apply(e)}});t.mixin(n.Vector.prototype,f.prototype,{set:function(e,t){this.x=e||0,this.y=t||0},clone:function(){return new n.Vector(this.x,this.y)},apply:function(e){return this.x=e.transformHPosition(this.x),this.y=e.transformVPosition(this.y),this},intersectsRect:function(e){return this.x>=e.x&&this.x<=e.x2&&this.y>=e.y&&this.y<=e.y2}});var l=t.type("pvc.Rect",f).init(function(e,t,n,r){this.set(e,t,n,r)}).add({set:function(e,t,n,r){this.x=e||0,this.y=t||0,this.dx=n||0,this.dy=r||0,this.calc()},calc:function(){this.dx<0&&(this.dx=-this.dx,this.x=this.x-this.dx),this.dy<0&&(this.dy=-this.dy,this.y=this.y-this.dy),this.x2=this.x+this.dx,this.y2=this.y+this.dy,this._sides=null},clone:function(){return new l(this.x,this.y,this.dx,this.dy)},apply:function(e){return this.x=e.transformHPosition(this.x),this.y=e.transformVPosition(this.y),this.dx=e.transformLength(this.dx),this.dy=e.transformLength(this.dy),this.calc(),this},containsPoint:function(e,t){return this.x<e&&e<this.x2&&this.y<t&&t<this.y2},intersectsRect:function(e){return this.x2>e.x&&this.x<e.x2&&this.y2>e.y&&this.y<e.y2},sides:function(){if(!this._sides){var e=this.x,t=this.y,n=this.x2,r=this.y2;this._sides=[new h(e,t,n,t),new h(n,t,n,r),new h(e,r,n,r),new h(e,t,e,r)]}return this._sides}}),c=t.type("pvc.Circle",f).init(function(e,t,n){this.x=e||0,this.y=t||0,this.radius=n||0}).add({clone:function(){return new c(this.x,this.y,this.radius)},apply:function(e){return this.x=e.transformHPosition(this.x),this.y=e.transformVPosition(this.y),this.radius=e.transformLength(this.radius),this},intersectsRect:function(e){var t=e.dx/2,n=e.dy/2,r=Math.abs(this.x-e.x-t),i=Math.abs(this.y-e.y-n);if(r>t+this.radius||i>n+this.radius)return!1;if(r<=t||i<=n)return!0;var s=Math.pow(r-t,2)+Math.pow(i-n,2);return s<=this.radius*this.radius}}),h=t.type("pvc.Line",f).init(function(e,t,n,r){this.x=e||0,this.y=t||0,this.x2=n||0,this.y2=r||0}).add({clone:function(){return new r.Line(this.x,this.y,this.x2,this.x2)},apply:function(e){return this.x=e.transformHPosition(this.x),this.y=e.transformVPosition(this.y),this.x2=e.transformHPosition(this.x2),this.y2=e.transformVPosition(this.y2),this},intersectsRect:function(e){if(!e)return!1;var t=e.sides();for(var n=0;n<4;n++)if(this.intersectsLine(t[n]))return!0;return!1},intersectsLine:function(e){var t=this,n=t.x2-t.x,r=t.y2-t.y,i=e.x2-e.x,s=e.y2-e.y,o=s*n-i*r;if(o===0)return!1;var u=t.y-e.y,a=t.x-e.x,f=i*u-s*a,l=n*u-r*a;if(o===0)return f===0&&l===0;var c=f/o;if(c<0||c>1)return!1;var h=l/o;return h<0||h>1?!1:!0}}),p=t.type("pvc.Polygon",f).init(function(e){this._corners=e||[]}).add({_sides:null,_bbox:null,corners:function(){return this._corners},clone:function(){return new p(this.corners().slice())},apply:function(e){delete this._sides,delete this._bbox;var t=this.corners();for(var n=0,r=t.length;n<r;n++)t[n].apply(e);return this},intersectsRect:function(e){var t,n,r=this.corners();n=r.length;for(t=0;t<n;t++)if(r[t].intersectsRect(e))return!0;var i=this.sides();n=i.length;for(t=0;t<n;t++)if(i[t].intersectsRect(e))return!0;return!1},sides:function(){var e=this._sides;if(!e){e=this._sides=[];var t=this.corners(),n=t.length;if(n){var r=t[0];for(var i=1;i<n;i++){var s=t[i];e.push(new h(r.x,r.y,s.x,s.y))}}}return e},bbox:function(){var e=this._bbox;if(!e){var t,i;this.corners().forEach(function(e,r){t==null?t=n.vector(e.x,e.y):(e.x<t.x&&(t.x=e.x),e.y<t.y&&(t.y=e.y)),i==null?i=n.vector(e.x,e.y):(e.x>i.x&&(i.x=e.x),e.y>i.y&&(i.y=e.y))}),e=this._bbox=new r.Rect(t.x,t.y,i.x-t.x,i.y-t.y)}return this._bbox}})})(),n.Behavior.selector=function(e,t){function c(e,u){t==null?(s=this.index,i=this.scene):(s=t.index,i=t.scene);if(!a){var l=this.root.scene.$g;a=[[l,"mousemove",n.listen(l,"mousemove",h)],[l,"mouseup",n.listen(l,"mouseup",p)],[document,"mousemove",n.listen(document,"mousemove",h)],[document,"mouseup",n.listen(document,"mouseup",p)]]}f=this.mouse(),o=f,this.selectionRect=new r.Rect(f.x,f.y),n.Mark.dispatch("selectstart",i,s,u)}function h(e){if(!i)return;e.stopPropagation(),i.mark.context(i,s,function(){var t=this.mouse();if(o){var r=t.x-o.x,u=t.y-o.y,a=r*r+u*u;if(a<=2)return;o=t}var c=f.x,h=f.y;this.selectionRect.set(c,h,t.x-c,t.y-h),l&&this.render(),n.Mark.dispatch("select",i,s,e)})}function p(e){var t=i;if(t){a&&(a.forEach(function(e){n.unlisten.apply(n,e)}),a=null),e.stopPropagation();var r=t.mark;r&&(n.Mark.dispatch("selectend",t,s,e),r.selectionRect=null),o=null,i=null}}var i,s,o,u,a,f,l=arguments.length>0?e:!0;return c},function(e){e.support.svg=e.support.svg||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")}(jQuery),t.scope(function(){function i(){return new r.text.FontSizeCache}function s(n,i,s){n instanceof r.text.FontSizeCache||t.fail.operationInvalid("Not a valid text cache.");var o=e;e=n;try{return i.call(s)}finally{e=o}}function o(t,n){t==null?t="":t=""+t;var r=e&&e.get(n,t);return r||(r=w(t,n),e&&e.put(n,t,r)),r}function u(e,t){return o(e,t).width}function a(e,t){return o(e,t).height}function f(e){if(n.renderer()==="batik"){var t=document.createElementNS("http://www.w3.org/2000/svg","text").style;return t.setProperty("font",e),parseInt(t.getProperty("font-size"),10)}var r=S();return r.css("font",e),parseInt(r.css("font-size"),10)}function l(e,t,n,r,i){if(n==="")return{h:!0,v:!0,d:!0};var s=u(n,r);return{h:s<=e,v:s<=t,d:s<=Math.sqrt(e*e+t*t)-i}}function c(e,t,n,r,i){return e+=u(r,n),h(e,t,n,r,i)}function h(e,t,n,r,i){if(t==="")return t;var s=u(t,n);if(s<=e)return t;if(s>e*1.5)return L(e,t,n,r,i);while(s>e)t=i?t.slice(1):t.slice(0,t.length-1),s=u(t,n);return i?r+t:t+r}function p(e,t,n){var i=[];if(t<u("a",n))return i;var s=(e||"").split(/\s+/),o="";while(s.length){var a=s.shift();if(a){var f=o?o+" "+a:a;r.text.getTextLength(f,n)>t?(o&&i.push(o),o=a):o=f}}return o&&i.push(o),i}function d(e,t,i,s,o,u){var a,f;switch(s){case"middle":f=t/2;break;case"top":f=u+t;break;case"bottom":f=-u}switch(i){case"right":a=-u-e;break;case"center":a=-e/2;break;case"left":a=u}var l=n.vector(a,f),c=l.plus(e,0),h=c.plus(0,-t),p=l.plus(0,-t);return o!==0&&(l=l.rotate(o),c=c.rotate(o),p=p.rotate(o),h=h.rotate(o)),new r.Polygon([l,c,p,h])}function v(e,t,n,i,s,o){var u=d(e,t,n,i,s,o),a=u.corners(),f;if(s===0){var l=a[2],c=a[1];f=new r.Rect(l.x,l.y,c.x-l.x,c.y-l.y)}else f=u.bbox();return f.sourceCorners=a,f.sourceAngle=s,f.sourceAlign=n,f.sourceTextWidth=e,f}function w(e,t){if(!e)return{width:0,height:0};switch(n.renderer()){case"vml":return k(e,t);case"batik":return x(e,t)}return E(e,t)}function E(e,t){if(!g){var r=S(),i=n.SvgScene.create("svg");i.setAttribute("font-size","10px"),i.setAttribute("font-family","sans-serif"),g=n.SvgScene.create("text"),i.appendChild(g),r[0].appendChild(i)}t||(t=null),y!==t&&(y=t,n.SvgScene.setStyle(g,{font:t}));var s=g.firstChild;s?s.nodeValue=""+e:n.renderer()==="svgweb"?g.appendChild(document.createTextNode(""+e,!0)):g.appendChild(document.createTextNode(""+e));var o=g.getBBox();return{width:o.width,height:o.height}}function S(){if(!m||!m.parent().length)m=$(b),m.length||(m=$("<div>").attr("id",b).css("position","absolute").css("visibility","hidden").css("width","auto").css("height","auto"),$("body").append(m));return m}function x(e,t){var n=C(t);return{width:getTextLenCGG(e,n.family,n.size,n.style,n.weight),height:getTextHeightCGG(e,n.family,n.size,n.style,n.weight)}}function C(e){var t=T&&T[e];if(!t){N||(N=document.createElementNS("http://www.w3.org/2000/svg","text"));var n=N.style;n.setProperty("font",e);var r=""+n.getProperty("font-family");if(!r)r="sans-serif";else if(r.length>2){var i=r.charAt(0);if(i==='"'||i==="'")r=r.substr(1,r.length-2)}t={family:r,size:""+n.getProperty("font-size"),style:""+n.getProperty("font-style"),weight:""+n.getProperty("font-weight")}}return t}function k(e,t){var r=n.Vml.text_dims(e,t);return{width:r.width,height:r.height}}function L(e,t,n,r,i){var s=t.length,o=s-2,a=0,f,l;while(a<=o&&o>0){f=Math.ceil((a+o)/2);var c=i?t.slice(s-f):t.slice(0,f);l=u(c,n);if(l>e)o=f-1;else{if(!(u(i?t.slice(s-f-1):t.slice(0,f+1),n)<e))return i?r+c:c+r;a=f+1}}return i?r+t.slice(s-o):t.slice(0,o)+r}var e,m=null,g=null,y=null,b="cccTextSizeTest_"+(new Date).getTime(),T,N;t.type("pvc.text.FontSizeCache").init(function(){this._fontsCache={}}).add({_getFont:function(e){return t.getOwn(this._fontsCache,e||"")||(this._fontsCache[e||""]={})},get:function(e,n){return t.getOwn(this._getFont(e),n||"")},put:function(e,t,n){return this._getFont(e)[t||""]=n}}),t.copyOwn(r.text,{createCache:i,useCache:s,getTextSize:o,getTextLength:u,getFontSize:f,getTextHeight:a,getFitInfo:l,trimToWidth:h,trimToWidthB:c,justify:p,getLabelBBox:v,getLabelPolygon:d})}),t.scope(function(){function e(e){e||t.fail.argumentRequired("keyArgs");var n=e.type||t.fail.argumentRequired("keyArgs.type");switch(n){case"linear":return(new r.color.LinearScalesBuild(e)).buildMap();case"discrete":return(new r.color.DiscreteScalesBuild(e)).buildMap();case"normal":return(new r.color.NormalScalesBuild(e)).buildMap()}throw t.error.argumentInvalid("scaleType","Unexistent scale type '{0}'.",[n])}function i(e){e||t.fail.argumentRequired("keyArgs");var n=e.type||t.fail.argumentRequired("keyArgs.type");switch(n){case"linear":return(new r.color.LinearScalesBuild(e)).build();case"discrete":return(new r.color.DiscreteScalesBuild(e)).build();case"normal":return(new r.color.NormalScalesBuild(e)).build()}throw t.error.argumentInvalid("scaleType","Unexistent scale type '{0}'.",[n])}r.color={scale:i,scales:e},t.type("pvc.color.ScalesBuild").init(function(e){this.keyArgs=e,this.data=e.data||t.fail.argumentRequired("keyArgs.data"),this.domainDimName=e.colorDimension||t.fail.argumentRequired("keyArgs.colorDimension"),this.domainDim=this.data.dimensions(this.domainDimName);var i=this.domainDim.type;i.isComparable?this.domainComparer=function(e,t){return i.compare(e,t)}:(this.domainComparer=null,r.log("Color value dimension should be comparable. Generated color scale may be invalid.")),this.nullRangeValue=e.nullColor?n.color(e.nullColor):n.Color.transparent,this.domainRangeCountDif=0}).add({build:function(){this.range=this._getRange(),this.desiredDomainCount=this.range.length+this.domainRangeCountDif;var e=this._getDomain();return this._createScale(e)},buildMap:function(){this.range=this._getRange(),this.desiredDomainCount=this.range.length+this.domainRangeCountDif;var e;if(this.keyArgs.normPerBaseCategory)e=function(e){var t=this._ensureDomain(null,!1,e);return this._createScale(t)};else{var n=this._getDomain(),r=this._createScale(n);e=t.fun.constant(r)}return this._createCategoryScalesMap(e)},_createScale:t.method({isAbstract:!0}),_createCategoryScalesMap:function(e){return this.data.leafs().object({name:function(e){return e.absKey},value:e,context:this})},_getRange:function(){var e=this.keyArgs,t=e.colorRange||["red","yellow","green"];return e.minColor!=null&&e.maxColor!=null?t=[e.minColor,e.maxColor]:e.minColor!=null?t.unshift(e.minColor):e.maxColor!=null&&t.push(e.maxColor),t.map(function(e){return n.color(e)})},_getDataExtent:function(e){var t=e.dimensions(this.domainDimName).extent({visible:!0});if(!t)return null;var n=t.min.value,r=t.max.value;return r==n&&(r>=1?n=r-1:r=n+1),{min:n,max:r}},_getDomain:function(){var e=this.keyArgs.colorRangeInterval;return e!=null?(this.domainComparer&&e.sort(this.domainComparer),e.length>this.desiredDomainCount&&(e=e.slice(0,this.desiredDomainCount))):e=[],this._ensureDomain(e,!0,this.data)},_ensureDomain:function(e,i,s){var o;if(e&&i){var u=this.desiredDomainCount-e.length;if(u>0){o=this._getDataExtent(s);if(o)switch(u){case 1:this.domainComparer?t.array.insert(e,o.max,this.domainComparer):e.push(o.max);break;case 2:this.domainComparer?(t.array.insert(e,o.min,this.domainComparer),t.array.insert(e,o.max,this.domainComparer)):(e.unshift(o.min),e.push(o.max));break;default:r.debug>=2&&r.log("Ignoring option 'colorRangeInterval' due to unsupported length."+t.format(" Should have '{0}', but instead has '{1}'.",[this.desiredDomainCount,e.length])),e=null}}}if(!e){o||(o=this._getDataExtent(s));if(o){var a=o.min,f=o.max,l=(f-a)/(this.desiredDomainCount-1);e=n.range(a,f+l,l)}}return e}}),t.type("pvc.color.LinearScalesBuild",r.color.ScalesBuild).add({_createScale:function(e){var t=n.Scale.linear();return e&&t.domain.apply(t,e),t.range.apply(t,this.range),t}}),t.type("pvc.color.DiscreteScalesBuild",r.color.ScalesBuild).init(function(e){this.base(e),this.domainRangeCountDif=1}).add({_createScale:function(e){function s(s){if(s==null)return r;for(var o=0;o<t;o++)if(s<=e[o+1])return n[o];return n[i]}var t=e.length-1,n=this.range,r=this.nullRangeValue,i=n.length-1;return s}})}),t.scope(function(){function e(e,r){function s(e){var n=t.getOwn(i,e)||t.fail.operationInvalid("Undefined option '{0}'",[e]);return n.resolve()}function o(e,t){var n=s(e);return t&&!n.isSpecified?undefined:n.value}function u(e){return s(e).isSpecified}function a(e){return c(e,!1)}function f(e){return c(e,!0)}function l(e){return s(e)._defaultValue}function c(e,n){for(var r in e){var s=t.getOwn(i,r);if(s){var u=e[r];u!==undefined&&s.set(r,n)}}return o}e||t.fail.argumentRequired("specs");var i={};return t.each(e,function(e,t){var s=new n(t,o,r,e);i[s.name]=s;var u=s.alias;u&&u.forEach(function(e){i[e]=s})}),o.option=o,o.isSpecified=u,o.defaultValue=l,o.specify=a,o.defaults=f,o}r.options=e;var n=t.type().init(function(e,n,r,i){this.name=e,this._context=r,this.option=n,this.cast=t.get(i,"cast");var s=t.get(i,"value");s!==undefined&&(this._defaultValue=this.value=s),this.resolveCore=t.get(i,"resolve"),this.resolveCore||(this.isResolved=!0),this.alias=t.array.as(t.get(i,"alias"))}).add({isSpecified:!1,isResolved:!1,value:undefined,_defaultValue:undefined,resolve:function(){return this.isResolved||(this.isResolved=!0,this.resolveCore(this._context)),this},specify:function(e){return this.set(e,!1)},defaultValue:function(e){return e!==undefined&&this.set(e,!0),this._defaultValue},set:function(e,t){return e!=null&&this.cast&&(e=this.cast(e,this._context)),t?(this._defaultValue=e,this.isSpecified||(this.value=e)):(this.isSpecified=!0,this.isResolved=!0,this.value=e),this}})}),t.global.NoDataException=function(){},r.data={visibleKeyArgs:{visible:!0}},t.type("pvc.data.DimensionType").init(function(e,i,s){this.complexType=e,this.name=i,this.label=t.get(s,"label")||t.firstUpperCase(i);var o=r.data.DimensionType.splitDimensionGroupName(i);this.group=o[0],this.groupLevel=t.nullyTo(o[1],0),this.label.indexOf("{")>=0&&(this.label=t.format(this.label,[this.groupLevel+1])),this.playedVisualRoles=new t.Map,this.isHidden=!!t.get(s,"isHidden");var u=t.get(s,"valueType")||null,a=r.data.DimensionType.valueTypeName(u),f=t.getOwn(r.data.DimensionType.cast,a,null);this.valueType=u,this.valueTypeName=a,this.cast=f,this.isDiscrete=t.get(s,"isDiscrete");if(this.isDiscrete==null)this.isDiscrete=this.valueType!==Number&&this.valueType!==Date;else{this.isDiscrete=!!this.isDiscrete;if(!this.isDiscrete&&this.valueType!==Number&&this.valueType!==Date)throw t.error.argumentInvalid("isDiscrete","The only supported continuous value types are Number and Date.")}this._converter=t.get(s,"converter")||null;if(!this._converter){var l=t.get(s,"rawFormat");if(l)switch(this.valueType){case Number:this._converter=n.Format.createParser(n.Format.number().fractionDigits(0,2));break;case Date:this._converter=n.Format.createParser(n.Format.date(l))}}this._key=t.get(s,"key")||null,this._comparer=t.get(s,"comparer");if(this._comparer===undefined)switch(this.valueType){case Number:this.isDiscrete||(this._comparer=t.compare);break;case Date:this._comparer=t.compare;break;default:this._comparer=null}this.isComparable=this._comparer!=null,this._formatter=t.get(s,"formatter")||null;if(!this._formatter)switch(this.valueType){case Number:this._formatter=n.Format.createFormatter(n.Format.number().fractionDigits(0,2));break;case Date:var c=t.get(s,"format")||"%Y/%m/%d";this._formatter=n.Format.createFormatter(n.Format.date(c))}}).add({compare:function(e,t){return e==null?t==null?0:-1:t==null?1:this._comparer.call(null,e,t)},comparer:function(e){if(!this.isComparable)return null;var t=this;return e?this._reverseComparer||(this._reverseComparer=function(e,n){return t.compare(n,e)}):this._directComparer||(this._directComparer=function(e,n){return t.compare(e,n)})},atomComparer:function(e){return e?this._reverseAtomComparer||(this._reverseAtomComparer=this._createReverseAtomComparer()):this._directAtomComparer||(this._directAtomComparer=this._createDirectAtomComparer())},_createReverseAtomComparer:function(){function t(t,n){return t===n?0:e.compare(n.value,t.value)}if(!this.isComparable)return h;var e=this;return t},_createDirectAtomComparer:function(){function t(t,n){return t===n?0:e.compare(t.value,n.value)}if(!this.isComparable)return c;var e=this;return t},formatter:function(){return this._formatter},converter:function(){return this._converter},playingPercentVisualRole:function(){return t.query(this.playedVisualRoles.values()).any(function(e){return e.isPercent})}}),r.data.DimensionType.cast={Date:function(e){return e instanceof Date?e:new Date(e)},Number:function(e){return e=Number(e),isNaN(e)?null:e},String:String,Boolean:Boolean,Object:Object,Any:null},r.data.DimensionType.dimensionGroupName=function(e){return e.replace(/^(.*?)(\d*)$/,"$1")},r.data.DimensionType.splitDimensionGroupName=function(e){var t=/^(.*?)(\d*)$/.exec(e),n=null;return t[2]&&(n=Number(t[2]),n<=1?n=1:n--),[t[1],n]},r.data.DimensionType.valueTypeName=function(e){if(e==null)return"Any";switch(e){case Boolean:return"Boolean";case Number:return"Number";case String:return"String";case Object:return"Object";case Date:return"Date";default:throw t.error.argumentInvalid("valueType","Invalid valueType function: '{0}'.",[e])}},r.data.DimensionType.dimensionGroupLevelName=function(e,t){return e+(t>=1?t+1:"")},r.data.DimensionType.extendSpec=function(e,n,i){var s=r.data.DimensionType.dimensionGroupName(e),o=t.get(i,"dimensionGroups");if(o){var u=o[s];u&&(n=t.create(u,n))}n||(n={});switch(s){case"category":var a=t.get(i,"isCategoryTimeSeries",!1);a&&n.valueType===undefined&&(n.valueType=Date);break;case"value":n.valueType===undefined&&(n.valueType=Number),n.valueType===Number&&n.formatter===undefined&&!n.format&&(n.formatter=t.get(i,"valueNumberFormatter"));break;default:e==="dataPart"&&(n.isDiscrete===undefined&&(n.isDiscrete=!0),n.isHidden===undefined&&(n.isHidden=!0),n.comparer===undefined&&(n.comparer=t.compare))}return n.converter===undefined&&n.valueType===Date&&!n.rawFormat&&(n.rawFormat=t.get(i,"timeSeriesFormat")),n},t.type("pvc.data.ComplexType").init(function(e){this._dims={},this._dimsList=[],this._dimsNames=[],this._dimsByGroup={},this._dimsNamesByGroup={};if(e)for(var t in e)this.addDimension(t,e[t])}).add({describe:function(){var e=["\n------------------------------------------"];return e.push("Complex Type Information"),this._dimsList.forEach(function(t){var n=[];n.push(t.valueTypeName),t.isComparable&&n.push("comparable"),t.isDiscrete||n.push("continuous"),t.isHidden&&n.push("hidden"),e.push("  "+t.name+" ("+n.join(", ")+")")}),e.push("------------------------------------------"),e.join("\n")},dimensions:function(e,n){if(e==null)return this._dims;var r=t.getOwn(this._dims,e,null);if(!r&&t.get(n,"assertExists",!0))throw t.error.argumentInvalid("name","Undefined dimension '{0}'",[e]);return r},dimensionsList:function(){return this._dimsList},dimensionsNames:function(){return this._dimsNames},groupDimensions:function(e,n){var r=t.getOwn(this._dimsByGroup,e);if(!r&&t.get(n,"assertExists",!0))throw t.error.operationInvalid("There is no dimension type group with name '{0}'.",[e]);return r},groupDimensionsNames:function(e,n){var r=t.getOwn(this._dimsNamesByGroup,e);if(!r&&t.get(n,"assertExists",!0))throw t.error.operationInvalid("There is no dimension type group with name '{0}'.",[e]);return r},addDimension:function(e,n){e||t.fail.argumentRequired("name"),!t.hasOwn(this._dims,e)||t.fail.operationInvalid("A dimension type with name '{0}' is already defined.",[e]);var i=new r.data.DimensionType(this,e,n);this._dims[e]=i,this._dimsList.push(i),this._dimsNames.push(e);var s=i.group;if(s){var o=t.getOwn(this._dimsByGroup,s),u;o?u=this._dimsNamesByGroup[s]:(o=this._dimsByGroup[s]=[],u=this._dimsNamesByGroup[s]=[]);var a=t.array.insert(u,e,t.compare);t.array.insertAt(o,~a,i)}return this._isPctRoleDimTypeMap=null,i},getPlayingPercentVisualRoleDimensionMap:function(){var e=this._isPctRoleDimTypeMap;return e||(e=this._isPctRoleDimTypeMap=new t.Map(t.query(t.own(this._dims)).where(function(e){return e.playingPercentVisualRole()}).object({name:function(e){return e.name}}))),e}}),t.type("pvc.data.TranslationOper").init(function(e,t,n,i){this.complexType=e,this.source=t,this.metadata=n||{},this.options=i||{},r.debug>=3&&this._logSource(),this._initType()}).add({_logSource:t.method({isAbstract:!0}),virtualItemSize:function(){return this.metadata.length},freeVirtualItemSize:function(){return this.virtualItemSize()-this._userUsedIndexesCount},defReader:function(e){e||t.fail.argumentRequired("readerSpec");var n=e.names;typeof n=="string"?n=n.split(/\s*\,\s*/):n=t.array.as(n);var r=!!n&&!!n.length;r&&n.forEach(function(e){e||t.fail.argumentRequired("readers[i].names"),e=e.replace(/^\s*(.+?)\s*$/,"$1"),!t.hasOwn(this._userUsedDims,e)||t.fail.argumentInvalid("readers[i].names","Dimension name '{0}' is already being read.",[e]),this._userUsedDims[e]=!0,this.ensureDimensionType(e)},this);var i=t.array.as(e.indexes);i&&i.forEach(this._userUseIndex,this);var s=e.reader;s?(r||t.fail.argumentRequired("reader.names","Required argument when a reader function is specified."),this._userRead(this._wrapReader(s,n),n)):r&&this._userCreateReaders(n,i)},configureType:t.method({isAbstract:!0}),_initType:function(){this._userDimsReaders=[],this._userDimsReadersByDim={},this._userItem=[],this._userDefDims={},this._userUsedDims={},this._userUsedIndexes={},this._userUsedIndexesCount=0;var e=this.options.dimensions;for(var t in e)this._userDefDimension(t,e[t]);var n=this.options.readers;n&&n.forEach(this.defReader,this);var r=this.options.multiChartIndexes;r!=null&&this.defReader({names:"multiChart",indexes:r})},_userDefDimension:function(e,n){e||t.fail.argumentInvalid("dimensions[i]","Invalid dimension name."),!t.hasOwn(this._userDefDims,e)||t.fail.argumentInvalid("dimensions[i]","A dimension with name '{0}' is already defined.",[e]),this._userDefDims[e]=!0,this.ensureDimensionType(e,n)},_userUseIndex:function(e){e=+e,e>=0||t.fail.argumentInvalid("index","Invalid reader index: '{0}'.",[e]),!t.hasOwn(this._userUsedIndexes,e)||t.fail.argumentInvalid("index","Virtual item index '{0}' is already assigned.",[e]),this._userUsedIndexes[e]=!0,this._userUsedIndexesCount++,this._userItem[e]=!0},_userCreateReaders:function(e,n){n||(n=[]);var i=n.length,s=e.length,o;if(s>i){var u=i>0?n[i-1]+1:0;do u=this._nextAvailableItemIndex(u),n[i]=u,this._userUseIndex(u),i++;while(s>i)}var a=i===s?s:s-1;for(var f=0;f<a;f++)o=e[f],this._userRead(this._propGet(o,n[f]),o);if(a<s){var l=r.data.DimensionType.splitDimensionGroupName(e[s-1]),c=l[0],h=t.nullyTo(l[1],0);for(var p=a;p<i;p++,h++)o=r.data.DimensionType.dimensionGroupLevelName(c,h),p>a&&(!t.hasOwn(this._userUsedDims,o)||t.fail.argumentInvalid("readers[i].names","Dimension name '{0}' of last dimension group name is already being read.",[o]),this._userUsedDims[o]=!0),this._userRead(this._propGet(o,n[p]),o)}},_userRead:function(e,n){t.fun.is(e)||t.fail.argumentInvalid("reader","Reader must be a function."),t.array.is(n)?n.forEach(function(t){this._userDimsReadersByDim[t]=e},this):this._userDimsReadersByDim[n]=e,this._userDimsReaders.push(e)},_wrapReader:function(e,t){function s(){return i=n.data,r=t.map(function(e){return i.dimensions(e)}),r.unshift(null),r}function o(t){return(r||s())[0]=t,e.apply(i,r)}var n=this,r,i;return o},_filterDimensionReader:function(e,n){function r(r){var i=e(r);if(i instanceof Array)return t.query(i).first(function(e){return e.dimension.name===n});if(i.dimension.name===n)return i}return r},execute:function(e){return this.data=e,this._executeCore()},_executeCore:function(){var e=this._getDimensionsReaders();return t.query(this._getItems()).select(function(t){return this._readItem(null,t,e)},this)},_getItems:function(){return this.source},_getDimensionsReaders:function(){return this._userDimsReaders},_readItem:function(e,n,i){e=e||[],r.debug>=4&&r.log("virtual item: "+JSON.stringify(n));var s=0,o=i.length,u=0,a=this.data;while(s<o){var f=i[s++].call(a,n);if(f!=null)if(f instanceof Array){var l=0,c=f.length;while(l<c)f.value!=null&&(e[u++]=f[l]),l++}else f.value!=null&&(e[u++]=f)}e.length=u;if(r.debug>=4){var h=t.query(e).object({name:function(e){return e.dimension.name},value:function(e){return{id:e.id,v:e.value,f:e.label}}});r.log("  -> atoms: "+JSON.stringify(h))}return e},_propGet:function(e,n,r){function o(t){return(s||(s=i.data.dimensions(e))).intern(t[n])}var i=this,s;return t.get(r,"ensureDim",!0)&&this.ensureDimensionType(e),o},_constGet:function(e,n,r){function o(){return s||(s=i.data.dimensions(e).intern(n))}var i=this,s;return t.get(r,"ensureDim",!0)&&this.ensureDimensionType(e),o},_nextAvailableItemIndex:function(e,n){e==null&&(e=0),n==null&&(n=Infinity);while(e<n&&t.hasOwn(this._userItem,e))e++;return e<n?e:-1},ensureDimensionType:function(e,t){var n=this.complexType.dimensions(e,{assertExists:!1});n||this.defDimensionType(e,t)},defDimensionType:function(e,t){return t=r.data.DimensionType.extendSpec(e,t,this.options),this.complexType.addDimension(e,t)}}),t.type("pvc.data.MatrixTranslationOper",r.data.TranslationOper).add({_logSource:function(){r.log("ROWS ("+this.source.length+")"),this.source&&t.query(this.source).take(10).each(function(e,t){r.log("row "+t+": "+JSON.stringify(e))}),r.log("COLS ("+this.metadata.length+")"),this.metadata&&this.metadata.forEach(function(e){r.log("column {index: "+e.colIndex+", name: "+e.colName+", label: "+e.colLabel+", type: "+e.colType+"}")})},_createSecondAxisSeriesKeySet:function(e,n){var r=null,i=n.length;return t.query(e).each(function(e){var s=+e;if(isNaN(s))throw t.error.argumentInvalid("secondAxisSeriesIndexes","Element is not a number '{0}'.",[e]);if(s<0){if(s<=-i)throw t.error.argumentInvalid("secondAxisSeriesIndexes","Index is out of range '{0}'.",[s]);s=i+s}else if(s>=i)throw t.error.argumentInvalid("secondAxisSeriesIndexes","Index is out of range '{0}'.",[s]);r||(r={}),r[n[s]]=!0}),r},_dataPartGet:function(e,n){function f(f){s||(o=e(),s=i.data.dimensions("dataPart"),r.debug>=3&&o&&r.log("Second axis series values: "+JSON.stringify(t.keys(o))));var l=n(f);return t.hasOwn(o,l.key)?a||(a=s.intern("1")):u||(u=s.intern("0"))}var i=this;this.ensureDimensionType("dataPart");var s,o,u,a;return f}}),t.type("pvc.data.CrosstabTranslationOper",r.data.MatrixTranslationOper).init(function(e,t,n,r){this.base(e,t,n,r),this._separator=this.options.separator||"~",this._measureData()}).add({virtualItemSize:function(){return this.R+this.C+this.M},_executeCore:function(){function s(e,t){var s=r[e],o=0,u=i[e];while(u-->0)n[s++]=t[o++]}function o(e,t){var s=r.M,o=i._colGroupsIndexes[t],u=i.M;for(var a=0;a<u;a++){var f=o[a];n[s++]=f!=null?e[f]:null}}function u(r){return s("R",r),t.query(this._colGroups).select(function(t,i){return s("C",t),o(r,i),this._readItem(null,n,e)},this)}if(!this.metadata.length)return t.query();var e=this._getDimensionsReaders(),n=new Array(this.virtualItemSize()),r=this._itemCrossGroupIndex,i=this;return t.query(this._lines).selectMany(u,this)},_measureData:function(){var e=r.cloneMatrix(this.source);this._lines=e,this.R=1,this.C=1,this.M=1,this.measuresDirection=null;var i;this.options.seriesInRows?(i=this.metadata.map(function(e){return e.colName}),e.unshift(i),n.transpose(e),i=e.shift(),i.forEach(function(e,t){i[t]={v:e}})):this.options.compatVersion<=1?i=this.metadata.map(function(e){return{v:e.colName}}):i=this.metadata.map(function(e){return{v:e.colName,f:e.colLabel}});var s;if(!this.options.isMultiValued)s=t.get(this.options,"categoriesCount",1),this.R=s,this._colGroups=i.slice(this.R),this._colGroupsIndexes=new Array(this._colGroups.length),this._colGroups.forEach(function(e,t){this._colGroups[t]=[e],this._colGroupsIndexes[t]=[this.R+t]},this);else{var o=t.get(this.options,"measuresInColumns",!0);if(o||this.options.measuresIndex==null){s=t.get(this.options,"categoriesCount",1),this.R=s;var u=i.slice(this.R),a=u.length;a>0&&(o?(this.measuresDirection="columns",this._processEncodedColGroups(u)):(this._colGroups=u,this._colGroupsIndexes=[],this._colGroups.forEach(function(e,t){this._colGroups[t]=this._splitEncodedColGroupCell(e),this._colGroupsIndexes[t]=[this.R+t]},this)),this.C=this._colGroups[0].length)}else{this.measuresDirection="rows",this.R=+this.options.measuresIndex;var f=this.options.measuresCount;f==null&&(f=1),this.M=f,this._colGroups=i.slice(this.R+1),this._colGroups.forEach(function(e,t){this._colGroups[t]=[e]},this)}if(this.C===1&&!this._userUsedDims.dataPart){var l=this.options.secondAxisSeriesIndexes;if(l!=null){var c=this._colGroups.map(function(e){return""+e[0].v});this._axis2SeriesKeySet=this._createSecondAxisSeriesKeySet(l,c)}}}this._itemCrossGroupIndex={C:0,R:this.C,M:this.C+this.R},r.debug>=3&&r.log("Crosstab translator "+JSON.stringify({R:this.R,C:this.C,M:this.M}))},_splitEncodedColGroupCell:function(e){var t=e.v,n=e.f;return t==null?(t=[],n=undefined):(t=t.split(this._separator),n=n&&n.split(this._separator)),t.map(function(e,t){return{v:e,f:n&&n[t]}})},_processEncodedColGroups:function(e){var n=e.length||t.assert("Must have columns"),r=[],i,s={},o=[];for(var u=0;u<n;u++){var a=e[u],f=a.v,l=a.v.lastIndexOf(this._separator),c,h;if(l<0)c=f,f="",h=[];else{c=f.substring(l+1),f=f.substring(0,l),h=f.split(this._separator);var p;a.f!=null&&(p=a.f.split(this._separator),p.pop()),h.forEach(function(e,t){var n=p&&p[t];h[t]={v:e,f:n}})}!i||i.encValues!==f?(i={index:u,encValues:f,values:h,measureNames:[c]},r.push(i)):i.measureNames.push(c);var d=u-i.index,v=t.getOwn(s,c);v?d>v.groupIndex&&(v.groupIndex=d):(s[c]=v={name:c,groupIndex:d,index:u},o.push(v))}o.sort(function(e,n){return t.compare(e.groupIndex,n.groupIndex)||t.compare(e.index,n.index)}),o.forEach(function(e,t){e.groupIndex=t});var m=r.length,g=new Array(m),y=new Array(m),b=o.length,w=this.R;r.map(function(e,t){g[t]=e.values;var n=y[t]=new Array(b);e.measureNames.forEach(function(t,r){n[s[t].groupIndex]=w+e.index+r})}),this._colGroups=g,this._colGroupsIndexes=y,this.M=b},configureType:function(){function i(i,s,o,u){var a=e._itemCrossGroupIndex[s]+u;while(u>0){var f=r.data.DimensionType.dimensionGroupLevelName(i,o);if(!e._userUsedDims[f]){n=e._nextAvailableItemIndex(n);if(n>=a)return;e._userItem[n]=!0;var l=e._propGet(f,n);e._userDimsReaders.push(l),!t.hasOwn(e._userDimsReadersByDim,f)||t.assert("Dimension already being read."),e._userDimsReadersByDim[f]=l,u--}o++}}if(this.measuresDirection==="rows")throw t.error.notImplemented();var e=this,n=0;this.C>0&&i("series","C",0,this.C),this.R>0&&i("category","R",0,this.R),this._userUsedDims.value||i("value","M",0,this.M);if(this._axis2SeriesKeySet){var s=this._userDimsReadersByDim.series;if(s){var o=t.fun.constant(this._axis2SeriesKeySet);s=this._filterDimensionReader(s,"series"),this._userDimsReaders.push(this._dataPartGet(o,s))}}}}),t.type("pvc.data.RelationalTranslationOper",r.data.MatrixTranslationOper).add({configureType:function(){function n(n,r){e._userDimsReaders.push(n),r&&(!t.hasOwn(e._userDimsReadersByDim,r)||t.assert("Dimension already being read."),e._userDimsReadersByDim[r]=n)}var e=this,i=this.metadata.length,s=i-this._userUsedIndexesCount;if(s>0){var o;!this._userUsedDims.value&&this.options.isMultiValued&&(o=this.options.measuresIndexes)!=null&&(this.defReader({names:"value",indexes:o}),s=i-this._userUsedIndexesCount);if(s>0){var u,a=this.options.seriesInRows?["value","series","category"]:["value","category","series"];a=a.filter(function(e){return!this._userUsedDims[e]},this).slice(0,s),s-=a.length;if(s>0){var f=t.get(this.options,"categoriesCount",1);if(f>1){var c=a.indexOf("category");c<0?this.options.seriesInRows?c=a.length:c=a.indexOf("value")+1:c++;var h=1;while(h<f)u=r.data.DimensionType.dimensionGroupLevelName("category",h++),this._userUsedDims[u]||t.array.insertAt(a,c++,u)}}var p=0;while(a.length&&(u=a.pop()))p=this._nextAvailableItemIndex(p),this._userItem[p]=!0,n(this._propGet(u,p),u),p++}}var d=this.options.secondAxisSeriesIndexes;if(d!=null){var v=this._userDimsReadersByDim.series;v&&n(l.call(this,d,v))}}}),t.type("pvc.data.Atom").init(function(e,n,r,i,s){this.dimension=e,this.id=n==null?0:t.nextId(),this.value=n,this.label=r,this.rawValue=i,this.key=s,this.globalKey=e.name+":"+s}).add({toString:function(){return this.label}});var p=1;t.type("pvc.data.Complex").init(function(e,n,i,s){this.id=p++;var o;e&&(o=e.owner,i||(i=e.atoms)),this.owner=o||this,this.atoms=i?Object.create(i):{};if(!n)this.value=null,this.key="",s&&(this.label="");else{var u=r.debug>=6,a=this.atoms,f=0,l,c,h=n.length;for(c=0;c<h;c++){var d=n[c]||t.fail.argumentRequired("atom"),v=d.value;if(v!=null){var m=d.dimension.name;if(!i||d!==i[m]){if(u){if(d.dimension!==o.dimensions(m))throw t.error.operationInvalid("Invalid atom dimension '{0}'.",[m]);if(t.hasOwnProp.call(a,m))throw t.error.operationInvalid("An atom of the same dimension has already been added '{0}'.",[m])}f++,a[m]=d,f===1&&(l=d)}}}if(f===1)this.value=l.value,this.key=l.globalKey,s&&(this.label=l.label);else{var g=o.type._dimsNames,y,b,w,E=o.labelSep;h=g.length;for(c=0;c<h;c++){var S=g[c];if(t.hasOwnProp.call(a,S)){var d=a[S];c?y+=","+d.globalKey:y=d.globalKey,s&&(b?b+=E+d.label:b=d.label)}}this.value=this.key=y,s&&(this.label=b)}}}).add({labelSep:" ~ ",label:null,ensureLabel:function(){var e=this.label;if(e!=null){e="";var n=this.owner.labelSep;t.eachOwn(this.atoms,function(t){var r=t.label;r&&(e?e+=n+r:e=r)}),this.label=e}return e},view:function(e){return new r.data.ComplexView(this,e)},toString:function(){var e=[""+this.constructor.typeName];return this.index!=null&&e.push("#"+this.index),this.owner.type.dimensionsNames().forEach(function(t){e.push(t+": "+JSON.stringify(this.atoms[t].value))},this),e.join(" ")}}),t.type("pvc.data.ComplexView",r.data.Complex).init(function(e,n){this.source=e;var r=this.viewDimNames=[],i=e.atoms,s=[];n.forEach(function(e){t.hasOwnProp.call(i,e)&&(s.push(i[e]),r.push(e))}),this.base(e,s,e.owner.atoms,!0)}).add({values:function(){return this.viewDimNames.map(function(e){return this.atoms[e].value},this)}}),t.type("pvc.data.Datum",r.data.Complex).init(function(e,t,n){this.base(e.owner,t,e.atoms),n&&(this.isNull=!0)}).add({isSelected:!1,isVisible:!0,isNull:!1,setSelected:function(e){if(this.isNull)return!1;e=e==null||!!e;var t=this.isSelected!==e;return t&&(e?this.isSelected=!0:delete this.isSelected,B.call(this.owner,this,e)),t},toggleSelected:function(){return this.setSelected(!this.isSelected)},setVisible:function(e){if(this.isNull)return!1;e=e==null||!!e;var t=this.isVisible!==e;return t&&(this.isVisible=e,j.call(this.owner,this,e)),t},toggleVisible:function(){return this.setVisible(!this.isVisible)}}),t.type("pvc.data.Dimension").init(function(e,n){this.data=e,this.type=n,this.root=this,this.owner=this;var r=n.name;this.name=r,this._atomComparer=n.atomComparer(),this._atomsByKey={};if(e.isOwner())this._atoms=[],g.call(this);else{var i=e.parent,s;i?(s=i._dimensions[r],E.call(s,this),this.root=e.parent.root):(i=e.linkParent,i||t.assert("Data must have a linkParent"),s=i._dimensions[r],x.call(s,this)),this._nullAtom=this.owner._nullAtom,this._lazyInit=function(){this._lazyInit=null;var e=this.data._datums,n=e.length,i=this._atomsByKey;for(var o=0;o<n;o++){var u=e[o].atoms[r];i[u.key]=u}this._atoms=s.atoms().filter(function(e){return t.hasOwnProp.call(i,e.key)})}}}).add({parent:null,linkParent:null,_children:null,_linkChildren:null,_atomsByKey:null,_atomVisibleDatumsCount:null,_disposed:!1,_nullAtom:null,_virtualNullAtom:null,_visibleAtoms:null,_visibleIndexes:null,_atomComparer:null,_atoms:null,_sumCache:null,count:function(){return this._lazyInit&&this._lazyInit(),this._atoms.length},isVisible:function(e){return this._lazyInit&&this._lazyInit(),t.hasOwn(this._atomsByKey,e.key)||t.assert("Atom must exist in this dimension."),C.call(this)[e.key]>0},atoms:function(e){this._lazyInit&&this._lazyInit();var n=t.get(e,"visible");return n==null?this._atoms:(n=!!n,this._visibleAtoms||(this._visibleAtoms={}),this._visibleAtoms[n]||(this._visibleAtoms[n]=L.call(this,n)))},indexes:function(e){this._lazyInit&&this._lazyInit();var r=t.get(e,"visible");return r==null?n.range(0,this._atoms.length):(r=!!r,this._visibleIndexes||(this._visibleIndexes={}),this._visibleIndexes[r]||(this._visibleIndexes[r]=k.call(this,r)))},atom:function(e){if(e==null||e==="")return this._nullAtom;if(e instanceof r.data.Atom)return e;this._lazyInit&&this._lazyInit();var t=this.type._key?this.type._key.call(null,e):e;return this._atomsByKey[t]||null},extent:function(e){var t=this.atoms(e),n=t.length;if(!n)return undefined;var r=this._nullAtom&&t[0].value==null?1:0;return n>r?{min:t[r],max:t[n-1]}:undefined},min:function(e){var t=this.atoms(e),n=t.length;if(!n)return undefined;var r=this._nullAtom&&t[0].value==null?1:0;return n>r?t[r]:undefined},max:function(e){var t=this.atoms(e),n=t.length;return n&&t[n-1].value!=null?t[n-1]:undefined},sum:function(e){var n=!!t.get(e,"abs",!1),r=t.get(e,"zeroIfNone",!0),i=v(e)+":"+n,s=t.getOwn(this._sumCache,i);if(s===undefined){var o=this.name;s=this.data.datums(null,e).reduce(function(e,t){var r=t.atoms[o].value;return n&&r<0&&(r=-r),e!=null?e+r:r},null),(this._sumCache||(this._sumCache={}))[i]=s}return r?s||0:s},percent:function(e,n){var i=e instanceof r.data.Atom?e.value:e;if(!i)return 0;var s=this.sum(t.create(n,{abs:!0}));return s?Math.abs(i)/s:0},percentOverParent:function(e){var t=this.sum(e);if(!t)return 0;var n=this.data.parent;if(!n)return 0;var r=n.dimensionsSumAbs(this.name,e);return r?Math.abs(t)/r:0},format:function(e,t){return""+(this.type._formatter?this.type._formatter.call(null,e,t):"")},intern:function(e){this.owner===this||t.assert("Can only internalize on an owner dimension.");if(e==null||e==="")return this._nullAtom||m.call(this,e);var n=this.type,i,s;n._converter?i=n._converter.call(null,e):typeof e=="object"&&"v"in e?(i=e.v,s=e.f):i=e;if(i==null||i==="")return this._nullAtom||m.call(this,e);if(n.cast){i=n.cast.call(null,i);if(i==null||i==="")return this._nullAtom||m.call(this)}var o=""+(n._key?n._key.call(null,i):i);o||t.fail.operationInvalid("Only a null value can have an empty key.");var u=this._atomsByKey[o];return u?u:(s==null&&(n._formatter?s=n._formatter.call(null,i,e):s=i),s=""+s,!s&&r.debug>=2&&r.log("Only the null value should have an empty label."),u=new r.data.Atom(this,i,s,e,o),t.array.insert(this._atoms,u,this._atomComparer),b.call(this),this._atomsByKey[o]=u,u)},dispose:function(){this._disposed||(i(this._children,"parent"),i(this._linkChildren,"linkParent"),this.parent&&S.call(this.parent,this),this.linkParent&&T.call(this.linkParent,this),b.call(this),this._lazyInit=null,this._atoms=this._nullAtom=this._virtualNullAtom=null,this._disposed=!0)}}),t.type("pvc.data.Data",r.data.Complex).init(function(e){e||t.fail.argumentRequired("keyArgs"),this._dimensions={},this._visibleDatums=new t.Map;var r,i,s,o=this.parent=e.parent||null;if(o)this.root=o.root,this.depth=o.depth+1,this.type=o.type,this._datums=e.datums||t.fail.argumentRequired("datums"),r=o.owner,i=e.atoms||t.fail.argumentRequired("atoms"),s=o.atoms;else{this.root=this;var u=e.linkParent||null;u?(r=u.owner,this.type=r.type,this._datums=e.datums||u._datums.slice(),this._leafs=[],s=u.atoms,P.call(u,this)):(r=this,s={},e.labelSep&&(this.labelSep=e.labelSep),this.type=e.type||t.fail.argumentRequired("type"),this._selectedDatums=new t.Map)}F.call(this),this.owner=r,this._atomsBase=s,this.type.dimensionsList().forEach(this._initDimension,this),this.base(r,i,s,!0),n.Dom.Node.call(this,null),delete this.nodeValue,this._children=this.childNodes,o?(D.call(o,this),o.absLabel?this.absLabel=t.string.join(r.labelSep,o.absLabel,this.label):this.absLabel=this.label,o.absKey?this.absKey=t.string.join(",",o.absKey,this.key):this.absKey=this.key):(this.absLabel=this.label,this.absKey=this.key)}).add(n.Dom.Node).add({parent:null,linkParent:null,_dimensions:null,_freeDimensionNames:null,_children:null,_linkChildren:null,_leafs:null,_childrenByKey:null,_childrenKeyDimName:null,_visibleDatums:null,_selectedDatums:null,_groupByCache:null,_sumAbsCache:null,treeHeight:null,_datums:null,_datumsById:null,depth:0,label:"",absLabel:"",_disposed:!1,_isFlattenGroup:!1,_initDimension:function(e){this._dimensions[e.name]=new r.data.Dimension(this,e)},dimensions:function(e,n){if(e==null)return this._dimensions;var r=t.getOwn(this._dimensions,e);if(!r&&t.get(n,"assertExists",!0))throw t.error.argumentInvalid("name","Undefined dimension '{0}'.",[e]);return r},freeDimensionNames:function(){if(!this._freeDimensionNames){var e=this._freeDimensionNames=[];t.eachOwn(this._dimensions,function(t,n){var i=this.atoms[n];(!(i instanceof r.data.Atom)||i.value==null)&&e.push(n)},this)}return this._freeDimensionNames},isOwner:function(){return this.owner===this},children:function(e){if(!this._children)return t.query();var n=t.get(e,"key");if(n!=null){var r=t.getOwn(this._childrenByKey,n);if(!r&&t.get(e,"assertExists",!0))throw t.error.argumentInvalid("Undefined child data with key '{0}'.",[n]);return r}return t.query(this._children)},childCount:function(){return this._children?this._children.length:0},leafs:function(){return t.query(this._leafs)},dispose:function(){this._disposed||(A.call(this),t.eachOwn(this._dimensions,function(e){e.dispose()}),this.parent&&(this.parent.removeChild(this),this.parent=null),this.linkParent&&H.call(this.linkParent,this),this._disposed=!0)}}),r.data.Data.add({load:function(e,n){O.call(this);var r=t.get(n,"where"),i=t.get(n,"isNull"),s=!!this._datums;s?(A.call(this),this._datums=_.call(this,e,r,i)):this._datums=M.call(this,e,r,i),F.call(this),s&&t.eachOwn(this._dimensions,function(e){w.call(e)}),this._leafs=this._datums}}),r.data.Data.add({selectedCount:function(){return this.isOwner()?this._selectedDatums.count:this.datums(null,{selected:!0}).count()},selectedDatums:function(){return this.isOwner()?this._selectedDatums.values():this.datums(null,{selected:!0}).array()},visibleCount:function(){return this._visibleDatums.count},clearSelected:function(e){O.call(this);if(!this._selectedDatums.count)return!1;var t;return e?(t=!1,this._selectedDatums.values().filter(e).forEach(function(e){t=!0,d.call(e),this._selectedDatums.rem(e.id)},this)):(t=!0,this._selectedDatums.values().forEach(function(e){d.call(e)}),this._selectedDatums.clear()),t}}),r.data.Data.setSelected=function(e,n){var r=!1;return e&&t.query(e).each(function(e){e.setSelected(n)&&(r=!0)}),r},r.data.Data.toggleSelected=function(e){t.array.isLike(e)||(e=t.query(e).array());var n=t.query(e).all(function(e){return e.isNull||e.isSelected});return this.setSelected(e,!n)},r.data.Data.setVisible=function(e,n){var r=!1;return e&&t.query(e).each(function(e){e.setVisible(n)&&(r=!0)}),r},r.data.Data.toggleVisible=function(e){t.array.isLike(e)||(e=t.query(e).array());var n=t.query(e).all(function(e){return e.isVisible});return r.data.Data.setVisible(e,!n)},t.type("pvc.data.GroupingSpec").init(function(e,n,r){this.type=n||null;var i=[];this.hasCompositeLevels=!1,this.levels=t.query(e||undefined).where(function(e){return e.dimensions.length>0}).select(function(e){return i.push(e.id),!this.hasCompositeLevels&&e.dimensions.length>1&&(this.hasCompositeLevels=!0),e},this).array(),this.depth=this.levels.length,this.isSingleLevel=this.depth===1,this.isSingleDimension=this.isSingleLevel&&!this.hasCompositeLevels,this.firstDimension=this.depth>0?this.levels[0].dimensions[0]:null,this.flatteningMode=t.get(r,"flatteningMode")||null,this.flattenRootLabel=t.get(r,"flattenRootLabel")||"",this.id=(this.flatteningMode||"")+"##"+this.flattenRootLabel+"##"+i.join("||")}).add({bind:function(e){this.type=e||t.fail.argumentRequired("type"),this.dimensions().each(function(t){t.bind(e)})},dimensions:function(){return t.query(this.levels).selectMany(function(e){return e.dimensions})},dimensionNames:function(){return this._dimNames||(this._dimNames=this.dimensions().select(function(e){return e.name}).array()),this._dimNames},view:function(e){return e.view(this.dimensionNames())},isDiscrete:function(){return!this.isSingleDimension||this.firstDimension.type.isDiscrete},isNull:function(){return!this.levels.length},ensure:function(e){var n=this,i=t.get(e,"flatteningMode");if(i){if(i==="singleLevel")return n.singleLevelGrouping(e);var s=t.get(e,"flattenRootLabel")||"";if(this.flatteningMode!==i||this.flattenRootLabel!==s)n=new r.data.GroupingSpec(n.levels,n.type,{flatteningMode:i,flattenRootLabel:s})}return t.get(e,"reverse",!1)&&(n=n.reversed()),n},singleLevelGrouping:function(e){var n=!!t.get(e,"reverse",!1);if(this.isSingleLevel&&!n)return this;this._singleLevelGrouping||(this._singleLevelGrouping={});var i=this._singleLevelGrouping[n];if(!i){var s=this.dimensions().select(function(e){return n?new r.data.GroupingDimensionSpec(e.name,!e.reverse,e.type.complexType):e}),o=new r.data.GroupingLevelSpec(s);i=new r.data.GroupingSpec([o],this.type,{flatteningMode:this.flatteningMode}),this._singleLevelGrouping[n]=i}return i},reversed:function(){var e=this._reverseGrouping;if(!e){var n=t.query(this.levels).select(function(e){var n=t.query(e.dimensions).select(function(e){return new r.data.GroupingDimensionSpec(e.name,!e.reverse,e.type.complexType)});return new r.data.GroupingLevelSpec(n)});e=new r.data.GroupingSpec(n,this.type,{flatteningMode:this.flatteningMode}),this._reverseGrouping=e}return e},toString:function(){return t.query(this.levels).select(function(e){return""+e}).array().join(", ")}}),t.type("pvc.data.GroupingLevelSpec").init(function(e){var n=[];this.dimensions=t.query(e).select(function(e){return n.push(e.id),e}).array(),this.id=n.join(","),this.depth=this.dimensions.length;var r=this;this.comparer=function(e,t){return r.compare(e,t)}}).add({compare:function(e,t){for(var n=0,r=this.depth;n<r;n++){var i=this.dimensions[n].compareDatums(e,t);if(i!==0)return i}return 0},key:function(e){var t=[],n=[],r=e.atoms,i=this.dimensions;for(var s=0,o=this.depth;s<o;s++){var u=r[i[s].name];n.push(u),t.push(u.globalKey)}return{key:t.join(","),atoms:n}},toString:function(){return t.query(this.dimensions).select(function(e){return""+e}).array().join("|")}}),t.type("pvc.data.GroupingDimensionSpec").init(function(e,t,n){this.name=e,this.reverse=!!t,this.id=this.name+":"+(this.reverse?"0":"1"),n&&this.bind(n)}).add({type:null,comparer:null,bind:function(e){e||t.fail.argumentRequired("type"),this.type=e.dimensions(this.name),this.comparer=this.type.atomComparer(this.reverse)},compareDatums:function(e,t){var n=this.comparer(e.atoms[this.name],t.atoms[this.name]);return n!==0?n:0},toString:function(){return this.name+(this.reverse?" desc":"")}}),r.data.GroupingSpec.parse=function(e,n){if(!e)return new r.data.GroupingSpec(null,n);var i;t.array.is(e)?i=e:t.string.is(e)&&(i=e.split(/\s*,\s*/));var s=t.query(i).select(function(e){var t=U(e,n);return new r.data.GroupingLevelSpec(t)});return new r.data.GroupingSpec(s,n)};var R=/^\s*(.+?)(?:\s+(asc|desc))?\s*$/i;t.type("pvc.data.DataOper").init(function(e,t){this._linkParent=e}).add({key:null,execute:t.method({isAbstract:!0})}),t.type("pvc.data.GroupingOper",r.data.DataOper).init(function(e,n,i){n||t.fail.argumentRequired("groupingSpecs"),this.base(e,i),this._where=t.get(i,"where"),this._visible=t.get(i,"visible",null),this._selected=t.get(i,"selected",null),this._isNull=t.get(i,"isNull",null);var s=this._selected==null,o="";this._where&&(o=t.get(i,"whereKey"),o||(!i||o===null?s=!1:(o=""+t.nextId("dataOperWhereKey"),i.whereKey=o)));var u=[];this._groupSpecs=t.array.as(n).map(function(n){if(n instanceof r.data.GroupingSpec){if(n.type!==e.type)throw t.error.argumentInvalid("groupingSpecText","Invalid associated complex type.")}else n=r.data.GroupingSpec.parse(n,e.type);return u.push(n.id),n}),s&&(this.key=u.join("!!")+"||visible:"+this._visible+"||isNull:"+this._isNull+"||where:"+o)}).add({execute:function(){var e=W(t.query(this._linkParent._datums),{visible:this._visible,selected:this._selected,isNull:this._isNull,where:this._where}),n=this._group(e);return this._generateData(n,this._linkParent)},_group:function(e){var n={isRoot:!0,treeHeight:t.query(this._groupSpecs).select(function(e){var t=e.levels.length;return t?e.flatteningMode?1:t:0}).reduce(t.add,0),datums:[]};return n.treeHeight>0&&this._groupSpecRecursive(n,e,0),n},_groupSpecRecursive:function(e,n,r){function h(n,r,i){var c=s[i],p=[],d=[],v=[],m={};f||(n.children=[],n.childrenKeyDimName=c.dimensions[0].name),t.query(r).each(function(e){var n=c.key(e);if(n!=null){var r=n.key,i=m[r];if(i)i.push(e);else{i=m[r]=[e],n.datums=i;var s=t.array.insert(d,e,c.comparer);t.array.insertAt(v,~s,n)}}},this);var g=i===o-1;v.forEach(function(r){var s=Object.create(r);s.datums=a&&g?r.datums:[];var o;if(!f)n.children.push(s);else{s.atoms=n.atoms.concat(s.atoms),o=t.query(s.atoms).where(function(e){return e.value!=null}).select(function(e){return e.globalKey}).array().join(",");if(t.hasOwn(e.childrenByKey,o)){p.push({datums:r.datums});return}l||(e.children.push(s),e.childrenByKey[o]=s,n.isFlattenGroup=!0)}g?a||this._groupSpecRecursive(s,r.datums,u):h.call(this,s,r.datums,i+1),p.push(s),f&&l&&(e.children.push(s),e.childrenByKey[o]=s,n.isFlattenGroup=!0)},this);var y=f&&!a;return r=y?[]:n.datums,p.forEach(function(e){t.array.append(r,e.datums)}),y&&this._groupSpecRecursive(n,r,u),p}var i=this._groupSpecs[r],s=i.levels,o=s.length,u=r+1,a=!(u<this._groupSpecs.length),f=!!i.flatteningMode,l=f&&i.flatteningMode==="tree-post",c;o||t.fail.operationInvalid("Must have levels"),f?(e.children=[],e.childrenByKey={},c={key:"",atoms:[],datums:[],label:i.flattenRootLabel},l||(e.children.push(c),e.childrenByKey[""]=c)):c=e,h.call(this,c,n,0),f&&(l&&e.children.push(c),e.datums=c.datums)},_generateData:function(e,t){var n;e.isRoot?(n=new r.data.Data({linkParent:t,datums:e.datums}),n.treeHeight=e.treeHeight):n=new r.data.Data({parent:t,atoms:e.atoms,datums:e.datums});if(e.isFlattenGroup){n._isFlattenGroup=!0;var i=e.label;i&&(n.label+=i,n.absLabel+=i)}var s=e.children;if(s&&s.length)n._childrenKeyDimName=e.childrenKeyDimName,s.forEach(function(e){this._generateData(e,n)},this);else if(!e.isRoot){var o=n.root._leafs;n.leafIndex=o.length,o.push(n)}return n}}),r.data.Data.add({count:function(){return this._datums.length},groupBy:function(e,t){var n=new r.data.GroupingOper(this,e,t),i=n.key,s,o;return i&&(s=this._groupByCache,o=s&&s[i]),o?r.debug>=7&&r.log("[GroupBy] Cache key hit '"+i+"'"):(r.debug>=7&&r.log("[GroupBy] "+(i?"Cache key not found: '"+i+"'":"No Cache key")),o=n.execute(),i&&((s||(this._groupByCache={}))[i]=o)),o},flattenBy:function(e,n){var r=e.flattenedGrouping(n)||t.fail.operationInvalid("Role is unbound.");return this.groupBy(r,n)},where:function(e,t){var n=this.datums(e,t).array();return new r.data.Data({linkParent:this,datums:n})},datums:function(e,n){return e?(e=z.call(this,e,n),X.call(this,e,n)):W(t.query(this._datums),n)},datum:function(e,n){e||t.fail.argumentRequired("whereSpec"),e=z.call(this,e,n);var i=X.call(this,e,n).first()||null;if(!i&&t.get(n,"createNull")&&e.length){var s=e[0],o=[];for(var u in this._dimensions){var a=s[u];a&&o.push(a[0])}i=new r.data.Datum(this,o,!0)}return i},firstDatum:function(){return this._datums.length?this._datums[0]:null},dimensionsSumAbs:function(e,n){var r=e+":"+v(n),i=t.getOwn(this._sumAbsCache,r);return i==null&&(i=this.children().where(function(e){return!e._isFlattenGroup}).select(function(t){return Math.abs(t.dimensions(e).sum(n))},this).reduce(t.add,0),(this._sumAbsCache||(this._sumAbsCache={}))[r]=i),i}}),r.data.Data.add({getInfo:function(){var e=["\n------------------------------------------"];return e.push("Dataset Information"),t.eachOwn(this.dimensions(),function(t,n){var r=t.count(),i=t.type,s=[];s.push(i.valueTypeName),i.isComparable&&s.push("comparable"),i.isDiscrete||s.push("continuous"),i.isHidden&&s.push("hidden"),e.push("  "+n+" ("+s.join(", ")+")"+" ("+r+")\n	"+t.atoms().slice(0,10).map(function(e){return e.label}).join(", ")+(r>10?"...":""))}),e.push("------------------------------------------"),e.join("\n")},getValues:function(){return n.range(0,this.getCategoriesSize()).map(function(e){return this._getValuesForCategoryIndex(e)},this)},_getDimensionValues:function(e){return this.dimensions(e).atoms().map(function(e){return e.value})},_getDimensionVisibleValues:function(e){return this.dimensions(e).atoms({visible:!0}).map(function(e){return e.value})},getSeries:function(){return this._getDimensionValues("series")},getVisibleSeriesIndexes:function(){return this.dimensions("series").indexes({visible:!0})},getVisibleCategoriesIndexes:function(){return this.dimensions("category").indexes({visible:!0})},getVisibleSeries:function(){return this._getDimensionVisibleValues("series")},getCategories:function(){return this._getDimensionValues("category")},getVisibleCategories:function(){return this._getDimensionVisibleValues("category")},_getValuesForCategoryIndex:function(e){var n=this.dimensions("category").atoms()[e],r=this.datums({category:n}).uniqueIndex(function(e){return e.atoms.series.key});return this.dimensions("series").atoms().map(function(e){var n=t.getOwn(r,e.key);return n?n.atoms.value.value:null})},getSeriesSize:function(){var e=this.dimensions("series",{assertExists:!1});return e?e.count():0},getCategoriesSize:function(){var e=this.dimensions("category",{assertExists:!1});return e?e.count():0}}),t.type("pvc.visual.Role").init(function(e,n){this.name=e,this.label=t.get(n,"label")||e,t.get(n,"isRequired",!1)&&(this.isRequired=!0),t.get(n,"autoCreateDimension",!1)&&(this.autoCreateDimension=!0);var r=t.get(n,"defaultDimensionName");r&&(this.defaultDimensionName=r);if(!r&&this.autoCreateDimension)throw t.error.argumentRequired("defaultDimensionName");var i,s=t.get(n,"requireIsDiscrete");s!=null&&(s||(i=!0));if(i!=null){i=t.get(n,"requireSingleDimension",!1);if(i){t.get(n,"isMeasure",!1)&&(this.isMeasure=!0,t.get(n,"isPercent",!1)&&(this.isPercent=!0));var o=t.get(n,"valueType",null);o!==this.valueType&&(this.valueType=o)}}i!==this.requireSingleDimension&&(this.requireSingleDimension=i),s!=this.requireIsDiscrete&&(this.requireIsDiscrete=!!s);var u=t.get(n,"flatteningMode");u&&u!=this.flatteningMode&&(this.flatteningMode=u)}).add({isRequired:!1,requireSingleDimension:!1,valueType:null,requireIsDiscrete:null,isMeasure:!1,isPercent:!1,defaultDimensionName:null,grouping:null,flatteningMode:"singleLevel",flattenRootLabel:"",autoCreateDimension:!1,isReversed:!1,label:null,firstDimensionName:function(){return this.grouping&&this.grouping.firstDimension.name},firstDimension:function(){return this.grouping&&this.grouping.firstDimension.type},setIsReversed:function(e){e?this.isReversed=!0:delete this.isReversed},setFlatteningMode:function(e){!e||e==="singleLevel"?delete this.flatteningMode:this.flatteningMode=e},setFlattenRootLabel:function(e){e?this.flattenRootLabel=e:delete this.flattenRootLabel},flatten:function(e,t){if(this.grouping)return e.flattenBy(this,t)},flattenedGrouping:function(e){var n=this.grouping;if(n)return e=t.setDefaults(e,"flatteningMode",this.flatteningMode,"flattenRootLabel",this.flattenRootLabel),n.ensure(e)},select:function(e,t){var n=this.grouping;if(n)return e.groupBy(n.ensure(t),t)},view:function(e){var t=this.grouping;if(t)return t.view(e)},preBind:function(e){return this.__grouping=e,this},isPreBound:function(){return!!this.__grouping},isBound:function(){return!!this.grouping},postBind:function(e){var t=this.__grouping;return t&&(delete this.__grouping,t.bind(e),this.bind(t)),this},bind:function(e){if(e)if(e.isNull())e=null;else{if(this.requireSingleDimension&&!e.isSingleDimension)throw t.error.operationInvalid("Role '{0}' only accepts a single dimension.",[this.name]);var n=this.valueType,i=this.requireIsDiscrete;e.dimensions().each(function(e){var s=e.type;if(n&&s.valueType!==n)throw t.error.operationInvalid("Role '{0}' cannot be bound to dimension '{1}'. \nIt only accepts dimensions of type '{2}' and not of type '{3}'.",[this.name,s.name,r.data.DimensionType.valueTypeName(n),s.valueTypeName]);if(i!=null&&s.isDiscrete!==i)throw t.error.operationInvalid("Role '{0}' cannot be bound to dimension '{1}'. \nIt only accepts {2} dimensions.",[this.name,s.name,i?"discrete":"continuous"])},this)}return this.grouping&&this.grouping.dimensions().each(function(e){e.type&&a.call(e.type,this)},this),this.grouping=e,this.grouping&&(this.isReversed&&(this.grouping=this.grouping.reversed()),this.grouping.dimensions().each(function(e){u.call(e.type,this)},this)),this}}),t.type("pvc.visual.Scene").init(function(e,i){r.debug>=4&&(this.id=t.nextId("scene")),this._renderId=0,this.renderState={},n.Dom.Node.call(this,null),this.parent=e||null,this.root=this;if(e){var s=t.get(i,"index",null);e.insertAt(this,s),this.root=e.root}else this._active=null,this._panel=t.get(i,"panel")||t.fail.argumentRequired("panel","Argument is required on root scene.");var o=t.get(i,"group",null),u;o?u=o._datums[0]:u=t.get(i,"datum"),this.datum=u||null,this.group=o;var a=u||o;this.atoms=a?a.atoms:null,this.vars=e?Object.create(e.vars):{}}).add(n.Dom.Node).add({datums:function(){return this.group?this.group.datums():this.datum?t.query(this.datum):t.query()},format:function(e){return t.format(e,this._formatScope,this)},_formatScope:function(e){if(e.charAt(0)==="#"){e=e.substr(1).split(".");if(e.length>2)throw t.error.operationInvalid("Scene format mask is invalid.");var n=this.atoms[e[0]];if(n){if(e.length>1)switch(e[1]){case"value":return n.value;case"label":break;default:throw t.error.operationInvalid("Scene format mask is invalid.")}return n}return null}return t.getPath(this.vars,e)},isRoot:function(){return this.root===this},panel:function(){return this.root._panel},chart:function(){return this.root._panel.chart},compatVersion:function(){return this.root._panel.compatVersion()},children:function(){return this.childNodes?t.query(this.childNodes):t.query()},anyInteraction:function(){return!!this.root._active||this.anySelected()},isActive:!1,setActive:function(e){this.isActive!==!!e&&K.call(this.root,this.isActive?null:this)},clearActive:function(){return K.call(this.root,null)},anyActive:function(){return!!this.root._active},active:function(){return this.root._active},activeSeries:function(){var e=this.active();return e&&e.vars.series.value},isActiveSeries:function(){if(this.isActive)return!0;var e;return(e=this.activeSeries())!=null&&e===this.vars.series.value},isSelected:function(){return this._selectedData().is},anySelected:function(){return this._selectedData().any},_selectedData:function(){return this.renderState._selectedData||(this.renderState._selectedData=this._createSelectedData())},_createSelectedData:function(){var e=this.panel().chart.data.owner.selectedCount()>0,t=e&&this.datums().any(function(e){return e.isSelected});return{any:e,is:t}}}),r.visual.ValueLabelVar=function(e,t){this.value=e,this.label=t},r.visual.ValueLabelVar.prototype.toString=function(){var e=this.label||this.value;return typeof e!="string"?""+e:e},t.type("pvc.visual.Sign").init(function(e,n,r){this.chart=e.chart,this.panel=e,this.pvMark=n,this.extensionId=t.get(r,"extensionId"),this.isActiveSeriesAware=!!this.chart.visualRoles("series",{assertExists:!1})&&t.get(r,"activeSeriesAware",!0),n.localProperty("_scene",Object).localProperty("group",Object),this.lockValue("_scene",function(e){return e}).lockValue("group",function(e){return e.group}).lockValue("datum",function(e){return e.datum}),n.sign=this,n.__buildInstance=n.buildInstance,n.buildInstance=this._dispatchBuildInstance}).postInit(function(e,t,n){this._addInteractive(n)}).add({_addInteractive:function(e){var n=this.panel,r=this.pvMark,i=this.chart.options;!t.get(e,"noTooltips",!1)&&i.showTooltips&&this.panel._addPropTooltip(r),this.selectable=!t.get(e,"noSelect",!1)&&i.selectable,this.hoverable=!t.get(e,"noHover",!1)&&i.hoverable,this.clickable=!t.get(e,"noClick",!1)&&n._shouldHandleClick(),this.doubleClickable=!t.get(e,"noDoubleClick",!1)&&i.doubleClickAction,this.interactive=this.selectable||this.hoverable;if(this.hoverable){var s,o;s="mouseover",o="mouseout",r.event(s,function(e){e.setActive(!0),(!n.topRoot.rubberBand||n.isAnimating())&&n._renderInteractive()}).event(o,function(e){e.clearActive()&&(!n.topRoot.rubberBand||n.isAnimating())&&n._renderInteractive()})}this.clickable&&n._addPropClick(r),this.doubleClickable&&n._addPropDoubleClick(r)},_dispatchBuildInstance:function(e){this.sign._buildInstance(this,e)},_buildInstance:function(e,t){this.pvInstance=t;var n=t.data;this.scene=n,J.call(n,e.renderId()),this.state={},e.__buildInstance.call(e,t)},intercept:function(e,n,r){typeof n!="function"&&(n=t.methodCaller(""+n));var i=this;return this.pvMark.intercept(e,function(e,t){var r=i._extFun,s=i._extArgs;i._extFun=e,i._extArgs=t;try{return n.apply(i,t)}finally{i._extFun=r,i._extArgs=s}},this._getExtension(e),r),this},delegate:function(e){var t;return this._extFun?(t=this._extFun.apply(this,this._extArgs),t===undefined&&(t=e)):t=e,t},hasDelegate:function(){return!!this._extFun},lockDimensions:function(){return this.pvMark.lock("left").lock("right").lock("top").lock("bottom").lock("width").lock("height"),this},lock:function(e,n){return typeof n!="function"?n=t.methodCaller(""+n,this):n=n.bind(this),this.lockValue(e,n)},lockValue:function(e,t){return this.pvMark.lock(e,t),this},optional:function(e,n){return typeof n!="function"?n=t.methodCaller(""+n,this):n=n.bind(this),this.optionalValue(e,n)},optionalValue:function(e,t){return this.pvMark[e](t),this},_getExtension:function(e){return this.panel._getExtension(this.extensionId,e)},_versionedExtFun:function(e,t,n){return t},color:function(e){var t=this.baseColor(e);return t===null?null:(this.interactive&&this.scene.anyInteraction()?t=this.interactiveColor(e,t):t=this.normalColor(e,t),t)},baseColor:function(e){var t=this.delegate();return t===undefined&&(t=this.defaultColor(e)),t},_initDefaultColorSceneScale:function(){var e=this.panel.defaultColorAxis();return e?e.sceneScale({nullToZero:!1}):t.fun.constant(r.defaultColor)},defaultColorSceneScale:function(){return this._defaultColorSceneScale||(defaultColorSceneScale=this._initDefaultColorSceneScale())},defaultColor:function(e){return this.defaultColorSceneScale()(this.scene)},normalColor:function(e,t){return t},interactiveColor:function(e,t){return t},dimColor:function(e,t){return r.toGrayScale(t,-0.3,null,null)}}),t.type("pvc.visual.Dot",r.visual.Sign).init(function(e,r,i){var s=r.add(n.Dot);this.base(e,s,i);if(!t.get(i,"freePosition",!1)){var o=e.isOrientationVertical()?"left":"bottom",u=e.anchorOrtho(o);this.lock(u,"y").lock(o,"x")}this.intercept("shape","shape").intercept("shapeRadius","radius").intercept("shapeSize","size").optionalValue("strokeDasharray",null).optionalValue("lineWidth",1.5).intercept("fillStyle","fillColor").intercept("strokeStyle","strokeColor")}).add({y:function(){return 0},x:function(){return 0},shape:function(){return this.delegate()},radius:function(){this.state.radius=this.delegate()},size:function(){var e=this.baseSize();return this.interactive&&this.scene.anyInteraction()?e=this.interactiveSize(e):e=this.normalSize(e),e},baseSize:function(){var e=this.state.radius;return e!=null?e*e:this.delegate(12)},normalSize:function(e){return e},interactiveSize:function(e){return this.scene.isActive?Math.max(e,5)*2.5:e},fillColor:function(){return this.color("fill")},strokeColor:function(){return this.color("stroke")},interactiveColor:function(e,t){var r=this.scene;if(r.isActive){if(e==="stroke")return t.brighter(1)}else if(r.anySelected()&&!r.isSelected()){if(this.isActiveSeriesAware&&r.isActiveSeries())return n.Color.names.darkgray.darker().darker();switch(e){case"fill":case"stroke":return this.dimColor(e,t)}}return this.base(e,t)}}),t.type("pvc.visual.Line",r.visual.Sign).init(function(e,r,i){var s=r.add(n.Line);this.base(e,s,i),this.lockValue("segmented",!0).lockValue("antialias",!0);if(!t.get(i,"freePosition",!1)){var o=e.isOrientationVertical()?"left":"bottom",u=e.anchorOrtho(o);this.lock(u,"y").lock(o,"x")}this.intercept("strokeStyle","strokeColor").intercept("lineWidth","strokeWidth")}).add({_addInteractive:function(e){e=t.setDefaults(e,"noHover",!0,"noTooltips",!0),this.base(e)},y:function(){return 0},x:function(){return 0},strokeWidth:function(){var e=this.baseStrokeWidth();return this.interactive&&this.scene.anyInteraction()?e=this.interactiveStrokeWidth(e):e=this.normalStrokeWidth(e),e},baseStrokeWidth:function(){return this.delegate(1.5)},normalStrokeWidth:function(e){return e},interactiveStrokeWidth:function(e){return this.isActiveSeriesAware&&this.scene.isActiveSeries()?Math.max(1,e)*2.5:e},strokeColor:function(){return this.color("stroke")},interactiveColor:function(e,t){var r=this.scene;if(r.anySelected()&&!r.isSelected()){if(this.isActiveSeriesAware&&r.isActiveSeries())return n.Color.names.darkgray.darker().darker();if(e==="stroke")return this.dimColor(e,t)}return this.base(e,t)}}),t.type("pvc.visual.Area",r.visual.Sign).init(function(e,r,i){var s=r.add(n.Area);this.base(e,s,i);var o=t.get(i,"antialias",!0),u=t.get(i,"segmented",!0);this.lockValue("segmented",u).lockValue("antialias",o);if(!t.get(i,"freePosition",!1)){var a=e.isOrientationVertical()?"left":"bottom",f=e.anchorOrtho(a),l=e.anchorOrthoLength(f);this.lock(a,"x").lock(f,"y").lock(l,"dy")}this.intercept("fillStyle","fillColor"),u&&o?this.lock("strokeStyle","fixAntialiasStrokeColor").lock("lineWidth","fixAntialiasStrokeWidth"):this.lockValue("strokeStyle",null).lockValue("lineWidth",0)}).add({_addInteractive:function(e){e=t.setDefaults(e,"noHover",!0,"noTooltips",!0),this.base(e)},x:function(){return 0},y:function(){return 0},dy:function(){return 0},fixAntialiasStrokeColor:function(){return this.pvMark.fillStyle()},fillColor:function(){return this.color("fill")},interactiveColor:function(e,t){return e==="fill"&&this.scene.anySelected()&&!this.scene.isSelected()?this.dimColor(e,t):this.base(e,t)},fixAntialiasStrokeWidth:function(){var e=this.pvMark.strokeStyle();return!e||e.a<1?1e-5:1}}),t.type("pvc.visual.Bar",r.visual.Sign).init(function(e,r,i){var s=r.add(n.Bar);this.base(e,s,i),this.normalStroke=t.get(i,"normalStroke",!1),this.intercept("fillStyle","fillColor").intercept("strokeStyle","strokeColor").intercept("lineWidth","strokeWidth")}).add({fillColor:function(){return this.color("fill")},strokeColor:function(){return this.color("stroke")},normalColor:function(e,t){return e==="stroke"&&!this.normalStroke?null:t},interactiveColor:function(e,t){var r=this.scene;if(e==="stroke"){if(r.isActive)return t.brighter(1.3).alpha(.7);if(!this.normalStroke)return null;if(r.anySelected()&&!r.isSelected())return this.isActiveSeriesAware&&r.isActiveSeries()?n.Color.names.darkgray.darker().darker():this.dimColor(e,t)}else if(e==="fill"){if(r.isActive)return t.brighter(.2).alpha(.8);if(r.anySelected()&&!r.isSelected())return this.isActiveSeriesAware&&r.isActiveSeries()?n.Color.names.darkgray.darker(2).alpha(.8):this.dimColor(e,t)}return this.base(e,t)},strokeWidth:function(){var e=this.baseStrokeWidth();return this.interactive&&this.scene.anyInteraction()?e=this.interactiveStrokeWidth(e):e=this.normalStrokeWidth(e),e},baseStrokeWidth:function(){var e=this.delegate();return e===undefined&&(e=this.defaultStrokeWidth()),e},defaultStrokeWidth:function(){return.5},normalStrokeWidth:function(e){return e},interactiveStrokeWidth:function(e){return this.scene.isActive?Math.max(1,e)*1.3:e}}),n.PieSlice=function(){n.Wedge.call(this)},n.PieSlice.prototype=n.extend(n.Wedge),n.PieSlice.prototype.midAngle=function(){var e=this.instance();return e.startAngle+e.angle/2},t.type("pvc.visual.PieSlice",r.visual.Sign).init(function(e,r,i){var s=r.add(n.PieSlice);this.base(e,s,i),this._activeOffsetRadius=t.get(i,"activeOffsetRadius",0),this._center=t.get(i,"center"),this.intercept("fillStyle","fillColor").intercept("strokeStyle","strokeColor").optionalValue("lineWidth",.6).intercept("angle","angle").lock("bottom","y").lock("left","x").lockValue("top",null).lockValue("right",null)}).add({angle:function(){return 0},x:function(){return this._center.x+this._offsetSlice("cos")},y:function(){return this._center.y-this._offsetSlice("sin")},_offsetSlice:function(e){var t=this._getOffsetRadius();return t!==0&&(t*=Math[e](this.pvMark.midAngle())),t},_getOffsetRadius:function(){var e=this.state.offsetRadius;return e==null&&(e=this.state.offsetRadius=this.offsetRadius()||0),e},fillColor:function(){return this.color("fill")},strokeColor:function(){return this.color("stroke")},defaultColor:function(e){return e==="stroke"?null:this.base(e)},interactiveColor:function(e,t){var n=this.scene;if(n.isActive)switch(e){case"fill":return t.brighter(.2).alpha(.8);case"stroke":return t.brighter(1.3).alpha(.7)}else if(n.anySelected()&&!n.isSelected())switch(e){case"fill":return this.dimColor(e,t)}return this.base(e,t)},offsetRadius:function(){var e=this.baseOffsetRadius();return this.interactive&&this.scene.anyInteraction()?e=this.interactiveOffsetRadius(e):e=this.normalOffsetRadius(e),e},baseOffsetRadius:function(){return 0},normalOffsetRadius:function(e){return e},interactiveOffsetRadius:function(e){return this.scene.isActive?e+this._activeOffsetRadius:e}}),t.type("pvc.visual.Rule",r.visual.Sign).init(function(e,t,r){var i=t.add(n.Rule);this.base(e,i,r),this.intercept("strokeStyle","strokeColor").intercept("lineWidth","strokeWidth")}).add({_addInteractive:function(e){e=t.setDefaults(e,"noHover",!0,"noSelect",!0,"noTooltips",!0,"noClick",!0,"noDoubleClick",!0),this.base(e)},strokeWidth:function(){var e=this.baseStrokeWidth();return this.interactive&&this.scene.anyInteraction()?e=this.interactiveStrokeWidth(e):e=this.normalStrokeWidth(e),e},baseStrokeWidth:function(){var e=this.delegate();return e===undefined&&(e=this.defaultStrokeWidth()),e},defaultStrokeWidth:function(){return 1},normalStrokeWidth:function(e){return e},interactiveStrokeWidth:function(e){return this.scene.isActive?Math.max(1,e)*2.2:e},strokeColor:function(){return this.color("stroke")},interactiveColor:function(e,t){var n=this.scene;return!n.isActive&&n.anySelected()&&!n.isSelected()?this.dimColor(e,t):this.base(e,t)}}),t.type("pvc.visual.Context").init(function(e,t,n){this.chart=e.chart,this.panel=e,G.call(this,t,n)}).add({isPinned:!1,pin:function(){return this.isPinned=!0,this},getV1Series:function(){var e;return this.scene.atoms&&(e=this.scene.atoms[this.panel._getV1DimName("series")])&&e.rawValue},getV1Category:function(){var e;return this.scene.atoms&&(e=this.scene.atoms[this.panel._getV1DimName("category")])&&e.rawValue},getV1Value:function(){var e;return this.scene.atoms&&(e=this.scene.atoms[this.panel._getV1DimName("value")])&&e.value}});var Y;return t.scope(function(){function e(e){return e.isDiscrete()?"Discrete":e.firstDimension.type.valueType===Date?"Timeseries":"Continuous"}t.type("pvc.visual.Axis").init(function(n,i,s,o,u){o||t.fail.argumentRequired("dataCells"),this.chart=n,this.type=i,this.index=s==null?0:s,this.dataCells=t.array.as(o),this.dataCell=this.dataCells[0],this.role=this.dataCell&&this.dataCell.role,this.scaleType=e(this.role.grouping),this.id=r.visual.Axis.getId(this.type,this.index),this.option=r.options(this._getOptionsDefinition(),this),this._checkRoleCompatibility(),this.setScale(t.get(u,"scale",null))}).add({isVisible:!0,setScale:function(e){return this.scale=e,e&&(e.type=this.scaleType),this},scaleType:function(){return e(this.role.grouping)},sceneScale:function(e){var n=t.get(e,"sceneVarName")||this.role.name,r=this.role.grouping;if(r.isSingleDimension&&r.firstDimension.type.valueType===Number){var i=this.scale,s=t.get(e,"nullToZero",!0),o=function(e){var t=e.vars[n].value;if(t==null){if(!s)return t;t=0}return i(t)};return t.copy(o,i),o}return this.scale.by1(function(e){return e.vars[n].value})},_getOptionsDefinition:function(){return Y},_checkRoleCompatibility:function(){var n=this.dataCells.length;if(n>1){var r=this.role.grouping,i;if(this.scaleType==="Discrete"){for(i=1;i<n;i++)if(r.id!==this.dataCells[i].role.grouping.id)throw t.error.operationInvalid("Discrete roles on the same axis must have equal groupings.")}else{if(!r.firstDimension.type.isComparable)throw t.error.operationInvalid("Continuous roles on the same axis must have 'comparable' groupings.");for(i=1;i<n;i++)if(this.scaleType!==e(this.dataCells[i].role.grouping))throw t.error.operationInvalid("Continuous roles on the same axis must have scales of the same type.")}}}}),r.visual.Axis.getId=function(e,t){return t===0?e:e+""+(t+1)},Y={}}),t.scope(function(){function i(e){return this.chart.options[e]}function s(e){return function(t){for(var n=0,r=e.length;n<r;n++)if(e[n].call(this,t)===!0)return!0}}function o(e){return a(e,"specify")}function u(e){return a(e,"defaultValue")}function a(e,t){return function(n){var r=e.call(n,this.name,this);if(r!==undefined)return this[t||"specify"](r),!0}}function p(e){return e!=null&&(e=+e,isNaN(e)&&(e=null)),e}var e=r.visual.Axis;t.type("pvc.visual.CartesianAxis",e).init(function(e,r,i,s,o){this.base(e,r,i,s,o);var u=e.options;this.orientation=n.getOrientation(this.type,u.orientation),this.orientedId=n.getOrientedId(this.orientation,this.index),this.v1OptionId=n.getV1OptionId(this.orientation,this.index),this.index!==1?this.isVisible=u["show"+t.firstUpperCase(this.orientedId)+"Scale"]:this.isVisible=!!u.secondAxisIndependentScale}).add({setScale:function(e){this.scale&&(delete this.domain,delete this.ticks,delete this._roundingPaddings),this.base(e);if(e&&!e.isNull&&this.scaleType!=="Discrete"){this.domain=e.domain();if(this.scaleType==="Continuous"){var t=this.option("DomainRoundMode");t==="nice"&&e.nice()}}return this},setTicks:function(e){var n=this.scale;n&&!n.isNull||t.fail.operationInvalid("Scale must be set and non-null."),this.ticks=e;if(n.type==="Continuous"&&this.option("DomainRoundMode")==="tick"){delete this._roundingPaddings;var r=e&&e.length;r?this.scale.domain(e[0],e[r-1]):this.scale.domain(this.domain[0],this.domain[1])}},setScaleRange:function(e){var n=this.scale;n.min=0,n.max=e,n.size=e;if(n.type==="Discrete"){if(n.domain().length>0){var i=this.chart.options.panelSizeRatio||.8;n.splitBandedCenter(n.min,n.max,i)}}else n.range(n.min,n.max);return r.debug>=4&&r.log("Scale: "+JSON.stringify(t.copyOwn(n))),n},getScaleRoundingPaddings:function(){var e=this._roundingPaddings;if(!e){e={begin:0,end:0};var n=this.scale,r;while(n&&!n.isNull&&n.type==="Continuous"&&(r=this.option("DomainRoundMode"))!=="none"){var i=n.domain(),s=this.domain||t.assert("Must be set"),o=i[1]-i[0];if(o){var u=s[0]-i[0];u>0&&(e.begin=u/o),u=i[1]-s[1],u>0&&(e.end=u/o)}break}this._roundingPaddings=e}return e},_getOptionsDefinition:function(){return h}});var n=r.visual.CartesianAxis;n.getOrientation=function(e,t){return e==="base"==(t==="vertical")?"x":"y"},n.getOrientedId=function(e,t){switch(t){case 0:return e;case 1:return"second"+e.toUpperCase()}return e+""+(t+1)},n.getV1OptionId=function(e,t){switch(t){case 0:return e;case 1:return"second"}return e+""+(t+1)},o.byId=o(function(e){return i.call(this,this.id+"Axis"+e)}),o.byV1OptionId=o(function(e){return i.call(this,this.v1OptionId+"Axis"+e)}),o.byCommonId=o(function(e){return i.call(this,"axis"+e)});var f=s([o.byId,o.byV1OptionId,o.byCommonId]),l={resolve:f},c={resolve:s([o.byId,o.byV1OptionId,o(function(e){if(!this.index&&this.type==="ortho")return i.call(this,this.id+e)}),o.byCommonId]),cast:p},h=t.create(Y,{Composite:{resolve:s([o(function(e){return this.index>0?!1:i.call(this,"useCompositeAxis")}),f]),cast:Boolean,value:!1},Size:{resolve:f,cast:p},SizeMax:l,Position:{resolve:s([f,u(function(e){if(this.index>0){var t=n.getV1OptionId(this.orientation,0),s=i.call(this,t+"Axis"+e)||"left";return r.BasePanel.oppositeAnchor[s]}})])},FixedMin:c,FixedMax:c,OriginIsZero:{resolve:s([f,o(function(e){switch(this.index){case 0:return i.call(this,"originIsZero");case 1:return i.call(this,"secondAxisOriginIsZero")}})]),cast:Boolean,value:!0},Offset:{resolve:s([o.byId,o.byV1OptionId,o(function(e){switch(this.index){case 0:return i.call(this,"axisOffset");case 1:return i.call(this,"secondAxisOffset")}})]),cast:p},LabelSpacingMin:{resolve:f,cast:p,value:1},OverlappedLabelsHide:{resolve:f,cast:Boolean,value:!1},OverlappedLabelsMaxPct:{resolve:f,cast:p,value:.2},FullGrid:{resolve:f,cast:Boolean,value:!1},FullGridCrossesMargin:{resolve:f,cast:Boolean,value:!0},EndLine:{resolve:f,cast:Boolean},ZeroLine:{resolve:f,cast:Boolean,value:!0},RuleCrossesMargin:{resolve:f,cast:Boolean,value:!0},DesiredTickCount:{resolve:f,cast:p},MinorTicks:{resolve:f,cast:Boolean,value:!0},DomainRoundMode:{resolve:f,cast:String,value:"none"},TickExponentMin:{resolve:f,cast:p},TickExponentMax:{resolve:f,cast:p},Title:{resolve:f,cast:String},TitleSize:{resolve:f,cast:p},TitleSizeMax:l,TitleFont:{resolve:f,cast:String},TitleMargins:l,TitlePaddings:l,TitleAlign:{resolve:f,cast:String},Font:{resolve:f,cast:String},ClickAction:l,DoubleClickAction:l})}),t.scope(function(){function i(e){return this.chart.options[e]}function s(e,t){return function(n){var r=e.call(n,this.name,this);if(r!==undefined)return this[t||"specify"](r),!0}}function o(e){return s.byOptionId.call(this,e)}function u(e,n){if(!t.object.is(e)){var i=this.option("Position");e=(new r.Size).setSize(e,{singleProp:r.BasePanel.orthogonalLength[i]})}return e}function a(e,t){var n=this.option("Position");return r.parseAlign(n,e)}function l(e){return e!=null&&(e=+e,isNaN(e)&&(e=null)),e}var e=r.visual.Axis;t.type("pvc.visual.ColorAxis",e).init(function(e,t,n,i,s){this.base(e,t,n,i,s),this.optionId=r.buildIndexedId("legend",this.index);var o=e.options,u;if(this.index===1){var a=o.secondAxisOwnColors;a==null&&(a=e.compatVersion()<=1),a&&(u=r.createColorScheme(o.secondAxisColor))}else u=r.createColorScheme(o.colors);this.hasOwnColors=!!u;if(!u){var f=e.axes.color;u=f?f.colorsFactory:null}this.colorsFactory=u;if(this.role.isBound()){var l=this.dataCell,c=e.partData(l.dataPartValues).flattenBy(l.role),h;if(!this.hasOwnColors){var f=e.axes.color;h=f?f.scale:null}if(!h){this.hasOwnColors=!0;var p=c.children().select(function(e){return e.value}).array();h=u(p)}this.setScale(h),this.domainData=c}this.isVisible=this.option("Visible")}).add({legendBulletGroupScene:null,_getOptionsDefinition:function(){return f},_getOptionByOptionId:function(e){return i.call(this,this.optionId+e)}});var n=r.visual.ColorAxis;s.byOptionId=s(n.prototype._getOptionByOptionId);var f=t.create(Y,{Visible:{resolve:o,cast:Boolean,value:!0},Position:{resolve:o,cast:r.parsePosition,value:"bottom"},Size:{resolve:o,cast:u},SizeMax:{resolve:o,cast:u},Align:{resolve:function(e){if(!s.byOptionId.call(this,e)){var t=this.option("Position"),n;t!=="top"&&t!=="bottom"?n="top":e.chart.compatVersion()<=1&&(n="left"),this.defaultValue(n)}},cast:a},Font:{resolve:o,cast:String},Margins:{resolve:function(e){if(!s.byOptionId.call(this,e)&&e.chart.compatVersion()>1){var n=this.option("Position"),i=t.set({},r.BasePanel.oppositeAnchor[n],5);this.defaultValue(i)}},cast:r.Sides.as},Paddings:{resolve:o,cast:r.Sides.as,value:5},Font:{resolve:o,cast:String,value:"10px sans-serif"},ClickMode:{resolve:o,cast:r.parseLegendClickMode,value:"toggleVisible"},DrawLine:{resolve:o,cast:Boolean,value:!1},DrawMarker:{resolve:o,cast:Boolean,value:!0},Shape:{resolve:o,cast:r.parseShape}})}),t.space("pvc.visual.legend",function(e){e.buildKey=function(e,t){return e+"|"+t.role.name+"|"+(t.dataPartValues!=null?t.dataPartValues:"")}}),t.type("pvc.visual.legend.BulletRootScene",r.visual.Scene).init(function(e,n){this.base(e,n);var i=t.get(n,"markerSize",15),s=(new r.Sides(t.get(n,"padding",5))).resolve(i,i);t.set(this.vars,"horizontal",t.get(n,"horizontal",!1),"font",t.get(n,"font"),"markerSize",i,"textMargin",t.get(n,"textMargin",6),"padding",s)}).add({layout:function(e){function v(e){var n=e.labelTextSize(),c=!n||!n.width||!n.height;e.isHidden=c;if(c)return;var h=0,p={width:s+n.width+h,height:Math.max(n.height,i)},d;l?d=!l.items.length:(l=new r.visual.legend.BulletItemSceneRow(0),d=!0);var v=l.size.width+p[u];d||(v+=o[u]),!d&&v>f&&(m(!1),v=p[u]);var g=l.size;g.width=v,g.height=Math.max(g.height,p[a]);var y=l.items.length;l.items.push(e),t.set(e.vars,"row",l,"rowIndex",y,"clientSize",p)}function m(e){var t=l.size;h.height+=t.height,c.length&&(h.height+=o[a]),h.width=Math.max(h.width,t.width),c.push(l),e||(l=new r.visual.legend.BulletItemSceneRow(c.length))}var n=e.clientSize;if(n.width>0&&n.height>0){var i=this.vars.markerSize,s=i+this.vars.textMargin,o=this.vars.padding,u=this.vars.horizontal?"width":"height",a=r.BasePanel.oppositeLength[u],f=n[u],l,c=[],h={width:0,height:0};this.childNodes.forEach(function(e){e.childNodes.forEach(v,this)},this);if(!l)return new r.Size(0,0);m(!0),t.set(this.vars,"rows",c,"rowCount",l,"size",h);var p=this.compatVersion()<=1,d=t.set({},u,p?n[u]:h.width,a,Math.min(h.height,n[a]));return d}return new r.Size(0,0)},defaultGroupSceneType:function(){var e=this._bulletGroupType;return e||(e=t.type(r.visual.legend.BulletGroupScene),this._bulletGroupType=e),e},createGroup:function(e){var t=this.defaultGroupSceneType();return new t(this,e)}}),t.type("pvc.visual.legend.BulletItemSceneRow").init(function(e){this.index=e,this.items=[],this.size={width:0,height:0}}),t.type("pvc.visual.legend.BulletGroupScene",r.visual.Scene).init(function(e,n){this.base(e,n),this.extensionPrefix=t.get(n,"extensionPrefix")||"legend",this._renderer=t.get(n,"renderer"),this.colorAxis=t.get(n,"colorAxis"),this.clickMode=t.get(n,"clickMode"),this.colorAxis&&!this.clickMode&&(this.clickMode=this.colorAxis.option("ClickMode"))}).add({hasRenderer:function(){return this._renderer},renderer:function(e){if(e!=null)this._renderer=e;else{e=this._renderer;if(!e){var t,n=this.colorAxis;n&&(t={drawRule:n.option("DrawLine"),drawMarker:n.option("DrawMarker"),markerShape:n.option("Shape")}),e=new r.visual.legend.BulletItemDefaultRenderer(t),this._renderer=e}}return e},itemSceneType:function(){var e=this._itemSceneType;if(!e){e=t.type(r.visual.legend.BulletItemScene);var n=this.clickMode;switch(n){case"toggleSelected":e.add(r.visual.legend.BulletItemSceneSelection);break;case"toggleVisible":e.add(r.visual.legend.BulletItemSceneVisibility)}this.panel()._extendSceneType("item",e,["isOn","isClickable","click"]),this._itemSceneType=e}return e},createItem:function(e){var t=this.itemSceneType();return new t(this,e)}}),t.type("pvc.visual.legend.BulletItemScene",r.visual.Scene).init(function(e,t){this.base(e,t);var n,i;t&&(n=t.value,i=t.label);if(n===undefined){var s=this.group||this.datum;s&&(n=s.value,i=s.ensureLabel())}this.vars.value=new r.visual.ValueLabelVar(n||null,i||"")}).add({isOn:function(){return!0},isClickable:function(){return!1},click:function(){},labelTextSize:function(){var e=this.vars.value;return e&&r.text.getTextSize(e.label,this.vars.font)}}),t.type("pvc.visual.legend.BulletItemSceneSelection").add({isOn:function(){var e=(this.group||this.datum).owner;return!e.selectedCount()||this.datums().any(function(e){return!e.isNull&&e.isSelected})},isClickable:function(){return this.chart().options.selectable},click:function(){var e=this.datums().array(),n=this.chart();e=n._onUserSelection(e);if(e){var i=t.query(e).any(function(e){return e.isSelected});r.data.Data.setSelected(e,!i)&&n.updateSelections()}}}),t.type("pvc.visual.legend.BulletItemSceneVisibility").add({isOn:function(){return this.datums().any(function(e){return!e.isNull&&e.isVisible})},isClickable:function(){return!0},click:function(){r.data.Data.toggleVisible(this.datums())&&this.chart().render(!0,!0,!1)}}),t.type("pvc.visual.legend.BulletItemRenderer"),t.type("pvc.visual.legend.BulletItemDefaultRenderer").init(function(e){this.drawRule=t.get(e,"drawRule",!1),this.drawRule&&(this.rulePvProto=t.get(e,"rulePvProto")),this.drawMarker=!this.drawRule||t.get(e,"drawMarker",!0),this.drawMarker&&(this.markerShape=t.get(e,"markerShape","square"),this.markerPvProto=t.get(e,"markerPvProto"))}).add({drawRule:!1,drawMarker:!0,markerShape:null,rulePvProto:null,markerPvProto:null,create:function(e,t){var r={},i=this.drawRule,s=function(e){return e.color};if(i){var o=(new n.Mark).left(0).top(function(){return this.parent.height()/2}).width(function(){return this.parent.width()}).lineWidth(1).strokeStyle(s);this.rulePvProto&&(o=this.rulePvProto.extend(o)),r.pvRule=t.add(n.Rule).extend(o)}if(this.drawMarker){var u=(new n.Mark).left(function(){return this.parent.width()/2}).top(function(){return this.parent.height()/2}).shapeSize(function(){return this.parent.width()}).lineWidth(2).fillStyle(s).strokeStyle(s).shape(this.markerShape).angle(i?0:Math.PI/2).antialias(function(){var e=Math.abs(Math.cos(this.angle()));if(e!==0&&e!==1)switch(this.shape()){case"square":case"bar":return!1}return!0});this.markerPvProto&&(u=this.markerPvProto.extend(u)),r.pvDot=t.add(n.Dot).extend(u)}return r},extendMarks:function(e,t,n){t.pvRule&&e.extend(t.pvRule,n+"Rule_"),t.pvDot&&e.extend(t.pvDot,n+"Dot_")}}),r.Abstract=Base.extend({invisibleLineWidth:.001,defaultLineWidth:1.5}),r.BaseChart=r.Abstract.extend({_disposed:!1,_updateSelectionSuspendCount:0,_selectionNeedsUpdate:!1,parent:null,root:null,axes:null,_axisType2RoleNamesMap:null,_visualRoles:null,_serRole:null,_dataPartRole:null,_measureVisualRoles:null,isPreRendered:!1,_createVersion:0,renderCallback:undefined,dataEngine:null,data:null,_partData:null,resultset:[],metadata:[],basePanel:null,titlePanel:null,legendPanel:null,_multiChartPanel:null,legendSource:"series",colors:null,secondAxisColor:null,multiChartPageCount:null,multiChartPageIndex:null,constructor:function(e){var n=this.parent=t.get(e,"parent")||null;if(r.debug>=3&&!n&&e)try{r.log("INITIAL OPTIONS:\n"+JSON.stringify(e))}catch(i){}n?(this.root=n.root,this.dataEngine=this.data=e.data||t.fail.argumentRequired("options.data"),this.left=e.left,this.top=e.top,this._visualRoles=n._visualRoles,this._measureVisualRoles=n._measureVisualRoles,n._serRole&&(this._serRole=n._serRole),n._dataPartRole&&(this._dataPartRole=n._dataPartRole)):(this.root=this,this._visualRoles={},this._measureVisualRoles=[]),this._axisType2RoleNamesMap={},this.axes={},this.options=t.mixin({},this.defaults,e)},compatVersion:function(){return this.options.compatVersion},_processOptions:function(){var e=this.options;this._processOptionsCore(e);if(r.debug>=3&&e&&!this.parent)try{r.log("CURRENT OPTIONS:\n"+JSON.stringify(e))}catch(t){}return e},_processOptionsCore:function(e){if(!$.support.svg||n.renderer()==="batik")e.animate=!1;if(e.showTooltips){var t=e.tipsySettings;t&&this.extend(t,"tooltip_")}},_preRender:function(e){var t=this.options;this._createVersion++,this.isPreRendered=!1,r.debug>=3&&r.log("Prerendering in pvc"),this._checkNoData(),this.parent||r.removeTipsyLegends(),this._processOptions(),!this.parent&&this._createVersion===1&&(this._initVisualRoles(),this._bindVisualRolesPre()),this._initData(e);var n=this._isRoleAssigned("multiChart");this._initAxes(n),this._initChartPanels(n),this.isPreRendered=!0},_checkNoData:function(){if(!this.parent&&!this.allowNoData&&this.resultset.length===0)throw new NoDataException},_initAxes:function(e){if(!this.parent){var t=this._axisType2RoleNamesMap.color;!t&&this.legendSource&&(t=this.legendSource,this._axisType2RoleNamesMap.color=t),t&&(this._createAxis("color",0),this.options.secondAxis&&this._createAxis("color",1))}else{var n=this.root,r=n.axes.color;r&&(this.axes.color=r,this.colors=n.colors),r=n.axes.color2,r&&(this.axes.color2=r,this.secondAxisColor=n.secondAxisColor)}},_createAxis:function(e,t){var n=this._getAxisDataCells(e,t),r=this._createAxisCore(e,t,n);return this.axes[r.id]=r,r},_getAxisDataCells:function(e,t){return this._buildAxisDataCells(e,t,null)},_buildAxisDataCells:function(e,n,r){return t.array.as(this._axisType2RoleNamesMap[e]).map(function(e){return{role:this.visualRoles(e),dataPartValues:r}},this)},_createAxisCore:function(e,n,i){switch(e){case"color":var s=new r.visual.ColorAxis(this,e,n,i);switch(n){case 0:this.colors=s.colorsFactory;break;case 1:this.options.secondAxisOwnColors&&(this.secondAxisColor=s.colorsFactory)}return s}throw t.error.operationInvalid("Invalid axis type '{0}'",[e])},_initChartPanels:function(e){this._initBasePanel(),this._initTitlePanel(),this._initLegendPanel(),!this.parent&&e?this._initMultiChartPanel():this._preRenderContent({margins:this.options.contentMargins,paddings:this.options.contentPaddings})},_preRenderContent:function(e){},_initData:function(e){if(!this.parent){var n=this.data;!n||t.get(e,"reloadData",!0)?this._onLoadData():(A.call(n),F.call(n))}delete this._partData,r.debug>=3&&r.log(this.data.getInfo())},_onLoadData:function(){var e=this.data,t=e?e.type:new r.data.ComplexType,n=this._createTranslationOptions(),i=this._createTranslation(t,n);i.configureType(),r.debug>=3&&r.log(t.describe()),this._bindVisualRoles(t),r.debug>=3&&this._logVisualRoles(),e||(e=this.dataEngine=this.data=new r.data.Data({type:t,labelSep:this.options.groupedLabelSep}));var s={where:this._getLoadFilter(),isNull:this._getIsNullDatum()};e.load(i.execute(e),s)},_getLoadFilter:function(){if(this.options.ignoreNulls)return function(e){var t=e.isNull;return t&&r.debug>=4&&r.log("Datum excluded."),!t}},_getIsNullDatum:function(){var e=this.measureDimensionsNames(),t=e.length;if(t)return function(n){var r=n.atoms;for(var i=0;i<t;i++)if(r[e[i]].value!=null)return!1;return!0}},_createTranslation:function(e,t){var n=t.crosstabMode?r.data.CrosstabTranslationOper:r.data.RelationalTranslationOper;return new n(e,this.resultset,this.metadata,t)},_createTranslationOptions:function(){var e=this.options,t=e.dataOptions||{},n;e.secondAxis&&(n=e.secondAxisSeriesIndexes,n===undefined&&(n=e.secondAxisIdx));var r=e.valueFormat,i;return r&&r!==this.defaults.valueFormat&&(i=function(e){return e!=null?r(e):""}),{compatVersion:e.compatVersion,secondAxisSeriesIndexes:n,seriesInRows:e.seriesInRows,crosstabMode:e.crosstabMode,isMultiValued:e.isMultiValued,dimensionGroups:e.dimensionGroups,dimensions:e.dimensions,readers:e.readers,measuresIndexes:e.measuresIndexes,multiChartIndexes:e.multiChartIndexes,separator:t.separator,measuresInColumns:t.measuresInColumns,measuresIndex:t.measuresIndex||t.measuresIdx,measuresCount:t.measuresCount||t.numMeasures,categoriesCount:t.categoriesCount,isCategoryTimeSeries:e.timeSeries,timeSeriesFormat:e.timeSeriesFormat,valueNumberFormatter:i}},_initVisualRoles:function(){this._addVisualRoles({multiChart:{defaultDimensionName:"multiChart*"}}),this._hasDataPartRole()&&(this._addVisualRoles({dataPart:{defaultDimensionName:"dataPart",requireSingleDimension:!0,requireIsDiscrete:!0}}),this._dataPartRole=this.visualRoles("dataPart"));var e=this._getSeriesRoleSpec();e&&(this._addVisualRoles({series:e}),this._serRole=this.visualRoles("series"))},_bindVisualRolesPre:function(){t.eachOwn(this._visualRoles,function(e){e.setIsReversed(!1)});var e={};t.each(this.options.visualRoles,function(n,i){var s=this._visualRoles[i]||t.fail.operationInvalid("Role '{0}' is not supported by the chart type.",[i]),o;n&&typeof n=="object"?(t.get(n,"isReversed",!1)&&s.setIsReversed(!0),o=n.dimensions):o=n;if(o!==undefined){var u=r.data.GroupingSpec.parse(o);s.preBind(u),u.dimensions().each(function(n){t.hasOwn(e,n.name)?delete e[n.name]:e[n.name]=s})}},this);var n=this.options.dimensions||(this.options.dimensions={});t.eachOwn(e,function(e,t){var r=n[t]||(n[t]={});e.valueType&&r.valueType===undefined&&(r.valueType=e.valueType,e.requireIsDiscrete!=null&&r.isDiscrete===undefined&&(r.isDiscrete=e.requireIsDiscrete)),r.label===undefined&&(r.label=e.label)},this)},_hasDataPartRole:function(){return!1},_getSeriesRoleSpec:function(){return null},_addVisualRoles:function(e){t.eachOwn(e,function(e,t){var n=new r.visual.Role(t,e);this._visualRoles[t]=n,n.isMeasure&&this._measureVisualRoles.push(n)},this)},_bindVisualRoles:function(e){function i(i,s){i.bind(r.data.GroupingSpec.parse(s,e)),t.array.as(s).forEach(function(e){n[e]=!0})}var n={};t.eachOwn(this._visualRoles,function(t,r){t.isPreBound()&&(t.postBind(e),t.grouping&&t.grouping.dimensions().each(function(e){n[e.name]=!0}))},this),t.eachOwn(this._visualRoles,function(s,o){if(!s.grouping){var u=s.defaultDimensionName;if(u){var a=u.match(/^(.*?)(\*)?$/)||t.fail.argumentInvalid("defaultDimensionName"),f=!!a[2];if(f){var l=e.groupDimensionsNames(a[1],{assertExists:!1});if(l){var c=t.query(l).where(function(e){return!t.hasOwn(n,e)});if(s.requireSingleDimension){var h=c.first();if(h){i(s,h);return}}else{c=c.array();if(c.length){i(s,c);return}}}}else if(!t.hasOwn(n,u)&&e.dimensions(u,{assertExists:!1})){i(s,u);return}if(s.autoCreateDimension){var p=a[1];e.addDimension(p,r.data.DimensionType.extendSpec(p,{isHidden:!0})),i(s,p);return}}if(s.isRequired)throw t.error.operationInvalid("Chart type requires unassigned role '{0}'.",[o]);s.bind(null)}},this)},_logVisualRoles:function(){var e=["\n------------------------------------------"];e.push("Visual Roles Information"),t.eachOwn(this._visualRoles,function(n,r){e.push("  "+r+t.array.create(18-r.length," ").join("")+(n.grouping?" <-- "+n.grouping:""))}),e.push("------------------------------------------"),r.log(e.join("\n"))},visualRoles:function(e,n){if(e==null)return t.own(this._visualRoles);var r=t.getOwn(this._visualRoles,e)||null;if(!r&&t.get(n,"assertExists",!0))throw t.error.argumentInvalid("roleName","Undefined role name '{0}'.",[e]);return r},measureVisualRoles:function(){return this._measureVisualRoles},measureDimensionsNames:function(){return t.query(this._measureVisualRoles).select(function(e){return e.firstDimensionName()}).where(t.notNully).array()},_isRoleAssigned:function(e){return!!this._visualRoles[e].grouping},partData:function(e){this._partData||(!this._dataPartRole||!this._dataPartRole.grouping?this._partData=this.data:this._partData=this._dataPartRole.flatten(this.data));if(!e)return this._partData;e=t.query(e).distinct().array(),e.sort();var n=this._dataPartRole.firstDimensionName();return e.length===1?this._partData._childrenByKey[n+":"+e[0]]||new r.data.Data({linkParent:this._partData,datums:[]}):this._partData.where([t.set({},n,e)])},_initBasePanel:function(){var e=this.options,t=this.parent&&this.parent._multiChartPanel;this.basePanel=new r.BasePanel(this,t,{margins:e.margins,paddings:e.paddings,size:{width:e.width,height:e.height}})},_initTitlePanel:function(){var e=this.options;t.empty(e.title)||(this.titlePanel=new r.TitlePanel(this,this.basePanel,{title:e.title,font:e.titleFont,anchor:e.titlePosition,align:e.titleAlign,alignTo:e.titleAlignTo,offset:e.titleOffset,inBounds:e.titleInBounds,margins:e.titleMargins,paddings:e.titlePaddings,titleSize:e.titleSize,titleSizeMax:e.titleSizeMax}))},_initLegendPanel:function(){var e=this.options;if(e.legend){var n=this.axes.color;this.legendPanel=new r.LegendPanel(this,this.basePanel,{anchor:n.option("Position"),align:n.option("Align"),alignTo:e.legendAlignTo,offset:e.legendOffset,inBounds:e.legendInBounds,size:n.option("Size"),sizeMax:n.option("SizeMax"),margins:n.option("Margins"),paddings:n.option("Paddings"),font:n.option("Font"),scenes:t.getPath(e,"legend.scenes"),minMarginX:e.legendMinMarginX,minMarginY:e.legendMinMarginY,textMargin:e.legendTextMargin,padding:e.legendPadding,shape:e.legendShape,markerSize:e.legendMarkerSize,drawLine:e.legendDrawLine,drawMarker:e.legendDrawMarker}),this._initLegendScenes(this.legendPanel)}},_initLegendScenes:function(e){function i(e){e&&e.domainData&&s.call(this,e)}function s(i){var s=i.domainData;n||(n=e._getBulletRootScene());var o=n.createGroup({group:s,colorAxis:i,extensionPrefix:r.visual.Axis.getId("legend",n.childNodes.length)});i.legendBulletGroupScene=o;var u=i.scale;s.children().each(function(e){var n=o.createItem({group:e});t.set(n,"color",u(e.value),"shape","square")})}var n;i.call(this,this.axes.color),i.call(this,this.axes.color2)},_initMultiChartPanel:function(){this._multiChartPanel=new r.MultiChartPanel(this,this.basePanel),this.basePanel._children.unshift(this.basePanel._children.pop())},useTextMeasureCache:function(e,t){var n=this.root,i=n._textMeasureCache||(n._textMeasureCache=r.text.createCache());return r.text.useCache(i,e,t||this)},render:function(e,t,n){this.useTextMeasureCache(function(){try{!this.isPreRendered||t?this._preRender({reloadData:n}):!this.parent&&this.isPreRendered&&r.removeTipsyLegends(),this.basePanel.render({bypassAnimation:e,recreate:t})}catch(i){i instanceof NoDataException?(r.debug>1&&r.log("No data found."),this._addErrorPanelMessage("No data found",!0)):(r.logError(i.message),r.debug>0&&this._addErrorPanelMessage("Error: "+i.message,!1))}})},_addErrorPanelMessage:function(e,t){var r=this.options,i=(new n.Panel).canvas(r.canvas).width(r.width).height(r.height),s=i.anchor("center").add(n.Label).text(e);t&&this.extend(s,"noDataMessage_"),i.render()},animate:function(e,t){return this.basePanel.animate(e,t)},isAnimatingStart:function(){return this.basePanel.isAnimatingStart()},setData:function(e,t){this.setResultset(e.resultset),this.setMetadata(e.metadata),$.extend(this.options,t)},setResultset:function(e){!this.parent||t.fail.operationInvalid("Can only set resultset on root chart."),this.resultset=e,e.length||r.log("Warning: Resultset is empty")},setMetadata:function(e){!this.parent||t.fail.operationInvalid("Can only set resultset on root chart."),this.metadata=e,e.length||r.log("Warning: Metadata is empty")},extend:function(e,n,i){if(e){var s=r.debug>=3?[]:null,o=t.get(i,"constOnly",!1),u=this.options.extensionPoints;if(u){e.borderPanel&&(e=e.borderPanel);for(var a in u)if(a.indexOf(n)===0){var f=a.substring(n.length),l=u[a];if(e.isLocked&&e.isLocked(f))s&&s.push(f+": locked extension point!");else if(e.isIntercepted&&e.isIntercepted(f))s&&s.push(f+":"+JSON.stringify(l)+" (controlled)");else{s&&s.push(f+": "+JSON.stringify(l));if(l!=null){var c=typeof l;if(c==="object"){if(f==="svg"||f==="css"){var h=e.propertyValue(f);h&&(l=t.copy(h,l))}}else if(o&&c==="function")continue}typeof e[f]=="function"?e[f](l):e[f]=l}}s&&(s.length?r.log("Applying Extension Points for: '"+n+"'\n	* "+s.join("\n	* ")):r.debug>=5&&r.log("No Extension Points for: '"+n+"'"))}}else r.debug>=4&&r.log("Applying Extension Points for: '"+n+"' (target mark does not exist)")},_getExtension:function(e){var t=this.options.extensionPoints;return t?(e=r.arraySlice.call(arguments).join("_"),t[e]):undefined},clearSelections:function(){this.data.owner.clearSelected()&&this.updateSelections()},_suspendSelectionUpdate:function(){this===this.root?this._updateSelectionSuspendCount++:this.root._suspendSelectionUpdate()},_resumeSelectionUpdate:function(){this===this.root?this._updateSelectionSuspendCount>0&&(--this._updateSelectionSuspendCount||this._selectionNeedsUpdate&&this.updateSelections()):this._resumeSelectionUpdate()},updateSelections:function(){if(this===this.root){if(this._inUpdateSelections)return;if(this._updateSelectionSuspendCount){this._selectionNeedsUpdate=!0;return}r.removeTipsyLegends(),this._inUpdateSelections=!0;try{var e=this.options.selectionChangedAction;if(e){var t=this.data.selectedDatums();e.call(null,t)}this.basePanel._renderInteractive()}finally{this._inUpdateSelections=!1,this._selectionNeedsUpdate=!1}}else this.root.updateSelections()},_onUserSelection:function(e){if(!e||!e.length)return e;if(this===this.root){var t=this.options.userSelectionAction;return t?t.call(null,e)||e:e}return this.root._onUserSelection(e)},isOrientationVertical:function(e){return(e||this.options.orientation)===r.orientation.vertical},isOrientationHorizontal:function(e){return(e||this.options.orientation)===r.orientation.horizontal},dispose:function(){this._disposed||(this._disposed=!0)},defaults:{width:400,height:300,orientation:"vertical",ignoreNulls:!0,crosstabMode:!0,isMultiValued:!1,seriesInRows:!1,groupedLabelSep:undefined,animate:!0,titlePosition:"top",titleAlign:"center",legend:!1,legendPosition:"bottom",secondAxis:!1,secondAxisIdx:-1,showTooltips:!0,v1StyleTooltipFormat:function(e,t,n,r){return e+", "+t+":  "+this.chart.options.valueFormat(n)+(r&&r.percent?" ("+r.percent.label+")":"")},tipsySettings:{gravity:"s",delayIn:200,delayOut:80,offset:2,opacity:.8,html:!0,fade:!1,corners:!1,followMouse:!1},valueFormat:t.scope(function(){var e=n.Format.number().fractionDigits(0,2);return function(t){return e.format(t)}}),percentValueFormat:t.scope(function(){var e=n.Format.number().fractionDigits(0,1);return function(t){return e.format(t*100)+"%"}}),clickable:!1,doubleClickMaxDelay:300,hoverable:!1,selectable:!1,ctrlSelectMode:!0,clearSelectionMode:"emptySpaceClick",rubberBandFill:"rgba(203, 239, 163, 0.6)",rubberBandLine:"#86fe00",compatVersion:Infinity}}),r.BasePanel=r.Abstract.extend({chart:null,parent:null,_children:null,type:n.Panel,height:null,width:null,anchor:"top",pvPanel:null,margins:null,paddings:null,isRoot:!1,isTopRoot:!1,root:null,topRoot:null,_coreInfo:null,_layoutInfo:null,data:null,dataPartValue:null,_colorAxis:null,_isAnimating:0,_isRubberBandSelecting:!1,_ignoreClicks:0,_v1DimRoleName:{series:"series",category:"category",value:"value"},_sceneTypeExtensions:null,constructor:function(e,t,n){n&&(n.scenes&&(this._sceneTypeExtensions=n.scenes,delete n.scenes),n.colorAxis&&(this._colorAxis=n.colorAxis,delete n.colorAxis)),$.extend(this,n),this.chart=e,this.position={},this.margins=new r.Sides(n&&n.margins),this.paddings=new r.Sides(n&&n.paddings),this.size=new r.Size(n&&n.size),this.sizeMax=new r.Size(n&&n.sizeMax),t?(this.parent=t,this.root=t.root,this.topRoot=t.topRoot,this.isTopRoot=!1,this.isRoot=t.chart!==e,this.data=t.data,this.isRoot&&(this.position.left=e.left,this.position.top=e.top),t._addChild(this)):(this.parent=null,this.root=this,this.topRoot=this,this.isRoot=!0,this.isTopRoot=!0,this.data=this.chart.data);if(this.isRoot)this.anchor=null,this.align=null,this.alignTo=null,this.offset=null;else{this.align=r.parseAlign(this.anchor,this.align);var i=this.alignTo,s=this.anchor;i==null||i===""||s!=="left"&&s!=="right"?i=this.align:i!=="page-middle"&&(isNaN(+i.charAt(0))?i=r.parseAlign(s,i):i=r.PercentValue.parse(i)),this.alignTo=i,this.offset=new r.Offset(this.offset)}},compatVersion:function(){return this.chart.compatVersion()},defaultColorAxis:function(){return this._colorAxis||this.chart.axes.color},defaultVisibleBulletGroupScene:function(){var e=this.defaultColorAxis();return e&&e.isVisible?e.legendBulletGroupScene:null},_addChild:function(e){e.parent===this||t.assert("Child has a != parent."),(this._children||(this._children=[])).push(e)},layout:function(e,n){if(!this._layoutInfo||t.get(n,"force",!1)){var i=t.get(n,"referenceSize");!i&&e&&(i=t.copyOwn(e));var s=this.size.resolve(i),o=this.sizeMax.resolve(i);if(!e){if(s.width==null||s.height==null)throw t.error.operationInvalid("Panel layout without width or height set.");e=t.copyOwn(s)}!i&&e&&(i=t.copyOwn(e)),o.width!=null&&e.width>o.width&&(e.width=o.width),o.height!=null&&e.height>o.height&&(e.height=o.height);var u=(t.get(n,"margins")||this.margins).resolve(i),a=(t.get(n,"paddings")||this.paddings).resolve(i),f=u.width+a.width,l=u.height+a.height,c=new r.Size(Math.max(e.width-f,0),Math.max(e.height-l,0)),h=t.copyOwn(s);h.width!=null&&(h.width=Math.max(h.width-f,0)),h.height!=null&&(h.height=Math.max(h.height-l,0));var p=this._layoutInfo||null,d=t.get(n,"canChange",!0),v=this._layoutInfo={canChange:d,referenceSize:i,margins:u,paddings:a,desiredClientSize:h,clientSize:c,pageClientSize:p?p.pageClientSize:c.clone(),previous:p};p&&(delete p.previous,delete p.pageClientSize);var m=this._calcLayout(v),g;m?(v.clientSize=m,g={width:m.width+f,height:m.height+l}):(g=e,m=c),this.isVisible=m.width>0&&m.height>0,delete v.desiredClientSize,this.width=g.width,this.height=g.height,!d&&p&&delete v.previous}},_calcLayout:function(e){function p(e,t,n){var r=0;while(e--){if(t.call(n,e,r)===!1)return!0;r++}return!1}function d(e,n){r.debug>=5&&r.log("\n[BasePanel] ==== LayoutCycle #"+(n+1)),c=new r.Sides(0),h=t.copyOwn(f);var i=e>0;c=new r.Sides(0),h=t.copyOwn(f);var s,o,l;s=0,o=a.length;while(s<o){l=a[s],r.debug>=5&&r.log("[BasePanel] SIDE Child i="+s+" at "+l.anchor);if(v.call(this,l,i))return!0;s++}s=0,o=u.length;while(s<o){l=u[s],r.debug>=5&&r.log("[BasePanel] FILL Child i="+s);if(v.call(this,l,i))return!0;s++}return!1}function v(e,t){var n=!1,i;return l.canChange=t,p(3,function(s,o){r.debug>=5&&r.log("[BasePanel]   Attempt #"+(o+1)),l.paddings=i,l.canChange=s>0,e.layout(new r.Size(h),l);if(e.isVisible){n=m.call(this,e,t);if(n)return!1;i=e._layoutInfo.requestPaddings;if(i){if(s>0)return i=new r.Sides(i),r.debug>=5&&r.log("[BasePanel] Child requested paddings change: "+JSON.stringify(i)),!0;r.debug>=2&&r.log("[Warning] [BasePanel] FILL Child requests paddings change but no more iterations possible.")}g.call(this,e),e.anchor!=="fill"&&y.call(this,e)}return!1},this),n}function m(e,t){var n=!1,i=e.width-h.width;i>0&&(t?(n=!0,h.width+=i,f.width+=i):r.debug>=2&&r.log("[Warning] Layout iterations limit reached."));var s=e.height-h.height;return s>0&&(t?(n=!0,h.height+=s,f.height+=s):r.debug>=2&&r.log("[Warning] Layout iterations limit reached.")),n}function g(r){var u=r.anchor,a=r.align,f=r.alignTo,l;u==="fill"?(u="left",l=c.left+h.width/2-r.width/2,a=f="middle"):l=c[u];var p,d;switch(a){case"top":case"bottom":case"left":case"right":p=a,d=0;break;case"center":case"middle":p=s[i[u]],d=-r[n[p]]/2}var v,m;switch(f){case"top":case"bottom":case"left":case"right":m=f,v=m!==p?h[n[p]]:0;break;case"center":case"middle":m=s[i[u]],v=h[n[p]]/2;break;case"page-center":case"page-middle":m=s[i[u]];var g=n[p],y=Math.min(h[g],e.pageClientSize[g]);v=y/2}var b=c[m]+v+d,w=r.offset.resolve(h);w&&(l+=w[o[u]]||0,b+=w[o[p]]||0),r.inBounds&&(l<0&&(l=0),b<0&&(b=0)),r.setPosition(t.set({},u,l,p,b))}function y(e){var t=e.anchor,r=n[t],i=e[r];c[t]+=i,h[r]-=i}if(!this._children)return;var n=r.BasePanel.orthogonalLength,i=r.BasePanel.relativeAnchor,s=r.BasePanel.leftTopAnchor,o=r.Offset.namesSidesToOffset,u=[],a=[];this._children.forEach(function(e){var n=e.anchor;n&&(n==="fill"?u.push(e):(t.hasOwn(i,n)||t.fail.operationInvalid("Unknown anchor value '{0}'",[n]),a.push(e)))});var f=t.copyOwn(e.clientSize),l={force:!0,referenceSize:f},c,h;return p(3,d,this),f},_create:function(e){if(!this.pvPanel||e){this.pvPanel=null,delete this._coreInfo,this.layout();if(!this.isVisible)return;this.isRoot&&this._creating();var i=this._layoutInfo.margins,s=this._layoutInfo.paddings;if(this.isTopRoot){this.pvRootPanel=this.pvPanel=(new n.Panel).canvas(this.chart.options.canvas);if(i.width>0||i.height>0)this.pvPanel.width(this.width).height(this.height),this.pvPanel=this.pvPanel.add(n.Panel)}else this.pvPanel=this.parent.pvPanel.add(this.type);var o=this.pvPanel,u=this.width-i.width,a=this.height-i.height;o.width(u).height(a);var f={};t.eachOwn(this.position,function(e,t){o[t](e+i[t]),f[this.anchorLength(t)]=!0},this),!f.width&&i.left>0&&o.left(i.left),!f.height&&i.top>0&&o.top(i.top);if(s.width>0||s.height>0)this.pvPanel=o.add(n.Panel).width(u-s.width).height(a-s.height).left(s.left).top(s.top);o.borderPanel=o,o.paddingPanel=this.pvPanel,this.pvPanel.paddingPanel=this.pvPanel,this.pvPanel.borderPanel=o,r.debug>=15&&(this.pvPanel.strokeStyle("lightgreen").lineWidth(1).strokeDasharray("- "),o.strokeStyle("lightblue").lineWidth(1).strokeDasharray(null)),this._createCore(this._layoutInfo),this.isTopRoot&&this.chart.options.selectable&&n.renderer()!=="batik"&&this._initRubberBand(),this.applyExtensions()}},_creating:function(){this._children&&this._children.forEach(function(e){e._creating()})},_createCore:function(e){this._children&&this._children.forEach(function(e){e._create()})},render:function(e){if(!this.isTopRoot)return this.topRoot.render(e);this._create(t.get(e,"recreate",!1));if(!this.isVisible)return;var n=this.chart,r=n.options;r.renderCallback&&r.renderCallback.call(n);var i=this.pvRootPanel;this._isAnimating=r.animate&&!t.get(e,"bypassAnimation",!1)?1:0;try{i.render();if(this._isAnimating){this._isAnimating=2;var s=this;i.transition().duration(2e3).ease("cubic-in-out").start(function(){s._isAnimating=0,s._onRenderEnd(!0)})}else this._onRenderEnd(!1)}finally{this._isAnimating=0}},_onRenderEnd:function(e){this._children&&this._children.forEach(function(t){t._onRenderEnd(e)})},_renderInteractive:function(){if(this.isVisible){var e=this._getSignums();e&&e.length?e.forEach(function(e){e.render()}):this._children||this.pvPanel.render(),this._children&&this._children.forEach(function(e){e._renderInteractive()})}},_getSignums:function(){return null},animate:function(e,t){return this.topRoot._isAnimating===1?e:t},isAnimatingStart:function(){return this.topRoot._isAnimating===1},isAnimating:function(){return this.topRoot._isAnimating>0},applyExtensions:function(){this.isRoot&&this.extend(this.pvPanel,"base_")},extend:function(e,t,n){this.chart.extend(e,t,n)},_extendSceneType:function(e,n,i){var s=t.get(this._sceneTypeExtensions,e);s&&r.extendType(n,s,i)},_getExtension:function(e){return this.chart._getExtension.apply(this.chart,arguments)},_getConstantExtension:function(e){var n=this.chart._getExtension.apply(this.chart,arguments);if(!t.fun.is(n))return n},setPosition:function(e){for(var n in e)if(t.hasOwn(r.Sides.namesSet,n)){var i=e[n];i===null?delete this.position[n]:(i=+i,!isNaN(i)&&isFinite(i)&&(this.position[n]=i))}},createAnchoredSize:function(e,t){return this.isAnchorTopOrBottom()?new r.Size(t.width,Math.min(t.height,e)):new r.Size(Math.min(t.width,e),t.height)},getPvPanel:function(e){var r=this.pvPanel;if(!e)return r;if(!this.parent)throw t.error.operationInvalid("Layers are not possible in a root panel.");if(!r)throw t.error.operationInvalid("Cannot access layer panels without having created the main panel.");var i=null;this._layers?i=this._layers[e]:this._layers={};if(!i){var s=this.parent.pvPanel,o=i=s.borderPanel.add(this.type).extend(r.borderPanel);r!==r.borderPanel&&(i=o.add(n.Panel).extend(r)),o.borderPanel=o,o.paddingPanel=i,i.paddingPanel=i,i.borderPanel=o,this.initLayerPanel(i,e),this._layers[e]=i}return i},initLayerPanel:function(e,t){},_getV1DimName:function(e){var t=this._v1DimName||(this._v1DimNameCache={}),n=t[e];if(n==null){var r=this.chart.visualRoles(this._v1DimRoleName[e],{assertExists:!1});n=r?r.firstDimensionName():"",t[e]=n}return n},_createContext:function(e,t){return new r.visual.Context(this,e,t)},_updateContext:function(e,t,n){G.call(e,t,n)},_getContext:function(e,t){return this._context?this._updateContext(this._context,e,t):this._context=this._createContext(e,t),this._context},_isTooltipEnabled:function(){return!this.isRubberBandSelecting()&&!this.isAnimating()},_addPropTooltip:function(e,r){var i=this,s=t.get(r,"tipsyEvent"),o=this.chart.options,u=Object.create(o.tipsySettings),a;u.isEnabled=this._isTooltipEnabled.bind(this),s||(s="mouseover");var f=o.tooltipFormat;f?a=function(e){return f.call(e,e.getV1Series(),e.getV1Category(),e.getV1Value()||"",e.scene.datum)}:a=this._buildTooltip,e.localProperty("tooltip").tooltip(function(){var t,n=i._createContext(e,null);return n.scene.atoms?function(){return t==null&&(t=a.call(i,n),n=null),t}:""}).title(function(){return""}).event(s,n.Behavior.tipsy(u||o.tipsySettings))},_requirePointEvent:function(e){if(!this.isTopRoot)return this.topRoot._requirePointEvent(e);this._attachedPointEvent||(this.pvPanel.events("all").event("mousemove",n.Behavior.point(e||20)),this._attachedPointEvent=!0)},_buildTooltip:function(e){function c(e,n){a.push("<b>"+e+"</b>: "+(t.html.escape(n)||" - ")+"<br/>")}function h(e,t){var s;return o?s=o.dimensions(t).percentOverParent(i):s=r.dimensions(t).percent(e.value),n.options.percentValueFormat.call(null,s)}var n=this.chart,r=n.data,i={visible:!0},s=e.scene,o=s.group,u=o&&o._datums.length>1;if(!u&&s.datum.isNull)return"";var a=[],f=e.panel.stacked===!1?null:r.type.getPlayingPercentVisualRoleDimensionMap(),l=u?o.atoms:s.datum.atoms;return t.each(l,function(e,n){var r=e.dimension.type;if(!r.isHidden)if(!u||e.value!=null){var i=e.label;f&&f.has(n)&&(i+=" ("+h(e,n)+")"),c(t.html.escape(e.dimension.type.label),i)}}),u&&(a.push("<hr />"),a.push("<b>#</b>: "+o._datums.length+"<br/>"),o.freeDimensionNames().forEach(function(e){var n=o.dimensions(e);if(!n.type.isHidden){var r=t.html.escape(n.type.label),s;n.type.valueType===Number?(s=n.format(n.sum(i)),f&&f.has(e)&&(s+=" ("+h(null,e)+")"),r="&sum; "+r):s=n.atoms(i).map(function(e){return e.label||"- "}).join(", "),c(r,s)}})),'<div style="text-align: left;">'+a.join("\n")+"</div>"},_addPropClick:function(e){function n(){var e=arguments[arguments.length-1];return t._handleClick(this,e)}var t=this;e.cursor("pointer").event("click",n)},_addPropDoubleClick:function(e){function n(){var e=arguments[arguments.length-1];return t._handleDoubleClick(this,e)}var t=this;e.cursor("pointer").event("dblclick",n)},_handleDoubleClick:function(e,t){var n=this.chart.options.doubleClickAction;if(n){this._ignoreClicks=2;var r=this._getContext(e,t);this._onDoubleClick(r)}},_onDoubleClick:function(e){var t=this.chart.options.doubleClickAction;t.call(e,e.getV1Series(),e.getV1Category(),e.getV1Value(),e.event)},_shouldHandleClick:function(e){var t=e||this.chart.options;return t.selectable||t.clickable&&t.clickAction},_handleClick:function(e,t){if(!this._shouldHandleClick())return;var n=this.chart.options,r;if(!n.doubleClickAction)r=this._getContext(e,t),this._handleClickCore(r);else{var i=this;r=this._createContext(e,t),window.setTimeout(function(){i._handleClickCore.call(i,r)},n.doubleClickMaxDelay||300)}},_handleClickCore:function(e){this._ignoreClicks?this._ignoreClicks--:(this._onClick(e),this.chart.options.selectable&&e.scene.datum&&this._onSelect(e))},_onClick:function(e){var t=this.chart.options.clickAction;t&&t.call(e,e.getV1Series(),e.getV1Category(),e.getV1Value(),e.event)},_onSelect:function(e){var n=e.scene.datums().array(),i=this.chart;n=this._onUserSelection(n);if(n&&n.length){var s;if(i.options.ctrlSelectMode&&!e.event.ctrlKey){var o=t.query(n).where(function(e){return e.isSelected}).object({name:function(e){return e.id}});s=i.data.owner.clearSelected(function(e){return!t.hasOwn(o,e.id)}),s|=r.data.Data.setSelected(n,!0)}else s=r.data.Data.toggleSelected(n);s&&this._onSelectionChanged()}},_onUserSelection:function(e){return this.chart._onUserSelection(e)},_onSelectionChanged:function(){this.chart.updateSelections()},isRubberBandSelecting:function(){return this.topRoot._isRubberBandSelecting},_initRubberBand:function(){var e=this,t=this.chart,i=t.options,s=t.data,o=2;this._isRubberBandSelecting=!1;var u=this.pvRootPanel||this.pvPanel.paddingPanel,a,f,l=this.selectBar=u.add(n.Bar).visible(function(){return!!f}).left(function(){return f.x}).top(function(){return f.y}).width(function(){return f.dx}).height(function(){return f.dy}).fillStyle(i.rubberBandFill).strokeStyle(i.rubberBandLine);this._getExtension("base","fillStyle")||u.fillStyle(r.invisibleFill);var c;u.event("mousedown",n.Behavior.selector(!1)).event("select",function(){if(!f){if(e.isAnimating())return;var t=this.selectionRect;if(Math.sqrt(t.dx*t.dx+t.dy*t.dy)<=o)return;f=t,e._isRubberBandSelecting=!0,a||(a=u.toScreenTransform()),e.rubberBand=f.clone().apply(a)}else f=this.selectionRect;l.render()}).event("selectend",function(){if(f){var t=arguments[arguments.length-1];a||(a=u.toScreenTransform()),e.rubberBand=f=this.selectionRect.clone().apply(a),f=null,e._isRubberBandSelecting=!1,l.render(),e._dispatchRubberBandSelectionTop(t),c=new Date,e.rubberBand=f=null}}),i.clearSelectionMode==="emptySpaceClick"&&u.event("click",function(){if(c){var t=new Date-c;if(t<300){c=null;return}}s.owner.clearSelected()&&e._onSelectionChanged()})},_dispatchRubberBandSelectionTop:function(e){r.debug>=3&&r.log("rubberBand "+JSON.stringify(this.rubberBand));var t=this.chart;t._suspendSelectionUpdate();try{!e.ctrlKey&&t.options.ctrlSelectMode&&t.data.owner.clearSelected(),t.useTextMeasureCache(this._dispatchRubberBandSelection,this)}finally{t._resumeSelectionUpdate()}},_dispatchRubberBandSelection:function(e){var n={},i={toggle:!1};if(this._detectDatumsUnderRubberBand(n,this.rubberBand,i)){var s=t.own(n);s=this._onUserSelection(s);var o;i.toggle?(r.data.Data.toggleSelected(s),o=!0):o=r.data.Data.setSelected(s,!0),o&&this._onSelectionChanged()}this._children&&this._children.forEach(function(e){e.rubberBand=this.rubberBand,e._dispatchRubberBandSelection(e)},this)},_detectDatumsUnderRubberBand:function(e,t,n){var r=!1;if(this.isVisible){var i=this._getSignums();i&&i.forEach(function(n){this._forEachMarkDatumUnderRubberBand(n,function(t){e[t.key]=t,r=!0},this,t)},this)}return r},_forEachMarkDatumUnderRubberBand:function(e,n,i,s){function o(o,u){if(o.intersectsRect(s)){var a=u.group,f=a?a._datums:t.array.as(u.datum);f&&f.forEach(function(t){t.isNull||(r.debug>=10&&r.log(t.key+": "+JSON.stringify(o)+" mark type: "+e.type),n.call(i,t))})}}s||(s=this.rubberBand);var u=t.get(e,"rubberBandSelectionMode","partial"),a=u==="center"?"getInstanceCenterPoint":"getInstanceShape";if(e.type==="area"||e.type==="line"){var f;e.eachSignumInstance(function(t,n){if(!t.visible||t.isBreak||t.datum&&t.datum.isNull)f=null;else{if(f){var r=e[a](f,t).apply(n);o(r,f)}f=t}},this)}else e.eachSignumInstance(function(t,n){if(!t.isBreak&&t.visible){var r=e[a](t).apply(n);o(r,t)}},this)},isAnchorTopOrBottom:function(e){return e||(e=this.anchor),e==="top"||e==="bottom"},anchorOrtho:function(e){return e||(e=this.anchor),r.BasePanel.relativeAnchor[e]},anchorOrthoMirror:function(e){return e||(e=this.anchor),r.BasePanel.relativeAnchorMirror[e]},anchorOpposite:function(e){return e||(e=this.anchor),r.BasePanel.oppositeAnchor[e]},anchorLength:function(e){return e||(e=this.anchor),r.BasePanel.parallelLength[e]},anchorOrthoLength:function(e){return e||(e=this.anchor),r.BasePanel.orthogonalLength[e]},isOrientationVertical:function(e){return this.chart.isOrientationVertical(e)},isOrientationHorizontal:function(e){return this.chart.isOrientationHorizontal(e)}},{relativeAnchor:{top:"left",bottom:"left",left:"bottom",right:"bottom"},leftBottomAnchor:{top:"bottom",bottom:"bottom",left:"left",right:"left"},leftTopAnchor:{top:"top",bottom:"top",left:"left",right:"left"},horizontalAlign:{top:"right",bottom:"left",middle:"center",right:"right",left:"left",center:"center"},verticalAlign:{top:"top",bottom:"bottom",middle:"middle",right:"bottom",left:"top",center:"middle"},relativeAnchorMirror:{top:"right",bottom:"right",left:"top",right:"top"},oppositeAnchor:{top:"bottom",bottom:"top",left:"right",right:"left"},parallelLength:{top:"width",bottom:"width",right:"height",left:"height"},orthogonalLength:{top:"height",bottom:"height",right:"width",left:"width"},oppositeLength:{width:"height",height:"width"}}),r.MultiChartPanel=r.BasePanel.extend({anchor:"fill",_calcLayout:function(e){var n=this.chart,i=n.visualRoles("multiChart");if(!i.grouping)return;var s=e.clientSize,o=n.options,u=Number(o.multiChartMax);if(isNaN(u)||u<1)u=Infinity;var a=i.flatten(n.data,{visible:!0}),f=a._children.length,l=Math.min(f,u);if(l===0)return;var c=+o.multiChartMaxColumns;if(isNaN(c)||u<1)c=3;var h=Math.min(l,c);h>=1&&isFinite(h)||t.assert("Must be at least 1 and finite");var p=Math.ceil(l/h);p>=1||t.assert("Must be at least 1");var d=r.PercentValue.parse(o.multiChartWidth);if(d==null){var v=isFinite(c)?h:3;d=new r.PercentValue(1/v)}d=r.PercentValue.resolve(d,s.width);var m;if(p===1&&t.get(o,"multiChartSingleRowFillsHeight",!0)||h===1&&t.get(o,"multiChartSingleColFillsHeight",!0)){var g=e.previous;g?m=g.height:m=s.height}else{var y=+o.multiChartAspectRatio;if(isNaN(y)||y<=0)y=this._calulateDefaultAspectRatio(d);m=d/y;var b=+t.get(o,"multiChartMaxHeight");!isNaN(b)&&b>0&&(m=Math.min(m,b))}return t.set(e,"data",a,"count",l,"width",d,"height",m,"colCount",h,"rowCount",p),{width:d*h,height:Math.max(s.height,m*p)}},_calulateDefaultAspectRatio:function(e){return this.chart instanceof r.PieChart?10/7:5/4},_createCore:function(e){if(!e.data)return;var n=this.chart,i=n.options,s=i.multiChartMargins||new r.Sides(new r.PercentValue(.02)),o=n.constructor,u=e.colCount-1,a=e.rowCount-1;for(var f=0;f<e.count;f++){var l=e.data._children[f],c=f%e.colCount,h=Math.floor(f/e.colCount),p={};c>0&&(p.left=s.left),c<u&&(p.right=s.right),h>0&&(p.top=s.top),h<a&&(p.bottom=s.bottom);var d=t.create(i,{parent:n,title:l.absLabel,legend:!1,data:l,width:e.width,height:e.height,left:c*e.width,top:h*e.height,margins:p,extensionPoints:{base_fillStyle:null}}),v=new o(d);v._preRender()}this.base(e)}}),r.TitlePanelAbstract=r.BasePanel.extend({pvLabel:null,anchor:"top",title:null,titleSize:undefined,font:"12px sans-serif",defaultPaddings:2,constructor:function(e,t,n){n||(n={});var i=n.anchor||this.anchor;if(n.size==null){var s=n.titleSize;s!=null&&(n.size=(new r.Size).setSize(s,{singleProp:this.anchorOrthoLength(i)}))}if(n.sizeMax==null){var o=n.titleSizeMax;o!=null&&(n.sizeMax=(new r.Size).setSize(o,{singleProp:this.anchorOrthoLength(i)}))}n.paddings==null&&(n.paddings=this.defaultPaddings),this.base(e,t,n);if(n.font===undefined){var u=this._getFontExtension();typeof u=="string"&&(this.font=u)}},_getFontExtension:function(){return this._getExtension("titleLabel","font")},_calcLayout:function(e){var t=new r.Size,n=this.anchor,i=this.anchorLength(n),s=this.anchorOrthoLength(n),o=e.desiredClientSize[i];o==null&&(o=r.text.getTextLength(this.title,this.font)+2);var u,a=e.clientSize[i];o>a?(o=a,u=r.text.justify(this.title,o,this.font)):u=this.title?[this.title]:[];var f=r.text.getTextHeight("m",this.font),l=u.length*f,c=e.desiredClientSize[s];c==null&&(c=l);var h=e.clientSize[s];if(c>h){var p=Math.max(1,Math.floor(h/f));if(u.length>p){var d=u[p];u.length=p,l=c=p*f;var v=u[p-1]+" "+d;u[p-1]=r.text.trimToWidthB(o,v,this.font,"..")}}return e.lines=u,e.topOffset=(c-l)/2,e.lineSize={width:o,height:f},e.a_width=i,e.a_height=s,t[i]=o,t[s]=c,t},_createCore:function(e){var t={top:0,right:Math.PI/2,bottom:0,left:-Math.PI/2},i=this.pvPanel.add(n.Panel).data(e.lines)[r.BasePanel.leftTopAnchor[this.anchor]](function(){return e.topOffset+this.index*e.lineSize.height})[this.anchorOrtho(this.anchor)](0)[e.a_height](e.lineSize.height)[e.a_width](e.lineSize.width),s=r.BasePanel.horizontalAlign[this.align];this.pvLabel=i.add(n.Label).text(function(e){return e}).font(this.font).textAlign(s).textBaseline("middle").left(function(){return this.parent.width()/2}).bottom(function(){return this.parent.height()/2}).textAngle(t[this.anchor]),s!=="center"&&(this.isAnchorTopOrBottom()?this.pvLabel.left(null)[s](0):this.anchor=="right"?s=="left"?this.pvLabel.bottom(null).top(0):this.pvLabel.bottom(0):this.anchor=="left"&&(s=="right"?this.pvLabel.bottom(null).top(0):this.pvLabel.bottom(0)))},applyExtensions:function(){this.extend(this.pvPanel,"title_"),this.extend(this.pvLabel,"titleLabel_")}}),r.TitlePanel=r.TitlePanelAbstract.extend({font:"14px sans-serif",defaultPaddings:4,constructor:function(e,t,n){n||(n={});var r=e.options.compatVersion<=1;if(r){var i=n.titleSize;i==null&&(n.titleSize=25)}this.base(e,t,n)}}),r.LegendPanel=r.BasePanel.extend({pvRule:null,pvDot:null,pvLabel:null,anchor:"bottom",pvLegendPanel:null,textMargin:6,padding:2.5,markerSize:15,font:"10px sans-serif",constructor:function(e,n,r){r||(r={});var i=e.compatVersion()<=1;if(i){var s=r.anchor||this.anchor,o=s!=="top"&&s!=="bottom";r.padding!==undefined?r.padding=Math.max(0,(r.padding-16)/2):r.padding=4;var u=Math.max(t.get(r,"minMarginX",8),0),a;o&&r.align!=="middle"&&r.align!=="bottom"?a=Math.max(t.get(r,"minMarginY",20)-20,0):a=0,r.paddings={left:u,top:a}}this.base(e,n,r)},_calcLayout:function(e){return this._getBulletRootScene().layout(e)},_createCore:function(e){function w(e,t){var n=e?e.apply(this,t):"black",i=t[0];return i.isOn()?n:r.toGrayScale(n,null,undefined,150)}var t=this,i=e.clientSize,s=this._getBulletRootScene(),o=s.vars.padding,u=s.vars.size,a=function(e){return e.color},f=this.isAnchorTopOrBottom(),l=f?"top":"left",c=this.anchorOpposite(l),h=this.anchorLength(l),p=this.anchorOrthoLength(l),d=f?"center":"middle",v=f?"left":"top",m=this.anchorOpposite(v),g=0;switch(this.align){case m:g=i[h]-u.width;break;case d:g=(i[h]-u.width)/2}this.pvPanel.overflow("hidden");var y=this.pvPanel.add(n.Panel).data(s.vars.rows)[v](g)[l](function(){var e=this.sibling();return e?e[l]+e[p]+o[p]:0})[h](function(e){return e.size.width})[p](function(e){return e.size.height});this.pvLegendPanel=y.add(n.Panel).data(function(e){return e.items}).def("hidden","false").localProperty("group",Object).group(function(e){return e.group}).lock(m,null).lock(c,null).lock(v,function(e){var t=e.vars.padding,n=this.sibling();return n?n[v]+n[h]+t[h]:0}).lock("height",function(e){return e.vars.clientSize.height}).lock(l,f?function(e){var t=e.vars;return t.row.size.height/2-t.clientSize.height/2}:0).lock("width",f?function(e){return e.vars.clientSize.width}:function(e){return this.parent.width()}).fillStyle(function(){return this.hidden()=="true"?"rgba(200,200,200,1)":"rgba(200,200,200,0.0001)"}).cursor(function(e){return e.isClickable()?"pointer":null}).event("click",function(e){if(e.isClickable())return e.click()});var b=this.pvLegendPanel.add(n.Panel).left(0).top(0).right(null).bottom(null).width(function(e){return e.vars.markerSize}).height(function(e){return e.vars.clientSize.height});r.debug>=20&&(y.strokeStyle("red"),this.pvLegendPanel.strokeStyle("green"),b.strokeStyle("blue")),s.childNodes.forEach(function(e){var t=b.add(n.Panel).visible(function(t){return t.parent===e}),r=e.renderer().create(this,t);e.renderInfo=r},this),this.pvLabel=b.anchor("right").add(n.Label).textAlign("left").text(function(e){return e.vars.value.label}).lock("textMargin",function(e){return e.vars.textMargin-4}).font(function(e){return e.vars.font}).textDecoration(function(e){return e.isOn()?"":"line-through"}).intercept("textStyle",w,this._getExtension("legendLabel","textStyle"))},applyExtensions:function(){this.extend(this.pvPanel,"legendArea_"),this.extend(this.pvLegendPanel,"legendPanel_"),this._getBulletRootScene().childNodes.forEach(function(e){e.renderer().extendMarks(this,e.renderInfo,e.extensionPrefix)},this),this.extend(this.pvLabel,"legendLabel_")},_getSignums:function(){return[this.pvLegendPanel]},_getBulletRootScene:function(){var e=this._rootScene;return e||(e=new r.visual.legend.BulletRootScene(null,{panel:this,group:this.chart.data,horizontal:this.isAnchorTopOrBottom(),font:this.font,markerSize:this.markerSize,textMargin:this.textMargin,padding:this.padding}),this._rootScene=e),e}}),r.TimeseriesAbstract=r.BaseChart.extend({allTimeseriesPanel:null,_preRenderContent:function(e){this.options.showAllTimeseries&&(this.allTimeseriesPanel=new r.AllTimeseriesPanel(this,this.basePanel,{anchor:this.options.allTimeseriesPosition,allTimeseriesSize:this.options.allTimeseriesSize}))},defaults:t.create(r.BaseChart.prototype.defaults,{showAllTimeseries:!0,allTimeseriesPosition:"bottom",allTimeseriesSize:50})}),r.AllTimeseriesPanel=r.BasePanel.extend({pvAllTimeseriesPanel:null,anchor:"bottom",allTimeseriesSize:50,_calcLayout:function(e){return this.createAnchoredSize(this.allTimeseriesSize,e.clientSize)},applyExtensions:function(){this.base(),this.extend(this.pvPanel,"allTimeseries_")}}),r.CartesianAbstract=r.TimeseriesAbstract.extend({_gridDockPanel:null,axesPanels:null,yAxisPanel:null,xAxisPanel:null,secondXAxisPanel:null,secondYAxisPanel:null,_mainContentPanel:null,yScale:null,xScale:null,_visibleDataCache:null,constructor:function(e){this.axesPanels={},this.base(e)},_getSeriesRoleSpec:function(){return{isRequired:!0,defaultDimensionName:"series*",autoCreateDimension:!0}},_initData:function(){this._visibleDataCache&&delete this._visibleDataCache,this.base.apply(this,arguments)},_initAxes:function(e){this.base(e);if(!e||this.parent)this._createAxis("base",0),this._createAxis("ortho",0),this.options.secondAxis&&this._createAxis("ortho",1)},_preRenderContent:function(e){r.debug>=3&&r.log("Prerendering in CartesianAbstract");var t=this.options,n=this.axes,i=n.base,s=n.ortho,o=n.ortho2;this._gridDockPanel=new r.CartesianGridDockingPanel(this,this.basePanel,e),o&&this._createAxisPanel(o),this._createAxisPanel(i),this._createAxisPanel(s),this._mainContentPanel=this._createMainContentPanel(this._gridDockPanel),this.basePanel.layout(),this._setAxisScaleRange(i),this._setAxisScaleRange(s),o&&this._setAxisScaleRange(o)},_createAxisCore:function(e,t,n){switch(e){case"base":case"ortho":var i=new r.visual.CartesianAxis(this,e,t,n);return this.axes[i.orientedId]=i,this._createAxisScale(i),i}return this.base(e,t,n)},_createAxisPanel:function(e){if(e.isVisible){var n,i=e.option("Title");t.empty(i)||(n=new r.AxisTitlePanel(this,this._gridDockPanel,{title:i,font:e.option("TitleFont")||e.option("Font"),anchor:e.option("Position"),align:e.option("TitleAlign"),margins:e.option("TitleMargins"),paddings:e.option("TitlePaddings"),titleSize:e.option("TitleSize"),titleSizeMax:e.option("TitleSizeMax")}));var s=r.AxisPanel.create(this,this._gridDockPanel,e,{useCompositeAxis:e.option("Composite"),font:e.option("Font"),anchor:e.option("Position"),axisSize:e.option("Size"),axisSizeMax:e.option("SizeMax"),labelSpacingMin:e.option("LabelSpacingMin"),tickExponentMin:e.option("TickExponentMin"),tickExponentMax:e.option("TickExponentMax"),fullGrid:e.option("FullGrid"),fullGridCrossesMargin:e.option("FullGridCrossesMargin"),ruleCrossesMargin:e.option("RuleCrossesMargin"),zeroLine:e.option("ZeroLine"),domainRoundMode:e.option("DomainRoundMode"),desiredTickCount:e.option("DesiredTickCount"),minorTicks:e.option("MinorTicks"),clickAction:e.option("ClickAction"),doubleClickAction:e.option("DoubleClickAction")});return n&&(n.panelName=s.panelName,s.titlePanel=n),this.axesPanels[e.id]=s,this.axesPanels[e.orientedId]=s,e.index<=1&&(this[e.orientedId+"AxisPanel"]=s),s}},_createMainContentPanel:function(e){throw t.error.notImplemented()},_createAxisScale:function(e){var n=e.index===1&&e.type==="ortho",i;return n&&!this.options.secondAxisIndependentScale?i=this.axes.ortho.scale||t.fail.operationInvalid("First ortho scale must be created first."):(i=this._createScaleByAxis(e),i.isNull&&r.debug>=3&&r.log(t.format("{0} scale for axis '{1}'- no data",[e.scaleType,e.id]))),e.setScale(i),n?this.secondScale=i:e.index||(this[e.orientation+"Scale"]=i),i},_createScaleByAxis:function(e){var t=this["_create"+e.scaleType+"ScaleByAxis"];return t.call(this,e)},_createDiscreteScaleByAxis:function(e){var t=null,r=this._getVisibleData(e.dataCell.dataPartValues,{ignoreNulls:!1}),i=e.role.flatten(r,{visible:!0,flatteningMode:t}),s=new n.Scale.ordinal;if(!i.count())s.isNull=!0;else{var o=i.children().select(function(e){return e.value}).array();s.domain(o)}return s},_createTimeseriesScaleByAxis:function(e){var t=this._getVisibleValueExtent(e),r=new n.Scale.linear;if(!t)r.isNull=!0;else{var i=t.min,s=t.max;s-i===0&&(s=new Date(s.getTime()+36e5)),r.domain(i,s)}return r},_createContinuousScaleByAxis:function(e){var t=this._getVisibleValueExtentConstrained(e),r=new n.Scale.linear;if(!t)r.isNull=!0;else{var i=t.min,s=t.max,o=e.option("OriginIsZero");o&&i*s>0&&(i>0?(i=0,t.minLocked=!0):(s=0,t.maxLocked=!0));if(i===s)i=i!==0?i*.99:o?0:-0.1,s=s!==0?s*1.01:.1;else if(i>s){var u=i;i=s,s=u}r.domain(i,s)}return r},_setAxisScaleRange:function(e){var t=this._mainContentPanel._layoutInfo,n=e.orientation==="x"?t.clientSize.width:t.clientSize.height;return e.setScaleRange(n),e.scale},_getAxesRoundingPaddings:function(){function n(t,n){var r=e[t];if(r==null||n>r)e[t]=n}function r(e){if(e){var t=e.getScaleRoundingPaddings();t&&(e.orientation==="x"?(n("left",t.begin),n("right",t.end)):(n("bottom",t.begin),n("top",t.end)))}}var e={},t=this.axes;return r(t.x),r(t.secondX),r(t.y),r(t.secondY),e},_getVisibleData:function(e,n){var r=t.get(n,"ignoreNulls",!0);r&&(r=!this.options.ignoreNulls);var i=r+"|"+(e||""),s=t.getOwn(this._visibleDataCache,i);return s||(s=this._createVisibleData(e,r),(this._visibleDataCache||(this._visibleDataCache={}))[i]=s),s},_createVisibleData:function(e,t){var n=this.partData(e);return this._serRole&&this._serRole.grouping?this._serRole.flatten(n,{visible:!0,isNull:t?!1:null}):n},_assertSingleContinuousValueRole:function(e){e.grouping.isSingleDimension||r.log("[WARNING] A linear scale can only be obtained for a single dimension role."),e.grouping.isDiscrete()&&r.log("[WARNING] The single dimension of role '{0}' should be continuous.",[e.name])},_getVisibleValueExtent:function(e){var n=e.dataCells;return n.length===1?this._getVisibleRoleValueExtent(e,n[0]):t.query(n).select(function(t){return this._getVisibleRoleValueExtent(e,t)},this).reduce(this._unionReduceExtent,null)},_unionReduceExtent:function(e,t){if(!e){if(!t)return null;e={min:t.min,max:t.max}}else t&&(t.min<e.min&&(e.min=t.min),t.max>e.max&&(e.max=t.max));return e},_getVisibleRoleValueExtent:function(e,n){var r=n.role,i=n.dataPartValues;this._assertSingleContinuousValueRole(r);if(r.name==="series")throw t.error.notImplemented();var s=r.firstDimensionName(),o=this._getVisibleData(i).dimensions(s).extent();return o?{min:o.min.value,max:o.max.value}:undefined},_getVisibleValueExtentConstrained:function(e,t,n){var r={minLocked:!1,maxLocked:!1};t==null&&(t=e.option("FixedMin"),t!=null&&(r.minLocked=!0)),n==null&&(n=e.option("FixedMax"),n!=null&&(r.maxLocked=!0));if(t==null||n==null){var i=this._getVisibleValueExtent(e);if(!i)return null;t==null&&(t=i.min),n==null&&(n=i.max)}return r.min=t,r.max=n,r},defaults:t.create(r.TimeseriesAbstract.prototype.defaults,{showAllTimeseries:!1,panelSizeRatio:.9,timeSeries:!1,timeSeriesFormat:"%Y-%m-%d",useCompositeAxis:!1,showXScale:!0,showYScale:!0,xAxisPosition:"bottom",yAxisPosition:"left",secondAxisIndependentScale:!1,secondAxisColor:"blue"})}),r.GridDockingPanel=r.BasePanel.extend({anchor:"fill",_calcLayout:function(e){function g(t,n){r.debug>=5&&r.log("\n[GridDockingPanel] ==== LayoutCycle "+(m?"Disaster MODE":"#"+(n+1)));var i,s,o=e.canChange!==!1&&!m&&t>0,u,a=!1;i=0,s=h.length;while(i<s){r.debug>=5&&r.log("[GridDockingPanel] SIDE Child i="+i),u=S(h[i],o);if(!m&&u){if(u===d)return m=!0,g(0),!1;if(u===v)a||(a=!0,e.requestPaddings=e.paddings);else{if(t>0)return r.debug>=5&&r.log("[GridDockingPanel] SIDE Child i="+i+" increased paddings"),!0;r.debug>=2&&r.log("[Warning] [GridDockingPanel] SIDE Child i="+i+" increased paddings but no more iterations possible.")}}i++}if(a)return r.debug>=5&&r.log("[GridDockingPanel] Restarting due to overflowPaddings change"),!1;i=0,s=c.length;while(i<s){r.debug>=5&&r.log("[GridDockingPanel] FILL Child i="+i),u=E(c[i],o);if(!m&&u){if(u===d)return m=!0,g(0),!1;if(t>0)return r.debug>=5&&r.log("[GridDockingPanel] FILL Child i="+i+" increased paddings"),!0;r.debug>=2&&r.log("[Warning] [GridDockingPanel] FILL Child i="+i+" increased paddings but no more iterations possible.")}i++}return!1}function y(e,t){var n=0;while(e--){if(t(e,n)===!1)return!0;n++}return!1}function b(e){var n=e.anchor;if(n)if(n==="fill"){c.push(e);var s=e.paddings.resolve(l.referenceSize);i=r.Sides.resolvedMax(i,s)}else t.hasOwn(a,n)||t.fail.operationInvalid("Unknown anchor value '{0}'",[n]),h.push(e)}function w(e){var t=!1,n=e.anchor;return l.paddings=C(n,i),e.layout(new r.Size(s),l),e.isVisible&&(t=k(n,i,e),x(n,e),T(n,e)),t}function E(e,t){var n=!1,o=e.anchor;return l.paddings=C(o,i),l.canChange=t,e.layout(new r.Size(s),l),e.isVisible&&(n=k(o,i,e,t),x(o,e),N(e,o)),n}function S(n,o){var a=!1;if(n.isVisible){var c=n.anchor,h=f[c],p=u[c],d=s[h],m=n[p],g=new r.Size(t.set({},h,d,p,m));l.paddings=C(c,i),l.canChange=o,n.layout(g,l);if(n.isVisible){a=k(c,i,n,o);if(L(c,e.paddings,n,o))return v;N(n,n.align)}}return a}function x(e,r){var i;e==="fill"?(e="left",i=n.left+s.width/2-r.width/2):i=n[e],r.setPosition(t.set({},e,i))}function T(e,t){var r=u[e],i=t[r];n[e]+=i,s[r]-=i}function N(e,r){var i;r==="fill"&&(r="middle");var o;switch(r){case"top":case"bottom":case"left":case"right":i=r,o=n[i];break;case"middle":i="bottom",o=n.bottom+s.height/2-e.height/2;break;case"center":i="left",o=n.left+s.width/2-e.width/2}e.setPosition(t.set({},i,o))}function C(e,t){var n=new r.Sides;return A(e).forEach(function(e){n.set(e,t[e])}),n}function k(e,n,i,s){var o=i._layoutInfo.requestPaddings,u=!1;if(o){r.debug>=10&&(r.log("[GridDockingPanel] => clientSize="+JSON.stringify(i._layoutInfo.clientSize)),r.log("[GridDockingPanel] <= requestPaddings="+JSON.stringify(o))),A(e).forEach(function(e){if(o.hasOwnProperty(e)){var t=n[e]||0,i=Math.floor(1e4*(o[e]||0))/1e4,a=i-t;a!==0&&Math.abs(a)>=Math.abs(.01*t)&&(s?(u=!0,n[e]=i,r.debug>=5&&r.log("[Warning] [GridDockingPanel]   changed padding "+e+" <- "+i)):r.debug>=2&&r.log("[Warning] [GridDockingPanel] CANNOT change but child wanted to: "+e+"="+i))}});if(u){var a=r.Sides.names.map(function(e){return(n[e]||0).toFixed(3)}).join("|");t.hasOwn(p,a)?(r.debug>=2&&r.log("[GridDockingPanel] LOOP detected"),u=d):p[a]=!0,n.width=n.left+n.right,n.height=n.top+n.bottom}}return u}function L(e,t,i,s){var o=i._layoutInfo.overflowPaddings,u=!1;return o&&(r.debug>=10&&r.log("[GridDockingPanel] <= overflowPaddings="+JSON.stringify(o)),A(e).forEach(function(e){if(o.hasOwnProperty(e)){var i=t[e]||0,a=Math.floor(1e4*(o[e]||0))/1e4;a-=n[e];var f=a-i;f>Math.abs(.05*i)&&(s?(u=!0,t[e]=a,r.debug>=5&&r.log("[GridDockingPanel]   changed overflow padding "+e+" <- "+a)):r.debug>=2&&r.log("[Warning] [GridDockingPanel] CANNOT change overflow  padding but child wanted to: "+e+"="+a))}}),u&&(t.width=t.left+t.right,t.height=t.top+t.bottom)),u}function A(e){switch(e){case"left":case"right":return r.Sides.vnames;case"top":case"bottom":return r.Sides.hnames;case"fill":return r.Sides.names}}if(!this._children)return;var n=new r.Sides(0),i=new r.Sides(0),s=t.copyOwn(e.clientSize),o,u=r.BasePanel.orthogonalLength,a=r.BasePanel.relativeAnchor,f=r.BasePanel.parallelLength,l={force:!0,referenceSize:e.clientSize},c=[],h=[],p={},d={},v={},m=!1;this._children.forEach(b),h.forEach(w),y(9,g),e.gridMargins=new r.Sides(n),e.gridPaddings=new r.Sides(i),e.gridSize=new r.Size(s)}}),r.CartesianGridDockingPanel=r.GridDockingPanel.extend({applyExtensions:function(){this.base(),this.extend(this.pvPanel,"content_"),this.extend(this.xGridRule,"xAxisGrid_"),this.extend(this.yGridRule,"yAxisGrid_"),this.extend(this.pvFrameBar,"plotFrame_"),this.chart.options.compatVersion<=1&&(this.extend(this.pvFrameBar,"xAxisEndLine_"),this.extend(this.pvFrameBar,"yAxisEndLine_")),this.extend(this.xZeroLine,"xAxisZeroLine_"),this.extend(this.yZeroLine,"yAxisZeroLine_")},_createCore:function(e){var t=this.chart,n=t.axes,r=n.x,i=n.y;r.isVisible&&r.option("FullGrid")&&(this.xGridRule=this._createGridRule(r)),i.isVisible&&i.option("FullGrid")&&(this.yGridRule=this._createGridRule(i)),this.base(e);var s=t._mainContentPanel;if(s){var o=t.options.showPlotFrame;o==null&&(t.options.compatVersion<=1?o=!!r.option("EndLine")||!!i.option("EndLine"):o=!0),o&&(this.pvFrameBar=this._createFrame(e,n)),r.scaleType==="Continuous"&&r.option("ZeroLine")&&(this.xZeroLine=this._createZeroLine(r,e)),i.scaleType==="Continuous"&&i.option("ZeroLine")&&(this.yZeroLine=this._createZeroLine(i,e))}},_createGridRule:function(e){var t=e.scale,r;if(!t.isNull&&(r=e.ticks)){var i=this._layoutInfo.gridMargins,s=this._layoutInfo.gridPaddings,o=e.orientation==="x"?"left":"bottom",u=this.anchorLength(o),a=this.anchorOrtho(o),f=this.anchorOpposite(a),l=i[o]+s[o],c=i[a],h=i[f],p=e.scaleType==="Discrete";p&&(r=r.concat(r[r.length-1]));var d=this.pvPanel.add(n.Rule).data(r).zOrder(-12).strokeStyle("#f0f0f0")[a](c)[f](h)[u](null);if(!p)d[o](function(e){return l+t(e)});else{var v=t.range().step/2,m=r.length-1;d[o](function(e){var n=l+t(e.value);return n+(this.index<m?-v:v)})}return d}},_createFrame:function(e,t){if(t.base.scale.isNull||t.ortho.scale.isNull&&(!t.ortho2||t.ortho2.scale.isNull))return;var r=e.gridMargins,i=r.left,s=r.right,o=r.top,u=r.bottom,a=this.pvPanel.add(n.Bar).zOrder(-8).left(i).right(s).top(o).bottom(u).strokeStyle("#808285").lineWidth(.5).lock("fillStyle",null);return a},_createZeroLine:function(e,t){var r=e.scale;if(!r.isNull){var i=r.domain();if(i[0]*i[1]<=0){var s=e.orientation==="x"?"left":"bottom",o=this.anchorLength(s),u=this.anchorOrtho(s),a=this.anchorOpposite(u),f=t.gridMargins,l=t.gridPaddings,c=f[s]+l[s]+r(0),h=f[u],p=f[a];this.pvZeroLine=this.pvPanel.add(n.Rule).zOrder(-9).strokeStyle("#808285")[u](h)[a](p)[s](c)[o](null)}}},_getOrthoAxis:function(e){var t=e==="base"?"ortho":"base";return this.chart.axes[t]}}),r.CartesianAbstractPanel=r.BasePanel.extend({anchor:"fill",orientation:"vertical",stacked:!1,offsetPaddings:null,constructor:function(e,t,n){function o(e,t){var n=i[e];if(n==null||t>n)s=!0,i[e]=t}function u(e){var t=e&&e.option("Offset");t!=null&&t>=0&&(e.orientation==="x"?(o("left",t),o("right",t)):(o("top",t),o("bottom",t)))}this.base(e,t,n);var r=e.axes,i={},s=!1;u(r.x),u(r.secondX),u(r.y),u(r.secondY),s&&(this.offsetPaddings=i)},_calcLayout:function(e){e.requestPaddings=this._calcRequestPaddings(e)},_calcRequestPaddings:function(e){var t=this.offsetPaddings;if(!t)return;var n=this.chart._getAxesRoundingPaddings(),i=e.clientSize,s=e.paddings,o={};return r.Sides.names.forEach(function(e){var u=r.BasePanel.orthogonalLength[e],a=i[u],f=s[u],l=a+f,c=l*(t[e]||0),h=a*(n[e]||0);o[e]=Math.max(c-h,0)},this),o},_createCore:function(){this.pvPanel.zOrder(-10);var e=this.chart.axes.ortho,t=this.chart.axes.base;(e.option("FixedMin")!=null||e.option("FixedMax")!=null||t.option("FixedMin")!=null||t.option("FixedMax")!=null)&&this.pvPanel.borderPanel.overflow("hidden")},_getVisibleData:function(e,t){return this.chart._getVisibleData(e||this.dataPartValue,t)},applyExtensions:function(){this.base(),this.extend(this.pvPanel,"chart_")},isOrientationVertical:function(){return this.orientation===r.orientation.vertical},isOrientationHorizontal:function(){return this.orientation===r.orientation.horizontal},_detectDatumsUnderRubberBand:function(e,n,r){var i=!1,s=this.chart,o=s.xAxisPanel,u=s.yAxisPanel,a,f;return o&&(a={},o._detectDatumsUnderRubberBand(a,n,r)||(a=null)),u&&(f={},u._detectDatumsUnderRubberBand(f,n,r)||(f=null)),a&&f?(t.eachOwn(f,function(n,r){t.hasOwn(a,r)&&(e[n.key]=n,i=!0)}),r.toggle=!0):a?(t.copy(e,a),i=!0):f?(t.copy(e,f),i=!0):i=this.base(e,n,r),i}}),r.CategoricalAbstract=r.CartesianAbstract.extend({constructor:function(e){this.base(e),t.set(this._axisType2RoleNamesMap,"base","category","ortho",this.options.orthoAxisOrdinal?"series":"value");var n=this.parent;n&&(this._catRole=n._catRole)},_initVisualRoles:function(){this.base(),this._addVisualRoles({category:{isRequired:!0,defaultDimensionName:"category*",autoCreateDimension:!0}}),this._catRole=this.visualRoles("category")},_createVisibleData:function(e,t){var n=this._serRole&&this._serRole.flattenedGrouping(),r=this._catRole.flattenedGrouping(),i=this.partData(e),s={visible:!0,isNull:t?!1:null};return n?i.groupBy([r,n],s):i.groupBy(r,s)},_getVisibleRoleValueExtent:function(e,n){var r=n.role,i=n.dataPartValues;return i==null?this._getVisibleCellValueExtent(e,r,null):t.query(i).select(function(t){return this._getVisibleCellValueExtent(e,r,t)},this).reduce(this._unionReduceExtent,null)},_isDataCellStacked:function(e,t){return this.options.stacked},_getVisibleCellValueExtent:function(e,n,i){switch(n.name){case"series":case"category":return r.CartesianAbstract.prototype._getVisibleRoleValueExtent.call(this,e,{role:n,dataPartValues:i})}this._assertSingleContinuousValueRole(n);var s=n.firstDimensionName(),o=this._getVisibleData(i);return e.type!=="ortho"||!this._isDataCellStacked(n,i)?o.leafs().select(function(e){return e.dimensions(s).sum()}).range():o.children().select(function(e){var t=this._getStackedCategoryValueExtent(e,s);if(t)return{range:t,group:e}},this).where(t.notNully).reduce(function(e,t){return this._reduceStackedCategoryValueExtent(e,t.range,t.group)}.bind(this),null)},_getStackedCategoryValueExtent:function(e,t){var n=null,r=null;return e.children().select(function(e){return e.dimensions(t).sum()}).each(function(e){e!=null&&(e>=0?n+=e:r+=e)}),n==null&&r==null?null:{max:n||0,min:r||0}},_reduceStackedCategoryValueExtent:function(e,t,n){return this._unionReduceExtent(e,t)},markEventDefaults:{strokeStyle:"#5BCBF5",lineWidth:"0.5",textStyle:"#5BCBF5",verticalOffset:10,verticalAnchor:"bottom",horizontalAnchor:"right",forceHorizontalAnchor:!1,horizontalAnchorSwapLimit:80},markEvent:function(e,t,i){if(!this.options.timeSeries){r.log("Attempting to mark an event on a non timeSeries chart");return}var s=$.extend({},this.markEventDefaults,i),o=this.axes.base.scale,u=n.Format.date(this.options.timeSeriesFormat).parse(e),a=o(u),f=o.range();if(a<f[0]||a>f[1]){r.log("Event outside the allowed range, returning");return}var l=this._mainContentPanel.pvPanel,c=this.yScale.range()[1];if(!s.forceHorizontalAnchor){var h=s.horizontalAnchor=="right"?f[1]-a:a;h<s.horizontalAnchorSwapLimit&&(s.horizontalAnchor=s.horizontalAnchor=="right"?"left":"right")}var p=l.add(n.Line).data([0,c]).strokeStyle(s.strokeStyle).lineWidth(s.lineWidth).bottom(function(e){return e}).left(a);p.anchor(s.horizontalAnchor).top(s.verticalAnchor=="top"?s.verticalOffset:c-s.verticalOffset).add(n.Label).text(t).textStyle(s.textStyle).visible(function(){return!this.index})},defaults:t.create(r.CartesianAbstract.prototype.defaults,{orthoAxisOrdinal:!1,stacked:!1})}),r.AxisPanel=r.BasePanel.extend({showAllTimeseries:!1,pvRule:null,pvTicks:null,pvLabel:null,pvRuleGrid:null,pvScale:null,isDiscrete:!1,roleName:null,axis:null,anchor:"bottom",axisSize:undefined,tickLength:6,panelName:"axis",scale:null,ruleCrossesMargin:!0,font:"9px sans-serif",labelSpacingMin:1,domainRoundMode:"none",desiredTickCount:null,tickExponentMin:null,tickExponentMax:null,minorTicks:!0,_isScaleSetup:!1,constructor:function(e,n,i,s){s=t.create(s,{anchor:i.option("Position")});if(s.sizeMax==null){var o=s.axisSizeMax;if(o!=null){var u=s.anchor||this.anchor;s.sizeMax=(new r.Size).setSize(o,{singleProp:this.anchorOrthoLength(u)})}}this.base(e,n,s),this.axis=i,this.roleName=i.role.name,this.isDiscrete=i.role.grouping.isDiscrete();if(s.font===undefined){var a=this._getConstantExtension(this.panelName+"Label","font");a&&(this.font=a)}},getTicks:function(){return this._layoutInfo&&this._layoutInfo.ticks},_calcLayout:function(e){var t=this.axis.scale;return this._isScaleSetup||(this.pvScale=t,this.scale=t,this.extend(t,this.panelName+"Scale_"),this._isScaleSetup=!0),t.isNull?e.axisSize=0:this._calcLayoutCore(e),this.createAnchoredSize(e.axisSize,e.clientSize)},_calcLayoutCore:function(e){e.axisSize=this.axisSize,this.isDiscrete&&this.useCompositeAxis?e.axisSize==null&&(e.axisSize=50):(this._calcTicks(),e.axisSize==null&&this._calcAxisSizeFromLabel(),this._calcMaxTextLengthThatFits(),this._calcOverflowPaddings(),e.labelBBox=null)},_calcAxisSizeFromLabel:function(){this._calcLabelBBox(),this._calcAxisSizeFromLabelBBox()},_calcLabelBBox:function(){var e=this._layoutInfo,n=this.panelName+"Label",i=this._getExtension(n,"textAlign");typeof i!="string"&&(i=this.isAnchorTopOrBottom()?"center":this.anchor=="left"?"right":"left");var s=this._getExtension(n,"textBaseline");if(typeof s!="string")switch(this.anchor){case"right":case"left":case"center":s="middle";break;case"bottom":s="top";break;default:s="bottom"}var o=t.number.as(this._getExtension(n,"textAngle"),0),u=t.number.as(this._getExtension(n,"textMargin"),3);e.labelBBox=r.text.getLabelBBox(e.maxTextWidth,e.textHeight,i,s,o,u)},_calcAxisSizeFromLabelBBox:function(){var e=this._layoutInfo,t=e.labelBBox,n=this._getLabelBBoxQuadrantLength(t,this.anchor);e.axisSize=this.tickLength+n;var r=t.sourceAngle;if(r!==0||!this.isAnchorTopOrBottom())e.axisSize+=this.tickLength},_getLabelBBoxQuadrantLength:function(e,t){var n;switch(t){case"left":n=-e.x;break;case"right":n=e.x2;break;case"top":n=-e.y;break;case"bottom":n=e.y2}return Math.max(n,0)},_calcOverflowPaddings:function(){this._layoutInfo.labelBBox||this._calcLabelBBox(),this._calcOverflowPaddingsFromLabelBBox()},_calcOverflowPaddingsFromLabelBBox:function(){var e=this._layoutInfo,t=e.paddings,n=e.labelBBox,i=this.isAnchorTopOrBottom()?["left","right"]:["top","bottom"],s=this.scale.type==="Discrete",o;s&&(this.axis.setScaleRange(e.clientSize[this.anchorLength()]),o=this.scale.range().band/2);var u=null;i.forEach(function(e){var r=this._getLabelBBoxQuadrantLength(n,e);r>0&&(r-=t[e]||0,r>0&&(s&&(r-=o),r>1&&(s&&(r*=1.05),u||(u={}),u[e]=r)))},this),r.debug>=6&&u&&r.log("[OverflowPaddings] "+this.panelName+" "+JSON.stringify(u)),e.overflowPaddings=u},_calcMaxTextLengthThatFits:function(){var e=this._layoutInfo,t=e.clientSize[this.anchorOrthoLength()];if(e.axisSize<=t)e.maxTextWidth=null;else{var r=e.labelBBox;r||this._calcAxisSizeFromLabel();var i=t-2*this.tickLength,s,o;switch(this.anchor){case"left":o=n.vector(0,1),s=n.vector(-i,0);break;case"right":o=n.vector(0,1),s=n.vector(i,0);break;case"top":o=n.vector(1,0),s=n.vector(0,-i);break;case"bottom":o=n.vector(1,0),s=n.vector(0,i)}var u=r.sourceCorners,a=u[0],f=u[1],l=u[2],c=u[3],h=c.minus(l),p=f.minus(a),d=n.SvgScene.lineIntersect,v=d(s,o,a,p),m=d(s,o,l,h),g;Math.cos(r.sourceAngle)>=0?g=Math.min(c.minus(m).length(),f.minus(v).length()):g=Math.min(l.minus(m).length(),a.minus(v).length());if(r.sourceAlign==="center"){var y=r.sourceTextWidth-g;g-=y}e.maxTextWidth=g}},_calcTicks:function(){var e=this._layoutInfo;e.textHeight=r.text.getTextHeight("m",this.font),e.maxTextWidth=null,this.axis.setTicks(null);switch(this.scale.type){case"Discrete":this._calcDiscreteTicks();break;case"Timeseries":this._calcTimeseriesTicks();break;case"Continuous":this._calcNumberTicks(e);break;default:throw t.error.operationInvalid("Undefined axis scale type")}this.axis.setTicks(e.ticks),e.maxTextWidth==null&&(e.maxTextWidth=t.query(e.ticksText).select(function(e){return r.text.getTextLength(e,this.font)},this).max())},_calcDiscreteTicks:function(){var e=this._layoutInfo,n=this.chart.visualRoles(this.roleName).flatten(this.chart.data,{visible:!0});e.data=n,e.ticks=n._children,e.ticksText=t.query(n._children).select(function(e){return e.absLabel}).array()},_calcTimeseriesTicks:function(){this._calcContinuousTicks(this._layoutInfo,this.desiredTickCount)},_calcNumberTicks:function(e){var t,n;!e.canChange&&(n=e.previous)?t=n.ticks.length:t=this.desiredTickCount;if(t==null){if(this.isAnchorTopOrBottom()){this._calcNumberHTicks();return}t=this._calcNumberVDesiredTickCount()}this._calcContinuousTicks(this._layoutInfo,t)},_calcContinuousTicks:function(e,t){this._calcContinuousTicksValue(e,t),this._calcContinuousTicksText(e)},_calcContinuousTicksValue:function(e,t){e.ticks=this.scale.ticks(t,{roundInside:this.domainRoundMode!=="tick",numberExponentMin:this.tickExponentMin,numberExponentMax:this.tickExponentMax})},_calcContinuousTicksText:function(e){e.ticksText=t.query(e.ticks).select(function(e){return this.scale.tickFormat(e)},this).array()},_calcNumberVDesiredTickCount:function(){var e=this._layoutInfo,t=e.textHeight*(1+Math.max(0,this.labelSpacingMin)),n=e.clientSize[this.anchorLength()];return Math.max(1,~~(n/t))},_calcNumberHTicks:function(){var e=this._layoutInfo,t=e.clientSize[this.anchorLength()],n=e.textHeight*(1+Math.max(0,this.labelSpacingMin)),i=this._calcNumberHDesiredTickCount(this,n),s=r.debug>=7,o,u,a,f,l;do{s&&r.log("calculateNumberHTicks TickCount IN desired = "+i),a={},this._calcContinuousTicksValue(a,i);var c=a.ticks,h=c.length;if(c.exponentOverflow){if(o!=null){if(o===1){f&&(a=f);break}l&&(a=l);break}c.exponent===this.exponentMin?(f=a,o=1):(l=a,o=-1)}else if(u==null||h!==u){s&&r.log("calculateNumberHTicks TickCount desired/resulting = "+i+" -> "+h),u=h,this._calcContinuousTicksText(a);var p=this._calcNumberHLength(a,n),d=p-t,v=a.error=Math.abs(d/t);s&&(r.log("calculateNumberHTicks error="+(a.error*100).toFixed(0)+"% count="+h+" step="+c.step),r.log("calculateNumberHTicks Length client/resulting = "+t+" / "+p+" spacing = "+n));if(d>0){if(i===1)break;if(f){v>f.error&&(a=f);break}l=a,o=-1}else{if(v<=.05||o===-1){l&&v>l.error&&(a=l);break}f=a,o=1}}i+=o}while(!0);a&&(e.ticks=a.ticks,e.ticksText=a.ticksText,e.maxTextWidth=a.maxTextWidth,r.debug>=5&&r.log("calculateNumberHTicks RESULT error="+(a.error*100).toFixed(0)+"% count="+a.ticks.length+" step="+a.ticks.step)),s&&r.log("calculateNumberHTicks END")},_calcNumberHDesiredTickCount:function(e){var t=this._layoutInfo,n=this.scale.domain().map(function(e){var t=this.scale.tickFormat(e);return r.text.getTextLength(t,this.font)},this),i=Math.max((n[1]+n[0])/2,t.textHeight),s=t.clientSize[this.anchorLength()];return Math.max(1,~~(s/(i+e)))},_calcNumberHLength:function(e,t){var n=e.ticksText,i=n.length,s=0,o=-Infinity;for(var u=0;u<i;u++){var a=r.text.getTextLength(n[u],this.font);a>o&&(o=a),u&&(s+=t),!u||u===i-1?s+=a/2:s+=a}return e.maxTextWidth=o,s},_createCore:function(){this.renderAxis()},applyExtensions:function(){this.base(),this.extend(this.pvPanel,this.panelName+"_"),this.extend(this.pvRule,this.panelName+"Rule_"),this.extend(this.pvTicks,this.panelName+"Ticks_"),this.extend(this.pvLabel,this.panelName+"Label_"),this.extend(this.pvMinorTicks,this.panelName+"MinorTicks_")},renderAxis:function(){if(this.scale.isNull)return;var e=this._layoutInfo.clientSize,t=this._layoutInfo.paddings,r=this.anchorOrtho(),i=this.anchorOpposite(r),s=this.anchorOrthoLength(r),o=this.ruleCrossesMargin?-t[r]:0,u=e[s]+(this.ruleCrossesMargin?t[i]:0),a=u-o,f=this.pvPanel;this._rSize=a,this.pvRule=f.add(n.Rule).zOrder(30).strokeStyle("black")[this.anchorOpposite()](0)[s](a)[r](o).lineCap("square"),this.isDiscrete?this.useCompositeAxis?this.renderCompositeOrdinalAxis():this.renderOrdinalAxis():this.renderLinearAxis()},_getOrthoScale:function(){var e=this.axis.type==="base"?"ortho":"base";return this.chart.axes[e].scale},_getOrthoAxis:function(){var e=this.axis.type==="base"?"ortho":"base";return this.chart.axes[e]},renderOrdinalAxis:function(){function g(e,t){var n=e?e.apply(this,t):!0;return n&&this.index%c===0}var e=this,i=this.scale,s=this.anchorOpposite(),o=this.anchorLength(),u=this.anchorOrtho(),a=this.anchorOrthoLength(),f=this._layoutInfo.data,l=this._layoutInfo.ticks.length,c;if(this.axis.option("OverlappedLabelsHide")&&l>0&&this._rSize>0){var h=t.between(this.axis.option("OverlappedLabelsMaxPct"),0,.9),p=r.text.getTextHeight("m",this.font)*(1-h);c=Math.max(1,Math.ceil(l*p/this._rSize)),r.debug>=4&&r.log({overlapFactor:h,itemCount:l,textHeight:p,Size:this._rSize,modulo:l*p/this._rSize,itemSpan:l*p,itemAvailSpace:this._rSize/l}),r.debug>=3&&c>1&&r.log("Hiding every "+c+" labels in axis "+this.panelName)}else c=1;this.pvTicks=this.pvRule.add(n.Rule).zOrder(20).data(this._layoutInfo.ticks).localProperty("group").group(function(e){return e})[o](null)[u](function(e){return i(e.value)})[a](this.tickLength).strokeStyle("rgba(0,0,0,0)");var d=this.isAnchorTopOrBottom()?"center":this.anchor=="left"?"right":"left",v=this.font,m=this._layoutInfo.maxTextWidth;isFinite(m)||(m=0),this.pvLabel=this.pvTicks.anchor(this.anchor).add(n.Label).intercept("visible",g,this._getExtension(this.panelName+"Label","visible")).zOrder(40).textAlign(d).text(function(e){var t=e.absLabel;return m&&(t=r.text.trimToWidthB(m,t,v,"..",!0)),t}).font(v).localProperty("group").group(function(e){return e}),this._shouldHandleClick()&&this.pvLabel.cursor("pointer").events("all").event("click",function(t){var n=arguments[arguments.length-1];return e._handleClick(t,n)}),this.doubleClickAction&&this.pvLabel.cursor("pointer").events("all").event("dblclick",function(t){var n=arguments[arguments.length-1];e._handleDoubleClick(t,n)})},renderLinearAxis:function(){function h(e,t){var n=(!c.scene||c.scene[this.index].visible)&&this.index<s.length-1;return n&&(e?e.apply(this,t):!0)}var e=this.scale,t=this._getOrthoAxis(),r=t.scale,i=this._layoutInfo,s=i.ticks,o=this.anchorOpposite(),u=this.anchorLength(),a=this.anchorOrtho(),f=this.anchorOrthoLength(),l=Math.abs(s[1]-s[0]),c=this.pvTicks=this.pvRule.add(n.Rule).zOrder(20).data(s)[u](null)[a](e)[f](this.tickLength);this.minorTicks&&(this.pvMinorTicks=this.pvTicks.add(n.Rule).zOrder(20)[a](function(t){return e(+t+l/2)})[f](this.tickLength/2).intercept("visible",h,this._getExtension(this.panelName+"MinorTicks","visible"))),this.renderLinearAxisLabel(s,i.ticksText)},renderLinearAxisLabel:function(e,t){var i=this.pvTicks.anchor(this.anchor).addMargin(this.anchorOpposite(),2),s=this.scale,o=this.font,u=this._layoutInfo.maxTextWidth;isFinite(u)||(u=0);var a=this.pvLabel=i.add(n.Label).zOrder(40).text(function(e){var n=t[this.index];return u&&(n=r.text.trimToWidthB(u,n,o,"..",!0)),n}).font(this.font).textMargin(.5).visible(!0),f=this.pvPanel.root;this.isAnchorTopOrBottom()?a.textAlign(function(){var t;if(this.index===0){t=a.toScreenTransform().transformHPosition(a.left());if(t<=0)return"left"}else if(this.index===e.length-1){t=a.toScreenTransform().transformHPosition(a.left());if(t>=f.width())return"right"}return"center"}):a.textBaseline(function(){var t;if(this.index===0){t=a.toScreenTransform().transformVPosition(a.top());if(t>=f.height())return"bottom"}else if(this.index===e.length-1){t=a.toScreenTransform().transformVPosition(a.top());if(t<=0)return"top"}return"middle"})},_handleDoubleClick:function(e,t){if(!e)return;var n=this.doubleClickAction;n&&(this._ignoreClicks=2,n.call(null,e,t))},_shouldHandleClick:function(){var e=this.chart.options;return e.selectable||e.clickable&&this.clickAction},_handleClick:function(e,t){if(!e||!this._shouldHandleClick())return;if(!this.doubleClickAction)this._handleClickCore(e,t);else{var n=this,r=this.chart.options;window.setTimeout(function(){n._handleClickCore.call(n,e,t)},r.doubleClickMaxDelay||300)}},_handleClickCore:function(e,t){if(this._ignoreClicks){this._ignoreClicks--;return}var n=this.clickAction;n&&n.call(null,e,t);var r=this.chart.options;if(r.selectable&&this.isDiscrete){var i=r.ctrlSelectMode&&!t.ctrlKey;this._selectOrdinalElement(e,i)}},_selectOrdinalElement:function(e,t){var n=e.datums().array();n=this._onUserSelection(n),t&&this.chart.data.owner.clearSelected(),r.data.Data.toggleSelected(n),this._onSelectionChanged()},_dispatchRubberBandSelection:function(e){},_detectDatumsUnderRubberBand:function(e,t){function r(t){t.datums().each(function(t){e[t.key]=t,n=!0})}if(!this.isDiscrete||!this.isVisible)return!1;var n=!1;if(!this.useCompositeAxis){var i=this.pvLabel;i.eachInstance(function(e,n){if(!e.isBreak){var s=e.group;if(s){var o=i.getInstanceShape(e).apply(n);o.intersectsRect(t)&&r(s)}}},this)}else{var s=this._pvLayout.toScreenTransform();this._rootElement.visitBefore(function(e,n){if(n>0){var i=s.transformHPosition(e.x+e.dx/2),o=s.transformVPosition(e.y+e.dy/2);t.containsPoint(i,o)&&r(e)}})}return n},renderCompositeOrdinalAxis:function(){var e=this,i=this.isAnchorTopOrBottom(),s=i?"h":"v",o=this._calcTipsyGravity(),u=2,a=2,f=this._pvLayout=this.getLayoutSingleCluster();f.node.def("fitInfo",null).height(function(t,n,i){var o=r.text.getFitInfo(t.dx,t.dy,t.label,e.font,h);return o.h||(s=="v"&&o.v?a=Math.min(u,t.depth):u=Math.min(u,t.depth)),this.fitInfo(o),t.dy}),f.node.add(n.Bar).fillStyle("rgba(127,127,127,.001)").strokeStyle(function(e){return e.maxDepth===1||!e.maxDepth?null:"rgba(127,127,127,0.3)"}).lineWidth(function(e){return e.maxDepth===1||!e.maxDepth?0:.5}).text(function(e){return e.label});var l=.3,c=1.27,h=r.text.getFontSize(this.font)/2,p=i?"center":this.anchor=="left"?"right":"left";this.pvLabel=f.label.add(n.Label).def("lblDirection","h").textAngle(function(e){if(e.depth>=a&&e.depth<u)return this.lblDirection("v"),-Math.PI/2;if(e.depth>=u){var t=e.dy/e.dx,n=Math.atan(t);if(n>c)return this.lblDirection("v"),-Math.PI/2;if(n>l)return this.lblDirection("d"),-n}return this.lblDirection("h"),0}).textMargin(1).textAlign(function(e){return s!="v"||e.depth>=a||e.depth>=u?"center":p}).left(function(e){return s!="v"||e.depth>=a||e.depth>=u?e.x+e.dx/2:p=="right"?e.x+e.dx:e.x}).font(this.font).text(function(t){var n=this.fitInfo();switch(this.lblDirection()){case"h":if(!n.h)return r.text.trimToWidth(t.dx,t.label,e.font,"..");break;case"v":if(!n.v)return r.text.trimToWidth(t.dy,t.label,e.font,"..");break;case"d":if(!n.d){var i=Math.sqrt(t.dy*t.dy+t.dx*t.dx);return r.text.trimToWidth(i-h,t.label,e.font,"..")}}return t.label}).cursor("default").events("all"),this._shouldHandleClick()&&this.pvLabel.cursor("pointer").event("click",function(t){var n=arguments[arguments.length-1];return e._handleClick(t,n)}),this.doubleClickAction&&this.pvLabel.cursor("pointer").event("dblclick",function(t){var n=arguments[arguments.length-1];e._handleDoubleClick(t,n)});var d=t.set(Object.create(this.chart.options.tipsySettings),"gravity",o,"offset",h*2);this.pvLabel.title(function(e){return this.instance().tooltip=e.label,""}).event("mouseover",n.Behavior.tipsy(d))},getLayoutSingleCluster:function(){var e=this.anchor,t=e=="bottom"||e=="left",i=this.chart.visualRoles(this.roleName).select(this.chart.data,{visible:!0,reverse:t}),s=i.treeHeight,o=i.nodes(),u=this._layoutInfo.axisSize;this._rootElement=o[0],s++;var a=u/s,f=s>2?1/12*u:0;a-=f;var l=s/(s-1),c=r.BasePanel.orthogonalLength[e],h=c=="width"?e==="left"?[-a,0]:[a,0]:e==="top"?[0,-a]:[0,a];this.pvRule.strokeStyle(null).lineWidth(0);var p=this.pvRule.add(n.Panel)[c](u).strokeStyle(null).lineWidth(0).add(n.Panel)[c](u*l).strokeStyle(null).lineWidth(0);return p.transform(n.Transform.identity.translate(h[0],h[1])),p.add(n.Layout.Cluster.Fill).nodes(o).orient(e)},_calcTipsyGravity:function(){switch(this.anchor){case"bottom":return"s";case"top":return"n";case"left":return"w";case"right":return"e"}return"s"}}),r.AxisPanel.create=function(e,n,i,s){var o=r[t.firstUpperCase(i.orientedId)+"AxisPanel"]||t.fail.argumentInvalid("cartAxis","Unsupported cartesian axis");return new o(e,n,i,s)},r.XAxisPanel=r.AxisPanel.extend({anchor:"bottom",panelName:"xAxis"}),r.SecondXAxisPanel=r.XAxisPanel.extend({panelName:"secondXAxis"}),r.YAxisPanel=r.AxisPanel.extend({anchor:"left",panelName:"yAxis"}),r.SecondYAxisPanel=r.YAxisPanel.extend({panelName:"secondYAxis"}),r.AxisTitlePanel=r.TitlePanelAbstract.extend({panelName:"axis",_getFontExtension:function(){return this._getExtension(this.panelName+"TitleLabel","font")},applyExtensions:function(){this.extend(this.pvPanel,this.panelName+"Title_"),this.extend(this.pvLabel,this.panelName+"TitleLabel_")}}),r.PieChartPanel=r.BasePanel.extend({anchor:"fill",pvPie:null,pvPieLabel:null,explodedOffsetRadius:0,explodedSliceIndex:null,activeOffsetRadius:new r.PercentValue(.05),valueRoleName:"value",showValues:!0,valuesMask:null,labelStyle:"linked",labelFont:"10px sans-serif",linkedLabel:{linkInsetRadius:new r.PercentValue(.05),linkOutsetRadius:new r.PercentValue(.025),linkMargin:new r.PercentValue(.025),linkHandleWidth:.5,labelSize:new r.PercentValue(.15),labelSpacingMin:.5},constructor:function(e,n,i){i||(i={});var s=e.options.compatVersion<=1;s&&i.labelStyle==null&&(i.labelStyle="inside");if(i.paddings==null){var o=i.innerGap||.95;delete i.innerGap,o>0&&o<1&&(i.paddings=Math.round((1-o)*100/2)+"%")}["explodedOffsetRadius","activeOffsetRadius"].forEach(function(e){var t=i[e];t!=null&&(i[e]=r.PercentValue.parse(t))});var u=i.labelStyle||this.labelStyle,a=u==="linked",f=i.valuesMask;f==null&&(i.valuesMask=a?"{value} ({value.percent})":"{value}");if(a){var l=i.linkedLabel;if(l){var c=i.linkedLabel=Object.create(this.linkedLabel);t.copy(c,l),["linkInsetRadius","linkOutsetRadius","linkMargin","labelSize"].forEach(function(e){var t=c[e];t!=null&&(c[e]=r.PercentValue.parse(t))})}}this.base(e,n,i)},_getCoreInfo:function(){return this._coreInfo||(this._coreInfo={rootScene:this._buildScene()}),this._coreInfo},_calcLayout:function(e){function a(e){return t.between(r.PercentValue.resolve(e,o),0,o)}function f(e){return t.between(r.PercentValue.resolve(e,s),0,s)}var i=e.clientSize,s=i.width,o=Math.min(s,i.height)/2;if(!o)return new r.Size(0,0);var u=n.vector(i.width/2,i.height/2),l=t.number.to(this._getExtension("pieLabel","font"));t.string.is(l)||(l=this.labelFont);var c=o;if(this.showValues&&this.labelStyle==="linked"){var h=this.linkedLabel,p=a(h.linkInsetRadius),d=a(h.linkOutsetRadius),v=f(h.linkMargin),m=f(h.labelSize),g=t.number.to(this._getExtension("pieLabel","textMargin"),3),y=r.text.getTextHeight("m",l),b=h.linkHandleWidth*y;v+=b;var w=h.labelSpacingMin*y,E=Math.max(0,s/2-o),S=Math.max(0,d+v+m-E),x=d+y,T=Math.max(0,x,S);T>=c?(this.showValues=!1,r.debug>=2&&r.log("Hiding linked labels due to insufficient space.")):(c-=T,e.link={insetRadius:p,outsetRadius:d,elbowRadius:c+d,linkMargin:v,handleWidth:b,labelSize:m,maxTextWidth:m-g,labelSpacingMin:w,textMargin:g,lineHeight:y})}var N=a(this.explodedOffsetRadius),C=0;this.chart.options.hoverable&&(C=a(this.activeOffsetRadius));var k=N+C,L=c-k;if(L<0)return new r.Size(0,0);e.center=u,e.clientRadius=o,e.normalRadius=L,e.explodedOffsetRadius=N,e.activeOffsetRadius=C,e.labelFont=l},_createCore:function(e){var i=this,s=this.chart,o=s.options,u={visible:!0},a=this._getCoreInfo(),f=a.rootScene,l=e.center,c=e.normalRadius;this.pvPie=(new r.visual.PieSlice(this,this.pvPanel,{extensionId:"pie",center:e.center,activeOffsetRadius:e.activeOffsetRadius})).lockValue("data",f.childNodes).override("angle",function(e){return e.vars.value.angle}).override("baseOffsetRadius",function(){var t=i.explodedSliceIndex;return t==null||t==this.pvMark.index?e.explodedOffsetRadius:this.base()}).lock("outerRadius",function(){return s.animate(0,c)}).intercept("innerRadius",function(e){var t=r.PercentValue.parse(this.delegate());return t instanceof r.PercentValue&&(t=t.resolve(this.pvMark.outerRadius())),t>0?s.animate(0,t):0},!0).pvMark;if(this.showValues){if(this.labelStyle==="inside")this.pvPieLabel=this.pvPie.anchor("outer").add(n.Label).intercept("visible",function(e,t){var n=t[0],r=n.vars.value.angle;return r<.001?!1:!e||e.apply(null,t)},this._getExtension("pieLabel","visible")).localProperty("group").group(function(e){return e.group}).text(function(e){return e.vars.value.sliceLabel}).textMargin(10);else if(this.labelStyle==="linked"){var h=e.link;f.layoutLinkLabels(e),this.pvLinkPanel=this.pvPanel.add(n.Panel).data(f.childNodes).localProperty("pieSlice").pieSlice(function(e){return i.pvPie.scene[this.index]}),this.pvLinkLine=this.pvLinkPanel.add(n.Line).data(function(e){var t=this.parent.pieSlice(),r=t.startAngle+t.angle/2,i=t.outerRadius-h.insetRadius,s=n.vector(t.left+i*Math.cos(r),t.top+i*Math.sin(r));return[s].concat(e.vars.link.dots)}).lock("visible").top(function(e){return e.y}).left(function(e){return e.x}).strokeStyle("black").lineWidth(.5),this.pvPieLabel=this.pvLinkPanel.add(n.Label).data(function(e){return e.vars.link.labelLines}).lock("visible").localProperty("group").group(function(e,t){return t.group}).left(function(e,t){return t.vars.link.labelX}).top(function(e,t){return t.vars.link.labelY+(this.index+1)*h.lineHeight}).textAlign(function(e,t){return t.vars.link.labelAnchor}).textBaseline("bottom").textMargin(h.textMargin).text(t.identity).fillStyle("red"),this._shouldHandleClick()&&(this.pvPieLabel.events("all"),this._addPropClick(this.pvPieLabel));if(r.debug>=20){this.pvPanel.add(n.Panel).zOrder(-10).left(e.center.x-e.clientRadius).top(e.center.y-e.clientRadius).width(e.clientRadius*2).height(e.clientRadius*2).strokeStyle("red"),this.pvPanel.strokeStyle("green");var p=n.Colors.category10();this.pvLinkLine.segmented(!0).strokeStyle(function(){return p(this.index)})}}this.pvPieLabel.font(e.labelFont)}},applyExtensions:function(){this.extend(this.pvPie,"pie_"),this.extend(this.pvPieLabel,"pieLabel_"),this.extend(this.pvLinkLine,"pieLinkLine_"),this.extend(this.pvPanel,"chart_")},_renderInteractive:function(){this.pvPanel.render()},_getSignums:function(){var e=[this.pvPie];return this.pvPieLabel&&e.push(this.pvPieLabel),e},_buildScene:function(){var e=new r.visual.PieRootScene(this);return this.sum=e.vars.sumAbs.value,e}}),t.type("pvc.visual.PieRootScene",r.visual.Scene).init(function(e){function d(e,t){if(t){var n=t._datums;if(n.length===1)return n[0].atoms[u].label}return a.format(e)}function v(){var e=this.vars.value;e.angle=this.parent.angleScale(e.value);var t=Math.abs(e.value)/h;e.percent=new r.visual.ValueLabelVar(t,l(t)),e.sliceLabel=this.sliceLabel()}var i=e.chart,s=i.visualRoles("category").flatten(i.data,r.data.visibleKeyArgs);this.base(null,{panel:e,group:s});var o=e.valueRoleName,u=i.visualRoles(o).firstDimensionName(),a=s.dimensions(u),f=i.options,l=f.percentValueFormat,c=this,h=0,p=t.type(r.visual.PieCategoryScene).init(function(e,t){this.base(c,{group:e}),this.vars.category=new r.visual.ValueLabelVar(e.value,e.label),h+=Math.abs(t),this.vars.value=new r.visual.ValueLabelVar(t,d(t,e))});e._extendSceneType("category",p,["sliceLabel","sliceLabelMask"]),s.children().each(function(e){var t=e.dimensions(u).sum(r.data.visibleKeyArgs);t!==0&&new p(e,t)}),this.angleScale=n.Scale.linear(0,h).range(0,2*Math.PI).by1(Math.abs),this.vars.sumAbs=new r.visual.ValueLabelVar(h,d(h)),this.childNodes.forEach(function(e){v.call(e)})}).add({layoutLinkLabels:function(e){var t=-Math.PI/2,n=[],r=[];this.childNodes.forEach(function(i){t=i.layoutI(e,t),(i.vars.link.dir>0?r:n).push(i)}),this._distributeLabels(-1,n,e),this._distributeLabels(1,r,e)},_distributeLabels:function(e,n,r){n.sort(function(e,n){return t.compare(e.vars.link.targetY,n.vars.link.targetY)}),this._distributeLabelsDownwards(n,r)&&this._distributeLabelsUpwards(n,r)&&this._distributeLabelsEvenly(n,r),n.forEach(function(e){e.layoutII(r)})},_distributeLabelsDownwards:function(e,t){var n=t.link,r=n.labelSpacingMin,i=t.clientSize.height,s=!1;for(var o=0,u=e.length-1;o<u;o++){var a=e[o].vars.link;!o&&a.labelTop()<0&&(s=!0);var f=e[o+1].vars.link,l=a.labelBottom()+r;if(f.labelTop()<l){var c=f.labelHeight/2,h=l+c,p=i-c;h>p?(s=!0,f.targetY=p):f.targetY=h}}return s},_distributeLabelsUpwards:function(e,t){var n=t.link,r=n.labelSpacingMin,i=!1;for(var s=e.length-1;s>0;s--){var o=e[s-1].vars.link,u=e[s].vars.link;s===1&&o.labelTop()<0&&(i=!0);var a=u.labelTop()-r;if(o.labelBottom()>a){var f=o.labelHeight/2,l=a-f,c=f;l<c?(i=!0,o.targetY=c):o.targetY=l}}return i},_distributeLabelsEvenly:function(e,t){var n=t.link,r=n.labelSpacingMin,i=0;e.forEach(function(e){i+=e.vars.link.labelHeight});var s=t.clientSize.height-i,o=s;e.length>1&&(o/=e.length-1);var u=0;return e.forEach(function(e){var t=e.vars.link,n=t.labelHeight/2;u+=n,t.targetY=u,u+=n+o}),!0}}),t.type("pvc.visual.PieLinkLabelVar").add({labelTop:function(){return this.targetY-this.labelHeight/2},labelBottom:function(){return this.targetY+this.labelHeight/2}}),t.type("pvc.visual.PieCategoryScene",r.visual.Scene).add({sliceLabelMask:function(){return this.panel().valuesMask},sliceLabel:function(){return this.format(this.sliceLabelMask())},layoutI:function(e,t){var i=this.vars.value,s=t+i.angle,o=(t+s)/2,u=this.vars.link=new r.visual.PieLinkLabelVar,a=e.link,f=r.text.justify(i.sliceLabel,a.maxTextWidth,e.labelFont);u.labelLines=f,u.labelHeight=f.length*a.lineHeight;var l=Math.cos(o),c=Math.sin(o),h=l>=0,p=h?1:-1;u.labelAnchor=h?"left":"right";var d=e.center,v=a.elbowRadius,m=d.x+v*l,g=d.y+v*c,y=d.x+p*v,b=y+p*a.linkMargin;return u.dots=[n.vector(m,g),n.vector(y,g)],u.elbowY=g,u.targetY=g+0,u.targetX=b,u.dir=p,s},layoutII:function(e){var t=this.vars.link,r=t.targetY,i=t.targetX,s=t.dots,o=e.link.handleWidth;o>0&&s.push(n.vector(i-t.dir*o,r)),s.push(n.vector(i,r)),t.labelX=i,t.labelY=r-t.labelHeight/2}}),r.PieChart=r.BaseChart.extend({pieChartPanel:null,legendSource:"category",_initVisualRoles:function(){this.base(),this._addVisualRoles({category:{isRequired:!0,defaultDimensionName:"category*",autoCreateDimension:!0},value:{isMeasure:!0,isRequired:!0,isPercent:!0,requireSingleDimension:!0,requireIsDiscrete:!1,valueType:Number,defaultDimensionName:"value"}})},_preRenderContent:function(e){this.base(),r.debug>=3&&r.log("Prerendering in pieChart");var n=this.options;this.pieChartPanel=new r.PieChartPanel(this,this.basePanel,t.create(e,{innerGap:n.innerGap,explodedOffsetRadius:n.explodedSliceRadius,explodedSliceIndex:n.explodedSliceIndex,activeOffsetRadius:n.activeSliceRadius,showValues:n.showValues,valuesMask:n.valuesMask,labelStyle:n.valuesLabelStyle,linkedLabel:n.linkedLabel,labelFont:n.valuesLabelFont,scenes:t.getPath(n,"pie.scenes")}))},defaults:t.create(r.BaseChart.prototype.defaults,{})}),r.BarAbstractPanel=r.CartesianAbstractPanel.extend({pvBar:null,pvBarLabel:null,pvCategoryPanel:null,pvSecondLine:null,pvSecondDot:null,data:null,barSizeRatio:.9,maxBarSize:200,showValues:!0,barWidth:null,barStepWidth:null,_linePanel:null,constructor:function(e,t,n){this.base(e,t,n),n=this.chart.options,this.stacked=n.stacked},_creating:function(){var e=this.defaultVisibleBulletGroupScene();if(e&&!e.hasRenderer()){var t=e.colorAxis;if(t.option("DrawMarker")){var i={drawMarker:!0,markerShape:t.option("Shape"),drawRule:t.option("DrawLine"),markerPvProto:new n.Mark};this.extend(i.markerPvProto,"bar_",{constOnly:!0}),e.renderer(new r.visual.legend.BulletItemDefaultRenderer(i))}}},_createCore:function(){this.base();var e=this.chart,t=e.options,i=!!this.stacked,s=this.isOrientationVertical(),o=this._getVisibleData(),u=e._serRole.flatten(o),a=this._buildScene(o,u),f=e.axes.ortho.scale,l=f(0),c=e.axes.ortho.sceneScale({sceneVarName:"value",nullToZero:!1}),h=e.axes.base.scale.range().band,p=e.axes.base.scale.range().step,d,v=s===i;if(i)d=h;else{var m=u.childCount();d=m>0?h*this.barSizeRatio/m:0}d>this.maxBarSize&&(d=this.maxBarSize),this.barWidth=d,this.barStepWidth=p,this.pvBarPanel=this.pvPanel.add(n.Layout.Band).layers(a.childNodes).values(function(e){return e.childNodes}).orient(s?"bottom-left":"left-bottom").layout(i?"stacked":"grouped").verticalMode(this._barVerticalMode()).yZero(l).band.x(e.axes.base.sceneScale({sceneVarName:"category"})).w(h).differentialControl(this._barDifferentialControl()).item.order(v?"reverse":null).h(function(t){var n=c(t);return n!=null?e.animate(0,n-l):null}).w(d).horizontalRatio(this.barSizeRatio).verticalMargin(t.barStackedMargin||0).end,this.pvBar=(new r.visual.Bar(this,this.pvBarPanel.item,{extensionId:"bar",freePosition:!0})).lockDimensions().pvMark.antialias(!1),this._addOverflowMarkers(),this.showValues&&(this.pvBarLabel=this.pvBar.anchor(this.valuesAnchor||"center").add(n.Label).localProperty("_valueVar")._valueVar(function(e){return t.showValuePercentage?e.vars.value.percent:e.vars.value}).visible(function(){var e=this.scene.target[this.index][s?"height":"width"];return e>=4}).text(function(){return this._valueVar().label}))},_barVerticalMode:function(){return null},_barDifferentialControl:function(){return null},applyExtensions:function(){this.base(),this.extend(this.pvBarPanel,"barPanel_"),this.extend(this.pvBar,"bar_"),this.extend(this.pvUnderflowMarker,"barUnderflowMarker_"),this.extend(this.pvOverflowMarker,"barOverflowMarker_"),this.extend(this.pvBarLabel,"barLabel_"),this._linePanel&&(this.extend(this._linePanel.pvLine,"barSecondLine_"),this.extend(this._linePanel.pvDot,"barSecondDot_"))},_addOverflowMarkers:function(){var e=this.chart.axes.ortho;e.option("FixedMax")!=null&&(this.pvOverflowMarker=this._addOverflowMarker(!1,e.scale)),e.option("FixedMin")!=null&&(this.pvUnderflowMarker=this._addOverflowMarker(!0,e.scale))},_addOverflowMarker:function(e,t){},_renderInteractive:function(){this.pvPanel.render()},_getSignums:function(){return[this.pvBar]},_buildScene:function(e,n){function o(t){var n=new r.visual.Scene(i,{group:t}),o=t.key;this._onNewSeriesScene(n,t),s.forEach(function(i){var s=i.key,a=e._childrenByKey[s]._childrenByKey[o],f=a?null:u(t,i),l=new r.visual.Scene(n,{group:a,datum:f});this._onNewSeriesCategoryScene(l,i,t)},this)}function u(n,i){var s=t.array.append(t.own(n.atoms),t.own(i.atoms));return new r.data.Datum(e,s,!0)}var i=new r.visual.Scene(null,{panel:this,group:e}),s=e._children;return n.children().each(o,this),i},_onNewSeriesScene:function(e,t){e.vars.series=new r.visual.ValueLabelVar(t.value,t.label)},_onNewSeriesCategoryScene:function(e,t,n){var i=e.vars.category=new r.visual.ValueLabelVar(t.value,t.label);i.group=t;var s=this.chart,o=e.group?e.group.dimensions(s._valueDim.name):null,u=o?o.sum({visible:!0,zeroIfNone:!1}):null,a=e.vars.value=new r.visual.ValueLabelVar(u,s._valueDim.format(u));if(s.options.showValuePercentage)if(u==null)a.percent=new r.visual.ValueLabelVar(null,a.label);else{var f=o.percentOverParent({visible:!0});a.percent=new r.visual.ValueLabelVar(f,s.options.percentValueFormat.call(null,f))}e.isNull=!e.group}}),r.BarAbstract=r.CategoricalAbstract.extend({constructor:function(e){this.base(e);var t=this.parent;t&&(this._valueRole=t._valueRole)},_initVisualRoles:function(){this.base(),this._addVisualRoles({value:{isMeasure:!0,isRequired:!0,isPercent:this.options.stacked,requireSingleDimension:!0,requireIsDiscrete:!1,valueType:Number,defaultDimensionName:"value"}}),this._valueRole=this.visualRoles("value")},_initData:function(){this.base.apply(this,arguments);var e=this.data;this._valueDim=e.dimensions(this._valueRole.firstDimensionName())},defaults:t.create(r.CategoricalAbstract.prototype.defaults,{showValues:!0,barSizeRatio:.9,maxBarSize:2e3,barStackedMargin:0,valuesAnchor:"center",showValuePercentage:!1})}),r.BarPanel=r.BarAbstractPanel.extend({}),r.BarChart=r.BarAbstract.extend({_processOptionsCore:function(e){this.base(e),e.secondAxis&&!e.showLines&&!e.showDots&&!e.showAreas&&(e.showLines=!0)},_hasDataPartRole:function(){return!0},_getAxisDataCells:function(e,t){if(this.options.secondAxis){var n;e==="ortho"?n=this.options.secondAxisIndependentScale?""+t:["0","1"]:e==="color"&&(n=""+t);if(n!=null)return this._buildAxisDataCells(e,t,n)}return this.base(e,t)},_isDataCellStacked:function(e,t){return(!t||t==="0")&&this.options.stacked},_createMainContentPanel:function(e){r.debug>=3&&r.log("Prerendering in barChart");var t=this.options,n=new r.BarPanel(this,e,{colorAxis:this.axes.color,dataPartValue:t.secondAxis?"0":null,barSizeRatio:t.barSizeRatio,maxBarSize:t.maxBarSize,showValues:t.showValues,valuesAnchor:t.valuesAnchor,orientation:t.orientation});if(t.secondAxis){r.debug>=3&&r.log("Creating LineDotArea panel.");var i=new r.LineDotAreaPanel(this,e,{colorAxis:this.axes.color2,dataPartValue:"1",stacked:!1,showValues:!(t.compatVersion<=1)&&t.showValues,valuesAnchor:t.valuesAnchor!="center"?t.valuesAnchor:"right",showLines:t.showLines,showDots:t.showDots,showAreas:t.showAreas,orientation:t.orientation,nullInterpolationMode:t.nullInterpolationMode});this._linePanel=i,n._linePanel=i}return n},defaults:t.create(r.BarAbstract.prototype.defaults,{showDots:!0,showLines:!0,showAreas:!1,nullInterpolationMode:"none"})}),r.NormalizedBarPanel=r.BarAbstractPanel.extend({_barVerticalMode:function(){return"expand"}}),r.NormalizedBarChart=r.BarAbstract.extend({constructor:function(e){e=t.set(e,"stacked",!0),this.base(e)},_processOptionsCore:function(e){e.stacked=!0,this.base(e)},_getVisibleValueExtentConstrained:function(e,t,n){return e.type==="ortho"&&(t=0,n=100),this.base(e,t,n)},_createMainContentPanel:function(e){r.debug>=3&&r.log("Prerendering in NormalizedBarChart");var t=this.options;return new r.NormalizedBarPanel(this,e,{barSizeRatio:t.barSizeRatio,maxBarSize:t.maxBarSize,showValues:t.showValues,valuesAnchor:t.valuesAnchor,orientation:t.orientation})}}),r.WaterfallPanel=r.BarAbstractPanel.extend({pvWaterfallLine:null,ruleData:null,_barDifferentialControl:function(){var e=this.chart._isFalling;return function(t){return e&&!this.index?1:t.vars.category.group._isFlattenGroup?-2:e?-1:1}},_createCore:function(){this.base();var e=this.chart,t=e.options,i=this.isOrientationVertical(),s=i?"bottom":"left",o=this.anchorOrtho(s),u=this._buildRuleScene(),a=e.axes.ortho.scale,f=.04*(a.range()[1]-a.range()[0]),l=a(0),c=e.axes.ortho.sceneScale({sceneVarName:"value"}),h=e.axes.base.sceneScale({sceneVarName:"category"}),p=e.axes.base.scale,d=this.barWidth/2,v=this.barWidth,m=this.barStepWidth,g=e._isFalling,y=e._waterColor;if(e.options.showWaterGroupAreas){var b=n.Colors.category10(),w=this._buildWaterGroupScene();this.pvWaterfallGroupPanel=this.pvPanel.add(n.Panel).data(w.childNodes).zOrder(-1).fillStyle(function(e){return b(0).alpha(.15)})[o](function(e){var t=e.vars.category;return p(t.leftValue)-m/2})[this.anchorLength(s)](function(e){var t=e.vars.category,n=Math.abs(p(t.rightValue)-p(t.leftValue));return n+m})[s](function(e){return a(e.vars.value.bottomValue)-f/2})[this.anchorOrthoLength(s)](function(e){return a(e.vars.value.heightValue)+f})}this.pvBar.sign.override("baseColor",function(e){var t=this.base(e);return e==="fill"&&this.scene.vars.category.group._isFlattenGroup?n.color(t).alpha(.75):t}),this.pvWaterfallLine=(new r.visual.Rule(this,this.pvPanel,{extensionId:"barWaterfallLine",noTooltips:!1,noHover:!1,noSelect:!1,noClick:!1,noDoubleClick:!1})).lockValue("data",u.childNodes).optional("visible",function(){return g&&!!this.scene.previousSibling||!g&&!!this.scene.nextSibling}).optional(s,function(){return l+e.animate(0,c(this.scene)-l)}).optionalValue(this.anchorLength(s),m+v).optional(o,g?function(){return h(this.scene)-m-d}:function(){return h(this.scene)-d}).override("baseColor",function(){return this.delegate(y)}).pvMark.lineCap("round"),e.options.showWaterValues&&(this.pvWaterfallLabel=this.pvWaterfallLine.add(n.Label)[s](function(t){return l+e.animate(0,c(t)-l)}).visible(function(e){return e.vars.category.group._isFlattenGroup?!1:g||!!e.nextSibling})[this.anchorOrtho(s)](h).textAlign(i?"center":"left").textBaseline(i?"bottom":"middle").textStyle(n.Color.names.darkgray.darker(2)).textMargin(5).text(function(e){return e.vars.value.label}))},applyExtensions:function(){this.base(),this.extend(this.pvWaterfallLine,"barWaterfallLine_"),this.extend(this.pvWaterfallLabel,"barWaterfallLabel_"),this.extend(this.pvWaterfallGroupPanel,"barWaterfallGroup_")},_buildRuleScene:function(){function t(t){var n=t.group,i=new r.visual.Scene(e,{group:n}),s=i.vars.category=new r.visual.ValueLabelVar(n.value,n.label);s.group=n;var o=t.offset;i.vars.value=new r.visual.ValueLabelVar(o,this.chart._valueDim.format(o))}var e=new r.visual.Scene(null,{panel:this,group:this._getVisibleData()});return this.chart._ruleInfos&&this.chart._ruleInfos.forEach(t,this),e},_buildWaterGroupScene:function(){function a(e,t){var n=e.children().where(function(e){return e.key!==""}).array();if(n.length){if(t){var o=new r.visual.Scene(u,{group:e}),c=o.vars.category=new r.visual.ValueLabelVar(e.value,e.label);c.group=e,c.level=t;var h=o.vars.value={},p=i[e.absKey],d=p.offset,v=p.range,m=-v.min+v.max;if(s){var g=l(e),y=i[g.absKey];c.leftValue=p.group.value,c.rightValue=y.group.value,h.bottomValue=d-v.max}else{var b=f(e),w=i[b.absKey];c.leftValue=w.group.value,c.rightValue=p.group.value,h.bottomValue=d-v.max}h.heightValue=m}n.forEach(function(e){a(e,t+1)})}}function f(e){var t=e._children&&e._children[0];return t?f(t):e}function l(e){var t=e._children&&e._children[e._children.length-1];return t?l(t):e}var e=this.chart,n=this.chart._ruleInfos,i=n&&t.query(n).object({name:function(e){return e.group.absKey},value:function(e){return e}}),s=e._isFalling,o=e._catRole.select(e.partData(this.dataPartValue),{visible:!0}),u=new r.visual.Scene(null,{panel:this,group:o});return i&&a(o,0),u}}),r.WaterfallChart=r.BarAbstract.extend({_isFalling:!0,_ruleInfos:null,_waterColor:n.Color.names.darkblue,constructor:function(e){this.base(e);var t=this.parent;t&&(this._isFalling=t._isFalling)},_processOptionsCore:function(e){e.stacked=!0,e.showWaterValues===undefined&&(e.showWaterValues=e.showValues),e.useCompositeAxis=!1,this.base(e)},_initVisualRoles:function(){this.base(),this._isFalling=this.options.waterDirection==="down",this._catRole.setFlatteningMode(this._isFalling?"tree-pre":"tree-post"),this._catRole.setFlattenRootLabel(this.options.allCategoryLabel)},_initLegendScenes:function(){this.base();var e=this._getExtension("barWaterfallLine","strokeStyle");e&&!t.fun.is(e)&&(this._waterColor=n.color(e)),this._addLegendGroup({id:"waterfallTotalLine",type:"discreteColorAndShape",items:[{value:null,label:this.options.accumulatedLineLabel,color:this._waterColor,shape:"bar",isOn:t.retTrue,click:null}]})},_reduceStackedCategoryValueExtent:function(e,t,n){var r,i;if(!e)return t?(r=t.max,i=t.min,this._ruleInfos=[{offset:r,negOffset:i,group:n,range:t}],{min:t.min,max:t.max,offset:r,negOffset:i}):null;r=e.offset,i=e.negOffset,this._isFalling&&this._ruleInfos.push({offset:r,negOffset:i,group:n,range:t});if(!n._isFlattenGroup){var s=this._isFalling?-1:1;r=e.offset=r+s*t.max,i=e.negOffset=i-s*t.min,i<e.min&&(e.min=i),r>e.max&&(e.max=r)}return this._isFalling||this._ruleInfos.push({offset:r,negOffset:i,group:n,range:t}),e},_createMainContentPanel:function(e){r.debug>=3&&r.log("Prerendering in WaterfallChart");var t=this.options;return new r.WaterfallPanel(this,e,{waterfall:t.waterfall,barSizeRatio:t.barSizeRatio,maxBarSize:t.maxBarSize,showValues:t.showValues,orientation:t.orientation})},defaults:t.create(r.BarAbstract.prototype.defaults,{waterDirection:"down",showWaterGroupAreas:!0,allCategoryLabel:"All",accumulatedLineLabel:"Accumulated"})}),r.LineDotAreaPanel=r.CartesianAbstractPanel.extend({anchor:"fill",stacked:!1,pvLine:null,pvArea:null,pvDot:null,pvLabel:null,pvScatterPanel:null,showLines:!0,showDots:!0,showValues:!0,valuesAnchor:"right",valueRoleName:null,nullInterpolationMode:"linear",_creating:function(){var e=this.defaultVisibleBulletGroupScene();if(e&&!e.hasRenderer()){var i=e.colorAxis,s=t.nullyTo(i.option("DrawMarker",!0),this.showDots||this.showAreas),o=t.nullyTo(i.option("DrawLine",!0),this.showLines&&!this.showAreas);if(s||o){var u={};if(u.drawMarker=s){var a=i.option("Shape",!0);this.showDots?(a||(a="circle"),u.markerPvProto=(new n.Dot).lineWidth(1.5).shapeSize(12)):u.markerPvProto=new n.Mark,u.markerShape=a,this.extend(u.markerPvProto,"dot_",{constOnly:!0})}if(u.drawRule=o)u.rulePvProto=(new n.Line).lineWidth(1.5),this.extend(u.rulePvProto,"line_",{constOnly:!0});e.renderer(new r.visual.legend.BulletItemDefaultRenderer(u))}}},_createCore:function(){function b(e){var t=this.base(e);return t&&y&&!this.hasDelegate()&&(t=t.darker(.6)),t}this.base(),this.valueRoleName=this.chart.axes.ortho.role.name;var e=this,i=this.chart,s=i.options,o=this.stacked,u=this.showDots,a=this.showAreas,f=this.showLines,l=this.isOrientationVertical()?"bottom":"left",c=i._catRole.grouping.isDiscrete(),h=this._getVisibleData(),p=!(this.width>0)||h._children.length/this.width>.5,d=this._buildScene(h,c);p&&(s.selectable||s.hoverable)&&(s.selectable=!1,s.hoverable=!1,r.debug>=3&&r.log('Warning: Disabling selection and hovering because the chart is to "dense".')),a?this.pvPanel.zOrder(-7):this.pvPanel.zOrder(1),this.pvScatterPanel=this.pvPanel.add(n.Panel).lock("data",d.childNodes);var v=a&&f&&!o?.5:null;this.pvArea=(new r.visual.Area(this,this.pvScatterPanel,{extensionId:"area",antialias:a&&!f,segmented:!p,noTooltips:!1,noHover:!1})).lock("visible",t.retTrue).lock("data",function(e){return e.childNodes}).override("x",function(){return this.scene.basePosition}).override("y",function(){return this.scene.orthoPosition}).override("dy",function(){return i.animate(0,this.scene.orthoLength)}).override("color",function(e){return a?this.base(e):null}).override("baseColor",function(e){var t=this.base(e);return t&&!this.hasDelegate()&&v!=null&&(t=t.alpha(v)),t}).override("fixAntialiasStrokeWidth",function(){return this.scene.isNull||this.scene.isAlone?0:this.base()}).pvMark;var m=u&&!f&&!a,g=!f&&a,y=o&&a;this.pvLine=(new r.visual.Line(this,this.pvArea.anchor(this.anchorOpposite(l)),{extensionId:"line",freePosition:!0})).lock("visible",m?t.retFalse:c&&o?function(){return!this.scene.isNull||this.scene.isIntermediate}:function(){return!this.scene.isNull}).override("color",function(t){return g&&!this.scene.isActiveSeries()?e.pvArea.fillStyle():this.base(t)}).override("baseColor",b).override("baseStrokeWidth",function(){var e;return f&&(e=this.base()),e==null?1.5:e}).pvMark;var w=!(a&&c&&o);this.pvDot=(new r.visual.Dot(this,this.pvLine,{extensionId:"dot",freePosition:!0})).intercept("visible",function(){var e=this.scene;return!e.isNull&&!e.isIntermediate&&!e.isInterpolated&&this.delegate(!0)}).override("color",function(e){if(!u){var t=this.scene.isActive||!w&&this.scene.isSingle||w&&this.scene.isAlone;if(!t)return r.invisibleFill}return this.base(e)}).override("baseColor",b).override("baseSize",function(){if(!u){var t=this.scene.isActive||!w&&this.scene.isSingle||w&&this.scene.isAlone;if(t&&!this.scene.isActive){var n=Math.max(e.pvLine.lineWidth(),.2)/2;return n*n}}return this.base()}).pvMark,this.showValues&&(this.pvLabel=this.pvDot.anchor(this.valuesAnchor).add(n.Label).bottom(0).text(function(e){return e.vars.value.label}))},applyExtensions:function(){this.base(),this.extend(this.pvScatterPanel,"scatterPanel_"),this.extend(this.pvArea,"area_"),this.extend(this.pvLine,"line_"),this.extend(this.pvDot,"dot_"),this.extend(this.pvLabel,"label_"),this.extend(this.pvLabel,"lineLabel_")},_renderInteractive:function(){this.pvScatterPanel.render()},_getSignums:function(){var e=[];return e.push(this.pvDot),(this.showLines||this.showAreas)&&e.push(this.pvLine),e},_buildScene:function(e,n){function b(t,n){var r=t.key,i=[],s={data:t,value:t.value,label:t.label,isInterpolated:!1,seriesInfos:i,index:n};return m.forEach(function(t){var n=e._childrenByKey[r],o=t.vars.series.value==null?null:t.group;o&&(n=n._childrenByKey[o.key]);var u=n?n.dimensions(a.name).sum(c):null,f={data:o,group:n,value:u,isNull:u==null,categ:s};i.push(f)},this),s}function x(){return u._serRole&&u._serRole.grouping?u._serRole.flatten(e).children().each(T,this):T.call(this,null),i.children().reverse().array()}function T(t){var n=new r.visual.Scene(i,{group:t||e});n.vars.series=new r.visual.ValueLabelVar(t?t.value:null,t?t.label:"")}function N(e,t){function n(n){var i=n.seriesInfos[t],s=i.group,o=i.value,u=s?null:O(i.data||e.group,n.data),f=new r.visual.Scene(e,{group:s,datum:u});f.vars.category=new r.visual.ValueLabelVar(n.value,n.label);var l=new r.visual.ValueLabelVar(o,a.format(o));l.accValue=o!=null?o:p,f.vars.value=l,f.isInterpolatedMiddle=i.isInterpolatedMiddle,f.isInterpolated=i.isInterpolated,f.isNull=i.isNull,f.isIntermediate=!1}y.forEach(n,this)}function C(e){var t=[],n=e.childNodes,r,i=0,s=null;for(var o=0,u=0,a=n.length;o<a;o++,u++){var f=n[u],c=o*2;t[c]=f,k.call(this,r,f,S&&S[c]),f.isAlone&&!s&&(s=f),f.isNull||i++;if(r){var h=L.call(this,e,r,f,u,S&&S[c-1]);h&&(t[c-1]=h,u++)}r=f}i===1&&s&&a===1&&(s.isSingle=!0),l&&(S=t)}function k(e,t,r){var i=t.vars.value.accValue;r&&(t.isNull&&!n?i=p:i+=r.vars.value.accValue,t.vars.value.accValue=i),t.basePosition=v(t),t.orthoPosition=d,t.orthoLength=h(i)-d;var s=!e||e.isNull,o=s&&!t.isNull;if(o){var u=t.nextSibling;o=!u||u.isNull}t.isAlone=o,t.isSingle=!1}function L(e,t,i,s,o){var u=t.isNull||i.isNull;if(u&&!this.showAreas)return null;var f,c,m;if(u){if(o&&n){var g=o.vars.value;c=g.accValue,f=g[this.valueRoleName]}else f=c=p;l&&n?m=i.basePosition-v.range().band/2:t.isNull?m=i.basePosition:m=t.basePosition}else{var y=t.vars.value,b=i.vars.value;f=(b.value+y.value)/2,c=(b.accValue+y.accValue)/2,m=(i.basePosition+t.basePosition)/2}var w=new r.visual.Scene(e,{index:s,group:i.isInterpolatedMiddle?t.group:i.group,datum:i.group?null:i.datum});w.vars.category=i.vars.category;var E=new r.visual.ValueLabelVar(f,a.format(f));return E.accValue=c,w.vars.value=E,w.isIntermediate=!0,w.isSingle=!1,w.isNull=u,w.isAlone=u&&i.isNull&&t.isNull,w.basePosition=m,w.orthoPosition=d,w.orthoLength=h(c)-d,w}function A(e){var t=e.childNodes,n=t.length,r,i;while(n&&(r=t[0]).isNull){i=r.nextSibling;if(i&&!i.isNull)break;e.removeAt(0),n--}while(n&&(r=t[n-1]).isNull){i=r.previousSibling;if(i&&!i.isNull)break;e.removeAt(n-1),n--}}function O(n,i){var s=n&&i?t.array.append(t.own(n.atoms),t.own(i.atoms)):n?t.own(n.atoms):t.own(i.atoms);return new r.data.Datum(e,s,!0)}var i=new r.visual.Scene(null,{panel:this,group:e}),s=e._children,o=this.nullInterpolationMode==="linear",u=this.chart,a=e.owner.dimensions(u.axes.ortho.role.firstDimensionName()),f=n?null:e.owner.dimensions(u.axes.base.role.firstDimensionName()),l=this.stacked,c={visible:!0,zeroIfNone:!1},h=this.dataPartValue!=="1"?u.axes.ortho.scale:u.axes.ortho2.scale,p=t.scope(function(){var e=h.domain(),t=e[0],n=e[1];return t*n>=0?t>=0?t:n:0}),d=h(0),v=u.axes.base.sceneScale({sceneVarName:"category"}),m=x.call(this),g=m.length,y=s.map(b,this),w=t.type().init(function(e){this._categInfos=e,this._outCategInfos=[],this._seriesCount=e.length>0?e[0].seriesInfos.length:0,this._seriesStates=t.range(0,this._seriesCount).select(function(e){return new E(this,e)},this).array(),!n&&e.length>=2&&(+e[1].value>=+e[0].value?this._comparer=t.compare:this._comparer=function(e,n){return t.compare(n,e)})}).add({interpolate:function(){var e;while(e=this._categInfos.shift())e.seriesInfos.forEach(this._visitSeries,this),this._outCategInfos.push(e);return this._outCategInfos},_visitSeries:function(e,t){this._seriesStates[t].visit(e)},firstNonNullOfSeries:function(e){var t=0,n=this._categInfos.length;while(t<n){var r=this._categInfos[t++];if(!r.isInterpolated){var i=r.seriesInfos[e];if(!i.isNull)return i}}},_setCategory:function(e){function r(e){return+e.value}!n||t.assert("Only for continuous base.");var i=t.array.binarySearch(this._categInfos,+e,this._comparer,r);if(i<0){var s={value:f.type.cast(e),isInterpolated:!0};s.label=f.format(s.value),s.seriesInfos=t.range(0,this._seriesCount).select(function(e,t){return{value:null,isNull:!0,categ:s}}).array(),this._categInfos.splice(~i,0,s)}return i}}),E=t.type().init(function(e,t){this.interpolation=e,this.index=t,this._lastNonNull(null)}).add({visit:function(e){e.isNull?this._interpolate(e):this._lastNonNull(e)},_lastNonNull:function(e){return arguments.length&&(this.__lastNonNull=e,this.__nextNonNull=undefined),this.__lastNonNull},_nextNonNull:function(){return this.__nextNonNull},_initInterpData:function(){if(this.__nextNonNull!==undefined)return;var e=this.__nextNonNull=this.interpolation.firstNonNullOfSeries(this.index)||null,r=this.__lastNonNull;if(e&&r){var i=r.value,s=e.value,o=s-i;if(n){var u=e.categ.index-r.categ.index;u>=2||t.assert("Must have at least one interpolation point."),this._stepValue=o/u,this._middleIndex=~~(u/2);var a=u-1;this._isOdd=a%2>0}else{var f=+r.categ.data.value,l=+e.categ.data.value,c=l-f;this._steep=o/c,this._middleCateg=(l+f)/2,this.interpolation._setCategory(this._middleCateg)}}},_interpolate:function(e){this._initInterpData();var t=this.__nextNonNull,r=this.__lastNonNull;if(!t&&!r)return;var i,s,o;if(t&&r)if(n){var u=e.categ.index-r.categ.index;i=r.value+u*this._stepValue,this._isOdd?(s=u<this._middleIndex?r.group:t.group,o=u===this._middleIndex):(s=u<=this._middleIndex?r.group:t.group,o=!1)}else{var a=+e.categ.value,f=+r.categ.data.value;i=r.value+this._steep*(a-f),s=a<this._middleCateg?r.group:t.group,o=a===this._middleCateg}else{if(!l)return;var c=t||r;i=c.value,s=c.group,o=!1}e.group=s,e.value=i,e.isNull=!1,e.isInterpolated=!0,e.isInterpolatedMiddle=o}});o&&(y=(new w(y)).interpolate()),m.forEach(N,this);var S;return m.forEach(C,this),m.forEach(A,this),i}}),r.LineDotAreaAbstract=r.CategoricalAbstract.extend({_initVisualRoles:function(){this.base(),this._addVisualRoles({value:{isMeasure:!0,isRequired:!0,isPercent:this.options.stacked,requireSingleDimension:!0,requireIsDiscrete:!1,valueType:Number,defaultDimensionName:"value"}})},_createMainContentPanel:function(e){r.debug>=3&&r.log("Prerendering in LineDotAreaAbstract");var t=this.options;return new r.LineDotAreaPanel(this,e,{stacked:t.stacked,showValues:t.showValues,valuesAnchor:t.valuesAnchor,showLines:t.showLines,showDots:t.showDots,showAreas:t.showAreas,orientation:t.orientation,nullInterpolationMode:t.nullInterpolationMode})},defaults:t.create(r.CategoricalAbstract.prototype.defaults,{showDots:!1,showLines:!1,showAreas:!1,showValues:!1,orthoAxisOffset:.04,baseAxisOffset:.01,valuesAnchor:"right",panelSizeRatio:1,nullInterpolationMode:"none",tipsySettings:{offset:15}})}),r.DotChart=r.LineDotAreaAbstract.extend({constructor:function(e){this.base(e),this.options.showDots=!0}}),r.LineChart=r.LineDotAreaAbstract.extend({constructor:function(e){this.base(e),this.options.showLines=!0}}),r.StackedLineChart=r.LineDotAreaAbstract.extend({constructor:function(e){this.base(e),this.options.showLines=!0,this.options.stacked=!0}}),r.StackedAreaChart=r.LineDotAreaAbstract.extend({constructor:function(e){this.base(e),this.options.showAreas=!0,this.options.stacked=!0}}),r.HeatGridChart=r.CategoricalAbstract.extend({constructor:function(e){e=t.set(e,"orthoAxisOrdinal",!0,"legend",!1),e.scalingType&&!e.colorScaleType&&(e.colorScaleType=e.scalingType),this.base(e);var n=this.parent;n&&(this._colorRole=n._colorRole,this._dotSizeRole=n._dotSizeRole)},_initVisualRoles:function(){this.base();var e="value",t="value2";if(this.options.compatVersion<=1){switch(this.options.colorValIdx){case 0:e="value";break;case 1:e="value2";break;default:e=undefined}switch(this.options.sizeValIdx){case 0:t="value";break;case 1:t="value2";break;default:t=undefined}}this._addVisualRoles({color:{isMeasure:!0,requireSingleDimension:!0,requireIsDiscrete:!1,valueType:Number,defaultDimensionName:e},dotSize:{isMeasure:!0,requireSingleDimension:!0,requireIsDiscrete:!1,valueType:Number,defaultDimensionName:t}}),this._colorRole=this.visualRoles("color"),this._dotSizeRole=this.visualRoles("dotSize")},_initData:function(e){this.base(e);var t=this._dotSizeRole.grouping;t&&(this._dotSizeDim=this.data.dimensions(t.firstDimension.name));var n=this._colorRole.grouping;n&&(this._colorDim=this.data.dimensions(n.firstDimension.name))},_createMainContentPanel:function(e){r.debug>=3&&r.log("Prerendering in heatGridChart");var t=this.options;return new r.HeatGridChartPanel(this,e,{showValues:t.showValues,orientation:t.orientation})},defaults:t.create(r.CategoricalAbstract.prototype.defaults,{colorValIdx:0,sizeValIdx:1,measuresIndexes:[2],showValues:!0,axisOffset:0,showPlotFrame:!1,orientation:"vertical",colorScaleType:"linear",normPerBaseCategory:!0,numSD:2,useShapes:!1,colorRange:["red","yellow","green"],nullColor:"#efc5ad"})}),r.HeatGridChartPanel=r.CartesianAbstractPanel.extend({anchor:"fill",pvHeatGrid:null,pvHeatGridLabel:null,data:null,showValues:!0,orientation:"vertical",shape:"square",nullShape:"cross",defaultBorder:1,nullBorder:2,selectedBorder:2,_createCore:function(){function y(e){var t,n=this.colorValue();return n!=null?t=g[this.group().parent.absKey](n):t=i.nullColor,e&&m.owner.selectedCount()>0&&!this.datum().isSelected&&(t=r.toGrayScale(t,.6)),t}function b(e,n){var i=this.parent.group();if(i){var s=i._childrenByKey[e.absKey];if(s){var o=s._datums[0];if(o)return o}}var u=t.array.append(t.own(e.atoms),t.own(n.atoms));return new r.data.Datum(m,u,!0)}this.base();var e=this.chart,i=e.options,s=this.colorDimName=e._colorDim&&e._colorDim.name,o=this.sizeDimName=e._dotSizeDim&&e._dotSizeDim.name;i.nullColor=n.color(i.nullColor),i.minColor!=null&&(i.minColor=n.color(i.minColor)),i.maxColor!=null&&(i.maxColor=n.color(i.maxColor)),i.shape!=null&&(this.shape=i.shape),i.nullShape!==undefined&&(this.nullShape=i.nullShape);var u=this.isOrientationVertical()?"bottom":"left",a=e.axes.x.scale,f=e.axes.y.scale,l=(a.max-a.min)/a.domain().length,c=(f.max-f.min)/f.domain().length;if(u!=="bottom"){var h=l;l=c,c=h}this._cellWidth=l,this._cellHeight=c;var p={visible:!0},d=e._catRole.flatten(e.data,p),v=e._serRole.flatten(e.data,p),m=this._getVisibleData(),g;s&&(g=r.color.scales(t.create(!1,this.chart.options,{type:i.colorScaleType,data:d,colorDimension:s})));var w=this.pvPanel.add(n.Panel).data(d._children).localProperty("group",Object).group(function(e){return m._childrenByKey[e.absKey]})[r.BasePanel.relativeAnchor[u]](function(){return this.index*l})[r.BasePanel.parallelLength[u]](l),E=this.pvHeatGrid=w.add(n.Panel).data(v._children).localProperty("group",Object).datum(b).group(function(e){return this.parent.group()._childrenByKey[e.absKey]}).localProperty("colorValue").colorValue(function(){return s&&this.datum().atoms[s].value}).localProperty("sizeValue").sizeValue(function(){return o&&this.datum().atoms[o].value});E[u](function(){return this.index*c})[r.BasePanel.orthogonalLength[u]](c).antialias(!1).strokeStyle(null).lineWidth(0),i.useShapes?this.shapes=this.createHeatMap(l,c,y):this.shapes=E,this.shapes.fillStyle(function(){return y.call(E,!0)});var S=s||o;this.showValues&&S&&(this.pvHeatGridLabel=E.anchor("center").add(n.Label).bottom(0).text(function(){return this.datum().atoms[S].label})),this._shouldHandleClick()&&this._addPropClick(this.shapes),i.doubleClickAction&&this._addPropDoubleClick(this.shapes),i.showTooltips&&this._addPropTooltip(this.shapes,{tipsyEvent:"mouseover"})},applyExtensions:function(){this.base(),this.pvHeatGridLabel&&this.extend(this.pvHeatGridLabel,"heatGridLabel_"),this.extend(this.pvHeatGrid,"heatGridPanel_"),this.extend(this.pvHeatGrid,"heatGrid_")},createHeatMap:function(e,i,s){function E(){return!f||!o._isNullShapeLineOnly()||this.parent.sizeValue()!=null?this.selected()?y:o.defaultBorder:this.selected()?b:w}function S(){var e=this.lineWidth();if(e>0){var t=s.call(this.parent,!1);return a.owner.selectedCount()===0||this.selected()?t.darker():t}return null}var o=this,u=this.chart.options,a=this.chart.data,f=this.sizeDimName,l=this.colorDimName,c=this.nullShape,h=this.shape,p=Math.min(e,i)/2;this.shape==="diamond"&&(p/=Math.SQRT2),p-=2;var d=p*p,v=12,m=d-v;m<=1&&(d=Math.max(d,2),v=1,m=d-v,r.debug>=2&&r.log("Using rescue mode dot area calculation due to insufficient space."));var g;f&&t.scope(function(){var e=a.dimensions(f).extent({visible:!0});if(e){var t=e.min.value,n=e.max.value,r=Math.abs(n-t);if(isFinite(r)&&r>1e-12){var i=m/r;g=function(e){return v+i*(e==null?0:e-t)}}}}),g||(g=n.functor(d));var y=this.selectedBorder==null||+this.selectedBorder===0?this.defaultBorder:this.selectedBorder,b=this.selectedBorder==null||+this.selectedBorder===0?this.nullBorder:this.selectedBorder,w=this.defaultBorder>0?this.defaultBorder:this.nullBorder,x;f?x=function(){return this.parent.sizeValue()!=null?h:c}:x=t.fun.constant(h);var T;return f?T=function(){var e=this.parent.sizeValue();return e==null&&!c?0:g(e)}:T=function(){return l&&!c&&this.parent.colorValue()==null?0:d},this.pvHeatGrid.add(n.Dot).localProperty("selected",Boolean).selected(function(){return this.datum().isSelected}).shape(x).shapeSize(T).lock("shapeAngle").fillStyle(function(){return s.call(this.parent)}).lineWidth(E).strokeStyle(S)},_isNullShapeLineOnly:function(){return this.nullShape=="cross"},_getSignums:function(){return[this.shapes]},_renderInteractive:function(){this.pvPanel.render()}}),r.MetricXYAbstract=r.CartesianAbstract.extend({constructor:function(e){var n=e&&e.compatVersion<=1;if(n){e||(e={});if(!e.visualRoles||!e.visualRoles.x){var r=e.dimensions||(e.dimensions={}),i=r.category||(r.category={});i.valueType===undefined&&(i.valueType=Number)}}this.base(e),t.set(this._axisType2RoleNamesMap,"base","x","ortho","y");var s=this.parent;s&&(this._xRole=s._xRole,this._yRole=s._yRole)},_initVisualRoles:function(){this.base();var e=this.options.compatVersion<=1;this._addVisualRoles({x:{isMeasure:!0,isRequired:!0,requireSingleDimension:!0,requireIsDiscrete:!1,valueType:Number,defaultDimensionName:e?"category":"value"},y:{isMeasure:!0,isRequired:!0,requireSingleDimension:!0,requireIsDiscrete:!1,valueType:Number,defaultDimensionName:e?"value":"value2"}}),this._xRole=this.visualRoles("x"),this._yRole=this.visualRoles("y")},_initData:function(){this.base.apply(this,arguments),this._xDim=this.data.dimensions(this._xRole.firstDimensionName()),this._yDim=this.data.dimensions(this._yRole.firstDimensionName())},defaults:t.create(r.CartesianAbstract.prototype.defaults,{valuesAnchor:"right",panelSizeRatio:1})}),r.MetricLineDotPanel=r.CartesianAbstractPanel.extend({anchor:"fill",pvLine:null,pvDot:null,pvLabel:null,pvScatterPanel:null,showLines:!0,showDots:!0,showValues:!0,valuesAnchor:"right",dotShape:"circle",dotSizeRatio:.2,dotSizeRatioTo:"minWidthHeight",autoDotSizePadding:!0,_v1DimRoleName:{series:"series",category:"x",value:"y"},constructor:function(e,t,n){this.base(e,t,n),this.offsetPaddings||(this.offsetPaddings=new r.Sides(.01))},_creating:function(){var e=this.defaultVisibleBulletGroupScene();if(e&&!e.hasRenderer()){var i=e.colorAxis,s=t.nullyTo(i.option("DrawMarker",!0),this.showDots),o=t.nullyTo(i.option("DrawLine",!0),this.showLines);if(s||o){var u={};if(u.drawMarker=s)u.markerShape=i.option("Shape",!0)||"circle",u.markerPvProto=(new n.Dot).lineWidth(1.5).shapeSize(12),this.extend(u.markerPvProto,"dot_",{constOnly:!0});if(u.drawRule=o)u.rulePvProto=(new n.Line).lineWidth(1.5),this.extend(u.rulePvProto,"line_",{constOnly:!0});e.renderer(new r.visual.legend.BulletItemDefaultRenderer(u))}}},_getRootScene:function(){var e=this._rootScene;if(!e){var t=this.chart,n=this._getVisibleData(),r=!!t._colorRole.grouping,i=this.showDots&&!!t._dotSizeDim,s;if(i){var o=t._dotSizeDim.extent({visible:!0});i=!!o;if(i){var u=o.min.value,a=o.max.value;if(this.dotSizeAbs){var f=t._dotSizeDim.atoms({visible:!0});for(var l=0;l<f.length;l++)if(l==0)u=a=Math.abs(f[0].value);else{var c=Math.abs(f[l].value);c>a&&(a=c),c<u&&(u=c)}}var h=Math.abs(a-u);i=isFinite(h)&&h>1e-12,i&&(s={min:u,max:a})}}e=this._buildScene(n,r,i),e.sizeValRange=s,this._rootScene=e}return e},_calcLayout:function(e){var t=this.chart,n=this._getRootScene(),i=e.clientSize;if(n.hasDotSizeRole){var s=this._calcDotRadiusRange(e);this.dotShape==="diamond"&&(s.max/=Math.SQRT2,s.min/=Math.SQRT2);var o=s.max*s.max,u=s.min*s.min,a=o-u;a<=1&&(o=Math.max(o,2),u=1,a=o-u,s={min:Math.sqrt(u),max:Math.sqrt(o)},r.debug>=3&&r.log("Using rescue mode dot area calculation due to insufficient space.")),this.maxDotRadius=s.max,this.maxDotArea=o,this.minDotArea=u,this.dotAreaSpan=a,this.dotSizeScale=this._getDotSizeRoleScale(n.sizeValRange)}this._calcAxesPadding(e,n)},_getDotDiameterRefLength:function(e){var n=e.clientSize,i=e.paddings;switch(this.dotSizeRatioTo){case"minWidthHeight":return Math.min(n.width+i.width,n.height+i.height);case"width":return n.width+i.width;case"height":return n.height+i.height}return r.debug>=2&&r.log(t.format("Invalid option 'dotSizeRatioTo' value. Assuming 'minWidthHeight'.",[this.dotSizeRatioTo])),this.dotSizeRatioTo="minWidthHeight",this._getDotDiameterRefLength(e)},_calcDotRadiusRange:function(e){var t=this._getDotDiameterRefLength(e),n=this.dotSizeRatio/2*t,r=Math.sqrt(12);return{min:r,max:n}},_calcAxesPadding:function(e,n){var i;if(!this.autoDotSizePadding)i=this._calcRequestPaddings(e);else{var s=this.chart,o=s.axes,u=e.clientSize,a=e.paddings;i={},o.x.setScaleRange(u.width),o.y.setScaleRange(u.height);var f=s.axes.base.sceneScale({sceneVarName:"x"}),l=s.axes.ortho.sceneScale({sceneVarName:"y"}),c=s.axes.base.scale.max,h=s.axes.ortho.scale.max,p=n.hasDotSizeRole,d=this.dotSizeScale;if(!p){var v=t.number.as(this._getExtension("dot","shapeRadius"),0);v>0?v*=v:(v=t.number.as(this._getExtension("dot","shapeSize"),0),!v>0&&(v=12)),d=t.fun.constant(v)}i={};var m;this.offsetPaddings&&(m={},r.Sides.names.forEach(function(e){var t=r.BasePanel.orthogonalLength[e];m[e]=(this.offsetPaddings[e]||0)*(u[t]+a[t])},this));var g=function(e,t){m&&(t+=m[e]||0),t<0&&(t=0);var n=i[e];if(n==null||t>n)i[e]=t},y=function(e){var t=f(e),n=l(e),r=Math.sqrt(d(p?e.vars.dotSize.value:0));g("left",r-t),g("bottom",r-n),g("right",t+r-c),g("top",n+r-h)};n.children().selectMany(function(e){return e.childNodes}).each(y)}e.requestPaddings=i},_createCore:function(e){this.base();var i=this,s=this.chart,o=s.options,u=this._getRootScene(),a=u.group,f=!(this.width>0)||a._leafs.length/this.width>.5;this._finalizeScene(u),f&&(o.selectable||o.hoverable)&&(o.selectable=!1,o.hoverable=!1,r.debug>=3&&r.log('Warning: Disabling selection and hovering because the chart is to "dense".')),this.pvPanel.zOrder(1),this.pvScatterPanel=this.pvPanel.add(n.Panel).lock("data",u.childNodes);var l=(new r.visual.Line(this,this.pvScatterPanel,{extensionId:"line"})).lock("data",function(e){return e.childNodes}).lockValue("visible",this.showLines).override("x",function(){return this.scene.basePosition}).override("y",function(){return this.scene.orthoPosition});this.pvLine=l.pvMark;var c=(new r.visual.Dot(this,this.pvLine,{extensionId:"dot",activeSeriesAware:this.showLines})).intercept("visible",function(){return!this.scene.isIntermediate&&this.delegate(!0)}).lockValue("shape",this.dotShape).override("x",function(){return this.scene.basePosition}).override("y",function(){return this.scene.orthoPosition}).override("color",function(e){if(!i.showDots){var t=this.scene.isActive||this.scene.isSingle;if(!t)return r.invisibleFill}return this.base(e)});this.pvDot=c.pvMark,this.pvDot.rubberBandSelectionMode="center",c.override("baseColor",function(e){var t=this.delegate();if(t===undefined){var t;if(!u.hasColorRole)t=this.defaultColor(e);else{var n=this.scene.vars.color.value;t=n==null?o.nullColor:h(n)}e==="stroke"&&(t=t.darker())}return t});if(u.hasColorRole){var h=this._getColorRoleScale(a);l.override("baseColor",function(e){var t=this.delegate();if(t===undefined){var n=this.scene.vars.color.value;t=n==null?o.nullColor:h(n)}return t}),c.override("interactiveColor",function(e,t){return this.scene.isActive?t:this.base(e,t)})}if(!u.hasDotSizeRole)c.override("baseSize",function(){if(!i.showDots&&this.scene.isSingle){var e=Math.max(i.pvLine.scene[this.pvMark.index].lineWidth,.2)/2;return e*e}return this.base()});else{var p=this._getDotSizeRoleScale(u.sizeValRange),d=this.dotSizeAbs;this.dotSizeAbs&&(c.override("strokeColor",function(e){return e.vars.dotSize.value<0?"#000000":this.base()}),c.optionalValue("lineCap","round"),c.optional("strokeDasharray",function(e){return e.vars.dotSize.value<0?"dot":null}),c.optional("lineWidth",function(e){return e.vars.dotSize.value<0?1.8:1.5})),c.override("baseSize",function(){var e=this.scene.vars.dotSize.value;return d&&(e=Math.abs(e)),p(e)}).override("interactiveSize",function(e){if(this.scene.isActive){var t=Math.sqrt(e)*1.1;return t*t}return e}),this.pvPanel.borderPanel.overflow("hidden")}this.showValues&&(this.pvLabel=this.pvDot.anchor(this.valuesAnchor).add(n.Label).bottom(0).text(function(e){return t.string.join(",",e.vars.x.label,e.vars.y.label)}))},_getColorRoleScale:function(e){var n=this.chart,i=n.options;if(n._colorRole.grouping.isDiscrete()){var s=n._colorRole.flatten(e.owner).children().select(function(e){return e.value}).array();return n.colors(s)}return r.color.scale(t.create(!1,i,{type:i.colorScaleType||"linear",data:e.owner,colorDimension:n._colorRole.firstDimensionName()}))},_getDotSizeRoleScale:function(e){var t=e.min,n=e.max,r=n-t,i=this.dotAreaSpan/r,s=this.minDotArea;return function(e){return s+i*(e==null?0:e-t)}},applyExtensions:function(){this.base(),this.extend(this.pvLabel,"lineLabel_"),this.extend(this.pvScatterPanel,"scatterPanel_"),this.extend(this.pvLine,"line_"),this.extend(this.pvDot,"dot_"),this.extend(this.pvLabel,"label_")},_renderInteractive:function(){this.pvScatterPanel.render()},_getSignums:function(){var e=[];return e.push(this.pvDot),this.showLines&&e.push(this.pvLine),e},_finalizeScene:function(e){var t=this.chart,n=t.axes.base.sceneScale({sceneVarName:"x"}),r=t.axes.ortho.sceneScale({sceneVarName:"y"});return e.children().selectMany(function(e){return e.childNodes}).each(function(e){e.basePosition=n(e),e.orthoPosition=r(e)},this),e},_buildScene:function(e,t,n){function c(e){var t=new r.visual.Scene(i,{group:e});t.vars.series=new r.visual.ValueLabelVar(e.value,e.label),e.datums().each(function(e){var n=e.atoms[s._xDim.name];if(n.value==null)return;var i=e.atoms[s._yDim.name];if(i.value==null)return;var a=new r.visual.Scene(t,{datum:e});a.vars.x=new r.visual.ValueLabelVar(n.value,n.label),a.vars.y=new r.visual.ValueLabelVar(i.value,i.label),o&&(a.vars.color=new r.visual.ValueLabelVar(o(a),""));if(u){var f=u(a);a.vars.dotSize=new r.visual.ValueLabelVar(f,s._dotSizeDim.format(f))}a.isIntermediate=!1})}function h(e){var t=e.childNodes,n;for(var r=0,i=0,s=t.length;r<s;r++,i++){var o=t[i];o.isSingle=!n&&!o.nextSibling;if(n){var u=p(e,n,o,i);u&&i++}n=o}}function p(e,t,n,i){var a=(n.vars.y.value+t.vars.y.value)/2,f=(n.vars.x.value+t.vars.x.value)/2,l=new r.visual.Scene(e,{index:i,datum:n.datum});return l.vars.x=new r.visual.ValueLabelVar(f,s._xDim.format(f)),l.vars.y=new r.visual.ValueLabelVar(a,s._yDim.format(a)),o&&(l.vars.color=n.vars.color),u&&(l.vars.dotSize=n.vars.dotSize),l.isIntermediate=!0,l.isSingle=!1,l}var i=new r.visual.Scene(null,{panel:this,group:e});i.hasColorRole=t,i.hasDotSizeRole=n;var s=this.chart,o,u;if(t){var a=s._colorRole.grouping;if(a.isSingleDimension){var f=s._colorRole.firstDimensionName();o=function(e){return e.atoms[f].value}}else o=function(e){return a.view(e.datum).value}}if(s._dotSizeDim){var l=s._dotSizeDim.name;u=function(e){return e.atoms[l].value}}return e.children().each(c,this),i.children().each(h,this),i}}),r.MetricLineDotAbstract=r.MetricXYAbstract.extend({constructor:function(e){this.base(e);var t=this.parent;t&&(this._colorRole=t._colorRole,this._dotSizeRole=t._dotSizeRole)},_processOptionsCore:function(e){this.base(e),e.nullColor&&(e.nullColor=n.color(e.nullColor))},_initVisualRoles:function(){this.base();var e=this.options.compatVersion<=1;this._addVisualRoles({color:{isMeasure:!0,defaultDimensionName:e?"value2":"value3"},dotSize:{isMeasure:!0,requireSingleDimension:!0,requireIsDiscrete:!1,valueType:Number,defaultDimensionName:e?"value3":"value4"}}),this._colorRole=this.visualRoles("color"),this._dotSizeRole=this.visualRoles("dotSize")},_initData:function(e){this.base(e);var t=this._dotSizeRole.grouping;t&&(this._dotSizeDim=this.data.dimensions(t.firstDimension.name));if(!this.parent){var n=this._colorRole.grouping;n&&(n.isDiscrete()?this.legendSource="color":this.options.legend=!1)}},_createMainContentPanel:function(e){r.debug>=3&&r.log("Prerendering in MetricLineDot");var t=this.options;return new r.MetricLineDotPanel(this,e,{showValues:t.showValues,valuesAnchor:t.valuesAnchor,showLines:t.showLines,showDots:t.showDots,orientation:t.orientation,dotSizeRatio:t.dotSizeRatio,dotSizeRatioTo:t.dotSizeRatioTo,autoDotSizePadding:t.autoDotSizePadding,dotSizeAbs:t.dotSizeAbs})},defaults:t.create(r.MetricXYAbstract.prototype.defaults,{showDots:!1,showLines:!1,showValues:!1,originIsZero:!1,tipsySettings:{offset:15},colorScaleType:"linear",colorRange:["red","yellow","green"],nullColor:"#efc5ad",dotSizeAbs:!1})}),r.MetricDotChart=r.MetricLineDotAbstract.extend({constructor:function(e){this.base(e),this.options.showDots=!0}}),r.MetricLineChart=r.MetricLineDotAbstract.extend({constructor:function(e){this.base(e),this.options.showLines=!0}}),r.BulletChart=r.BaseChart.extend({bulletChartPanel:null,allowNoData:!0,constructor:function(e){e=e||{};var t=e.dimensionGroups||(e.dimensionGroups={}),n=t.range||(t.range={});n.valueType===undefined&&(n.valueType=Number);var r=t.marker||(t.marker={});r.valueType===undefined&&(r.valueType=Number),e.legend=!1,e.selectable=!1,e.tooltipFormat=function(e,t,n){return this.chart.options.valueFormat(n)},this.base(e)},_initVisualRoles:function(){this.base(),this._addVisualRoles({title:{defaultDimensionName:"title*"},subTitle:{defaultDimensionName:"subTitle*"},value:{isMeasure:!0,requireSingleDimension:!0,requireIsDiscrete:!1,valueType:Number,defaultDimensionName:"value*"},marker:{isMeasure:!0,requireSingleDimension:!0,requireIsDiscrete:!1,valueType:Number,defaultDimensionName:"marker*"},range:{isMeasure:!0,requireIsDiscrete:!1,valueType:Number,defaultDimensionName:"range*"}})},_createTranslation:function(e,t){var r=this.base(e,t),i=r.virtualItemSize();if(i)switch(i){case 1:r.defReader({names:"value"});break;case 2:r.defReader({names:["title","value"]});break;case 3:r.defReader({names:["title","value","marker"]});break;default:r.defReader({names:["title","subTitle","value","marker"]}),i>4&&r.defReader({names:"range",indexes:n.range(4,i)})}return r},_preRenderContent:function(e){r.debug>=3&&r.log("Prerendering in bulletChart"),this.bulletChartPanel=new r.BulletChartPanel(this,this.basePanel,t.create(e,{showValues:this.options.showValues,showTooltips:this.options.showTooltips,orientation:this.options.orientation}))},defaults:t.create(r.BaseChart.prototype.defaults,{showValues:!0,orientation:"horizontal",legend:!1,bulletSize:30,bulletSpacing:50,bulletMargin:100,bulletTitle:"Bullet",bulletSubtitle:"",bulletTitlePosition:"left",crosstabMode:!1,seriesInRows:!1})}),r.BulletChartPanel=r.BasePanel.extend({anchor:"fill",pvBullets:null,pvBullet:null,data:null,onSelectionChange:null,showValues:!0,_createCore:function(){var e=this.chart,t=e.options,i=this.buildData(),s=t.orientation=="horizontal"?"left":"bottom",o,u,a,f,l,c,h,p,d;if(t.orientation=="horizontal"){o=this.width-this.chart.options.bulletMargin-20,u=0;switch(t.bulletTitlePosition){case"top":h=this.chart.options.bulletMargin,f=0,a="left",l=-12,d=parseInt(t.titleSize/2,10);break;case"bottom":h=this.chart.options.bulletMargin,f=0,a="left",l=t.bulletSize+32,d=0;break;case"right":h=5,f=o+5,a="left",l=parseInt(t.bulletSize/2,10),d=0;break;case"left":default:h=this.chart.options.bulletMargin,f=0,l=parseInt(t.bulletSize/2,10),a="right",d=0}c="bottom",p=function(){return this.index*(t.bulletSize+t.bulletSpacing)+d}}else{o=this.height-this.chart.options.bulletMargin-20;switch(t.bulletTitlePosition){case"top":h=this.chart.options.bulletMargin,f=0,a="left",l=-20,u=0,p=undefined;break;case"bottom":h=this.chart.options.bulletMargin,f=0,a="left",l=o+20,u=0,p=20;break;case"right":h=5,f=this.chart.options.bulletSize+40,a="left",l=o,u=-Math.PI/2,p=undefined;break;case"left":default:h=this.chart.options.bulletMargin,f=-12,l=this.height-this.chart.options.bulletMargin-20,a="left",u=-Math.PI/2,p=undefined}c="right",h=function(){return t.bulletMargin+this.index*(t.bulletSize+t.bulletSpacing)}}this.pvBullets=this.pvPanel.add(n.Panel).data(i)[r.BasePanel.orthogonalLength[s]](o)[r.BasePanel.parallelLength[s]](this.chart.options.bulletSize).margin(20).left(h).top(p),this.pvBullet=this.pvBullets.add(n.Layout.Bullet).orient(s).ranges(function(e){return e.ranges}).measures(function(e){return e.measures}).markers(function(e){return e.markers}),t.clickable&&this.pvBullet.cursor("pointer").event("click",function(e){var r=e.title,i=e.subtitle,s=n.event;return t.clickAction(r,i,e.measures,s)}),this.pvBulletRange=this.pvBullet.range.add(n.Bar),this.pvBulletMeasure=this.pvBullet.measure.add(n.Bar).text(function(e){return t.valueFormat(e)}),this.pvBulletMarker=this.pvBullet.marker.add(n.Dot).shape("square").fillStyle("white").text(function(e){return t.valueFormat(e)});if(this.showTooltips){var v=this;this.pvBulletMeasure.localProperty("tooltip").tooltip(function(t,n){var r=n.title,i=n.subtitle;return e.options.tooltipFormat.call(v,r,i,t)}),this.pvBulletMarker.localProperty("tooltip").tooltip(function(t,n){var r=n.title,i=n.subtitle;return e.options.tooltipFormat.call(v,r,i,t)}),this.pvBulletMeasure.event("mouseover",n.Behavior.tipsy(this.chart.options.tipsySettings)),this.pvBulletMarker.event("mouseover",n.Behavior.tipsy(this.chart.options.tipsySettings))}this.pvBulletRule=this.pvBullet.tick.add(n.Rule),this.pvBulletRuleLabel=this.pvBulletRule.anchor(c).add(n.Label).text(this.pvBullet.x.tickFormat),this.pvBulletTitle=this.pvBullet.anchor(s).add(n.Label).font("bold 12px sans-serif").textAngle(u).left(-10).textAlign(a).textBaseline("bottom").left(f).top(l).text(function(e){return e.formattedTitle}),this.pvBulletSubtitle=this.pvBullet.anchor(s).add(n.Label).textStyle("#666").textAngle(u).textAlign(a).textBaseline("top").left(f).top(l).text(function(e){return e.formattedSubtitle});var m=typeof t.axisDoubleClickAction=="function"?function(e,n){t.axisDoubleClickAction(e,n)}:null;m&&(this.pvBulletTitle.cursor("pointer").events("all").event("dblclick",function(e){m(e,arguments[arguments.length-1])}),this.pvBulletSubtitle.cursor("pointer").events("all").event("dblclick",function(e){m(e,arguments[arguments.length-1])})),this.extend(this.pvBullets,"bulletsPanel_"),this.extend(this.pvBullet,"bulletPanel_"),this.extend(this.pvBulletRange,"bulletRange_"),this.extend(this.pvBulletMeasure,"bulletMeasure_"),this.extend(this.pvBulletMarker,"bulletMarker_"),this.extend(this.pvBulletRule,"bulletRule_"),this.extend(this.pvBulletRuleLabel,"bulletRuleLabel_"),this.extend(this.pvBulletTitle,"bulletTitle_"),this.extend(this.pvBulletSubtitle,"bulletSubtitle_"),this.extend(this.pvPanel,"chart_")},buildData:function(){r.debug>=3&&r.log("In buildData: "+this.chart.data.getInfo());var e,n=this.chart,i=n.options,s=n.visualRoles("title"),o=s.grouping,u=n.visualRoles("subTitle"),a=u.grouping,f=n.visualRoles("value"),l=f.grouping&&f.firstDimensionName(),c=n.visualRoles("marker"),h=c.grouping&&c.firstDimensionName(),p=n.visualRoles("range"),d=p.grouping,v={title:i.bulletTitle,formattedTitle:t.scope(function(){var e=o&&s.firstDimension().formatter();return e?e(i.bulletTitle):i.bulletTitle}),subtitle:i.bulletSubtitle,formattedSubtitle:t.scope(function(){var e=a&&u.firstDimension().formatter();return e?e(i.bulletSubtitle):i.bulletSubtitle}),ranges:i.bulletRanges||[],measures:i.bulletMeasures||[],markers:i.bulletMarkers||[]};return!f.grouping&&!o&&!c.grouping&&!a&&!d?e=[v]:e=n.data.datums().select(function(e){var t=Object.create(v),n=e.atoms,r;return l&&(t.measures=[n[l].value]),o&&(r=o.view(e),t.title=r.value,t.formattedTitle=r.label),a&&(r=a.view(e),t.subtitle=r.value,t.formattedSubtitle=r.label),h&&(t.markers=[n[h].value]),d&&(t.ranges=d.view(e).values()),t},this).array(),e}}),r.ParallelCoordinates=r.BaseChart.extend({parCoordPanel:null,legendSource:"category",constructor:function(e){e=e||{},e.dimensions=e.dimensions||{},e.dimensions.value||(e.dimensions.value={valueType:null}),this.base(e)},_preRenderContent:function(e){r.debug>=3&&r.log("Prerendering in parallelCoordinates"),this.parCoordPanel=new r.ParCoordPanel(this,this.basePanel,t.create(e,{topRuleOffset:this.options.topRuleOffset,botRuleOffset:this.options.botRuleOffset,leftRuleOffset:this.options.leftRuleOffset,rightRuleOffset:this.options.rightRuleOffset,sortCategorical:this.options.sortCategorical,mapAllDimensions:this.options.mapAllDimensions,numDigits:this.options.numDigits}))},defaults:t.create(r.BaseChart.prototype.defaults,{topRuleOffset:30,botRuleOffset:30,leftRuleOffset:60,rightRuleOffset:60,sortCategorical:!0,mapAllDimensions:!0,numDigits:0})}),r.ParCoordPanel=r.BasePanel.extend({anchor:"fill",pvParCoord:null,dimensions:null,dimensionDescr:null,data:null,retrieveData:function(){var e=this.chart.data,t=this.chart.options.numDigits;this.dimensions=e.getVisibleCategories();var n=e.getValues(),r=e.getVisibleSeriesIndexes(),i=e.getVisibleCategoriesIndexes(),s=e.getCategories(),o=this.chart.options.mapAllDimensions?i.map(function(e){return isNaN(n[e][0])?{categorical:!0,len:0,map:[]}:{categorical:!1,len:0,map:[],displayValue:[]}}):i.map(function(e){return isNaN(n[e][0])?{categorical:!0,len:0,map:[]}:null}),u=function(e,n){var r=o[e],i=null;if(!r.categorical){var s=n.toFixed(t);i=r.map[s],i==null&&(i=r.len,r.len++,r.map[s]=i,r.displayValue[s]=n)}else i=r.map[n],i==null&&(i=r.len,r.len++,r.map[n]=i);return i};for(var a in o)o.hasOwnProperty(a)&&o[a]&&o[a].categorical&&(o[a].displayValue=o[a].map);var f,l,c;if(this.chart.options.sortCategorical||this.chart.options.mapAllDimensions)for(f=0;f<o.length;f++)if(o[f]){for(var h=0;h<n[f].length;h++)u(f,n[f][h]);var p=o[f].map,d=[];for(l in p)p.hasOwnProperty(l)&&d.push(l);d.sort();if(o[f].categorical)for(c=0;c<d.length;c++)p[d[c]]=c;else for(c=0;c<d.length;c++)p[d[c]].index=c}var v=function(e){var t={};for(var r in i)i.hasOwnProperty(r)&&(t[s[r]]=o[r]?u(r,n[r][e]):n[r][e]);return t};this.data=r.map(function(e){return v(e)});var m=this.dimensions.map(function(e){var t={},n=e.split("__");return t.id=e,t.name=n[0],t.unit=n.length>1?n[1]:"",t});for(f=0;f<m.length;f++){l=m[f];var g=i[f];l.orgRowIndex=g;var y=n[g].length,b,w,E,S,x;if(o[g]){b=w=E=S=o[g].displayValue[n[g][0]];for(c=1;c<y;c++)x=o[g].displayValue[n[g][c]],x<b&&(E=b,b=x),x>w&&(S=w,w=x)}else{b=w=E=S=n[g][0];for(c=1;c<y;c++)x=n[g][c],x<b&&(E=b,b=x),x>w&&(S=w,w=x)}var T=(w-S+(E-b))/2;l.min=b,l.max=w,l.step=T,l.categorical=!1;if(o[g]){l.map=o[g].map,l.mapLength=o[g].len,l.categorical=o[g].categorical;if(!l.categorical){l.orgValue=[];var N=o[g].map;for(var C in N)N.hasOwnProperty(C)&&(l.orgValue[N[C]]=0+C)}}}var k=function(e,t){var n={};for(var r=0;r<e.length;r++)n[e[r]]=t[r];return n};this.dimensionDescr=k(this.dimensions,m)},_createCore:function(){function P(e){var n=e.dim;return b[n].min=Math.max(g[n].domain()[0],g[n].invert(t-e.y-e.dy)),b[n].max=Math.min(g[n].domain()[1],g[n].invert(t-e.y)),w=n,_.render(),!1}function H(e){if(e.dy<3){var n=e.dim;b[n].min=Math.max(g[n].domain()[0],g[n].invert(0)),b[n].max=Math.min(g[n].domain()[1],g[n].invert(t)),e.y=s,e.dy=f,w=n,_.render()}return!1}var e=this;this.retrieveData();var t=this.height,r=this.chart.options.numDigits,i=this.chart.options.topRuleOffset,s=this.chart.options.botRuleOffset,o=this.chart.options.leftRuleOffset,u=this.width-this.chart.options.rightRuleOffset,a=this.height-i,f=a-s,l=i-12,c=this.dimensions,h=this.dimensionDescr,p=function(e,t){var r=h[e].min,i=h[e].max,o=h[e].step;return t&&(r-=o,i+=o),n.Scale.linear(r,i).range(s,a)},d=function(e){var t=p(e,!0).range(s,a),n=h[e];if(n.orgValue&&!n.categorical){var r=function(e){var r=t(n.orgValue[e]);return r};return r.domain=function(){return t.domain()},r.invert=function(e){return t.invert(e)},r}return t},v=function(e){var t=p(e,!1).range("steelblue","brown");return t},m=n.Scale.ordinal(c).splitFlush(o,u),g=n.dict(c,d),y=n.dict(c,v),b=n.dict(c,function(e){return{min:g[e].domain()[0],max:g[e].domain()[1]}}),w=c[0],E=this.chart.options.mapAllDimensions?function(e){return c.every(function(t){var n=h[t],r=n.orgValue&&!n.categorical?n.orgValue[e[t]]:e[t];return r>=b[t].min&&r<=b[t].max})}:function(e){return c.every(function(t){return e[t]>=b[t].min&&e[t]<=b[t].max})},S=null;this.pvParCoord=this.pvPanel.add(n.Panel).data(e.data).visible(E).add(n.Line).data(c).left(function(e,t){return m(e)}).bottom(function(e,t){var n=g[e](t[e]);return n}).strokeStyle("#ddd").lineWidth(1).antialias(!1);var x=this.pvPanel.add(n.Rule).data(c).left(m).top(i).bottom(s);x.anchor("top").add(n.Label).top(l).font("bold 10px sans-serif").text(function(e){return h[e].name});var T=[],N=6,C=3;for(var k in h)if(h.hasOwnProperty(k)){var L=h[k];if(L.categorical){var A=m(L.id)+N;for(var O in L.map)L.map.hasOwnProperty(O)&&(T[T.length]={x:A,y:g[L.id](L.map[O])+C,label:O})}}var M=this.pvPanel.add(n.Panel).data(T).add(n.Label).left(function(e){return e.x}).bottom(function(e){return e.y}).text(function(e){return e.label}).textAlign("left"),_=this.pvPanel.add(n.Panel),D=_.add(n.Panel).data(e.data).visible(E).add(n.Line).data(c).left(function(e,t){return m(e)}).bottom(function(e,t){return g[e](t[e])}).strokeStyle(function(e,t){var n=h[w],r=n.orgValue&&!n.categorical?n.orgValue[t[w]]:t[w];return y[w](r)}).lineWidth(1),B=_.add(n.Panel).data(c.map(function(e){return{y:s,dy:f,dim:e}})).left(function(e){return m(e.dim)-30}).width(60).fillStyle("rgba(0,0,0,.001)").cursor("crosshair").event("mousedown",n.Behavior.select()).event("select",P).event("selectend",H).add(n.Bar).left(25).top(function(e){return e.y}).width(10).height(function(e){return e.dy}).fillStyle(function(e){return e.dim==w?y[e.dim]((b[e.dim].max+b[e.dim].min)/2):"hsla(0,0,50%,.5)"}).strokeStyle("white").cursor("move").event("mousedown",n.Behavior.drag()).event("dragstart",P).event("drag",P);B.anchor("bottom").add(n.Label).textBaseline("top").text(function(e){return h[e.dim].categorical?"":b[e.dim].min.toFixed(r)+h[e.dim].unit}),B.anchor("top").add(n.Label).textBaseline("bottom").text(function(e){return h[e.dim].categorical?"":b[e.dim].max.toFixed(r)+h[e.dim].unit}),this.extend(this.pvParCoord,"parCoord_"),this.extend(this.pvPanel,"chart_")}}),r.DataTree=r.BaseChart.extend({structEngine:null,structMetadata:null,structDataset:null,DataTreePanel:null,legendSource:"category",constructor:function(e){e=e||{},e.dimensionGroups=e.dimensionGroups||{},e.dimensionGroups.value||(e.dimensionGroups.value={valueType:null}),this.base(e)},setStructData:function(e){this.structDataset=e.resultset,this.structDataset.length||r.log("Warning: Structure-dataset is empty"),this.structMetadata=e.metadata,this.structMetadata.length||r.log("Warning: Structure-Metadata is empty")},_preRenderContent:function(e){r.debug>=3&&r.log("Prerendering in data-tree");var n=this.structEngine,i=n?n.type:new r.data.ComplexType;i.addDimension("value",{});var s={seriesInRows:!0,crosstabMode:!0},o=new r.data.CrosstabTranslationOper(i,this.structDataset,this.structMetadata,s);o.configureType(),n||(n=this.structEngine=new r.data.Data({type:i})),n.load(o.execute(n)),r.debug>=3&&r.log(this.structEngine.getInfo()),this.dataTreePanel=new r.DataTreePanel(this,this.basePanel,t.create(e,{topRuleOffset:this.options.topRuleOffset,botRuleOffset:this.options.botRuleOffset,leftRuleOffset:this.options.leftRuleOffset,rightRuleOffset:this.options.rightRuleOffset,boxplotColor:this.options.boxplotColor,valueFontsize:this.options.valueFontsize,headerFontsize:this.options.headerFontsize,border:this.options.border,perpConnector:this.options.perpConnector,numDigits:this.options.numDigits,minVerticalSpace:this.options.minVerticalSpace,connectorSpace:this.options.connectorSpace,minAspectRatio:this.options.minAspectRatio}))},defaults:t.create(r.BaseChart.prototype.defaults,{topRuleOffset:30,botRuleOffset:30,leftRuleOffset:60,rightRuleOffset:60,boxplotColor:"grey",headerFontsize:16,valueFontsize:20,border:2,perpConnector:!1,numDigits:0,connectorSpace:.15,minVerticalSpace:.05,minAspectRatio:2})}),r.DataTreePanel=r.BasePanel.extend({anchor:"fill",pvDataTree:null,treeElements:null,structMap:null,structArr:null,hRules:null,vRules:null,rules:null,generatePerpConnectors:function(e){this.hRules=[],this.vRules=[],this.rules=[];for(var t in this.structMap){var n=this.structMap[t];if(n.children!=null){var r=1e4,i=-1e4,s=n.left+n.width;this.hRules.push({left:s,width:e,bottom:n.bottom+n.height/2}),s+=e;for(var o in n.children){var u=this.structMap[n.children[o]],a=u.bottom+u.height/2;a>i&&(i=a),a<r&&(r=a),this.hRules.push({left:s,width:u.left-s,bottom:a})}i>r&&this.vRules.push({left:s,bottom:r,height:i-r})}}},generateLineSegment:function(e,t,n,r){var i=[];i.push({x:e,y:t}),i.push({x:n,y:r}),this.rules.push(i)},generateConnectors:function(e){this.hRules=[],this.vRules=[];if(this.chart.options.perpConnector){this.generatePerpConnectors(e);return}this.rules=[];for(var t in this.structMap){var n=this.structMap[t];if(n.children!=null){var r,i,s,o=1e4,u=-1e4;for(s in n.children)i=this.structMap[n.children[s]],r=i.bottom+i.height/2,r>u&&(u=r),r<o&&(o=r);var a=(u+o)/2,f=n.left+n.width,l=f+e;this.generateLineSegment(f,n.bottom+n.height/2,l,a);for(s in n.children)i=this.structMap[n.children[s]],r=i.bottom+i.height/2,this.generateLineSegment(l,a,i.left,r)}}},retrieveStructure:function(){var e=this.chart.structEngine,t=this.chart.options,n=e.getVisibleCategories();this.treeElements=e.getVisibleSeries();var r=e.getValues(),i=n.length>4,s;for(s in this.treeElements)this.treeElements[s]=$.trim(this.treeElements[s]);var o=[];o.getElement=function(e){return o[e]==null&&(o[e]={min:1e4,max:-1e4}),o[e]},o.addValue=function(e,t){var n=o.getElement(e);return t<n.min&&(n.min=t),t>n.max&&(n.max=t),n};var u,a,f,l;for(s in this.treeElements)f=this.treeElements[s],u=f[0],a=u.charCodeAt(0),l=parseInt(f.slice(1),10),o.addValue("__cols",a),o.addValue(u,l);var c=o.getElement("__cols"),h=this.innerWidth/(c.max-c.min+1),p=t.connectorSpace*h,d=h-p,v=d/t.minAspectRatio,m=c.min;delete o.__cols;for(s in o){c=o[s];if(typeof c=="function")continue;var g=c.max-c.min+1;c.gridHeight=this.innerHeight/g,c.cellHeight=c.gridHeight*(1-t.minVerticalSpace),c.cellHeight>v&&(c.cellHeight=v),c.relBottom=(c.gridHeight-c.cellHeight)/2,c.numRows=g}var y=new RegExp("[\\s\"']+","g");this.structMap={};for(s in this.treeElements){var b={};f=this.treeElements[s],b.box_id=f,this.structMap[f]=b,u=f[0],a=u.charCodeAt(0),l=parseInt(f.slice(1),10),c=o.getElement(u),b.colIndex=a-m,b.rowIndex=c.numRows-(l-c.min)-1,b.left=this.leftOffs+b.colIndex*h,b.width=d,i?(b.bottom=r[4][s],b.height=r[5][s]):(b.bottom=this.botOffs+b.rowIndex*c.gridHeight+c.relBottom,b.height=c.cellHeight),b.label=r[0][s],b.selector=r[1][s],b.aggregation=r[2][s];var w=(r[3][s]||"").replace(y," ");b.children=w===" "||w===""?null:w.split(" ")}this.generateConnectors((h-d)/2),this.structArr=[];for(s in this.structMap)f=this.structMap[s],this.structArr.push(f)},findDataValue:function(e,t){for(var n=0;n<t[0].length;n++)if(t[0][n]==e)return t[1][n];r.log("Error: value with key : "+e+" not found.")},generateBoxPlots:function(){var e=this.chart.options;for(var t in this.structArr){var i=this.structArr[t];if(!i.values.length)continue;i.subplot={};var s=i.subplot,o=[],u=15,a=i.width/6;s.hRules=[],s.vRules=[],s.marks=[],s.labels=[],o.push(this.findDataValue("_p5",i.values)),o.push(this.findDataValue("_p25",i.values)),o.push(this.findDataValue("_p50",i.values)),o.push(this.findDataValue("_p75",i.values)),o.push(this.findDataValue("_p95",i.values));var f=!1;if(typeof o[2]!="undefined"){o[4]<o[0]&&(o=o.reverse(),r.log(" dataset "+i.box_id+" repaired (_p95 was smaller than _p5)")),o[4]>o[0]?s.hScale=n.Scale.linear(o[0],o[4]):(f=!0,s.hScale=n.Scale.linear(o[0]-1e-10,o[0]+1e-10)),s.hScale.range(i.left+a,i.left+i.width-a);var l=""+o[2],c;for(c=0;c<o.length;c++)o[c]=s.hScale(o[c]);s.bot=i.bottom+i.height/3,s.top=i.bottom+2*i.height/3,s.mid=(s.top+s.bot)/2,s.textBottom=i.bottom+u,s.textBottom=s.bot-e.valueFontsize-1;var h=3;if(f)s.vRules.push({left:o[0],bottom:s.bot,lWidth:h,height:s.top-s.bot});else{s.hRules.push({left:o[0],width:o[1]-o[0],lWidth:1,bottom:s.mid}),s.hRules.push({left:o[1],width:o[3]-o[1],lWidth:1,bottom:s.bot}),s.hRules.push({left:o[1],width:o[3]-o[1],lWidth:1,bottom:s.top}),s.hRules.push({left:o[3],width:o[4]-o[3],lWidth:1,bottom:s.mid});for(c=0;c<o.length;c++)s.vRules.push({left:o[c],bottom:s.bot,lWidth:c==2?h:1,height:s.top-s.bot})}s.labels.push({left:o[2],bottom:s.textBottom,text:this.labelFixedDigits(l),size:e.smValueFont,color:e.boxplotColor})}}},labelFixedDigits:function(e){typeof e=="string"&&(e=parseFloat(e));if(typeof e=="number"){var t=this.chart.options.numDigits;e=e.toFixed(t)}return""+e},addDataPoint:function(e){var t=this.chart.options;for(var n in this.structArr){var r=this.structArr[n];if(!r.values.length)continue;var i=this.findDataValue(e,r.values);if(typeof i=="undefined")continue;var s=r.subplot,o=s.hScale(i),u="green";s.marks.push({left:o,bottom:s.mid,color:u}),s.labels.push({left:o,bottom:s.textBottom,text:this.labelFixedDigits(i),size:t.valueFont,color:u})}},retrieveData:function(){var e=this.chart.data,t=this.chart.options,n=e.getVisibleCategories(),i=e.getVisibleSeries(),s=e.getValues(),o={},u,a=s.length;for(var f in this.structArr){var l=this.structArr[f];l.values=[];for(u=0;u<a;u++)l.values.push([]);o[l.selector]=l}var c={};for(u in i){var h=o[i[u]];if(typeof h!="undefined")for(var p in s)h.values[p].push(s[p][u]);else c[i[u]]=!0}for(var d in c)r.log("Could'nt find box for selector: "+d);this.generateBoxPlots();var v=new RegExp("[\\s\"']+","g");if(t.selectParam){var m=t.selectParam.replace(v,"");m!="undefined"&&m.length>0&&typeof window[m]!="undefined"&&(m=window[m],this.addDataPoint(m))}},_createCore:function(){var e=this,t=this.chart.options;t.smValueFontsize=Math.round(.6*t.valueFontsize),t.smValueFont=""+t.smValueFontsize+"px sans-serif",t.valueFont=""+t.valueFontsize+"px sans-serif";var r=t.topRuleOffset,i=t.botRuleOffset,s=t.leftRuleOffset;this.innerWidth=this.width-s-t.rightRuleOffset,this.innerHeight=this.height-r-i,this.botOffs=i,this.leftOffs=s,this.retrieveStructure(),this.retrieveData();var o=t.headerFontsize+3,u=this.rules,a;for(a=0;a<u.length;a++)this.pvPanel.add(n.Line).data(u[a]).left(function(e){return e.x}).bottom(function(e){return e.y}).lineWidth(1).strokeStyle("black");this.pvDataTree=this.pvPanel.add(n.Bar).data(e.structArr).left(function(e){return e.left}).bottom(function(e){return e.bottom}).height(function(e){return e.height}).width(function(e){return e.width}).fillStyle("green").add(n.Bar).left(function(e){return e.left+t.border}).bottom(function(e){return e.bottom+t.border}).height(function(e){return e.height-t.border-o}).width(function(e){return e.width-2*t.border}).fillStyle("white").add(n.Label).text(function(e){return e.label}).textAlign("center").left(function(e){return e.left+e.width/2}).bottom(function(e){return e.bottom+e.height-t.headerFontsize-5+t.headerFontsize/5}).font(""+t.headerFontsize+"px sans-serif").textStyle("white").fillStyle("blue");for(a=0;a<this.structArr.length;a++){var f=this.structArr[a];this.pvPanel.add(n.Rule).data(f.subplot.hRules).left(function(e){return e.left}).width(function(e){return e.width}).bottom(function(e){return e.bottom}).lineWidth(function(e){return e.lWidth}).strokeStyle(e.chart.options.boxplotColor),this.pvPanel.add(n.Rule).data(f.subplot.vRules).left(function(e){return e.left}).height(function(e){return e.height}).bottom(function(e){return e.bottom}).lineWidth(function(e){return e.lWidth}).strokeStyle(e.chart.options.boxplotColor),this.pvPanel.add(n.Dot).data(f.subplot.marks).left(function(e){return e.left}).bottom(function(e){return e.bottom}).fillStyle(function(e){return e.color}),this.pvPanel.add(n.Label).data(f.subplot.labels).left(function(e){return e.left}).bottom(function(e){return e.bottom}).font(function(e){return e.size}).text(function(e){return e.text}).textAlign("center").textStyle(function(e){return e.color})}t.perpConnector&&(this.pvPanel.add(n.Rule).data(e.vRules).left(function(e){return e.left}).bottom(function(e){return e.bottom}).height(function(e){return e.height}).strokeStyle("black"),this.pvPanel.add(n.Rule).data(e.hRules).left(function(e){return e.left}).bottom(function(e){return e.bottom}).width(function(e){return e.width}).strokeStyle("black")),this.extend(this.pvDataTree,"dataTree_"),this.extend(this.pvPanel,"chart_")}}),t.type("pvc.data.BoxplotChartTranslationOper",r.data.MatrixTranslationOper).init(function(e,t,n,r,i){this._chart=e,this.base(t,n,r,i)}).add({configureType:function(){function n(t,n){var i=this._chart.visualRoles(t);if(!i.isPreBound()){n==null&&(n=1);var s=i.defaultDimensionName.match(/^(.*?)(\*)?$/)[1],o=0;while(o<n){var u=r.data.DimensionType.dimensionGroupLevelName(s,o++);this.complexType.dimensions(u,{assertExists:!1})||e.push(u)}}}var e=[],i=t.get(this.options,"categoriesCount",1);i>=1||(i=1),n.call(this,"category",i),r.BoxplotChart.measureRolesNames.forEach(function(e){n.call(this,e)},this),e.slice(0,this.freeVirtualItemSize()),e.length&&this.defReader({names:e})},defDimensionType:function(e,n){var i=r.data.DimensionType.dimensionGroupName(e);switch(i){case"median":n=t.setUDefaults(n,"valueType",Number);break;case"percentil":n=t.setUDefaults(n,"valueType",Number,"label","{0}% Percentil")}return this.base(e,n)}}),r.BoxplotChart=r.CategoricalAbstract.extend({legendSource:null,constructor:function(e){e.legend=!1,this.base(e),this._axisType2RoleNamesMap.ortho=r.BoxplotChart.measureRolesNames},_processOptionsCore:function(e){this.base.apply(this,arguments),e.secondAxis=e.showLines||e.showDots||e.showAreas,e.secondAxisIndependentScale=!1,e.stacked=!1,e.legend=!1},_getSeriesRoleSpec:function(){return null},_hasDataPartRole:function(){return!0},_initVisualRoles:function(){this.base();var e={isMeasure:!0,requireSingleDimension:!0,requireIsDiscrete:!1,valueType:Number},n=t.query([{name:"median",label:"Median",defaultDimensionName:"median",isRequired:!0},{name:"percentil25",label:"25% Percentil",defaultDimensionName:"percentil25"},{name:"percentil75",label:"75% Percentil",defaultDimensionName:"percentil75"},{name:"percentil5",label:"5% Percentil",defaultDimensionName:"percentil5"},{name:"percentil95",label:"95% Percentil",defaultDimensionName:"percentil95"}]).object({name:function(e){return e.name},value:function(n){return t.create(e,n)}});this._addVisualRoles(n)},_createTranslation:function(e,t){return new r.data.BoxplotChartTranslationOper(this,e,this.resultset,this.metadata,t)},_isDataCellStacked:function(){return!1},_createMainContentPanel:function(e){r.debug>=3&&r.log("Prerendering in boxplotChart");var t=this.options,n=new r.BoxplotChartPanel(this,e,{orientation:t.orientation,boxSizeRatio:t.boxSizeRatio,maxBoxSize:t.maxBoxSize,boxplotColor:t.boxplotColor});if(t.secondAxis){r.debug>=3&&r.log("Creating LineDotArea panel.");var i=new r.LineDotAreaPanel(this,e,{orientation:t.orientation,stacked:!1,showValues:!(t.compatVersion<=1)&&t.showValues,valuesAnchor:t.valuesAnchor,showLines:t.showLines,showDots:t.showDots,showAreas:t.showAreas,nullInterpolationMode:t.nullInterpolationMode});this._linePanel=i}return n},defaults:t.create(r.CategoricalAbstract.prototype.defaults,{boxplotColor:"darkgreen",boxSizeRatio:1/3,maxBoxSize:Infinity,showDots:!1,showLines:!1,showAreas:!1,nullInterpolationMode:"none",showValues:!1,valuesAnchor:"right"})},{measureRolesNames:["median","percentil25","percentil75","percentil5","percentil95"]}),r.BoxplotChartPanel=r.CartesianAbstractPanel.extend({anchor:"fill",_createCore:function(){function l(e){return e.lock(s,function(){return this.pvMark.parent[o]()/2}).override("defaultColor",function(e){if(e==="stroke")return a}),e}function c(e){return e.lock(s,function(e){return e.vars.category.boxLeft}).lock(o,function(e){return e.vars.category.boxWidth}),e}function h(e){return c(e),e.override("defaultColor",function(e){if(e==="stroke")return a}),e}this.base();var e=this._buildScene(),i=this.isOrientationVertical()?"bottom":"left",s=this.anchorOrtho(i),o=this.anchorLength(i),u=this.anchorOrthoLength(i),a=n.color(this.boxplotColor),f=n.color("limegreen");this.pvBoxPanel=this.pvPanel.add(n.Panel).data(e.childNodes)[s](function(e){var t=e.vars.category;return t.x-t.width/2})[o](function(e){return e.vars.category.width}),this.pvVRuleTop=l(new r.visual.Rule(this,this.pvBoxPanel,{extensionId:"boxVRule",freePosition:!0,noHover:!1,noSelect:!1,noClick:!1,noDoubleClick:!1})).intercept("visible",function(e){return e.vars.category.showVRuleAbove&&this.delegate(!0)}).lock(i,function(e){return e.vars.category.vRuleAboveBottom}).lock(u,function(e){return e.vars.category.vRuleAboveHeight}).pvMark,this.pvVRuleBot=l(new r.visual.Rule(this,this.pvBoxPanel,{extensionId:"boxVRule",freePosition:!0,noHover:!1,noSelect:!1,noClick:!1,noDoubleClick:!1})).intercept("visible",function(e){return e.vars.category.showVRuleBelow&&this.delegate(!0)}).lock(i,function(e){return e.vars.category.vRuleBelowBottom}).lock(u,function(e){return e.vars.category.vRuleBelowHeight}).pvMark,this.pvBar=c(new r.visual.Bar(this,this.pvBoxPanel,{extensionId:"boxBar",freePosition:!0,normalStroke:!0})).intercept("visible",function(e){return e.vars.category.showBox&&this.delegate(!0)}).lock(i,function(e){return e.vars.category.boxBottom}).lock(u,function(e){return e.vars.category.boxHeight}).override("defaultColor",function(e){switch(e){case"fill":return f;case"stroke":return a}}).override("defaultStrokeWidth",t.fun.constant(1)).pvMark,this.pvHRule5=h(new r.visual.Rule(this,this.pvBoxPanel,{extensionId:"boxHRule5",freePosition:!0,noHover:!1,noSelect:!1,noClick:!1,noDoubleClick:!1})).intercept("visible",function(){return this.scene.vars.percentil5.value!=null&&this.delegate(!0)}).lock(i,function(){return this.scene.vars.percentil5.position}).pvMark,this.pvHRule95=h(new r.visual.Rule(this,this.pvBoxPanel,{extensionId:"boxHRule95",freePosition:!0,noHover:!1,noSelect:!1,noClick:!1,noDoubleClick:!1})).intercept("visible",function(){return this.scene.vars.percentil95.value!=null&&this.delegate(!0)}).lock(i,function(){return this.scene.vars.percentil95.position}).pvMark,this.pvHRule50=h(new r.visual.Rule(this,this.pvBoxPanel,{extensionId:"boxHRule50",freePosition:!0,noHover:!1,noSelect:!1,noClick:!1,noDoubleClick:!1})).intercept("visible",function(){return this.scene.vars.median.value!=null&&this.delegate(!0)}).lock(i,function(){return this.scene.vars.median.position}).override("defaultStrokeWidth",t.fun.constant(2)).pvMark},applyExtensions:function(){this.base(),this.extend(this.pvBoxPanel,"boxPanel_"),this.extend(this.pvBoxPanel,"box_"),this.extend(this.pvBar,"boxBar_"),this.extend(this.hRule50,"boxHRule50_"),this.extend(this.hRule5,"boxHRule5_"),this.extend(this.hRule95,"boxHRule95_"),this.extend(this.pvVRuleTop,"boxVRule_"),this.extend(this.pvVRuleBot,"boxVRule_")},_renderInteractive:function(){this.pvBoxPanel.render()},_getSignums:function(){return[this.pvBar]},_buildScene:function(){function c(s){var c=new r.visual.Scene(o,{group:s}),h=c.vars,p=h.category=new r.visual.ValueLabelVar(s.value,s.label);t.set(p,"group",s,"x",u(s.value),"width",a,"boxWidth",f,"boxLeft",a/2-f/2),e.measureVisualRoles().forEach(function(e){var t=n[e.name],o;if(t){var u=s.dimensions(t),a=u.sum(i);o=new r.visual.ValueLabelVar(a,u.format(a)),o.position=l(a)}else o=new r.visual.ValueLabelVar(null,""),o.position=null;h[e.name]=o});var d=h.percentil5.value!=null,v=h.percentil25.value!=null,m=h.median.value!=null,g=h.percentil75.value!=null,y,b,w=v||g;w&&(y=v?h.percentil25.position:m?h.median.position:h.percentil75.position,b=g?h.percentil75.position:m?h.median.position:h.percentil25.position,w=b!==y,w&&(p.boxBottom=y,p.boxHeight=b-y)),p.showBox=w,w=h.percentil95.value!=null,w&&(y=g?h.percentil75.position:m?h.median.position:v?h.percentil25.position:d?h.percentil5.position:null,w=y!=null,w&&(p.vRuleAboveBottom=y,p.vRuleAboveHeight=h.percentil95.position-y)),p.showVRuleAbove=w,w=d,w&&(b=v?h.percentil25.position:m?h.median.position:g?h.percentil75.position:null,w=b!=null,w&&(y=h.percentil5.position,p.vRuleBelowHeight=b-y,p.vRuleBelowBottom=y)),p.showVRuleBelow=w}var e=this.chart,n=t.query(e.measureVisualRoles()).object({name:function(e){return e.name},value:function(e){return e.firstDimensionName()}}),i={visible:!0,zeroIfNone:!1},s=this._getVisibleData(),o=new r.visual.Scene(null,{panel:this,group:s}),u=e.axes.base.scale,a=u.range().band,f=Math.min(a*this.boxSizeRatio,this.maxBoxSize),l=e.axes.ortho.scale;return s.children().each(c,this),o}}),r}),pen.define("cdf/lib/CCC/pvc-d1.0",[],function(){}),pentaho=typeof pentaho=="undefined"?{}:pentaho,pentaho.common=pentaho.common||{},dojo.require("dojox.storage"),pentaho.common.localcache={keyRegex:new RegExp("[-\\.]","gi"),cacheHasBeenRefreshed:!1,lmMap:{},isAvailable:function(){if(dojox.storage.isAvailable()){if(dojox.storage.manager.getProvider().declaredClass=="dojox.storage.FlashStorageProvider"){var e=new dojox.flash.Install,t=!e.needed();return t}return!0}return!1},getCacheKey:function(e){return e.replace(this.keyRegex,"_")},putValue:function(e,t,n){if(this.isAvailable()){this.refreshCacheExirations(),e=this.getCacheKey(e);var r=this.getLastModified(e);typeof n=="undefined"&&(n=this.lmMap[e]);if(r==null)var i={lastModified:typeof n=="undefined"?0:n,value:t};else var i={lastModified:typeof n=="undefined"?r:n,value:t};dojox.storage.put(e,i)}},getValue:function(e){if(this.isAvailable()){this.refreshCacheExirations(),e=this.getCacheKey(e);var t=dojox.storage.get(e);if(t!=null)return t.value}return null},getLastModified:function(e){if(this.isAvailable()){this.refreshCacheExirations(),e=this.getCacheKey(e);var t=dojox.storage.get(e);if(t!=null){var n=t.lastModified;return n}return null}},setLastModified:function(e,t){if(this.isAvailable()){e=this.getCacheKey(e);var n=dojox.storage.get(e);n!=null?n.lastModified=t:n={lastModified:t,value:null},dojox.storage.put(e,n)}},clear:function(e){this.isAvailable()&&(e=this.getCacheKey(e),dojox.storage.remove(e))},updateCacheExpiration:function(e){this.lmMap={};var t=this.lmMap;$(e).find("cache-item").each(function(){var e=$(this).find("key").text();e=pentaho.common.localcache.getCacheKey(e);var n=$(this).find("last-modified").text();t[e]=n;var r=pentaho.common.localcache.getValue(e);r!=null&&pentaho.common.localcache.getLastModified(e)<n&&(pentaho.common.localcache.clear(e),pentaho.common.localcache.setLastModified(e,n))})},refreshCacheExirations:function(){this.cacheHasBeenRefreshed==0&&window.pentahoCacheExpirationServiceResults!="undefined"&&window.pentahoCacheExpirationServiceResults!=null&&(this.cacheHasBeenRefreshed=!0,this.updateCacheExpiration(window.pentahoCacheExpirationServiceResults))}},pen.define("common-ui/cache/LocalCache",[],function(){}),pentaho=typeof pentaho=="undefined"?{}:pentaho,pentaho.DataTable=function(e){this.jsonTable=e,this.className="pentaho.DataTable",e.metadata&&(this.jsonTable=pentaho.DataTable.convertCdaToDataTable(e))},pentaho.DataTable.convertCdaToDataTable=function(e){var t=[],n=[];for(var r=0;r<e.metadata.length;r++)col={id:e.metadata[r].colName,type:e.metadata[r].colType.toLowerCase(),label:e.metadata[r].colLabel},col.label||(col.label=col.id),col.type=="numeric"&&(col.type="number"),t.push(col);var i=e.resultset;for(var s=0;s<i.length;s++){var o=[],u=i[s];for(r=0;r<u.length;r++)o.push({v:u[r]});var a={c:o};n.push(a)}return{cols:t,rows:n}},pentaho.DataTable.prototype.makePostable=function(){this.jsonTable["class"]="org.pentaho.dataservice.DataTable";for(var e=0;e<this.getNumberOfColumns();e++)this.jsonTable.cols[e]["class"]="org.pentaho.dataservice.Column";for(var e=0;e<this.getNumberOfRows();e++){var t=this.jsonTable.rows[e].c;if(t)for(cellNo=0;cellNo<t.length;cellNo++)t[cellNo]&&(t[cellNo]["class"]="org.pentaho.dataservice.Cell")}},pentaho.DataTable.prototype.getJsonTable=function(){return this.jsonTable},pentaho.DataTable.prototype.getNumberOfColumns=function(){return this.jsonTable.cols.length},pentaho.DataTable.prototype.getNumberOfRows=function(){return this.jsonTable.rows.length},pentaho.DataTable.prototype.getColumnType=function(e){return this.jsonTable.cols[e].type},pentaho.DataTable.prototype.getColumnId=function(e){return this.jsonTable.cols[e].id},pentaho.DataTable.prototype.getColumnLabel=function(e){return this.jsonTable.cols[e].label},pentaho.DataTable.prototype.getValue=function(e,t){return this.jsonTable.rows[e].c[t]?this.jsonTable.rows[e].c[t].v!==undefined?this.jsonTable.rows[e].c[t].v:this.jsonTable.rows[e].c[t]:null},pentaho.DataTable.prototype._getCell=function(e,t){return this.jsonTable.rows[e].c[t]?this.jsonTable.rows[e].c[t]:null},pentaho.DataTable.prototype.getFormattedValue=function(e,t){return this.jsonTable.rows[e].c[t]?this.jsonTable.rows[e].c[t].f!==undefined?this.jsonTable.rows[e].c[t].f:this.jsonTable.rows[e].c[t].v!==undefined?this.jsonTable.rows[e].c[t].v:this.jsonTable.rows[e].c[t].v==null?null:this.jsonTable.rows[e].c[t]:null},pentaho.DataTable.prototype.getColumnRange=function(e){var t,n,r=!1;for(var i=0;i<this.getNumberOfRows();i++){var s=this.getValue(i,e);!r&&(s||s==0)?(t=s,n=s,r=!0):(s<t&&(t=s),s>n&&(n=s))}var o={min:t,max:n};return o},pentaho.DataTable.prototype.getDistinctValues=function(e){var t=[],n={},r=this.getColumnType(e)=="number";for(var i=0;i<this.getNumberOfRows();i++){var s=r?this.getValue(i,e):this.getFormattedValue(i,e);n[s]||(n[s]=!0,t.push(s))}return t},pentaho.DataTable.prototype.getDistinctFormattedValues=function(e){var t=[],n={};for(var r=0;r<this.getNumberOfRows();r++){var i=this.getFormattedValue(r,e);n[i]||(n[i]=!0,t.push(i))}return t},pentaho.DataTable.prototype.getFilteredRows=function(e){var t=[],n={};for(var r=0;r<this.getNumberOfRows();r++)for(var i=0;i<e.length;i++){e[i].value&&this.getValue(r,e[i].column)==e[i].value&&t.push(r);if(e[i].combinations){var s=this.getValue(r,e[i].column),o=e[i].combinations,u=!1;for(combinationNo=0;combinationNo<o.length;combinationNo++)for(valueNo=0;valueNo<o[combinationNo].values.length;valueNo++)if(s==o[combinationNo].values[valueNo]){if(n[combinationNo])n[combinationNo][1].push(r);else{var a=["combine",[]];a[1].push(r),t.push(a),n[combinationNo]=a}u=!0}u||t.push(r)}}return t},pentaho.DataTable.prototype.setColumnProperty=function(e,t,n){e>=0&&e<this.jsonTable.cols.length&&(this.jsonTable.cols[e][t]=n)},pentaho.DataTable.prototype.getColumnProperty=function(e,t){return e>=0&&e<this.jsonTable.cols.length?this.jsonTable.cols[e][t]:null},pentaho.DataView=function(e){this.dataTable=e,this.rows=null,this.columns=null,this.className="pentaho.DataView"},pentaho.DataView.prototype.setRows=function(e){this.rows=e},pentaho.DataView.prototype.setColumns=function(e){this.columns=e},pentaho.DataView.prototype.getColumnRange=function(e){var t,n,r=!1;for(var i=0;i<this.getNumberOfRows();i++){var s=this.getValue(i,e);!r&&(s||s==0)?(t=s,n=s,r=!0):(s<t&&(t=s),s>n&&(n=s))}var o={min:t,max:n};return o},pentaho.DataView.prototype.getDistinctValues=function(e){var t=[],n={};for(var r=0;r<this.getNumberOfRows();r++){var i=this.getValue(r,e);n[i]||(n[i]=!0,t.push(i))}return t},pentaho.DataView.prototype.getDistinctFormattedValues=function(e){var t=[],n={};for(var r=0;r<this.getNumberOfRows();r++){var i=this.getFormattedValue(r,e);n[i]||(n[i]=!0,t.push(i))}return t},pentaho.DataView.prototype.hideColumns=function(e){tmpCols=[];for(var t=0;t<this.getNumberOfColumns();t++)tmpCols.push(t);for(var n=e.length-1;n>-1;n--)tmpCols.splice(e[n],1);this.columns=tmpCols},pentaho.DataView.prototype.getNumberOfRows=function(){return this.rows==null?this.dataTable.getNumberOfRows():this.rows.length},pentaho.DataView.prototype.getNumberOfColumns=function(){return this.columns==null?this.dataTable.getNumberOfColumns():this.columns.length},pentaho.DataView.prototype.getColumnId=function(e){return this.columns==null?this.dataTable.getColumnId(e):this.dataTable.getColumnId(this.columns[e])},pentaho.DataView.prototype.getColumnLabel=function(e){return this.columns==null?this.dataTable.getColumnLabel(e):this.dataTable.getColumnLabel(this.columns[e])},pentaho.DataView.prototype.getColumnType=function(e){return this.columns==null?this.dataTable.getColumnType(e):this.dataTable.getColumnType(this.columns[e])},pentaho.DataView.prototype.getValue=function(e,t){var n=this.rows==null?e:this.rows[e],r=this.columns==null?t:this.columns[t];if(n.length&&n[0]=="combine"){var i=this.getColumnType(t),s;for(var o=0;o<n[1].length;o++)o==0?s=this.dataTable.getValue(n[1][o],r):i=="string"?s+=" + "+this.dataTable.getValue(n[1][o],r):i=="number"&&(s+=this.dataTable.getValue(n[1][o],r));return s}return this.dataTable.getValue(n,r)},pentaho.DataView.prototype._getCell=function(e,t){var n=this.rows==null?e:this.rows[e],r=this.columns==null?t:this.columns[t];return this.dataTable._getCell(n,r)},pentaho.DataView.prototype.getFormattedValue=function(e,t){var n=this.rows==null?e:this.rows[e],r=this.columns==null?t:this.columns[t];if(n.length&&n[0]=="combine"){var i=this.getColumnType(t),s;for(var o=0;o<n[1].length;o++)o==0?s=this.dataTable.getFormattedValue(n[1][o],r):i=="string"?s+=" + "+this.dataTable.getFormattedValue(n[1][o],r):i=="number"&&(s+=this.dataTable.getFormattedValue(n[1][o],r));return s}return this.dataTable.getFormattedValue(n,r)},pentaho.DataView.prototype.toDataTable=function(){var e=[];for(var t=0;t<this.getNumberOfColumns();t++)col={type:this.getColumnType(t),id:this.getColumnId(t),label:this.getColumnLabel(t)},e.push(col);var n=[];for(var r=0;r<this.getNumberOfRows();r++){cells=[];for(var t=0;t<this.getNumberOfColumns();t++){var i=this._getCell(r,t);cells.push(i)}row={c:cells},n.push(row)}var s={cols:e,rows:n},o=new pentaho.DataTable(s);return o},pentaho.DataView.prototype.setColumnProperty=function(e,t,n){this.dataTable.setColumnProperty(e,t,n)},pentaho.DataView.prototype.getColumnProperty=function(e,t){return this.dataTable.getColumnProperty(e,t)},pen.define("common-ui/vizapi/DataTable",[],function(){}),pentaho=typeof pentaho=="undefined"?{}:pentaho,pentaho.events={},pentaho.events.listeners=[],pentaho.events.trigger=function(e,t,n){for(var r=0;r<pentaho.events.listeners.length;r++)pentaho.events.listeners[r].object==e&&pentaho.events.listeners[r].eventName==t&&pentaho.events.listeners[r].func(n)},pentaho.events.addListener=function(e,t,n){pentaho.events.listeners.push({object:e,eventName:t,func:n})},pentaho.events.removeListener=function(e,t){var n=0;while(n<pentaho.events.listeners.length)pentaho.events.listeners[n].object==e&&pentaho.events.listeners[n].eventName==t?pentaho.events.listeners.splice(n,1):n++},pentaho.events.removeSource=function(e){var t=0;while(t<pentaho.events.listeners.length)pentaho.events.listeners[t].object==e?pentaho.events.listeners.splice(t,1):t++},pen.define("common-ui/vizapi/Events",[],function(){}),pentaho=typeof pentaho=="undefined"?{}:pentaho,pentaho.palettes=[],pentaho.palettes.push({name:"palette 1",colors:["#336699","#99CCFF","#999933","#666699","#CC9933","#006666","#3399FF","#993300","#CCCC99","#666666","#FFCC66","#6699CC","#663366"]}),pentaho.palettes.push({name:"palette 2",colors:["#880a0f","#b09a6b","#772200","#c52f0d","#123d82","#4a0866","#ffaa00","#1e8ad3","#aa6611","#772200","#8b2834","#333333"]}),pentaho.palettes.push({name:"palette 3",colors:["#387179","#626638","#A8979A","#B09A6B","#772200","#C52F0D","#123D82","#4A0866","#445500","#FFAA00","#1E8AD3","#AA6611","#772200"]}),pentaho.visualizations=pentaho.visualizations||[],pentaho.visualizations.getById=function(e){for(var t=0;t<this.length;t++)if(this[t].id==e)return this[t];return null};var visualizations=pentaho.visualizations;pentaho.VizController=function(e){this.id=e,this.domNode=null,this.isDragging=!1,this.combinations=[],this.selections=[],this.highlights=[],this.metrics=null,this.origTable=null,this.dataTable=null,this.currentViz=null,this.currentAction="select",this.layoutPanelElement=null,this.layoutPanel=null,this.visualPanelElement=null,this.layoutShown=!1,this.toolbarElement=null,this.title=null,this.chart=null,this.palette=pentaho.palettes[0],this.lastError=null},pentaho.VizController.prototype.getError=function(){return this.lastError},pentaho.VizController.prototype.getState=function(){try{var e={};return this.currentViz&&(e.vizId=this.currentViz.id,this.chart.getState&&(e.vizState=this.chart.getState())),e}catch(t){return this.lastError=t,null}},pentaho.VizController.prototype.setState=function(e){try{if(!this.currentViz||this.currentViz.id!=e.vizId){for(var t=0;t<pentaho.visualizations.length;t++)if(pentaho.visualizations[t].id==e.id){this.currentViz=pentaho.visualizations[t];break}this.currentViz||alert("Visualization not found: "+e.vizId),this.setVisualization(this.currentViz)}return delete e.dataReqs,dojo.safeMixin(this.currentViz,e),this.chart&&this.chart.setState&&this.chart.setState(e.vizState),!0}catch(n){return this.lastError=n,!1}},pentaho.VizController.prototype.setDomNode=function(e){try{this.domNode=e;while(e.firstChild)e.removeChild(e.firstChild);var t=this.domNode.offsetWidth,n=this.domNode.offsetHeight;return this.visualPanelElement=document.createElement("DIV"),this.visualPanelElement.setAttribute("id","visualPanelElement-"+this.id),this.visualPanelElement.setAttribute("style","border:0px solid #red; background-color: white; width: "+t+"px; height: "+n+"px"),this.domNode.appendChild(this.visualPanelElement),!0}catch(r){return this.lastError=r,!1}},pentaho.VizController.prototype.setDataTable=function(e){try{return this.origTable=e,this.setupTable(),!0}catch(t){return this.lastError=t,!1}},pentaho.VizController.prototype.setTitle=function(e){this.title=e},pentaho.VizController.prototype.setVisualization=function(e,t){try{return this.currentViz&&this.currentViz["class"]!=e["class"]&&this.setDomNode(this.domNode),this.currentViz=e,this.doVisualization(e,t),!0}catch(n){return this.lastError=n,!1}},pentaho.VizController.prototype.updateVisualization=function(e){try{if(!this.currentViz)return;return this.doVisualization(this.currentViz,e),!0}catch(t){return this.lastError=t,!1}},pentaho.VizController.prototype.doVisualization=function(visualization,userDefinedOptions){this.userDefinedOptions=userDefinedOptions||{};if(!this.dataTable)return;try{currentView=new pentaho.DataView(this.dataTable);var className=visualization["class"],options={title:this.title,width:this.visualPanelElement.offsetWidth,height:this.visualPanelElement.offsetHeight,metrics:this.metrics,palette:this.palette,controller:this,action:this.currentAction,selections:this.highlights};if(visualization.needsColorGradient){var gradMap=[[255,0,0],[255,255,0],[0,0,255],[0,255,0]];options.color1=gradMap[0],options.color2=gradMap[3]}var propMap=visualization.propMap;if(propMap)for(var propNo=0;propNo<propMap.length;propNo++){var prop=propMap[propNo],propValue=null;prop.source=="columnlabel"&&(propValue=currentView.getColumnLabel(prop.position)),prop.source=="maxvalue"&&(propValue=this.metrics[prop.position].range.max),prop.source=="minvalue"&&(propValue=this.metrics[prop.position].range.min);var obj=options;for(var nameNo=0;nameNo<prop.name.length;nameNo++)nameNo<prop.name.length-1?(obj[prop.name[nameNo]]||(obj[prop.name[nameNo]]={}),obj=obj[prop.name[nameNo]]):obj[prop.name[nameNo]]=propValue}if(visualization.args)for(var x in visualization.args)options[x]=visualization.args[x];for(var x in this.userDefinedOptions)options[x]=this.userDefinedOptions[x];var id="chart_div"+this.id;if(!this.chart||this.chart.vizId!=visualization.id){var chartDiv=this.visualPanelElement;eval("this.chart = new "+className+"(chartDiv)"),pentaho.events.addListener(this.chart,"select",function(){return myself.chartSelectHandler.apply(myself,arguments||[])}),pentaho.events.addListener(this.chart,"doubleclick",function(){return myself.chartDoubleClickHandler.apply(myself,arguments||[])}),pentaho.events.addListener(this.chart,"onmouseover",function(){return myself.chartMouseOverHandler.apply(myself,arguments||[])}),pentaho.events.addListener(this.chart,"onmouseout",function(){return myself.chartMouseOutHandler.apply(myself,arguments||[])})}var myself=this;this.chart.controller=this,this.chart.id="viz"+this.id,this.chart.vizId=visualization.id;if(!currentView){alert("No suitable dataset"),document.getElementById("chart_div").innerHTML="";return}try{this.chart.draw(currentView,options)}catch(e){alert(e)}return this.currentViz=visualization,!0}catch(e){return this.lastError=e,!1}},pentaho.VizController.prototype.chartSelectHandler=function(e){this.processHighlights(e),pentaho.events.trigger(this,"select",e)},pentaho.VizController.prototype.chartDoubleClickHandler=function(e){pentaho.events.trigger(this,"doubleclick",e)},pentaho.VizController.prototype.processHighlights=function(e){var t=e.selectionMode||"TOGGLE";t=="REPLACE"&&(this.highlights=[]);for(var n=0;n<e.selections.length;n++){var r=e.selections[n],i,s,o,u,a,f,l;r.rowItem&&(i=r.rowItem,f=r.rowId,l=r.rowLabel);if(r.column||r.column==0)s=r.columnId,o=r.columnLabel,a=r.columnItem;(r.row||r.row==0)&&r.column&&(u=r.value);var c=!1,h=!1;if(t=="TOGGLE")for(var p=0;p<this.highlights.length;p++){var d=this.highlights[p].rowItem,v=this.highlights[p].colItem,m=d&&(d==i||d.join&&d.join("-")==i.join("-")),g=v&&(v==a||v.join&&v.join("-")==a.join("-"));typeof g=="undefined"&&(g=!0);if(m&&g&&this.highlights[p].colId&&this.highlights[p].colId==s&&this.highlights[p].type=="column"&&r.type=="cell"){this.highlights[p].type="row",highlight.id=r.rowId,highlight.value=i,h=!0;break}if(m&&g&&this.highlights[p].colId&&this.highlights[p].colId==s&&this.highlights[p].type=="column"){this.highlights.splice(p,1),c=!0;break}if(m&&g){this.highlights.splice(p,1),c=!0;break}}!c&&!h&&(highlight={rowItem:i,colId:s,colLabel:o,colItem:a,rowId:f,rowLabel:l},highlight.type=r.type,r.type=="row"?(highlight.id=f,highlight.value=i):r.type=="column"?(highlight.type="column",highlight.id=s,highlight.value=o):r.type=="cell"&&(highlight.type="cell",highlight.id=s,highlight.value=o),this.highlights.push(highlight))}},pentaho.VizController.prototype.createCombination=function(){var e,t,n=[];for(var r=0;r<this.highlights.length;r++)r==0?(e=this.highlights[r].type,n.push(this.highlights[r].value),t=this.highlights[r].id):this.highlights[r].id==t&&n.push(this.highlights[r].value);this.combinations.push({values:n,columnId:t}),this.setupTable(),this.highlights=[],this.updateVisualization()},pentaho.VizController.prototype.updateHighlights=function(){this.chart.setHighlights&&this.chart.setHighlights(this.highlights)},pentaho.VizController.prototype.clearSelections=function(){this.highlights=[]},pentaho.VizController.prototype.setupTable=function(){if(!this.origTable)return;this.metrics=[],this.dataTable=this.origTable;if(this.combinations&&this.combinations.length>0){var e=this.origTable.getFilteredRows([{column:0,combinations:this.combinations}]),t=new pentaho.DataView(table);t.setRows(e),this.dataTable=t}for(var n=0;n<this.dataTable.getNumberOfColumns();n++)if(this.dataTable.getColumnType(n)=="string"){var r=this.dataTable.getDistinctValues(n),i=pentaho.VizController.createPaletteMap(r,this.palette);this.metrics.push({values:r,paletteMap:i})}else if(this.dataTable.getColumnType(n)=="number"){var s=this.dataTable.getColumnRange(n);this.metrics.push({range:s})}},pentaho.VizController.createPaletteMap=function(e,t){var n={};for(var r=0;r<e.length&&r<t.colors.length;r++)n[e[r]]=t.colors[r];for(var r=t.colors.length;r<e.length;r++)n[e[r]]="#000000";return n},pentaho.VizController.getRrbGradient=function(e,t,n,r,i){if(n-t<=0)return pentaho.VizController.getRrbColor(i[0],i[1],i[2]);var s=(e-t)/(n-t),o=new Array(3);return o[0]=Math.floor(s*(i[0]-r[0])+r[0]),o[1]=Math.floor(s*(i[1]-r[1])+r[1]),o[2]=Math.floor(s*(i[2]-r[2])+r[2]),pentaho.VizController.getRrbColor(o[0],o[1],o[2])},pentaho.VizController.getRgbGradientFromMultiColorHex=function(e,t,n,r){var i=r.length-1,s=n-t;if(s<=0)var o=r.length-1,u=o;else var o=Math.floor((e-t)/s*i),u=Math.ceil((e-t)/s*i);var a=pentaho.VizController.convertToRGB(r[o]),f=pentaho.VizController.convertToRGB(r[u]),l=o==0?1:o/i*n,c=u/i*n,h;l==c?h=1:h=(e-l)/(c-l);var p=new Array(3);return p[0]=Math.floor(h*(f[0]-a[0])+a[0]),p[1]=Math.floor(h*(f[1]-a[1])+a[1]),p[2]=Math.floor(h*(f[2]-a[2])+a[2]),pentaho.VizController.getRrbColor(p[0],p[1],p[2])},pentaho.VizController.getRgbStepFromMultiColorHex=function(e,t,n,r){var i=r.length-1,s=n-t,o=Math.round((e-t)/s*i),u=pentaho.VizController.convertToRGB(r[o]);return pentaho.VizController.getRrbColor(u[0],u[1],u[2])},pentaho.VizController.convertToRGB=function(e){return e.indexOf("#")==0?e=e.substring(1):e=pentaho.VizController.CSS_Names[e.toLowerCase()],[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]},pentaho.VizController.getRrbColor=function(e,t,n){return"RGB("+e+","+t+","+n+")"},pentaho.VizController.prototype.resize=function(e,t){this.visualPanelElement.style.width=e+"px",this.visualPanelElement.style.height=t+"px",this.chart.resize(e,t)},pentaho.VizController.dashboardMode=!1;try{window.parent&&typeof window.parent.PentahoDashboardController!="undefined"}catch(ignored){}pentaho.VizController.CSS_Names={aliceblue:"F0F8FF",antiquewhite:"FAEBD7",aqua:"00FFFF",aquamarine:"7FFFD4",azure:"F0FFFF",beige:"F5F5DC",bisque:"FFE4C4",black:"000000",blanchedalmond:"FFEBCD",blue:"0000FF",blueviolet:"8A2BE2",brown:"A52A2A",burlywood:"DEB887",cadetblue:"5F9EA0",chartreuse:"7FFF00",chocolate:"D2691E",coral:"FF7F50",cornflowerblue:"6495ED",cornsilk:"FFF8DC",crimson:"DC143C",cyan:"00FFFF",darkblue:"00008B",darkcyan:"008B8B",darkgoldenRod:"B8860B",darkgray:"A9A9A9",darkgrey:"A9A9A9",darkgreen:"006400",darkkhaki:"BDB76B",darkmagenta:"8B008B",darkoliveGreen:"556B2F",darkorange:"FF8C00",darkorchid:"9932CC",darkred:"8B0000",darksalmon:"E9967A",darkseagreen:"8FBC8F",darkslateblue:"483D8B",darkslategray:"2F4F4F",darkslategrey:"2F4F4F",darkturquoise:"00CED1",darkviolet:"9400D3",deeppink:"FF1493",deepskyblue:"00BFFF",dimgray:"696969",dimgrey:"696969",dodgerblue:"1E90FF",firebrick:"B22222",floralwhite:"FFFAF0",forestgreen:"228B22",fuchsia:"FF00FF",gainsboro:"DCDCDC",ghostwhite:"F8F8FF",gold:"FFD700",goldenrod:"DAA520",gray:"808080",grey:"808080",green:"008000",greenyellow:"ADFF2F",honeydew:"F0FFF0",hotpink:"FF69B4",indianred:"CD5C5C",indigo:"4B0082",ivory:"FFFFF0",khaki:"F0E68C",lavender:"E6E6FA",lavenderblush:"FFF0F5",lawngreen:"7CFC00",lemonchiffon:"FFFACD",lightblue:"ADD8E6",lightcoral:"F08080",lightcyan:"E0FFFF",lightgoldenrodyellow:"FAFAD2",lightgray:"D3D3D3",lightgrey:"D3D3D3",lightgreen:"90EE90",lightpink:"FFB6C1",lightsalmon:"FFA07A",lightseagreen:"20B2AA",lightskyblue:"87CEFA",lightslategray:"778899",lightslategrey:"778899",lightsteelblue:"B0C4DE",lightyellow:"FFFFE0",lime:"00FF00",limegreen:"32CD32",linen:"FAF0E6",magenta:"FF00FF",maroon:"800000",mediumaquamarine:"66CDAA",mediumblue:"0000CD",mediumorchid:"BA55D3",mediumpurple:"9370D8",mediumseagreen:"3CB371",mediumslateblue:"7B68EE",mediumspringgreen:"00FA9A",mediumturquoise:"48D1CC",mediumvioletred:"C71585",midnightblue:"191970",mintcream:"F5FFFA",mistyrose:"FFE4E1",moccasin:"FFE4B5",navajowhite:"FFDEAD",navy:"000080",oldlace:"FDF5E6",olive:"808000",olivedrab:"6B8E23",orange:"FFA500",orangered:"FF4500",orchid:"DA70D6",palegoldenrod:"EEE8AA",palegreen:"98FB98",paleturquoise:"AFEEEE",palevioletRed:"D87093",papayawhip:"FFEFD5",peachpuff:"FFDAB9",peru:"CD853F",pink:"FFC0CB",plum:"DDA0DD",powderblue:"B0E0E6",purple:"800080",red:"FF0000",rosybrown:"BC8F8F",royalblue:"4169E1",saddlebrown:"8B4513",salmon:"FA8072",sandybrown:"F4A460",seagreen:"2E8B57",seashell:"FFF5EE",sienna:"A0522D",silver:"C0C0C0",skyblue:"87CEEB",slateblue:"6A5ACD",slategray:"708090",slategrey:"708090",snow:"FFFAFA",springgreen:"00FF7F",steelblue:"4682B4",tan:"D2B48C",teal:"008080",thistle:"D8BFD8",tomato:"FF6347",turquoise:"40E0D0",violet:"EE82EE",wheat:"F5DEB3",white:"FFFFFF",whitesmoke:"F5F5F5",yellow:"FFFF00",yellowgreen:"9ACD32"},pen.define("common-ui/vizapi/VizController",[],function(){});var COMPLETE=4,STATUS_OK=200,STATUS_UNAUTHORIZED=401,STATUS_NOT_FOUND=404,base="",pathArray=window.location.pathname.split("/"),webAppPath="/"+pathArray[1];pen.define("common-ui/repo/pentaho-ajax",[],function(){}),pen.define("common-ui/vizapi/ccc/ccc_wrapper",["cdf/lib/CCC/def","cdf/lib/CCC/pvc-d1.0","cdf/lib/CCC/protovis","common-ui/vizapi/VizController","common-ui/vizapi/ccc/ccc_analyzer_plugin"],function(e,t,n){function i(e){pentaho.visualizations.push(e)}function o(){function s(e){var n=e.color;return e.isOn()?n:t.toGrayScale(n)}function v(e,t){return t&&cvCatalog[(e||"")+t]||""}function m(e){return v("VIZ_",e)||e}function g(e,t){return v("dropZoneLabels_",e)||v("ropZoneLabels_",e)||t||e}function y(e,t){return v("dlgChartProps",e)||t||e}function b(e){return{id:"rows",dataType:"string",dataStructure:"column",caption:g(e),required:!1,allowMultiple:!0,defaultAppend:!0}}function w(e){return{id:"columns",dataType:"string",dataStructure:"column",caption:g(e),required:!1,allowMultiple:!0}}function E(e){return{id:"measures",dataType:"number",dataStructure:"column",caption:g(e),required:!0,allowMultiple:!0,defaultAppend:!0}}function S(){return{id:"multi",dataType:"string",dataStructure:"column",caption:g("MULTI_CHART"),allowMultiple:!0,required:!1}}function x(t){var n=["circle","cross","diamond","square","triangle"];return t&&(n=n.filter(function(n){return e.hasOwn(t,n)})),n.unshift("none"),{id:"shape",dataType:"string",values:n,ui:{labels:n.map(function(e){return g(e.toUpperCase())}),group:"options",type:"combo",caption:g("BULLET_STYLE")}}}function T(){return{id:"lineWidth",dataType:"string",values:["1","2","3","4","5","6","7","8"],ui:{labels:["1","2","3","4","5","6","7","8"],group:"options",type:"combo",caption:y("LineWidth")}}}function N(){return{id:"pattern",dataType:"string",values:["GRADIENT","3-COLOR","5-COLOR"],ui:{labels:["GRADIENT","3_STEP","5_STEP"].map(function(e){return g(e)}),group:"options",type:"combo",caption:g("PATTERN")}}}function C(){return{id:"colorSet",dataType:"string",values:["ryg","ryb","blue","gray"],ui:{labels:["RYG","RYB","BLUE","GRAY"].map(function(e){return g("GRAD_"+e)}),group:"options",type:"combo",caption:g("COLORSET")}}}function k(){return{id:"reverseColors",dataType:"boolean",ui:{label:g("COLORSET_REVERSE"),group:"options",type:"checkbox"}}}function L(e){return{id:"optionsBtn",dataType:"none",ui:{group:"options",type:"button",label:g("CHART_OPTIONS"),seperator:e||!1}}}function A(t,n){var r=[];return e.get(n,"row",!0)&&r.push(b(t+"_ROW")),e.get(n,"column",!0)&&r.push(w(t+"_COL")),e.get(n,"measure",!0)&&r.push(E(t+"_NUM")),e.get(n,"multi",!0)&&r.push(S()),e.get(n,"options",!0)&&r.push(L(!1)),r}var n="#808285",r="#D1D3D4",o={groupedLabelSep:"~",legend:!0,multiRole:"multi",legendPosition:"right",legendSizeMax:"60%",legendPaddings:10,legendPadding:{left:1,right:1,top:2,bottom:2},orthoAxisFullGrid:!0,axisEndLine:!0,axisSizeMax:"50%",axisLabelSpacingMin:.6,axisDomainRoundMode:"tick",axisTitleSizeMax:"20%",showPlotFrame:!1,axisOverlappedLabelsHide:!0,axisOverlappedLabelsMaxPct:.05,extensionPoints:{xAxisRule_strokeStyle:n,yAxisRule_strokeStyle:n,secondYAxisRule_strokeStyle:n,xAxisTicks_strokeStyle:r,yAxisTicks_strokeStyle:r,secondYAxisTicks_strokeStyle:r,legendArea_lineWidth:1,legendArea_strokeStyle:"#c0c0c0",legendLabel_textDecoration:null,legendDot_fillStyle:s,legendDot_strokeStyle:s,legend2Dot_fillStyle:s,legend2Dot_strokeStyle:s},tipsySettings:{delayIn:200,delayOut:80,offset:2,html:!0,gravity:"nw",fade:!1,followMouse:!0,corners:!0,arrow:!1,opacity:1},rolesToCccDimensionsMap:{columns:"series",rows:"category",multi:"multiChart",measures:"value"}},u={orientation:"vertical"},a={orientation:"horizontal",xAxisPosition:"top"},f=e.create(o,u),l=e.create(o,a),c=e.create(f,{extensionPoints:{xAxisLabel_textAngle:-Math.PI/4,xAxisLabel_textAlign:"right",xAxisLabel_textBaseline:"top"}}),h={cccClass:"pvc.BarChart",panelSizeRatio:.8,crosstabMode:!0,measuresInColumns:!1},p=e.create(c,h),d=e.create(l,h);i({id:"ccc_bar",type:"barchart",source:"CCC",name:m("VERTICAL_BAR"),"class":"pentaho.ccc.BarChart",args:e.create(p),propMap:[],dataReqs:[{name:"Default",reqs:A("VERTICAL_BAR")}],menuOrdinal:100}),i({id:"ccc_barstacked",type:"barchart",source:"CCC",name:m("STACKED_VERTICAL_BAR"),"class":"pentaho.ccc.BarChart",args:e.create(p,{stacked:!0}),propMap:[],dataReqs:[{name:"Default",reqs:A("STACKED_VERTICAL_BAR")}],menuOrdinal:110}),i({id:"ccc_horzbar",type:"horzbarchart",source:"CCC",name:m("HORIZONTAL_BAR"),"class":"pentaho.ccc.BarChart",args:e.create(d),propMap:[],dataReqs:[{name:"Default",reqs:A("HORIZONTAL_BAR")}],menuOrdinal:130,menuSeparator:!0}),i({id:"ccc_horzbarstacked",type:"horzbarchart",source:"CCC",name:m("STACKED_HORIZONTAL_BAR"),"class":"pentaho.ccc.BarChart",args:e.create(d,{stacked:!0}),propMap:[],dataReqs:[{name:"Default",reqs:A("STACKED_HORIZONTAL_BAR")}],menuOrdinal:140}),i({id:"ccc_barnormalized",type:"barchart",source:"CCC",name:m("PCT_STACKED_VERTICAL_BAR"),"class":"pentaho.ccc.NormalizeBarChart",args:e.create(p,{cccClass:"pvc.NormalizedBarChart"}),propMap:[],dataReqs:[{name:"Default",reqs:A("PCT_STACKED_VERTICAL_BAR")}],menuOrdinal:120}),i({id:"ccc_horzbarnormalized",type:"horzbarchart",source:"CCC",name:m("PCT_STACKED_HORIZONTAL_BAR"),"class":"pentaho.ccc.NormalizeBarChart",args:e.create(d,{cccClass:"pvc.NormalizedBarChart"}),propMap:[],dataReqs:[{name:"Default",reqs:A("PCT_STACKED_HORIZONTAL_BAR")}],menuOrdinal:150}),i({id:"ccc_line",type:"linechart",source:"CCC",name:m("LINE"),"class":"pentaho.ccc.LineChart",args:e.create(c,{cccClass:"pvc.LineChart",shape:"circle",nullInterpolationMode:"linear",orthoAxisOffset:0,baseAxisOffset:0,crosstabMode:!0,measuresInColumns:!1,tipsySettings:{offset:15}}),propMap:[],dataReqs:[{name:"Default",reqs:e.array.append(A("LINE",{options:!1}),[x(),T(),L(!0)])}],menuOrdinal:160,menuSeparator:!0}),i({id:"ccc_area",type:"areachart",source:"CCC",name:m("STACKED_AREA"),"class":"pentaho.ccc.StackedAreaChart",args:e.create(c,{cccClass:"pvc.StackedAreaChart",crosstabMode:!0,measuresInColumns:!1,showLines:!0,orthoAxisOffset:0,baseAxisOffset:0,tipsySettings:{offset:15}}),propMap:[],dataReqs:[{name:"Default",reqs:A("STACKED_AREA")}],menuOrdinal:180}),i({id:"ccc_line_hover",type:"linechart",source:"CCC",name:m("LINE"),"class":"pentaho.ccc.LineChart",args:e.create(c,{cccClass:"pvc.LineChart",hoverable:!0,showTooltips:!1,crosstabMode:!0,measuresInColumns:!1,orthoAxisOffset:0,baseAxisOffset:0,shape:"circle",nullInterpolationMode:"linear",tipsySettings:{offset:15}}),propMap:[],dataReqs:[{name:"Default",reqs:e.array.append(A("LINE",{options:!1}),[x(),T(),L(!0)])}]}),i({id:"ccc_area_hover",type:"areachart",source:"CCC",name:m("STACKED_AREA"),"class":"pentaho.ccc.StackedAreaChart",args:e.create(c,{cccClass:"pvc.StackedAreaChart",crosstabMode:!0,measuresInColumns:!1,showLines:!0,orthoAxisOffset:0,baseAxisOffset:0,hoverable:!0,showTooltips:!1,tipsySettings:{offset:15}}),propMap:[],dataReqs:[{name:"Default",reqs:A("STACKED_AREA")}]}),i({id:"ccc_scatter",type:"scatter",source:"CCC",name:m("SCATTER"),"class":"pentaho.ccc.MetricDotChart",maxValues:[1e3,2500,5e3,1e4],args:e.create(f,{cccClass:"pvc.MetricDotChart",crosstabMode:!0,measuresInColumns:!0,axisFullGrid:!0,dotSizeAbs:!0,dotSizeRatio:.2,dotSizeRatioTo:"height",autoDotSizePadding:!1,rolesToCccDimensionsMap:{columns:null,color:"color",multi:"multiChart",measures:null,x:"value",y:"value2",size:"value4"}}),propMap:[],dataReqs:[{name:"Default",reqs:[{id:"x",dataType:"number",dataStructure:"column",caption:g("SCATTER_X"),required:!0,allowMultiple:!1},{id:"y",dataType:"number",dataStructure:"column",caption:g("SCATTER_Y"),required:!0,allowMultiple:!1},{id:"rows",dataType:"string",dataStructure:"column",caption:g("SCATTER_ROW"),required:!0,allowMultiple:!0},{id:"color",dataType:"number, string",dataStructure:"column",caption:g("SCATTER_COL"),required:!1,allowMultiple:!1},{id:"size",dataType:"number",dataStructure:"column",caption:g("SCATTER_Z"),required:!1,allowMultiple:!1},S(),N(),C(),k(),L(!0)]}],menuOrdinal:190,menuSeparator:!0}),i({id:"ccc_barline",type:"barchart",source:"CCC",name:m("VERTICAL_BAR_LINE"),"class":"pentaho.ccc.BarLineChart",args:e.create(p,{shape:"circle",nullInterpolationMode:"linear",secondAxis:!0,secondAxisIndependentScale:!1,secondAxisSeriesIndexes:null,rolesToCccDimensionsMap:{measuresLine:"value"}}),propMap:[],dataReqs:[{name:"Default",reqs:[b("VERTICAL_BAR_LINE_ROW"),w("VERTICAL_BAR_LINE_COL"),e.set(E("VERTICAL_BAR_LINE_NUMCOL"),"required",!1),e.set(E("VERTICAL_BAR_LINE_NUMLINE"),"id","measuresLine","required",!1),S(),x(),T(),L(!0)]}],menuOrdinal:125}),i({id:"ccc_waterfall",type:"waterfallchart",source:"CCC",name:m("WATERFALL"),"class":"pentaho.ccc.WaterfallChart",args:e.create(p,{cccClass:"pvc.WaterfallChart"}),propMap:[],dataReqs:[{name:"Default",reqs:A("WATERFALL")}]}),i({id:"ccc_boxplot",type:"boxplotchart",source:"CCC",name:m("BOXPLOT"),"class":"pentaho.ccc.BoxplotChart",args:e.create(p,{cccClass:"pvc.BoxplotChart",extensionPoints:{boxVRule_svg:{"stroke-dasharray":"5, 5"}},rolesToCccDimensionsMap:{columns:null,multi:"multiChart",measures:"median",percentil25:"percentil25",percentil75:"percentil75",percentil5:"percentil5",percentil95:"percentil95"}}),propMap:[],dataReqs:[{name:"Default",reqs:[b("BOXPLOT_ROW"),e.set(E("BOXPLOT_PCT50"),"allowMultiple",!1,"required",!1),{id:"percentil25",dataType:"number",dataStructure:"column",caption:g("BOXPLOT_PCT25"),required:!1,allowMultiple:!1},{id:"percentil75",dataType:"number",dataStructure:"column",caption:g("BOXPLOT_PCT75"),required:!1,allowMultiple:!1},{id:"percentil5",dataType:"number",dataStructure:"column",caption:g("BOXPLOT_PCT05"),required:!1,allowMultiple:!1},{id:"percentil95",dataType:"number",dataStructure:"column",caption:g("BOXPLOT_PCT95"),required:!1,allowMultiple:!1},S(),L()]}]}),i({id:"ccc_pie",type:"piechart",source:"CCC",name:m("MULTIPLE_PIE"),"class":"pentaho.ccc.PieChart",args:e.create(o,{multiRole:"columns",cccClass:"pvc.PieChart",crosstabMode:!0,measuresInColumns:!1,showValues:!0,legendShape:"circle",rolesToCccDimensionsMap:{columns:"multiChart",multi:null},titlePosition:"bottom",extensionPoints:{pie_strokeStyle:"white",pie_lineWidth:.8}}),propMap:[],dataReqs:[{name:"Default",reqs:A("MULTIPLE_PIE",{multi:!1})}],menuOrdinal:180}),i({id:"ccc_heatgrid",type:"heatgrid",source:"CCC",name:m("HEATGRID"),"class":"pentaho.ccc.HeatGridChart",maxValues:[500,1e3,2e3,5e3],args:e.create(o,{cccClass:"pvc.HeatGridChart",crosstabMode:!0,measuresInColumns:!0,useCompositeAxis:!0,panelSizeRatio:.8,showValues:!1,useShapes:!0,shape:"square",nullShape:null,nullColor:"#efc5ad",orthoAxisSize:null,baseAxisSize:null,xAxisSize:30,yAxisSize:50,axisFullGrid:!1,axisEndLine:!1,colorScaleType:"linear",normPerBaseCategory:!1,numSD:2,rolesToCccDimensionsMap:{multi:null,color:"value",size:"value2"}}),propMap:[],dataReqs:[{name:"Default",reqs:[{id:"rows",dataType:"string",dataStructure:"row",caption:g("HEATGRID_ROW"),required:!0,allowMultiple:!0},{id:"columns",dataType:"string",dataStructure:"column",caption:g("HEATGRID_COL"),required:!1,allowMultiple:!0},{id:"color",dataType:"number",dataStructure:"column",caption:g("HEATGRID_COLOR"),required:!1,allowMultiple:!1},{id:"size",dataType:"number",dataStructure:"column",caption:g("HEATGRID_SIZE"),required:!1,allowMultiple:!1},N(),C(),k(),x({square:!0,circle:!0}),L(!0)]}],menuOrdinal:200}),i({id:"ccc_bulletchart",type:"bulletchart",source:"CCC",name:"Bullet Chart","class":"pentaho.ccc.BulletChart",args:{cccClass:"pvc.BulletChart",showValues:!0,valuesAnchor:"right",titlePosition:"top",titleSize:25,legendPosition:"bottom",crosstabMode:!0,measuresInColumns:!0,bulletTitle:"Test for title",bulletSubtitle:"Test for subtitle",bulletMeasures:[],bulletMarkers:["7500"],bulletRanges:["3000","6500","9000"],bulletMargin:50,panelSizeRatio:.8,extensionPoints:{bulletRuleLabel_font:"7pt sans"},rolesToCccDimensionsMap:{multi:null,columns:"subTitle",rows:"title"}},propMap:[],dataReqs:[{name:"Default",reqs:[{id:"rows",dataType:"string",dataStructure:"row",caption:"Across",required:!0},{id:"columns",dataType:"string",dataStructure:"column",caption:"Down",required:!0},{id:"measures",dataType:"number",dataStructure:"column",caption:"Values",required:!0},L()]}]})}function f(e){e._cccEventsShield||(e._cccEventsShield=!0,a.forEach(function(t){c(e,t,l)}))}function l(e){e||(e=window.event),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}function c(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)}function d(e){switch(e){case"string":return"STRING";case"number":return"NUMERIC"}throw new Error("Unsupported data type")}function v(e){var t=e.lastIndexOf("~");return t<0?["",e]:[e.substring(0,t),e.substring(t+1)]}function m(e,t){return e?e.replace(/\bdefault\s*$/i,"sans-serif"):(t||10)+"px sans-serif"}function g(e,t){var n=e[t+"Size"];if(n){var r=e[t+"Style"];return r==null||r=="PLAIN"?r="":r+=" ",r+n+"px "+e[t+"FontFamily"]}}function y(e,t){return+e[t+"Size"]}function b(e,t){return e[t+"FontFamily"]}function w(e,t){var n=e.getColumnProperty(t,"dataReq");if(n)return n instanceof Array?n.map(function(e){return e.id||"undefined"}):[n.id||"undefined"]}var r=200;pentaho=typeof pentaho!="undefined"?pentaho:{},e.globalSpace("pentaho",pentaho),pentaho.visualizations||(pentaho.visualizations={}),o();if(typeof document.location!="undefined")try{(""+document.location).indexOf("debug=true")>-1&&analyzerPlugins[analyzerPlugins.length-1].init()}catch(s){t.logError("CCC ANALYZER PLUGIN: "+s.message)}var u=["#0000cc","#0d8ecf","#b0de09","#fcd202","#ff6600","#cd0d74","#cc0000","#00cc00","#650cd0","#3a3a3a","#7272e3","#79c1e4","#d3ed77","#fde673","#ffaa72","#e379b2","#e37272","#72e372","#aa79e5","#929292","#00007a","#07547b","#698405","#967c01","#983b00","#7a0745","#7a0000","#007a00","#3c077b","#000000"];e.type("pentaho.ccc.Axis").init(function(e,t){function n(e,t){e.axis=this,e.index=t;var n=e.role;if(n&&n!=="undefined"){this._ensureRole(n)&&(this.boundRoles[n]=!0,this.boundRolesIdList.push(n));var r=this.gemsByRole[n];e.roleLevel=r.length,r.push(e),this.indexesByRole[n].push(t)}this.formulas.push(e.formula)}this.chart=e,this.id=t,this.gemsByRole={},this.indexesByRole={},this.boundRoles={},this.boundRolesIdList=[],this.gems=this._getGems(),this.depth=this.gems.length,this.formulas=[],this.gems.forEach(n,this)}).add({defaultRole:null,_ensureRole:function(e){if(!this.gemsByRole[e])return this.gemsByRole[e]=[],this.indexesByRole[e]=[],!0},configure:function(e,t){return this.configureDimensionGroups(),this.configureReaders(e,t)},configureDimensionGroups:function(){},configureReaders:function(t,n){var r=this.chart.options.readers,i=t;return this.cccDimList().forEach(function(t){if(!t||!e.hasOwn(n,t)){t&&(n[t]=!0);var s={names:t,indexes:i};r.push(s),i++}}),i},_getGems:function(){var e=this.chart._axesGemsInfo[this.id],t=this.chart._vizHelper;return t.completeAxisGemsMetadata&&t.completeAxisGemsMetadata(this.id,e),e},getAxisLabel:function(){var t=e.query(this._getAxisLabelGems()).where(function(e){return e.cccDimName}).select(function(e){return e.label}).array(),n=t.pop(),r=t.join(", ");return r&&n?this.chart._message("chartAxisTitleMultipleDimText",[r,n]):r||n},_getAxisLabelGems:function(){return this.gems},buildHtmlTooltip:function(e,t,n){this.gems.forEach(this._buildGemHtmlTooltip.bind(this,e,t,n))},_buildGemHtmlTooltip:function(t,n,r,i,s){if(i.cccDimName&&i.role!==this.chart._vizOptions.multiRole){var o=n.atoms[i.cccDimName];o.dimension.type.isHidden||t.push(e.html.escape(i.label)+": "+e.html.escape(o.label))}},cccDimList:e.method({isAbstract:!0}),fillCellSelection:e.method({isAbstract:!0}),getDrillDownInfo:function(e){return null},getDeepestInfo:function(e){return null}}),pentaho.ccc.Axis.create=function(t,n){var r;switch(n){case"row":r=pentaho.ccc.RowAxis;break;case"column":r=pentaho.ccc.ColumnAxis;break;case"measure":r=pentaho.ccc.MeasureAxis;break;default:throw e.error.argumentInvalid("Undefined axis value '{0}'.",[n])}return new r(t)},e.type("pentaho.ccc.DiscreteAxis",pentaho.ccc.Axis).init(function(t,n){this.base(t,n);var r=this.gemsByRole[this.chart._vizOptions.multiRole];this.hasMulti=!!r&&e.query(r).any(function(e){return!e.isMeasureDiscrim})}).postInit(function(){this.hasMulti&&this._ensureRole(this.chart._vizOptions.multiRole)}).add({_nonMultiGemFilter:function(e){return e.role!==this.chart._vizOptions.multiRole},cccDimList:function(){if(!this._cccDimList){var e=this._cccDimList=new Array(this.gems.length);this.gems.forEach(function(t){t.cccDimName=e[t.index]=this._getGemDimName(t)||null},this)}return this._cccDimList},_getGemDimName:function(e){var n=this.chart._vizOptions.rolesToCccDimensionsMap,r=n[e.role];if(typeof r=="string")return t.data.DimensionType.dimensionGroupLevelName(r,e.roleLevel)},_buildGemHtmlTooltip:function(e,t,n,r,i){this._nonMultiGemFilter(r)&&this.base.apply(this,arguments)},_getAxisLabelGems:function(){return e.query(this.gems).where(this._nonMultiGemFilter,this)},fillCellSelection:function(e,t,n){var r=[],i=[],s;this.getSelectionGems(n).each(function(e){var n=t.atoms[e.cccDimName];r.push(e.formula),i.push(n.value),s=n.label});if(r.length){var o=this.id;e[o]=!0,e[o+"Id"]=r,e[o+"Item"]=i,e[o+"Label"]=s}},getSelectionGems:function(t){return t==null&&(t=!0),e.query(this.gems).where(function(e,n){return(!t||this._nonMultiGemFilter(e))&&!e.isMeasureDiscrim&&!!e.cccDimName},this)},getKeepOrDrillGems:function(t,n){return n==null&&(n=!0),e.query(this.gems).where(function(e,r){return e===t||(!n||this._nonMultiGemFilter(e))&&!e.isMeasureDiscrim&&!!e.cccDimName},this)},selectGemsWithLink:function(t,n,r){var i=e.query(this.gems);r&&(i=i.reverse());var s=e.object.is(t);return i.where(function(r){return r.hasLink&&(!t||(s?e.hasOwn(t,r.linkType):r.linkType===t))&&(!n||r.cccDimName&&n.atoms[r.cccDimName])})},selectBoundGems:function(t,n){var r=e.query(this.gems);return n&&(r=r.reverse()),r.where(function(e){return!e.isMeasureDiscrim&&e.cccDimName&&t.atoms[e.cccDimName]})},getHyperlinkInfo:function(e){var t=this.selectGemsWithLink(this.chart._hyperlinkTypes,e,!0).first();if(t)return{gem:t,atom:e.atoms[t.cccDimName]}},getDrillDownInfo:function(t){var n=this.getDeepestInfo(t);if(!n)return null;var r=n.gem.formula,i=this.chart.getChildFormula(r);if(!i){var s=e.query(this.gems).reverse().array();for(var o=1;o<s.length;o++){var u=s[o];if(!u.isMeasureDiscrim){var a=this.getHierarchyDeepestGem(u.formula),f;if(a){if(t){f=t.atoms[a.cccDimName];if(!f||f.value==null)n=null}n={gem:a,atom:f}}}r=n.gem.formula,i=this.chart.getChildFormula(r);if(i)break}if(!i)return null}return e.hasOwn(this.chart.gemsMap,i)?null:(n.drillChild=i,n)},getDeepestInfo:function(e,t){if(this.depth){var n=this.getLastProperGem(t);if(n){var r=this.getHierarchyDeepestGem(n.formula),i;if(r){if(e){i=e.atoms[r.cccDimName];if(!i||i.value==null)return null}return{gem:r,atom:i}}}}return null},getLastProperGem:function(t){var n;return t&&(n=t.match(/^(\[.*?\])?.*$/)[1]),e.query(this.gems).reverse().first(function(e){return!e.isMeasureDiscrim&&(!n||e.hierarchy===n)})},getHierarchyDeepestGem:function(t){var n=this.chart._getHierarchyFormulas(t,!1,!1);return e.query(n).reverse().select(function(t){var n=e.getOwn(this.chart.gemsMap,t);return n&&n.axis===this&&n.cccDimName?n:null},this).first(e.notNully)||null}}),e.type("pentaho.ccc.ColumnAxis",pentaho.ccc.DiscreteAxis).init(function(e){var t=e._vizOptions.rolesToCccDimensionsMap;this.hasMeasureDiscrim=!e.options.dataOptions.measuresInColumns&&(!!t[this.defaultRole]||!!t[e.axes.row.defaultRole]),this.isHiddenMeasureDiscrim=this.hasMeasureDiscrim&&!(e.axes.measure.genericMeasuresCount>1),this.base(e,"column"),this._ensureRole(this.defaultRole),this.realDepth=this.hasMeasureDiscrim?this.depth-1:this.depth}).add({defaultRole:"columns",hiddenMeasureDiscrimDimName:"measureDiscrim",measureDiscrimName:null,_getGems:function(){var e=this.base();return this.hasMeasureDiscrim&&e.push({isMeasureDiscrim:!0,id:"__MeasureDiscrim__",label:"Measure discriminator",axis:this.id,role:this.defaultRole}),e},_getGemDimName:function(e){if(e.isMeasureDiscrim&&this.isHiddenMeasureDiscrim)return this.measureDiscrimName=this.hiddenMeasureDiscrimDimName;var n=this.base(e);if(e.isMeasureDiscrim){if(!n){var r=this.chart._vizOptions.rolesToCccDimensionsMap,i=this.chart.axes.row,s=i.defaultRole,o=r[s],u=i.gemsByRole[s].length;n=t.data.DimensionType.dimensionGroupLevelName(o,u)}this.measureDiscrimName=n}return n},configureDimensionGroups:function(){this.base(),this.cccDimList(),this.measureDiscrimName&&(this.chart.options.dimensions[this.measureDiscrimName]={isHidden:!0})}}),e.type("pentaho.ccc.RowAxis",pentaho.ccc.DiscreteAxis).init(function(e){this.base(e,"row"),this._ensureRole(this.defaultRole)}).add({defaultRole:"rows"}),e.type("pentaho.ccc.MeasureAxis",pentaho.ccc.Axis).init(function(t){this.base(t,"measure"),this._ensureRole(this.defaultRole),this.genericMeasuresCount=0,this.genericMeasureRoles={},e.eachOwn(this.gemsByRole,function(e,t){t.indexOf("measures")===0&&(this.genericMeasureRoles[t]=!0,this.genericMeasuresCount+=e.length)},this)}).add({defaultRole:"measures",_getGems:function(){var t=this.base(),n=[];return t.forEach(function(t){var r=t.id,i;r&&(i=e.getOwn(this.chart._measuresInfo,r))&&(t.role=i.role,n.push(t))},this),n},cccDimList:function(){return this._cccDimList||(this._cccDimList=this.chart._measureRolesInfoList.map(function(e){return e.cccDimName})),this._cccDimList},_buildGemHtmlTooltip:function(t,n,r,i){var s=this.chart.axes.column;if(s.measureDiscrimName&&e.hasOwn(this.genericMeasureRoles,i.role)&&i.id!==n.atoms[s.measureDiscrimName].value)return;var o=this.chart._measureRolesInfo[i.role].cccDimName;if(o){var u=n.atoms[o];if(!u.dimension.type.isHidden){var a=i.label;e.hasOwn(this.chart._noRoleInTooltipMeasureRoles,i.role)||(a+=" ("+i.role+")"),a+=": "+u.label;if(!this.chart._noPercentInTootltipForPercentGems||i.measureType!=="PCTOF"){var f=this._getAtomPercent(u,r);f!=null&&(a+=" ("+f+"%)")}t.push(e.html.escape(a))}}},_getAtomPercent:function(e,t){if(t){var n=t.chart,r=n.data,i=r.type.getPlayingPercentVisualRoleDimensionMap(),s=e.dimension.name;if(i.has(s)){var o=t.scene.group,u;return o?u=o.dimensions(s).percentOverParent({visible:!0}):u=r.dimensions(s).percent(e.value),n.options.valueFormat.call(null,Math.round(u*1e4)/100)}}},fillCellSelection:function(t,n){t.value=e.query(this.gems).select(function(e){var t=this.chart._measureRolesInfo[e.role].cccDimName;if(t)return n.atoms[t].label},this).where(e.truthy).array().join(" ~ ")}});var a=["mouseover","mouseout","mousemove"];e.type("pentaho.ccc.Chart").init(function(e){this._element=e,this._elementName=e.id,f(e)}).add({_keyAxesIds:["column","row"],_axesIds:["column","row","measure"],_axesCreateOrderIds:["row","measure","column"],_cccVirtualItemAxesLayout:["column","row","measure"],_drillAxesIds:["column","row"],_noRoleInTooltipMeasureRoles:{measures:!0},_noPercentInTootltipForPercentGems:!1,draw:function(e,t){this._metadata=[],this._resultset=null,this._dataTable=e,this._initOptions(t),this._processDataTable(),this._initAxes();var n=this.axes.row.depth;this.options.dataOptions.categoriesCount=n,this._hasMultiChartColumns=this.axes.row.hasMulti||this.axes.column.hasMulti,this._readUserOptions(this.options,t),this._readData(),this._configure(),this._prepareLayout(this.options),this._render()},resize:function(e,t){this._lastResizeTimeout!=null&&clearTimeout(this._lastResizeTimeout),this._lastResizeTimeout=setTimeout(function(){this._lastResizeTimeout=null,this._doResize(e,t)}.bind(this),50)},_doResize:function(t,n){if(this._chart){var r=this._chart.options;e.set(r,"width",t,"height",n),this._prepareLayout(r),this._chart.render(!0,!0,!1)}},setHighlights:function(e){this._selections=e;if(!this._ownChange)if(!e||e.length==0){this._ownChange=!0;try{this._chart.clearSelections()}finally{this._ownChange=!1}}},getOutputParameters:function(){var e=[];if(this._vizOptions.cccClass=="pvc.PieChart")e.push([this._dataTable.getColumnId(0),!0,this._dataTable.getColumnId(0)]);else for(var t=0;t<this._dataTable.getNumberOfColumns();t++)e.push([this._dataTable.getColumnId(t),!0,this._dataTable.getColumnId(t)]);return e},getColors:function(){if(this._colors)return this._colors;var e=null,t=this._vizOptions.metrics[0].paletteMap;if(t){e=[];for(var n=0;n<this._dataTable.getNumberOfRows();n++){var r=this._getTableValue(n,0);if(this._selections&&this._selections.length>0){var i=!1;for(var s=0;s<this._selections.length;s++){var o=this._selections[s];if(o.type=="row"&&o.rowItem==r||o.type=="column"&&o.colId==this._dataTable.getColumnId(1)){e.push(t[r]),i=!0;break}}i||e.push("#bbbbbb")}else e.push(t[r])}}return e},_initOptions:function(t){t=this._vizOptions=$.extend({},t),this._vizHelper=cv.pentahoVisualizationHelpers[t.customChartType],this._hasContentLink=this._vizHelper.isInteractionEnabled()&&this._vizHelper.hasContentLink(),this._selections=t.selections,this.options={canvas:this._elementName,showValues:!1,legend:!0,legendClickMode:"toggleSelected",legend2ClickMode:"toggleSelected",titlePosition:"top",paddings:10,animate:!1,showTooltips:!0,clickable:!0,selectable:!0,hoverable:!1,ctrlSelectMode:!1,clearSelectionMode:"manual",extensionPoints:{},dimensionGroups:{},dimensions:{},readers:[],visualRoles:{},ignoreNulls:!1,crosstabMode:!!t.crosstabMode,isMultiValued:!0,seriesInRows:!1,dataOptions:{categoriesCount:1,measuresInColumns:!!t.measuresInColumns}},t.height=t.height||400,t.width=t.width||400;for(var n in t)this._shouldSkipVizOption(n)||this._configureOption(n,t[n]);var r=t.extensionPoints;r&&e.copy(this.options.extensionPoints,r)},_message:function(e,t){return this._vizHelper.message(e,t)},_readUserOptions:function(e,t){var r=e.extensionPoints,i=t.backgroundFill;if(i&&i!=="NONE"){var s;if(i==="GRADIENT")if(this._hasMultiChartColumns){var o=n.color(t.backgroundColor).rgb();o=n.rgb(~~((255+o.r)/2),~~((255+o.g)/2),~~((255+o.b)/2),o.a),s=o}else s="linear-gradient(to top, "+t.backgroundColor+", "+t.backgroundColorEnd+")";else s=t.backgroundColor;r.base_fillStyle=s}i=t.labelColor,i!==undefined&&(r.xAxisLabel_textStyle=r.yAxisLabel_textStyle=r.xAxisTitleLabel_textStyle=r.yAxisTitleLabel_textStyle=i),i=t.legendColor,i!==undefined&&(r.legendLabel_textStyle=i),i=t.legendBackgroundColor,i&&i.toLowerCase()!=="#ffffff"&&(r.legendArea_fillStyle=i),i=t.lineWidth;if(i!==undefined){r.line_lineWidth=+i;var u=3+6*(+i/8);r.dot_shapeSize=u*u}i=t.maxChartsPerRow,i!==undefined&&(e.multiChartMaxColumns=+i);if(t.labelSize){var a=g(t,"label");e.axisTitleFont=e.axisFont=a;if(this._hasMultiChartColumns){var f=y(t,"label"),l=b(t,"label");e.titleFont=f+2+"px "+l}}t.legendSize&&(e.legendFont=g(t,"legend"))},_processDataTable:function(){function m(e,n){if(/\[MEASURE:(\d+)\]$/.test(n))return!1;var r=w(t,h);return l.push({id:p,formula:p,label:t.getColumnLabel(h),axis:"row",role:r?r[0]:"undefined",index:l.length}),!0}function g(e){if(e){var n=w(t,h),r=e.split("~"),i=r.length-1;r.forEach(function(e,t){c.push({id:undefined,formula:undefined,label:undefined,axis:"column",role:n[t],index:t})})}}function y(n,l){var c=e.getOwn(a,l);if(!c){var p=w(t,h).pop();c={id:l,formula:undefined,label:v(t.getColumnLabel(h))[1],axis:"measure",role:p,index:f.length,isUnmapped:p==="undefined"},a[l]=c,f.push(c)}var d=e.getOwn(s,n);d?d.measureIds.push(l):(d={index:h,encValues:n,values:n?n.split("~"):[],measureIds:[l]},s[n]=d,i.push(d));var m=h-d.index,g=e.getOwn(o,c.role);g?m>g.groupIndex&&(g.groupIndex=m):(g={id:p,cccDimName:c.isUnmapped?null:r[p]||e.assert("Must map to CCC all measure roles that the data table contains."),groupIndex:m,index:h},o[c.role]=g,u.push(g))}var t=this._dataTable,n=t.getNumberOfColumns(),r=this._vizOptions.rolesToCccDimensionsMap,i=[],s={},o={},u=[],a={},f=[],l=[],c=[],h=0,p,d;while(h<n){p=t.getColumnId(h),d=v(p);if(!m.apply(this,d))break;h++}if(h<n){g.call(this,d[0]);for(;;){y.apply(this,d);if(++h>=n)break;p=t.getColumnId(h),d=v(p)}}u.sort(function(t,n){return e.compare(t.groupIndex,n.groupIndex)||e.compare(t.index,n.index)}),u.forEach(function(e,t){e.groupIndex=t}),this._measureRolesInfo=o,this._measureRolesInfoList=u,this._colGroups=i,this._measuresInfo=a,this._axesGemsInfo={measure:f,row:l,column:c}},_initAxes:function(){function n(e){var t=pentaho.ccc.Axis.create(this,e);t.gems.forEach(r,this),this.axes[e]=t}function r(e){var t=e.formula,n=e.id;t&&(this.gemsMap[t]=e),n&&t!==n&&(this.gemsMap[n]=e),e.reportAxis==="column"&&this._gemCountColumnReportAxis++,e.isMeasureDiscrim&&(this._measureDiscrimGem=e)}this.gemsMap={},this.axes={},this._gemCountColumnReportAxis=0,this._measureDiscrimGem=null,this._axesCreateOrderIds.forEach(n,this);var e=0,t={};this._cccVirtualItemAxesLayout.forEach(function(n){e=this.axes[n].configure(e,t)},this)},_readData:function(){this._readDataCrosstab()},_readDataCrosstab:function(){var e=this._dataTable,t=e.getNumberOfColumns(),n=e.getNumberOfRows();this._colors=u;for(var r=0;r<t;r++)this._addCdaMetadata(e.getColumnId(r),e.getColumnLabel(r),d(e.getColumnType(r)));var i=this._resultset=new Array(n);for(var s=0;s<n;s++){var o=new Array(t);for(r=0;r<t;r++)o[r]=this._getTableCell(s,r);i[s]=o}},_configure:function(){var e=this.options;this._vizOptions.controller.domNode.style.overflow="hidden",e.colors=this.getColors(),(this.options.legend=this._showLegend())&&this._configureLegend(),this._hasMultiChartColumns&&this._configureMultiChart(),e.axisFont=m(e.axisFont,12),e.axisTitleFont=m(e.axisTitleFont,12),this._vizHelper.isInteractionEnabled()?(e.showTooltips&&this._configureTooltip(),(e.selectable=this._canSelect())&&this._configureSelection(),this._configureDoubleClick()):(e.showTooltips=!1,e.clickable=!1,e.selectable=!1,e.hoverable=!1)},_configureMultiChart:function(){var e=this.options,t=this._vizOptions.controller.domNode.style;t.overflowX="hidden",t.overflowY="auto",e.multiChartMax=50;var n=m(e.titleFont,12);n&&!/black|(\bbold\b)/i.test(n)&&(n="bold "+n),e.titleFont=n},_configureTooltip:function(){var e=this;this.options.tooltipFormat=function(t,n,r,i){return e._getTooltipText(i,this)}},_canSelect:function(){return this.options.selectable?this._gemCountColumnReportAxis>=2?!1:!0:!1},_configureSelection:function(){var e=this;this.options.userSelectionAction=function(t){return e._onUserSelection(t)},this.options.selectionChangedAction=function(t){e._onSelectionChanged(t)}},_configureDoubleClick:function(){var e=this;this.options.doubleClickAction=function(t,n,r,i){e._onDoubleClick(this.scene.datum,this)},this.options.axisDoubleClickAction=function(n){if(n instanceof t.data.Complex)return e._onDoubleClick(n)}},_showLegend:function(){if(!this.options.legend)return!1;if(this.axes.measure.genericMeasuresCount>1)return!0;var e=this.axes.column,t=this._vizOptions.rolesToCccDimensionsMap[e.defaultRole];return!t||e.realDepth>0?!0:!1},_configureLegend:function(){var e=this.options;e.legendFont=m(e.legendFont,10);var t=e.legendPosition,n=t==="top"||t==="bottom";if(this._hasMultiChartColumns&&!n){e.legendAlignTo="page-middle",e.legendInBounds=!0;var r=e.legendMargins;r?typeof r!="object"&&(r=e.legendMargins={all:r}):r=e.legendMargins={},r.top=20}"legendAlign"in e||(n?e.legendAlign="center":e.legendAlign="middle")},_shouldSkipVizOption:function(e){return e in p},_configureOption:function(e,t){switch(e){case"legendPosition":t=t&&t.toLowerCase();break;case"showLegend":e="legend",t=""+t=="true";break;case"legendSize":case"lineWidth":t=parseFloat(t)}this.options[e]=t},_prepareLayout:function(e){this._hasMultiChartColumns&&n.renderer()!=="batik"&&(e.width-=17)},_render:function(){while(this._element.firstChild)this._element.removeChild(this._element.firstChild);this._currentChartType=this._vizOptions.cccClass;var n=e.getPath({pvc:t},this._currentChartType);this._chart=new n(this.options),this._chart.setData({metadata:this._metadata,resultset:this._resultset}),this._chart.render()},_getTooltipText:function(t,n){var r=[];this._axesIds.forEach(function(e){this.axes[e].buildHtmlTooltip(r,t,n)},this);if(this._hasContentLink)s=this._message("chartTooltipFooterContentlink"),r.push(s);else{var i=this._getHyperlinkInfo(t),s;if(i)s=this._message("chartTooltipFooterHyperlink",[e.html.escape(i.gem.linkLabel||this._message("chartTooltipHyperlinkDefaultTitle"))]),r.push(s);else{var o=this._getDrillDownInfo(t);o&&(s=this._message("chartTooltipFooterDrillDown",[e.html.escape(this._vizHelper.getFormulaLabel(o.drillChild))]),r.push(s))}}var u=this._vizOptions.controller.highlights,a=u&&u.length;if(a){var f=a===1?"chartTooltipFooterSelectedSingle":"chartTooltipFooterSelectedMany";s=this._message(f,[a]),r.push(s)}return r.join("<br />")},_onUserSelection:function(e){return this._processSelection(e)},_getSelectionKey:function(t){var n=t.__cccKey;if(!n){var r=[t.type],i=e.array.append;t.columnId&&(i(r,t.columnId),i(r,t.columnItem)),t.rowId&&(i(r,t.rowId),i(r,t.rowItem)),n=t.__cccKey=r.join("||")}return n},_doesSharedSeriesSelection:function(){return this._gemCountColumnReportAxis===1},_onSelectionChanged:function(e){if(!this.options.selectable)return;var t=this._selectionExcludesMultiGems(),n=[],r={};this._doesSharedSeriesSelection()?e.forEach(function(e){var i={type:"column"};this.axes.column.fillCellSelection(i,e,t);var s=this._getSelectionKey(i),o=r[s];o?o.__cccDatums.push(e):(i.__cccDatums=[e],r[s]=i,n.push(i))},this):e.forEach(function(e){var i=this._complexToCellSelection(e,t),s=this._getSelectionKey(i),o=r[s];o||(i.__cccDatums=e,r[s]=i,n.push(i))},this),n=this._limitSelection(n),pentaho.events.trigger(this,"select",{source:this,selections:n,selectionMode:"REPLACE"})},_limitSelection:function(n){var i=n,s=n.length,o=s-r;if(o>0){var u=[];i=[];for(var a=0;a<s;a++){var f=n[a],l=!0;if(o)if(this._previousSelectionKeys){var c=this._getSelectionKey(f);this._previousSelectionKeys[c]||(l=!1)}else a>=r&&(l=!1);if(l)i.push(f);else{var h=f.__cccDatums;h&&(e.array.is(h)?e.array.append(u,h):u.push(h)),o--}}t.data.Data.setSelected(u,!1),this._chart.updateSelections(),this._vizHelper.showConfirm(["infoExceededMaxSelectionItems",r],"SELECT_ITEM_LIMIT_REACHED")}return this._previousSelectionKeys=e.query(i).object({name:function(e){return this._getSelectionKey(e)},value:e.retTrue,context:this}),i},_selectionExcludesMultiGems:function(){return!0},_processSelection:function(e){function s(e){function o(e){n[e]=s[e]}if(!e.isNull){var n={},s=e.atoms;r&&r.forEach(o),i&&i.forEach(o),t.push(n)}}var t;if(e.length){var n=this._selectionExcludesMultiGems(),r=this.axes.column.getSelectionGems(n).select(function(e){return e.cccDimName}).array(),i;this._gemCountColumnReportAxis||(i=this.axes.row.getSelectionGems(n).select(function(e){return e.cccDimName}).array()),!r.length&&(!i||!i.length)?e=[]:(t=[],e.forEach(s),e=this._chart.data.datums(t,{visible:!0}).array())}return e},_onDoubleClick:function(e){if(this._hasContentLink)return this._followContentlink(e),!0;var t=this._getHyperlinkInfo(e);if(t)return this._followHyperlink(t,e),!0;var n=this._getDrillDownInfo(e);return n?(this._drillDown(n,e),!0):!1},_followContentlink:function(t){var n=e.query(this._drillAxesIds).selectMany(function(e){return this.axes[e].selectGemsWithLink("DASHBOARD",t,!1)},this).select(function(e){return{clickLevel:!0,formula:e.formula,member:t.atoms[e.cccDimName].value}}).array();n.length&&this._vizHelper.link(n)},_hyperlinkTypes:{FILE:1,URL:1},_followHyperlink:function(t,n){var r=e.query(this._drillAxesIds).selectMany(function(e){return this.axes[e].selectBoundGems(n)},this).select(function(e){return{clickLevel:t.gem===e,formula:e.formula,member:n.atoms[e.cccDimName].value}}).array();this._vizHelper.link(r)},_drillDown:function(t,n){function o(e){this.axes[e].getKeepOrDrillGems(i,s).each(function(e){if(e===i)u(e,t.atom,"KEEP_AND_DRILL");else if(!e.isMeasureDiscrim){var r=a(e,n);r&&u(e,r,"KEEP")}})}function u(t,n,i){r.push({action:i,formula:t.formula,member:n.value,caption:e.html.escape(n.label)})}function a(e,t){var n;if(t&&(n=e.cccDimName)){var r=t.atoms[n];if(r&&r.value!=null)return r}return null}var r=[],i=t.gem,s=this._selectionExcludesMultiGems();this._keyAxesIds.forEach(o,this),this._vizHelper.click(r,!0)},_getHyperlinkInfo:function(t){return e.query(this._drillAxesIds).select(function(e){return this.axes[e].getHyperlinkInfo(t)},this).where(e.notNully).first()||null},_getDrillDownInfo:function(t){return e.query(this._drillAxesIds).select(function(e){return this.axes[e].getDrillDownInfo(t)},this).where(e.notNully).first()||null},_complexToCellSelection:function(e,t){var n={type:"cell"};return this._axesIds.forEach(function(r){this.axes[r].fillCellSelection(n,e,t)},this),n},getChildFormula:function(e){var t=this._getHierarchyFormulas(e,!1,!1);if(t){var n=t.indexOf(e);if(n>=0)return t[n+1]||null}return null},_getHierarchyFormulas:function(e,t,n){var r,i=e+"|"+!!t+"|"+!!n;return this._hierarchyFormulaCache?r=this._hierarchyFormulaCache[i]:this._hierarchyFormulaCache={},r||(r=this._vizHelper.getHierarchyFormulas(e,t,n),this._hierarchyFormulaCache[i]=r),r},_addCdaMetadata:function(e,t,n){this._metadata.push({colIndex:this._metadata.length,colName:e,colLabel:t,colType:n})},_getTableCell:function(e,t){var n=this._dataTable._getCell(e,t);if(!n)return null;var r=n.v;return r==null||r==="-"?null:{v:r,f:n.f}},_getTableValue:function(e,t){var n=this._getTableCell(e,t);return n?n.v:ceff.f}}),e.type("pentaho.ccc.CartesianChart",pentaho.ccc.Chart).add({_configure:function(){this.base(),this._configureAxesDisplayUnits(),this._showAxisTitle("base")&&this._configureAxisTitle("base",this._getBaseAxisTitle()),this._showAxisTitle("ortho")&&this._configureAxisTitle("ortho",this._getOrthoAxisTitle())},_showAxisTitle:e.fun.constant(!0),_getOrthoAxisTitle:e.noop,_getBaseAxisTitle:e.noop,_configureAxisTitle:function(t,n){var r=this._cartesianAxesDisplayUnitsText[t];n=e.string.join(" - ",n,r);if(n){var i=this.options;i[t+"AxisTitle"]=n}},_getMeasureRoleTitle:function(e){var t="",n=this.axes.measure,r;if(!e)this.axes.measure.genericMeasuresCount===1&&(r=n.gemsByRole[n.defaultRole][0]);else{var i=n.gemsByRole[e];i.length===1&&(r=i[0])}return r&&(t+=r.label),t},_configureAxisRange:function(e,t){var n=this._vizOptions,r=e?"":"Secondary";if(n["autoRange"+r]!=="true"){var i=n["valueAxisLowerLimit"+r];i!=null&&(this.options[t+"AxisFixedMin"]=i,this.options[t+"AxisOriginIsZero"]=!1),i=n["valueAxisUpperLimit"+r],i!=null&&(this.options[t+"AxisFixedMax"]=i)}},_cartesianAxesDisplayUnitsText:null,_configureAxesDisplayUnits:function(){this._cartesianAxesDisplayUnitsText={}},_configureAxisDisplayUnits:function(t,n,r){r||(this.options[n+"AxisTickExponentMin"]=0);var i,s=this._vizOptions["displayUnits"+(t?"":"Secondary")];if(s&&s!=="UNITS_0"){var o=s.match(/^UNITS_(\d+)$/)||e.fail.argumentInvalid("displayUnits");i=this._message("dlgChartOption_"+s)}this._cartesianAxesDisplayUnitsText[n]=i||""}}),e.type("pentaho.ccc.CategoricalContinuousChart",pentaho.ccc.CartesianChart).add({_showAxisTitle:function(e){return!this._hasMultiChartColumns||e==="ortho"},_getOrthoAxisTitle:function(){return this._getMeasureRoleTitle()},_getBaseAxisTitle:function(){return this.axes.row.getAxisLabel()},_configure:function(){this.base(),this._configureAxisRange(!0,"ortho")},_configureAxesDisplayUnits:function(){this.base(),this._configureAxisDisplayUnits(!0,"ortho")}}),e.type("pentaho.ccc.BarChart",pentaho.ccc.CategoricalContinuousChart).add({_configure:function(){this.base();var e=this.options,t=e.orientation==="vertical";t||(e.visualRoles.category={isReversed:!0})}}),e.type("pentaho.ccc.BarLineChart",pentaho.ccc.BarChart).add({_noRoleInTooltipMeasureRoles:{measures:!0,measuresLine:!0},_initAxes:function(){this.base(),this._measureDiscrimGem||e.assert("Must exist to distinguish measures.");var t=this.options.readers,n=this._measureDiscrimGem.cccDimName,r=e.query(t).where(function(e){return e.names===n}).select(function(e){return e.indexes}).first(null,null,-1);r>=0||e.assert("Must be present in virtual item.");var i=this.axes.measure.defaultRole,s=this.gemsMap,o,u,a;t.push({names:"dataPart",reader:function(t,n){var o=t[r].v,f=s[o]||e.assert("Measure must be defined.");return f.role===i?u||(u=n.intern("0")):a||(a=n.intern("1"))}})},_configureAxesDisplayUnits:function(){this.base(),this._configureAxisDisplayUnits(!1,"ortho2")},_configure:function(){var e=this.options,t=e.extensionPoints,r=e.shape;r&&r==="none"?e.showDots=!1:(e.showDots=!0,e.extensionPoints.dot_shape=r),this.base(),this._configureAxisRange(!1,"ortho2"),this._configureAxisTitle("ortho2",""),e.secondAxisIndependentScale=!0,e.secondAxisOwnColors=!1,e.secondAxisColor=e.colors.map(function(e){return n.color(e).brighter(.5)})}}),e.type("pentaho.ccc.NormalizeBarChart",pentaho.ccc.BarChart).add({_configure:function(){this.base();var e=this.options,n=t.visual.CartesianAxis.getOrientation("ortho",e.orientation);e.extensionPoints[n+"AxisScale_tickFormatter"]=function(e){return e+"%"}}}),e.type("pentaho.ccc.WaterfallChart",pentaho.ccc.CategoricalContinuousChart),e.type("pentaho.ccc.LineChart",pentaho.ccc.CategoricalContinuousChart).add({_drillAxesIds:["row"],_configure:function(){var e=this.options,t=e.extensionPoints,n=e.shape;n&&n==="none"?e.showDots=!1:(e.showDots=!0,e.extensionPoints.dot_shape=n),this.base()},_configureLegend:function(){this.base();var e=this.options,t=e.extensionPoints,n=t.dot_shapeSize;if(n!=null){var r=Math.sqrt(n);e.legendMarkerSize=Math.max(15,2*(r+3))}}}),e.type("pentaho.ccc.StackedAreaChart",pentaho.ccc.CategoricalContinuousChart).add({_drillAxesIds:["row"]}),e.type("pentaho.ccc.BoxplotChart",pentaho.ccc.CategoricalContinuousChart).add({_readData:function(){this.base(),e.set(this.options.dataOptions,"categoriesCount",this.axes.row.gemsByRole.rows.length)}}),e.type("pentaho.ccc.HeatGridChart",pentaho.ccc.CartesianChart).add({_configure:function(){this.base();var e=this._vizOptions.colorRange&&this._vizOptions.colorRange[0];e&&(this.options.nullColor=e)},_prepareLayout:function(e){this.base(e);var t=this.axes.measure.depth,n=this.axes.row.depth,r=this.axes.column.depth,i=Math.max(1,this._dataTable.getNumberOfRows()-1),s=this._dataTable.getNumberOfColumns()-n;t>0&&(s/=t);var o=e.width,u=e.height,a=o/u,f=i/s,l=300,c=70,h=200,p=.35,d=Math.min(l,n*c),v=Math.min(l,r*c),m=Math.min(l,n*h,u*p),g=Math.min(l,r*h,o*p),y,b;if(f>a){var w=u-o/f;b=v,y=Math.min(w,m),y=Math.max(y,d)}else if(f<a){var E=o-u*f;y=d,b=Math.min(E,g),b=Math.max(b,v)}e.orthoAxisSize=undefined,e.baseAxisSize=undefined,e.xAxisSize=y,e.yAxisSize=b},_doesSharedSeriesSelection:function(){return!1},_processSelection:function(n){function m(t){function r(t){var r=i[t]||(i[t]={}),s=n[t];e.hasOwn(r,s.id)||(r[s.id]=s)}var n=t.atoms;s.forEach(r),o.forEach(r)}function g(){function r(n,r){t[r]=e.own(n)}var t={},n=[t];return e.eachOwn(i,r),n}if(n.length){var r=this._chart.data,i={},s=this.axes.column.getSelectionGems().select(function(e){return e.cccDimName}).array(),o=this.axes.row.getSelectionGems().select(function(e){return e.cccDimName}).array(),u=n.length===1&&n[0].isSelected,a;if(!u){var f=e.query(n).union(r.selectedDatums()).uniqueIndex(function(e){return e.id}),l=t.data.GroupingSpec.parse(o,r.type),c=r.groupBy(l,{visible:!0,where:function(t){return e.hasOwn(f,t.id)},whereKey:null}),h=c.leafs().select(function(t){return e.copyProps(t.atoms,o)});if(s.length){var p=t.data.GroupingSpec.parse(s,r.type),d=r.groupBy(p,{visible:!0,where:function(t){return e.hasOwn(f,t.id)},whereKey:null});h=h.selectMany(function(t){return d.leafs().select(function(n){return e.copyProps(Object.create(t),n.atoms,s)})})}a=h.array(),n=r.datums(a,{visible:!0}).array()}else{var v=n[0];a=[e.query(s).object({value:function(e){return v.atoms[e]}}),e.query(o).object({value:function(e){return v.atoms[e]}})],n=r.datums(a,{visible:!0,selected:!0}).array()}}return n}}),e.type("pentaho.ccc.MetricDotChart",pentaho.ccc.CartesianChart).add({_noRoleInTooltipMeasureRoles:{x:!0,y:!0},_configure:function(){this.base();var e=this.options,n=this._vizOptions.colorRange&&this._vizOptions.colorRange[0];n&&(e.nullColor=n),this._configureAxisRange(!0,"base"),this._configureAxisRange(!1,"ortho");var r;this.axes.measure.boundRoles.size?r=1.1*e.dotSizeRatio/2:r=0,e.xAxisOffset=e.yAxisOffset=r,this.axes.measure.boundRoles.color?(e.dimensionGroups.color={valueType:Number},e.visualRoles.color="color"):this.axes.column.boundRoles.color&&(e.visualRoles.color=this.axes.column.gemsByRole.color.map(function(e,n){return t.data.DimensionType.dimensionGroupLevelName("color",n)}).join(", "))},_showLegend:function(){return this.options.legend&&this.axes.column.boundRoles.color?this._colGroups.length>1:this.options.legend},_getOrthoAxisTitle:function(){return this._getMeasureRoleTitle("y")},_getBaseAxisTitle:function(){return this._getMeasureRoleTitle("x")},_configureAxesDisplayUnits:function(){this.base(),this._configureAxisDisplayUnits(!0,"base",!0),this._configureAxisDisplayUnits(!1,"ortho",!0)}}),e.type("pentaho.ccc.PieChart",pentaho.ccc.Chart).add({_noPercentInTootltipForPercentGems:!0,_drillAxesIds:["row","column"],_configure:function(){this.base(),this.options.showValues&&this._configureValuesMask()},_showLegend:function(){return this.options.legend&&this.axes.row.depth>0},_readUserOptions:function(e,t){this.base(e,t),e.valuesLabelFont=m(null,y(t,"label"))},_configureMultiChart:function(){this.base(),this.options.legendSizeMax="50%"},_configureValuesMask:function(){var e=this.axes.column,t=e.measureDiscrimName;if(t){var n=this.gemsMap;this.options.pie={scenes:{category:{sliceLabelMask:function(){var e=this.atoms[t],r,i;return e&&(r=e.value)&&(i=n[r])&&i.measureType==="PCTOF"?"{value}":"{value} ({value.percent})"}}}}}},_selectionExcludesMultiGems:function(){return!1}}),e.type("pentaho.ccc.BulletChart",pentaho.ccc.Chart).add({_configure:function(){this.base()},_prepareLayout:function(e){this.base(e);var t=this._vizOptions,n=e.orientation==="vertical";this._resultset.length>20?(e.bulletSize=10,e.bulletSpacing=n?60:20):this._resultset.length>10?(e.bulletSize=15,e.bulletSpacing=n?80:30):(e.bulletSize=20,e.bulletSpacing=n?120:50);var r=(2+e.bulletSize+e.bulletSpacing)*this._resultset.length;n?r>e.width&&(t.controller.domNode.style.overflowX="auto",t.controller.domNode.style.overflowY="hidden",e.width=r):r>e.height&&(t.controller.domNode.style.overflowY="auto",t.controller.domNode.style.overflowX="hidden",e.height=r)}});var h={};h._readDataBullet=function(){var e=this._dataTable,t=e.getNumberOfRows(),n=this._otherDtColIndexes,r=this._otherDtColIndexes.length,i=this._vizOptions;this.options.seriesInRows=!0,this._addCdaMetadata("Category","Category","STRING"),this._addCdaMetadata("Series","Series","STRING"),this._addCdaMetadata("Value","Value","NUMERIC"),this._addCdaMetadata("Marker","Marker","NUMERIC");if(i.bulletRanges)for(var s=0,o=i.bulletRanges.length;s<o;s++)this._addCdaMetadata("Range"+s,"Range "+s,"NUMERIC");var u=this.axes.measure.depth;for(var a=0;a<t;a++){var f=this._aggregateRowAxisForTableRow(a);for(var l=0;l<r;l+=u)for(var c=0;c<u;c+=2){var h=l+c,p=h+1,d=n[h],v=e.getColumnId(d).split("~");v.pop();var m=[f,v.join("~"),this._getTableValue(a,d),c+1<u?this._getTableValue(a,n[p]):i.bulletMarkers[0]],g=i.bulletRanges;g&&g.forEach(function(e){m.push(e)}),this._resultset.push(m)}}},h._aggregateRowAxisForTableRow=function(e){var t=this._rowNormalDtColIndexes.map(function(t){return this._getTableValue(e,t)},this);return t.join("~")};var p=n.dict(["cccClass","rolesToCccDimensionsMap","crosstabMode","measuresInColumns","extensionPoints","dimensionGroups","readers","dataOptions","action","autoRange","backgroundColor","backgroundColorEnd","backgroundFill","chartType","controller","customChartType","displayUnits","maxChartsPerRow","labelSize","labelStyle","labelFontFamily","labelColor","legendBackgroundColor","legendColor","legendFontFamily","legendStyle","legendSize","lineShape","maxChartsPerRow","maxValues","metrics","palette","selections"],function(){return!0})}),pen.define("common-ui/vizapi/ccc/ccc_analyzer_plugin",["cdf/lib/CCC/def","cdf/lib/CCC/pvc-d1.0","common-ui/vizapi/VizController"],function(e,t){dojo.require("pentaho.common.Messages"),pentaho=typeof pentaho!="undefined"?pentaho:{},pentaho.visualizations||(pentaho.visualizations={}),analyzerPlugins=typeof analyzerPlugins=="undefined"?[]:analyzerPlugins;var n=!1;analyzerPlugins.push({init:function(){if(n)return;n=!0,dojo.declare("analyzer.CCCVizHelper",null,{isInteractionEnabled:function(){return!0},hasContentLink:function(){return/\bcl=/.test(window.location.href)},showConfirm:function(e,t){(!t||!cv.prefs.suppressMsg[t])&&cv.getActiveReport().rptDlg.showConfirm(e,null,null,null,t)},message:function(e,t){var n=cvCatalog[e]||"";return n&&t&&(n=cv.util.substituteParams.apply(cv.util,[n].concat(t))),n},getFormulaLabel:function(e){return cv.util.parseMDXExpression(e,!1)},getHierarchyFormulas:function(e,t,n){return cv.getFieldHelp().getHierarchy(e,t,n)},completeAxisGemsMetadata:function(t,n){function u(e,t){return parseFloat(e.getAttribute("gembarOrdinal"))-parseFloat(t.getAttribute("gembarOrdinal"))}function a(t){var n="[@gembarId='"+t+"']";s?n="cv:measures/cv:measure"+n:n="cv:columnAttributes/cv:attribute"+n+" | "+"cv:rowAttributes/cv:attribute"+n;var i=r.selectNodes(n);return i=e.query(i).array(),i.sort(u),i}function f(t){var n=e.getOwn(o,t);n||(n=o[t]=a(t));var r;while(n.length){r=n.shift();if(r.getAttribute("hideInChart")!=="true")break}return r}var r=cv.getActiveReport().reportDoc.getReportNode(),i=cv.getFieldHelp(),s=t==="measure",o={};dojo.forEach(n,function(t){var n=t.role;if(!n||n==="undefined")return;var r=f(t.role)||e.assert("Undefined gem in document."),o=r.getAttribute("formula")||null,u=!1,a,l,c,h,p;switch(r.parentNode.tagName){case"rowAttributes":p="row";break;case"columnAttributes":p="column";break;case"measures":p="measure"}s&&(l="[Measures]",t.measureType=r.getAttribute("measureTypeEnum"));if(s&&t.measureType!=="VALUE")a=r.getAttribute("id"),o=null,u=!1;else{var d=cv.getActiveReport().getGem(o)||e.assert("No gem object.");a=d.getUniqueId(),t.label=d.getDisplayLabel(!0);var v=d.getLink&&d.getLink();u=!!v,c=u?v.getAttribute("toolTip"):null,h=u?v.getAttribute("type"):null,s||(o||e.assert("Non-measures have formulas."),l=i.get(o,"hierarchy"))}e.set(t,"id",a,"formula",o,"hierarchy",l,"hasLink",u,"linkLabel",c||"","linkType",h,"reportAxis",p)})},click:function(e,t){cv.getActiveReport().clickChart(e,t)},link:function(e){cv.getActiveReport().linkDlg.performAction(e)},generateOptionsFromAnalyzerState:function(e){var t={},n=e.reportDoc.getChartOptions().attributes;for(var r=0;r<n.length;r++){var i=n[r];switch(i.nodeName){case"lineShape":case"lineWidth":case"scatterPattern":case"scatterColorSet":case"scatterReverseColors":break;default:t[i.nodeName]=i.nodeValue}}return t},canRefreshReport:function(e){var t=e.getVizDataReq();for(var n=0;n<t.length;n++)if(t[n].required==1&&e.findGemsByGembarId(t[n].id).length==0)return!1;switch(e.visualization.id){case"ccc_heatgrid":return e.findGemsByGembarId("color").length>0||e.findGemsByGembarId("size").length>0;case"ccc_barline":return e.findGemsByGembarId("measures").length>0||e.findGemsByGembarId("measuresLine").length>0}return!0}}),dojo.declare("analyzer.CCCVizConfig",[analyzer.ColorConfiguration],{_processModelValueChange:function(e,n){t.debug>=3&&t.log("ANALYZER MODEL EVENT "+e.id+": "+JSON.stringify(n.newVal)),this.report.visualization.args[e.id]=n.newVal},onModelEvent:function(e,t,n,r){n=="value"&&this._processModelValueChange(t,r),this.inherited(arguments)},_setScalingType:function(e){this.report.visualization.args.colorScaleType=e},_setColorRange:function(e){this.report.visualization.args.colorRange=e},getConfiguration:function(){var e=this.inherited(arguments);return e}}),dojo.declare("analyzer.CCCHeatgridVizConfig",[analyzer.CCCVizConfig],{onModelEvent:function(e,t,n,r){switch(n){case"insertAt":case"gems":this._updateOptions(e)}this.inherited(arguments)},updateConfiguration:function(e){this._updateOptions(e)},_updateOptions:function(e){var t=e.byId("color"),n=e.byId("size"),r=t.gems.length+n.gems.length;t.required=r==0,n.required=r==0}}),dojo.declare("analyzer.CCCBarLineVizConfig",[analyzer.CCCVizConfig],{onModelEvent:function(e,t,n,r){switch(n){case"insertAt":case"gems":this._updateMeasuresOptions(e)}this.inherited(arguments)},updateConfiguration:function(e){this._updateMeasuresOptions(e),this.inherited(arguments)},_updateMeasuresOptions:function(e){var t=e.byId("measures"),n=e.byId("measuresLine"),r=t.gems.length+n.gems.length;t.required=r==0,n.required=r==0;var i=n.gems.length>0;e.byId("shape").ui.hidden=!i,e.byId("lineWidth").ui.hidden=!i}}),dojo.declare("analyzer.CCCScatterVizConfig",[analyzer.CCCVizConfig],{onModelEvent:function(e,t,n,r){switch(n){case"insertAt":case"gems":this._updateColorRoleOptions(e)}this.inherited(arguments)},updateConfiguration:function(e){this._updateColorRoleOptions(e)},_updateColorRoleOptions:function(e){var t=e.byId("color");t.allowMultiple=!t.gems.length||t.gems[0].type!=="measure";var n=t.gems.length>0&&t.gems[0].type==="measure";e.byId("reverseColors").ui.hidden=!n,e.byId("colorSet").ui.hidden=!n,e.byId("pattern").ui.hidden=!n}});var r=["ccc_bar","ccc_barstacked","ccc_barnormalized","ccc_horzbar","ccc_horzbarstacked","ccc_horzbarnormalized","ccc_pie","ccc_line","ccc_area","ccc_scatter","ccc_barline","ccc_heatgrid"],i={ccc_heatgrid:analyzer.CCCHeatgridVizConfig,ccc_scatter:analyzer.CCCScatterVizConfig,ccc_barline:analyzer.CCCBarLineVizConfig},s=new analyzer.CCCVizHelper;cv.pentahoVisualizations||(cv.pentahoVisualizations=[]),cv.pentahoVisualizationsHelpers||(cv.pentahoVisualizationsHelpers={}),dojo.forEach(r,function(e){cv.pentahoVisualizations.push(pentaho.visualizations.getById(e)),cv.pentahoVisualizationHelpers[e]=s,analyzer.LayoutPanel.configurationManagers["JSON_"+e]=i[e]||analyzer.CCCVizConfig},this)}})}),pen.define("analyzer/oss-module",["cdf/Base","cdf/jquery","cdf/lib/CCC/protovis","cdf/lib/CCC/jquery.tipsy","cdf/lib/CCC/tipsy","cdf/lib/CCC/protovis-msie","cdf/lib/CCC/pvc-d1.0","common-ui/cache/LocalCache","common-ui/vizapi/DataTable","common-ui/vizapi/Events","common-ui/vizapi/VizController","common-ui/repo/pentaho-ajax","common-ui/vizapi/ccc/ccc_wrapper","common-ui/vizapi/ccc/ccc_analyzer_plugin"])